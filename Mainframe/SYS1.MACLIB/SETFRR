*                                                                       00050000
*%/* IF PLS, EXCLUDE THE BAL FORM OF THE MACRO                          00100000
         MACRO                                                          00150000
&NAME    SETFRR    &OPT,&FRRAD=,&PARMAD=,&WRKREGS=,&RELATED=,&CLEAR=,  C00200000
               &MODE=,&EUT=,&INLINE=NO,&ASSIST=NO,&AMODE=CALLER,       C00250000
               &CANCEL=,&OPT2                                     @D1A  00300000
.*                                                                      00350000
.********************************************************************** 00400000
.*                                                                    * 00450000
.*   COPYRIGHT =                                                      * 00483300
.*               5685-001                                             * 00516600
.*               THIS MODULE IS "RESTRICTED MATERIALS OF IBM"         * 00550000
.*               (C) COPYRIGHT IBM CORP. 1980,1988                    * 00600000
.*               LICENSED MATERIALS - PROPERTY OF IBM                 * 00650000
.*                                                                    * 00800000
.*   STATUS = HBB3310                                                 * 00850000
.*                                                                    * 00900000
.*     THE SETFRR MACRO EXPANSION GENERATES CODE WHICH MANIPULATES A  * 00950000
.*     STACK WHEN INLINE=YES IS SPECIFIED.  WHEN INLINE=YES   @G381P2F* 01000000
.*     IS NOT SPECIFIED, THE SETFRR MACRO EXPANSION           @G381P2F* 01050000
.*     GENERATES CODE WHICH CALLS IEAVTSFR TO MANIPULATE      @G381P2F* 01100000
.*     THE CURRENT STACK.                                         @H1C* 01150000
.*                                                                    * 01200000
.*   THERE  ARE TWO STACKS WHICH CAN BE MANIPULATED VIA THE SETFRR    * 01250000
.*   MACRO                                                            * 01300000
.*         1. A STACK FOR FRRS  RUNNING IN SUPERVISOR CONTROL MODE    * 01350000
.*         2. A STACK FOR FRRS RUNNING IN NON-SUPERVISOR CONTROL MODE * 01400000
.*                                                                    * 01450000
.*   THE HEADER FORMAT FOR EACH OF THESE STACKS IS AS FOLLOWS         * 01500000
.*                                                                    * 01550000
.*      NON-SUPERVISOR CONTROL STACK HEADER FORMAT                    * 01600000
.*                                                                    * 01650000
.*       ***********************************************              * 01700000
.*       * ADDRESS OF STACK - 32 BYTES                 *              * 01750000
.*       ***********************************************              * 01800000
.*       *    ADDRESS OF LAST ENTRY IN THE STACK       *              * 01850000
.*       ***********************************************              * 01900000
.*       *  LENGTH OF EACH ENTRY IN THE STACK  (32)    *              * 01950000
.*       ***********************************************              * 02000000
.*       *ADDRESS OF CURRENT FRR ADDRESS IN THE STACK  *              * 02050000
.*       *(INITIALIZED TO THE ADDRESS OF STACK - 32)   *              * 02100000
.*       ***********************************************              * 02150000
.*                                                                    * 02200000
.*      SUPERVISOR CONTROL STACK HEADER FORMAT                        * 02250000
.*                                                                    * 02300000
.*       ***********************************************              * 02350000
.*       * ADDRESS OF STACK                            *              * 02400000
.*       ***********************************************              * 02450000
.*       *    ADDRESS OF LAST ENTRY IN THE STACK       *              * 02500000
.*       ***********************************************              * 02550000
.*       *  LENGTH OF EACH ENTRY IN THE STACK  (32)    *              * 02600000
.*       ***********************************************              * 02650000
.*       *ADDRESS OF CURRENT FRR ADDRESS IN THE STACK  *              * 02700000
.*       *(INITIALIZED TO THE ADDRESS OF THE STACK )   *              * 02750000
.*       ***********************************************              * 02800000
.*                                                                    * 02850000
.* PRIOR TO ISSUING SETFRR THE USER MUST HAVE PERFORMED THE FOLLOWING * 02900000
.*     1.  ESTABLISHED ADDRESSABILITY TO THE PSA(THE FIRST            * 02950000
.*         INSTRUCTION GENERATED BY THE SETFRR EXPANSION REFERENCES   * 03000000
.*         THE PSACSTK FIELD OF THE PSA)                              * 03050000
.*                                                                    * 03100000
.*     2.  HAVE ISSUED THE FRR STACK MAPPING MACRO(IHAFRRS)           * 03150000
.*                                                                    * 03200000
.* CHANGE-ACTIVITY                                            @G381P2F* 03350000
.*         MVS/SYSTEM PRODUCT RELEASE 2 2/21/79               @G381P2F* 03400000
.*                 CROSS MEMORY PARAMETERS (MODE,EUT)         @G381P2F* 03450000
.*                 INTRODUCED OUT-OF-LINE CODE (INLINE)       @G381P2F* 03500000
.*                 RACE CONDITION FIXED                       @G381P2F* 03550000
.*                 INTRODUCED ADD FRR INSTRUCTION (SETFRRI) 4/17/80   * 03600000
.*                                                            @G38LP1S* 03650000
.*                 - USE LA TO OBTAIN NORMAL STACK ADDRESS    @ZM49899* 03700000
.*                 - ADDED OPT2 TO CATCH MISSING PARENS AND   @ZM50139* 03750000
.*                 FIXED OVERFLOW OF COMMENTS WHEN SYMBOLIC   @ZM50139* 03800000
.*                 NAMES ARE USED IN WRKREGS  4/24/79         @ZM50139* 03850000
.*                 - ON ADDFLUSH, CHANGED THE LOAD ADDRESS    @ZMB0044* 03900000
.*                 OF FRRSENTS TO AN ADD OF FRRSELEN TO REG 1 @ZMB0044* 03950000
.*                 TO ADDRESS THE FIRST ENTRY 8/29/79         @ZMB0044* 04000000
.*         MVS/SYSTEM PRODUCT VERSION 2 RELEASE 1             @G860P1S* 04050000
.*                 - ADDED THE AMODE = CALLER OR DEFINED TO   @G860P1F* 04100000
.*                   THE INLINE SETFRR WITH THE AF(ADD-FLUSH) @G860P1F* 04150000
.*                   OPTION FOR USE BY THE DISPATCHER.        @G860P1F* 04200000
.*      $L1=RTM1REC ,JBB2125,821203,PDA8: INVOKE SETFRRP IN PL/S  @L1A* 04250000
.*      $H1=ADVPROC1,JBB2133,830103,PDXB: REMOVE ASSIST SUPPORT   @H1A* 04300000
.*      $L2=AR      ,HBB3310,851101,PDXB: AR SUPPORT                  * 04350000
.*      $D1=DCR0059 ,HBB3310,861029,PDU8: CANCEL KEYWORD SUPPORT  @D1A* 04375000
.*                                                                    * 04400000
.********************************************************************** 04450000
         GBLC  &SYSSPLV                                        @G860P1C 04500000
      SPLEVEL TEST                     INVOKE SPLEVEL MACRO    @G860P1C 04550000
      AIF    ('&SYSSPLV' EQ '1').S370  S/370 LEVEL REQUESTED?  @G860P1C 04600000
      LCLC    &LA                 HOLDS LA OR LAE BY SPLEVEL       @L2A 04650000
      LCLC    &LAA                HOLDS LA OR LAE BY SYSSTATE      @L2A 04700000
&LA   SETC    'LA'                LA INSTRUCTION FOR SP2           @L2A 04750000
&LAA  SETC    'LA'                ASSUME TO USE LA INSTRUCTION     @L2A 04800000
      GBLC     &SYSASCE           ASC ENVIRONMENT                  @L2A 04950000
      SYSSTATE TEST               WHAT IS ASC ENVIRONMENT          @L2A 05000000
      AIF ('&SYSASCE' EQ 'P').USEPRIM PRIMARY, PROCESS NORMALLY    @L2A 05100000
&LA   SETC    'LAE'               USE LAE INSTRUCTION              @L2A 05125000
&LAA  SETC    'LAE'               AR/ANY -- USE LAE INSTRUCTION    @L2A 05150000
.USEPRIM ANOP                                                      @L2A 05200000
*    MACDATE    11/01/85                                           @L2C 05250000
      LCLA    &CTRLNK                                          @G381P2F 05300000
      LCLA    &I                                               @G381P2F 05350000
      LCLA    &J                                               @G381P2F 05400000
      LCLA    &MODFLG                                          @G381P2F 05450000
      LCLB    &B(5)                                            @G381P2F 05500000
      LCLC    &R1                                                       05550000
      LCLC    &R2                                                       05600000
      LCLC    &R3                                                       05650000
      LCLC    &R4                                                       05700000
         LCLC  &LABEL                                          @G38LP1S 05750000
         LCLC  &RX,&RY,&T                                      @G38LP1S 05800000
&J    SETA    N'&MODE                                          @G381P2F 05850000
.*    VERIFY THAT THERE ARE NO POSITIONAL PARAMETERS OTHER     @ZM50139 05900000
.*    THAN OPTION,  THIS COULD OCCUR IF MODE WAS SPECIFIED     @ZM50139 05950000
.*    WITH MORE THAN ONE PARAMETER AND PARENTHESIS WERE NOT    @ZM50139 06000000
.*    USED                                                     @ZM50139 06050000
      AIF    ('&OPT2' NE '').MSG12                             @ZM50139 06100000
         AIF   ('&ASSIST' NE 'YES').ASSTOK   SKIP IF ASSIST NOT WANTED X06150000
                                                               @G38LP1S 06200000
         MNOTE  8,'SETFRR ASSIST NOT SUPPORTED'                    @H1A 06250000
         AGO   .END                     LEAVE MACRO                @H1A 06300000
.*                                                                8@H1D 06350000
.ASSTOK  ANOP  ,                                               @G38LP1S 06400000
.*                                                             @G860P1F 06450000
.*       THE AMODE = DEFINED IS ONLY ALLOWED FOR THE INLINE    @G860P1F 06500000
.*       SETFRR WITH THE AF(ADD-FLUSH) OPTION. THE DISPATCHER  @G860P1F 06550000
.*       IS THE ONLY USER OF IT.                               @G860P1F 06600000
.*                                                             @G860P1F 06650000
         AIF   ('&AMODE' EQ 'CALLER').AMODECL SKIP IF CALLER           X06700000
                                              IS SPECIFIED     @G860P1F 06750000
         AIF   ('&AMODE' NE 'DEFINED').MSG14 INVALID OPTION -          X06800000
                                              ISSUE A MESSAGE  @G860P1F 06850000
         AIF   ('&OPT' NE 'AF').MSG15  ADD-FLUSH IS REQUIRED   @G860P1F 06900000
         AIF   ('&INLINE' NE 'YES' AND '&INLINE' NE 'Y').MSG9          X06950000
                                      INLINE = YES IS REQUIRED @G860P1F 07000000
.AMODECL ANOP  ,                                               @G860P1F 07050000
.*    VERIFY VALID OPTION SPECIFIED FOR CLEAR KEYWORD                   07100000
.C1   AIF    ('&CLEAR' EQ '' OR '&CLEAR' EQ 'Y' OR '&CLEAR' EQ 'N').C2  07150000
      AIF    ('&CLEAR' EQ 'YES' OR '&CLEAR' EQ 'NO').C2                 07200000
      AIF    ('&OPT' EQ 'A').CLEARY                            @G38LP2F 07250000
.*    DEFAULT FOR REPLACE AND ADDFLUSH IS CLEAR=NO             @G38LP2F 07300000
      MNOTE  0,'INVALID CLEAR OPTION, CLEAR=NO ASSUMED'        @G38LP2F 07350000
         AGO      .C2                                          @G38LP2F 07400000
.CLEARY  ANOP  ,                                               @G38LP2F 07450000
.*    DEFAULT FOR ADD IS CLEAR=YES                             @G38LP2F 07500000
      MNOTE  0,'INVALID CLEAR OPTION, CLEAR=YES ASSUMED'       @G38LP2F 07550000
         AGO      .C2                                                   07600000
.C4      MNOTE      8,'** PARMAD MUST BE SPECIFIED WITH CLEAR OPTION'   07650000
         MEXIT                                                          07700000
.C2      AIF       ('&CLEAR' NE '' AND '&PARMAD' EQ '').C4              07750000
         AIF       ('&WRKREGS' EQ '').MSG1            CHECK TO SEE IF   07800000
.*                                                    WORK REGISTERS    07850000
.*                                                    ARE SPECIFIED     07900000
         AIF   ('&INLINE' EQ 'NO' OR '&INLINE' EQ 'N').OUTLINE          07950000
.*                                          BRANCH IF INLINE=YES WAS    08000000
.*                                          NOT SPECIFIED      @G381P2F 08050000
         AIF   ('&INLINE' NE 'YES' AND '&INLINE' NE 'Y').MSG9           08100000
.*                                          ISSUE MESSAGE IF &INLINE    08150000
.*                                          IS SPECIFIED INCORRECTLY    08200000
.*                                                             @G381P2F 08250000
         AIF   ('&MODE' NE '' AND '&MODE(1)' NE 'HOME').MSG7   @G381P2F 08300000
         AIF   ('&MODE' NE '' AND &J GT 1).MSG7                @G381P2F 08350000
.*                                          ISSUE MESSAGE IF &MODE      08400000
.*                                          IS SPECIFIED INCORRECTLY    08450000
.*                                          WITH INLINE=YES    @G381P2F 08500000
         AIF   ('&CANCEL' NE '').MSG16      CANCEL KEYWORD NOT     @D1A 08516600
.*                                          SUPPORTED FOR INLINE FORM   08533200
         AIF   ('&EUT' NE '').MSG6                             @G381P2F 08550000
.*                                          ISSUE MESSAGE IF &EUT       08600000
.*                                          IS SPECIFIED WITH           08650000
.*                                          INLINE=YES         @G381P2F 08700000
         AIF       ('&WRKREGS'(1,1) NE '(' OR N'&WRKREGS NE 2).MSG2     08750000
.*                                                    IF &WRKREGS IS    08800000
.*                                                    SPECIFIED BUT     08850000
.*                                                    INVALIDLY ISSUE   08900000
.*                                                    ERROR MESSAGE.    08950000
.*    SET UP LOCAL CHARACTER FOR USE IN EXPANSIONS                      09000000
&R1    SETC    '&WRKREGS(1)'                                            09050000
&R2    SETC    '&WRKREGS(2)'                                            09100000
&R3    SETC    '&PARMAD(1)'                                             09150000
&R4    SETC    '&FRRAD(1)'                                              09200000
.*                                                    OTHERWISE CHECK   09250000
.*                                                    &OPT FOR A VALID  09300000
.*                                                    OPTION            09350000
         AIF       ('&OPT' EQ 'A' OR '&OPT' EQ 'R').ADREP               09400000
         AIF       ('&OPT' EQ 'D' OR '&OPT' EQ 'P').EXPAND              09450000
         AIF       ('&OPT' EQ 'F').FLUSH                                09500000
         AIF       ('&OPT' EQ 'AF').ADFL  ADD/FLUSH OPTION              09550000
.INVOPT  MNOTE     12,'INVALID OPTION &OPT SPECIFIED'          @G38LP1S 09600000
.*                                                    MESSAGE STATING   09650000
.*                                                    INVALID OPTION    09700000
         AGO       .END                               STOP EXPANSION    09750000
.ADREP   AIF       ('&FRRAD' EQ '').MSG3              ISSUE MESSAGE IF  09800000
.*                                                    &FRRAD  IS NOT    09850000
.*                                                    SPECIFIED FOR     09900000
.*                                                    THE ADD/REPLACE   09950000
.*                                                    OPTION            10000000
         AGO       .EXPAND1                                             10050000
.EXPAND  ANOP                                         BEGIN EXPANSION   10100000
         AIF       ('&FRRAD' NE '' OR '&PARMAD' NE '').WARN             10150000
         AGO       .EXPAND1                                             10200000
.WARN    MNOTE     *,'FRRAD AND/OR PARMAD SPECIFIED FOR DELETE/PURGE'   10250000
         MNOTE     0,'FRRAD AND/OR PARMAD IGNORED-DELETE/PURGE HONORED' 10300000
.*                                                             @G38LP2F 10350000
.EXPAND1 ANOP                                                           10400000
&NAME    L     &R1,PSACSTK-PSA(0,0)         ADDRESS OF CURRENT STACK    10450000
         AIF       ('&OPT' EQ 'P').PURGE              GO EXPAND FOR A   10500000
.*                                                    PURGE OF THE FRR  10550000
.*                                                    STACK             10600000
         AIF       ('&OPT' EQ 'A').ADD   GO TO ADD ROUTINE              10650000
         L     &R2,FRRSCURR-FRRS(&R1,0)    CURRENT ELEMENT ADDRESS @L2C 10700000
         CL    &R2,FRRSEMP-FRRS(&R1,0)      IS THE FRR STACK EMPTY @L2C 10750000
         AIF       ('&OPT' EQ 'R').BRANCH             IF OPTION IS      10800000
.*                                                    REPLACE EXPAND    10850000
.*                                                    AT .BRANCH        10900000
         BE    *+12                         YES, DO NOT DELETE ENTRY    10950000
         SL    &R2,FRRSELEN-FRRS(&R1,0)     DECREMENT CURRENT          *11000000
                                            ADDRESS                @L2C 11050000
         AGO       .UPDATE                                              11100000
.ADD     L     &R2,FRRSELEN-FRRS(&R1,0)     LENGTH OF FRR STACK        *11150000
                                            ENTRY                  @L2C 11200000
.*                                          (USE FRRSELEN INSTEAD OF    11250000
.*                                           OF 32)            @G381P2F 11300000
         AL    &R2,FRRSCURR-FRRS(&R1,0)     COMPUTE NEXT ENTRY         *11350000
                                            ADDRESS                @L2C 11400000
         CL    &R2,FRRSLAST-FRRS(&R1,0)     WILL STACK OVERFLOW    @L2C 11450000
         BH    PSALSFCC-PSA(0,0)            YES, ISSUE 07D ABEND        11500000
         AGO       .COMMON1                                             11550000
.BRANCH  BNE   *+8                          NO, SKIP UPDATE    @G381P2F 11600000
.COMMON  AL    &R2,FRRSELEN-FRRS(&R1,0)    COMPUTE NEXT ENTRY ADDR @L2C 11650000
.COMMON1 ANOP                                                  @G381P2F 11700000
         AIF        ('&FRRAD'(1,1) EQ '(').STFRR                        11750000
         AIF        (T'&FRRAD EQ 'N').MSG4                              11800000
         ICM   &R1,15,&FRRAD             PUT FRR ADDRESS       @G860P1C 11850000
*                                        IN REGISTER           @G860P1C 11900000
         BSM   &R1,0                     SAVE ADDRESS MODE     @G860P1C 11950000
*                                        OF FRR ROUTINE        @G860P1C 12000000
         ST    &R1,FRRSFRRA-FRRSENTR(&R2,0) ADD ADDR TO STACK      @L2C 12050000
         L     &R1,PSACSTK-PSA(0,0)      ADDR OF CURRENT STACK @G860P1C 12100000
         AGO         .PMCHK                                             12150000
.STFRR   ANOP                                                  @G860P1C 12200000
         BSM   &R4,0                     SAVE ADDRESS MODE     @G860P1C 12250000
*                                        OF FRR ROUTINE        @G860P1C 12300000
         ST    &R4,FRRSFRRA-FRRSENTR(&R2,0) ADD ADDR TO STACK      @L2C 12350000
.PMCHK   AIF    ('&PARMAD' EQ '' ).UPDATE                      @G381P2F 12400000
.*                             DETERMINE IF PARMS ARE SPECIFIED         12450000
         AIF        ('&PARMAD'(1,1) EQ '(').LPARM                       12500000
         AIF        (T'&PARMAD EQ 'N').MSG4                             12550000
         AIF     ('&OPT' EQ 'R' AND '&CLEAR' EQ 'Y').C5                 12600000
         AIF     ('&OPT' EQ 'R' AND '&CLEAR' EQ 'YES').C5               12650000
         AIF       ('&OPT' NE 'A').NOZERO1            IS THIS THE       12700000
.*                                                    ADD OPTION        12750000
.*                                                   YES DO FOLLOWING   12800000
         AIF   ('&CLEAR' EQ 'N' OR '&CLEAR' EQ 'NO').NOZERO1            12850000
.C5      AIF   ('&SYSASCE' EQ 'P').NOLAE1                          @L2A 12900000
         LAE   &R2,0(&R2,0)                 SET ALET TO 0          @L2A 12950000
.NOLAE1  XC    FRRSPARM-FRRSENTR(24,&R2),FRRSPARM-FRRSENTR(&R2)         13000000
*                                           ZERO FRR PARM AREA          13050000
.NOZERO1 ST    &R2,FRRSCURR-FRRS(&R1,0)     UPDATE CURRENT             *13100000
                                            ENTRY ADDRESS          @L2C 13150000
         LA    &R2,FRRSPARM-FRRSENTR(&R2,0) RETURN PARM AREA       @L2C 13200000
         ST    &R2,&PARMAD                  ADDRESS TO USER             13250000
         AGO        .END                                                13300000
.LPARM   ANOP                                                           13350000
         AIF      ('&OPT' EQ 'R' AND '&CLEAR' EQ 'Y').C6                13400000
         AIF      ('&OPT' EQ 'R' AND '&CLEAR' EQ 'YES').C6              13450000
         AIF       ('&OPT' NE 'A').NOZERO2            IS THIS THE       13500000
.*                                                    ADD OPTION        13550000
.*                                                   YES DO FOLLOWING   13600000
         AIF   ('&CLEAR' EQ 'N' OR '&CLEAR' EQ 'NO').NOZERO2            13650000
.C6      XC    FRRSPARM-FRRSENTR(24,&R2),FRRSPARM-FRRSENTR(&R2)         13700000
*                                           ZERO FRR PARM AREA          13750000
.NOZERO2 ST    &R2,FRRSCURR-FRRS(&R1,0)     UPDATE CURRENT             *13800000
                                            ENTRY ADDRESS          @L2C 13850000
         &LAA  &R3,FRRSPARM-FRRSENTR(&R2,0) ADDR OF PARM AREA      @L2C 13900000
         AGO       .END                                                 13950000
.PURGE   L     &R2,FRRSEMP-FRRS(&R1,0)      LOAD EMPTY STACK ADDR  @L2C 14000000
.UPDATE  ST    &R2,FRRSCURR-FRRS(&R1,0)     UPDATE CURRENT STACK       *14050000
                                            ENTRY                  @L2C 14100000
         AIF       ('&OPT' NE 'P').END      FINISHED IF NOT             14150000
*                                           PURGE              @G382P2F 14200000
         CL    &R1,PSANSTK-PSA(0,0)         IS THIS THE NORMAL          14250000
*                                           STACK              @G382P2F 14300000
         BNE   *+8                          NO, BRANCH         @G382P2F 14350000
         NI    PSAMFLGS-PSA(0),X'7F'        ENSURE PSANSS FLAG          14400000
*                                           IS OFF             @G382P2F 14450000
         AGO       .END                                                 14500000
.FLUSH   ANOP                                                           14550000
&NAME    L     &R1,PSASTAK-PSA(0,0)               NORMAL STACK PTR      14600000
         ST    &R1,PSASTAK-PSA+FRRSCURR-FRRS(0,0) PURGE STACK           14650000
         MVI   PSASTAK-PSA+FRRSRTMW-FRRS(0),X'00' ZERO RECURSION BYTE   14700000
         NI    PSAMFLGS-PSA(0),X'7F'             ENSURE PSANSS          14750000
*                                                FLAG IS OFF   @G381P2F 14800000
         AGO   .END                                                     14850000
.ADFL    ANOP                                                           14900000
         AIF   ('&FRRAD' EQ '').MSG3  INSURE FRR AD IS SPECIFIED        14950000
         AIF   ('&FRRAD'(1,1) EQ '(').B10                               15000000
         AIF   (T'&FRRAD EQ 'N').MSG4                                   15050000
&R4      SETC  '&WRKREGS(2)'   SET WORK REG                             15100000
&NAME    L     &R4,&FRRAD                        LOAD FRR ADDRESS       15150000
         MVI   PSASTAK-PSA+FRRSRTMW-FRRS(0),0    ZERO RECURSION BYTE    15200000
         AGO  .B11                                                      15250000
.B10     ANOP                                                           15300000
&NAME    MVI   PSASTAK-PSA+FRRSRTMW-FRRS(0),0    ZERO RECURSION BYTE    15350000
.B11     NI    PSAMFLGS-PSA(0),X'7F'             ENSURE PSANSS          15400000
*                                                FLAG IS OFF   @G381P2F 15450000
         L     &R1,PSASTAK-PSA+FRRSEMP-FRRS(,0)  EMPTY STACK ADDRESS    15500000
*                                                              @G381P2F 15550000
         ST    &R1,PSASTAK-PSA+FRRSCURR-FRRS(,0) RESET STACK            15600000
         AL    &R1,PSASTAK-PSA+FRRSELEN-FRRS(,0) FIRST ENTRY ADDRESS    15650000
*                                                              @ZMB0044 15700000
         AIF   ('&AMODE' EQ 'DEFINED').AMODEFD  FRR ADDRESS IS ALREADY X15750000
                                              POINTER DEFINED  @G860P1F 15800000
         BSM   &R4,0          SAVE ADDRESS MODE OF FRR ROUTINE @G860P1C 15850000
.AMODEFD ANOP  ,                                               @G860P1F 15900000
         ST    &R4,FRRSFRRA-FRRSENTR(&R1,0)   ADD ADDRESS TO STACK @L2C 15950000
         AIF   ('&PARMAD' EQ '').C14    IF NO PARMS REQUEST BRANCH      16000000
.*                                      TO RESET THE STACK     @G381P2F 16050000
         AIF    ('&CLEAR' NE 'Y' AND '&CLEAR' NE 'YES').C14    @G381P2F 16100000
         AIF   ('&SYSASCE' EQ 'P').NOLAE2                          @L2A 16150000
         LAE   &R1,0(&R1,0)             SET ALET                   @L2A 16200000
.NOLAE2  ANOP                                                      @L2A 16250000
         XC    FRRSPARM-FRRSENTR(24,&R1),FRRSPARM-FRRSENTR(&R1)         16300000
*                                                CLEAR PARM AREA        16350000
.C14     ST    &R1,PSASTAK-PSA+FRRSCURR-FRRS(,0) RESET STACK            16400000
*                                                              @G381P2F 16450000
         AIF   ('&PARMAD' EQ '').END   FINISHED IF NO PARMS REQUEST     16500000
.*                                                             @G381P2F 16550000
         AIF   ('&PARMAD'(1,1) EQ '(').C10                              16600000
         AIF   (T'&PARMAD EQ 'N').MSG4                                  16650000
         AGO   .C13                                                     16700000
.C10     &LAA  &R3,FRRSPARM-FRRSENTR(&R1,0)      FRR PARM ADDRESS  @L2C 16750000
         AGO   .END                                                     16800000
.C13     LA    &R2,FRRSPARM-FRRSENTR(&R1,0)      FRR PARM ADDRESS  @L2C 16850000
         ST    &R2,&PARMAD                       RETURN TO USER         16900000
         AGO   .END                                                     16950000
.*                                        ***************************   17000000
.OUTLINE ANOP                                                  @G381P2F 17050000
.*                                        FOLLOWING IS CODE TO          17100000
.*                                        BRANCH TO IEAVTSFR   @G381P2F 17150000
.*                                        AND PERFORM ADD FRR  @G38LP1S 17200000
.*                                        INSTRUCTION          @G38LP1S 17250000
.*                                                                      17300000
.*    SET UP LOCAL CHARACTER FOR USE IN EXPANSIONS                      17350000
&I       SETA  1                 INIT INDEX FOR MODE           @G381P2F 17400000
&MODFLG  SETA  0                 INIT MODE FLAGS               @G381P2F 17450000
&CTRLNK  SETA  0                 INIT BRANCH TABLE CTR         @G381P2F 17500000
         AIF   ('&SYSASCE' EQ 'P').KEEPCTR                         @L2A 17550000
&CTRLNK  SETA  72                RESET TO AR TABLE                 @L2A 17600000
.KEEPCTR ANOP                                                      @L2A 17650000
&B(1)    SETB  0                 INIT MODE=HOME IND            @G381P2F 17700000
&B(2)    SETB  0                 INIT MODE=FULLXM IND          @G381P2F 17750000
&B(3)    SETB  0                 INIT MODE=PRIMARY IND         @G381P2F 17800000
&B(4)    SETB  0                 INIT MODE=LOCAL IND           @G381P2F 17850000
&B(5)    SETB  0                 INIT MODE=GLOBAL IND          @G381P2F 17900000
&R1      SETC  '&WRKREGS(1)'                                   @G381P2F 17950000
&R3      SETC  '&PARMAD(1)'                                    @G381P2F 18000000
&R4      SETC  '&FRRAD(1)'                                     @G381P2F 18050000
.*                                                    OTHERWISE CHECK   18100000
.*                                                    &OPT FOR A VALID  18150000
.*                                                    OPTION            18200000
         AIF       ('&OPT' EQ 'A' OR '&OPT' EQ 'R').ADREP2     @G381P2F 18250000
         AIF       ('&OPT' EQ 'D' OR '&OPT' EQ 'P').EXPAND2    @G381P2F 18300000
         AIF       ('&OPT' EQ 'F').FLUSH2                      @G381P2F 18350000
         AIF       ('&OPT' EQ 'AF').ADFL2  ADD/FLUSH OPTION    @G381P2F 18400000
         MNOTE     12,'INVALID OPTION &OPT SPECIFIED'                   18450000
.*                                                    MESSAGE STATING   18500000
.*                                                    INVALID OPTION    18550000
         AGO       .END                               STOP EXPANSION    18600000
.*                                                                      18650000
.ADREP2  ANOP                              SYNTAX CHECK FOR ADD         18700000
.*                                         AND REPLACE         @G381P2F 18750000
.*                                                                      18800000
         AIF       ('&FRRAD' EQ '').MSG3              ISSUE MESSAGE IF  18850000
.*                                                    &FRRAD  IS NOT    18900000
.*                                                    SPECIFIED FOR     18950000
.*                                                    THE ADD/REPLACE   19000000
.*                                                    OPTION   @G381P2F 19050000
         AIF       ('&MODE' NE '').MODELP  CHECK MODE          @G381P2F 19100000
&B(1)    SETB      1                      IND HOME DEFAULTED   @G381P2F 19150000
         AGO       .CHKEUT                                              19200000
.MODELP  ANOP                              MODE LOOP WILL SCAN THE      19250000
.*                                         MODE OPTIONS, SYNTAX CHECK   19300000
.*                                         AND INDICATE THE OPTIONS     19350000
.*                                         CHOSEN              @G381P2F 19400000
         AIF       ('&MODE(&I)' NE 'HOME').FULL  IF NOT HOME, CHECK     19450000
.*                                               FOR FULLXM    @G381P2F 19500000
         AIF       (&B(2) OR &B(3)).MSG10  ISSUE MESSAGE IF FULLXM OR   19550000
.*                                         PRIMARY HAS ALSO BEEN        19600000
.*                                         SPECIFIED           @G381P2F 19650000
&B(1)    SETB      1                       IND HOME SPEC       @G381P2F 19700000
         AGO       .INITLP                                     @G381P2F 19750000
.FULL    ANOP                                                  @G381P2F 19800000
         AIF       ('&MODE(&I)' NE 'FULLXM').PRIM IF NOT FULLXM,CHECK   19850000
.*                                               FOR PRIMARY   @G381P2F 19900000
         AIF       (&B(2)).INITLP          IGNORE IF FULLXM WAS         19950000
.*                                         SPECIFIED BEFORE    @G381P2F 20000000
         AIF       (&B(1) OR &B(3)).MSG10  ISSUE MESSAGE IF HOME OR     20050000
.*                                         PRIMARY HAS ALSO BEEN        20100000
.*                                         SPECIFIED           @G381P2F 20150000
&MODFLG  SETA      &MODFLG+8               IND FULLXM          @G381P2F 20200000
&B(2)    SETB      1                       IND FULLXM SPEC     @G381P2F 20250000
         AGO       .INITLP                                     @G381P2F 20300000
.PRIM    ANOP                                                  @G381P2F 20350000
         AIF       ('&MODE(&I)' NE 'PRIMARY').LCL IF NOT PRIMARY, CHK   20400000
.*                                                FOR LOCAL    @G381P2F 20450000
         AIF       (&B(3)).INITLP          IGNORE IF PRIMARY WAS        20500000
.*                                         SPECIFIED BEFORE    @G381P2F 20550000
         AIF       (&B(1) OR &B(2)).MSG10  ISSUE MESSAGE IF HOME OR     20600000
.*                                         FULLXM HAS ALSO BEEN         20650000
.*                                         SPECIFIED           @G381P2F 20700000
&MODFLG  SETA      &MODFLG+4               IND PRIMARY         @G381P2F 20750000
&B(3)    SETB      1                       IND PRIMARY SPEC    @G381P2F 20800000
         AGO       .INITLP                                     @G381P2F 20850000
.LCL     ANOP                                                  @G381P2F 20900000
         AIF       ('&MODE(&I)' NE 'LOCAL').GLB  IF NOT LOCAL, CHECK    20950000
.*                                               FOR GLOBAL    @G381P2F 21000000
         AIF       (&B(4)).INITLP          IGNORE IF LOCAL WAS          21050000
.*                                         SPECIFIED BEFORE    @G381P2F 21100000
&MODFLG  SETA      &MODFLG+2               IND LOCAL           @G381P2F 21150000
&B(4)    SETB      1                       IND LOCAL SPEC      @G381P2F 21200000
         AGO       .INITLP                                     @G381P2F 21250000
.GLB     ANOP                                                  @G381P2F 21300000
         AIF       ('&MODE(&I)' NE 'GLOBAL').MSG10  IF NOT GLOBAL,      21350000
.*                                               ISSUE MESSAGE THAT     21400000
.*                                               MODE IS SPECIFIED      21450000
.*                                               INCORRECTLY   @G381P2F 21500000
         AIF       (&B(5)).INITLP          IGNORE IF GLOBAL WAS         21550000
.*                                         SPECIFIED BEFORE    @G381P2F 21600000
&MODFLG  SETA      &MODFLG+1               IND GLOBAL          @G381P2F 21650000
&B(5)    SETB      1                       IND GLOBAL SPEC     @G381P2F 21700000
.INITLP  ANOP                                                  @G381P2F 21750000
&I       SETA      &I+1                    INCR ELEMENT CTR    @G381P2F 21800000
         AIF       (&I LE &J).MODELP       IF MORE ELEMENTS, LOOP TO    21850000
.*                                         SCAN THE NEXT ONE   @G381P2F 21900000
.*                                                                      21950000
.CHKEUT  ANOP                              CHECK EUT           @G382P2F 22000000
.*                                                                      22050000
         AIF       ('&EUT' NE '' AND '&EUT' NE 'Y' AND                 S22100000
                   '&EUT' NE 'YES').MSG8    ISSUE MESSAGE IF &EUT       22150000
.*                                          IS SPECIFIED INCORRECTLY    22200000
.*                                                             @G382P2F 22250000
         AIF       ('&CANCEL' NE '' AND '&CANCEL' NE 'YES' AND         S22258300
                   '&CANCEL' NE 'NO').MSG17                        @D1A 22266600
.*                                          ISSUE MESSAGE IF CANCEL     22274900
.*                                          IS SPECIFIED INCORRECTLY    22283200
.*                                                                 @D1A 22291500
         AGO        .EXPAND3                                   @G382P2F 22300000
.*                                                                      22350000
.EXPAND2 ANOP                             SYNTAX CHECK FOR DELETE       22400000
.*                                        AND PURGE            @G381P2F 22450000
.*                                                                      22500000
         AIF       ('&FRRAD' EQ '' AND '&PARMAD' EQ '').WARN2           22550000
.*                                                             @G381P2F 22600000
         MNOTE     *,'FRRAD AND/OR PARMAD SPECIFIED FOR DELETE/PURGE'   22650000
.*                                                             @G381P2F 22700000
         MNOTE     0,'FRRAD AND/OR PARMAD IGNORED-DELETE/PURGE HONORED' 22750000
.*                                                             @G38LP2F 22800000
.WARN2   ANOP                                                  @G381P2F 22850000
         AIF       ('&WRKREGS'(1,1) NE '(' OR N'&WRKREGS NE 2).MSG2     22900000
.*                                       IF &WRKREGS IS SPECIFIED BUT   22950000
.*                                       INVALIDLY, ISSUE ERROR         23000000
.*                                       MESSAGE.              @G382P2F 23050000
&R2    SETC    '&WRKREGS(2)'                                   &G382P2F 23100000
         AIF       ('&MODE' EQ '').WARN3                       @G381P2F 23150000
         MNOTE     0,'MODE SPECIFIED FOR DELETE/PURGE - MODE IGNORED'   23200000
.*                                                             @G38LP2F 23250000
.WARN3   ANOP                                                  @G381P2F 23300000
         AIF       ('&CANCEL' NE '' AND '&OPT' EQ 'P').MSG18       @D1A 23320000
         AIF       ('&CANCEL' EQ '').EUTCHK                        @D1A 23340000
         MNOTE     0,'CANCEL SPECIFIED FOR DELETE- CANCEL IGNORED' @D1A 23360000
.EUTCHK  AIF       ('&EUT' NE '' AND '&OPT' EQ 'P').MSG11          @D1C 23380000
         AIF       ('&EUT' EQ '').CHKEUT                       @G382P2F 23400000
         MNOTE     0,'EUT SPECIFIED FOR DELETE - EUT IGNORED'  @G38LP2F 23450000
.*                                                                      23500000
.EXPAND3 ANOP                          START CODE GENERATION FOR        23550000
.*                                     ADD, REPLACE, DELETE, AND        23600000
.*                                     PURGE                   @G381P2F 23650000
&LABEL   SETC  '&NAME'        LABEL REQUESTED BY CALLER        @G38LP1S 23700000
.*                                                                1@H1D 23750000
&LABEL   L     &R1,PSACSTK-PSA(0,0)      ADDR OF CURRENT STACK @G38LP1S 23800000
         AIF   ('&SYSASCE' EQ 'P').NOLAE3                          @L2A 23850000
         LAE   &R1,0(&R1,0)              SET ALET                  @L2A 23900000
.NOLAE3  ANOP                                                           23950000
         AIF       ('&OPT' EQ 'D' OR '&OPT' EQ 'P').CHKMPTY  BRANCH     24000000
.*                                        IF DELETE OR PURGE   @G381P2F 24050000
         AIF       ('&EUT' EQ '').SAVREGS  BRANCH IF NOT EUT   @G381P2F 24100000
         CL    &R1,PSANSTK-PSA(0,0)      IS CURRENT STACK THE           24150000
*                                        NORMAL STACK          @G382P2F 24200000
         BNE   *+8                       NO, BRANCH            @G382P2F 24250000
         OI    PSAMFLGS-PSA(0),X'80'     IND EUT TYPE FRR      @G381P2F 24300000
         AGO   .SAVREGS                                            @H1C 24350000
.CHKMPTY ANOP                                                  @G382P2F 24400000
         L     &R2,FRRSCURR-FRRS(&R1,0)     ADDR OF CURRENT            *24450000
                                            ELEMENT                @L2C 24500000
         CL    &R2,FRRSEMP-FRRS(&R1,0)      IS THE FRR STACK           *24550000
                                            EMPTY                  @L2C 24600000
         BE    A&SYSNDX                 YES, NO NEED TO UPDATE     @L2C 24650000
         AGO        .SAVREGS                                   @G381P2F 24700000
.*                                                                      24750000
.ADFL2   ANOP                          SYNTAX CHECK FOR ADD/FLUSH       24800000
.*                                                             @G381P2F 24850000
.*                                                                      24900000
         AIF       ('&FRRAD' EQ '').MSG3              ISSUE MESSAGE IF  24950000
.*                                                    &FRRAD  IS NOT    25000000
.*                                                    SPECIFIED FOR     25050000
.*                                                    THE ADD/FLUSH     25100000
.*                                                    OPTION   @G381P2F 25150000
         AIF       ('&MODE' EQ '').ADFLEUT                     @G381P2F 25200000
         MNOTE     0,'MODE SPECIFIED FOR ADDFLUSH - MODE IGNORED'       25250000
.*                                                             @G38LP2F 25300000
.ADFLEUT ANOP                                                  @G381P2F 25350000
         AIF       ('&EUT' NE '').MSG11                        @G381P2F 25400000
.ADFLCNL ANOP                                                      @D1A 25410000
         AIF       ('&CANCEL' NE '').MSG18                         @D1A 25420000
.*                                     CANCEL NOT SUPPORTED ON          25430000
.*                                     ADD-FLUSH OPTION            @D1A 25440000
.*                                                                      25450000
.*                                     START CODE GENERATION FOR        25500000
.*                                     ADDFLUSH                @G381P2F 25550000
.*                                                                      25600000
&NAME    &LAA  &R1,PSASTAK-PSA(0,0)      NORMAL STACK ADDR         @L2C 25650000
.*                                                             @G381P2F 25700000
.SAVREGS ANOP                          CONTINUE WITH CODE GENERATION    25750000
.*                                     FOR ADD, REPLACE, ADDFLUSH,      25800000
.*                                     DELETE, AND PURGE       @G381P2F 25850000
.*                                                             @G381P2F 25900000
         AIF   ('&SYSASCE' EQ 'P').NOSTAM1                         @L2A 25950000
         STAM  14,3,64(&R1)              SAVE ARS 14-3             @L2A 26000000
.NOSTAM1 ANOP                                                      @L2A 26050000
         STM   14,3,16(&R1)              SAVE REGS 14-3        @G381P2F 26100000
         AIF        ('&OPT' EQ 'D' OR '&OPT' EQ 'P').DELPUR    @G381P2F 26150000
.*                                                             @G381P2F 26200000
.*                                   IF OPTION IS ADD, REPLACE, OR      26250000
.*                                   ADD/FLUSH, SAVE &FRRAD    @G381P2F 26300000
.*                                                             @G381P2F 26350000
         AIF        ('&FRRAD'(1,1) EQ '(').STFRR2 IF A REG WAS          26400000
.*                                                SPECIFIED    @G381P2F 26450000
         AIF        (T'&FRRAD EQ 'N').MSG4                     @G381P2F 26500000
         L     0,&FRRAD                  LOAD FRR ADDRESS      @G381P2F 26550000
         AGO         .LDREG1                                   @G381P2F 26600000
.STFRR2  ANOP                                                  @G381P2F 26650000
         AIF        (T'&FRRAD NE 'N').LDREG0  IF NOT SELF-DEFINING,     26700000
.*                                          BRANCH             @G381P2F 26750000
         AIF        (&R4 EQ 0).LDREG1       IF FRR ADDR PASSED IN       26800000
.*                                          REG 0, BRANCH      @G381P2F 26850000
.LDREG0  ANOP                                                  @G381P2F 26900000
         LR    0,&R4                     LOAD FRR ADDRESS      @G381P2F 26950000
.LDREG1  ANOP                                                  @G381P2F 27000000
         AIF        (T'&WRKREGS(1) NE 'N').LDREG1A  IF NOT SELF-        27050000
.*                                          DEFINING, BRANCH   @G381P2F 27100000
         AIF        (&R1 EQ 1).NTRYAD       IF FIRST WORK REG PASSED    27150000
.*                                          IS REG 1, BRANCH   @G381P2F 27200000
.LDREG1A ANOP                                                  @G381P2F 27250000
         AIF   ('&SYSASCE' EQ 'P').DOLR                            @L2A 27300000
         LAE   1,0(&R1,0)                COPY WITH ALET            @L2A 27350000
         AGO   .NTRYAD                   SKIP LR                   @L2A 27400000
.DOLR    LR    1,&R1                     SAVE STACK PTR        @G381P2F 27450000
.NTRYAD  ANOP                                                  @G381P2F 27500000
.*                                   CALCULATE ENTRY ADDRESS INTO       27550000
.*                                   IEAVTSFR                  @G381P2F 27600000
.*                                                             @G381P2F 27650000
         AIF   ('&CLEAR' EQ 'Y' OR '&CLEAR' EQ 'YES').CLEAR    @G381P2F 27700000
         AIF   ('&OPT' NE 'A').CHKADFL   DEFAULT FOR ADDFLUSH AND       27750000
.*                                       REPLACE IS CLEAR=NO   @G381P2F 27800000
         AIF   ('&CLEAR' EQ 'N' OR '&CLEAR' EQ 'NO').CHKADFL            27850000
.*                                       DEFAULT FOR ADD IS             27900000
.*                                       CLEAR=YES             @G381P2F 27950000
.CLEAR   ANOP                                                  @G381P2F 28000000
&CTRLNK  SETA    &CTRLNK+4               OFFSET FOR CLEAR=YES      @L2C 28050000
.*                                       (IEAVTSFR BR TABLE)   @G381P2F 28100000
.CHKADFL ANOP                                                  @G381P2F 28150000
         AIF   ('&OPT' NE 'AF').CHKEM    CHK IF ADDFLUSH       @G381P2F 28200000
&CTRLNK  SETA  &CTRLNK+48                OFFSET FOR ADDFLUSH   @G381P2F 28250000
         AGO   .BALR                                           @G381P2F 28300000
.CHKEM   ANOP                                                  @G381P2F 28350000
         AIF   ('&CANCEL' NE 'NO').CHKE                            @D1A 28362500
&MODFLG  SETA  &MODFLG+64                TURN ON CANCEL=NO BIT     @D1A 28375000
.CHKE    ANOP                                                      @D1A 28387500
         AIF   ('&EUT' EQ '').CHKMODE    CHECK FOR MODE IF EUT NOT      28400000
.*                                       SPECIFIED             @G381P2F 28450000
&MODFLG  SETA  &MODFLG+128               IND EUT=YES           @G381P2F 28500000
         AGO   .INDEM                                          @G381P2F 28550000
.CHKMODE ANOP                                                  @G381P2F 28600000
         AIF   (&MODFLG EQ 0).OPTS       BRANCH IF MODE WAS NOT         28650000
.*                                       SPECIFIED OR =HOME    @G381P2F 28700000
.INDEM   ANOP                            IND EUT OR MODE (OTHER THAN    28750000
.*                                       HOME) OR CANCEL WAS            28783300
.*                                       SPECIFIED                 @D1C 28816600
         AIF   (&B(2) OR &B(3)).SAVXM    BRANCH IF MODE=FULLXM OR       28850000
.*                                       PRIMARY WAS SPEC      @G381P2F 28900000
&CTRLNK  SETA  &CTRLNK+8                 OFFSET FOR EUT, MODE OR CANCEL 28950000
.*                                       WITHOUT CROSS MEMORY STATUS    29000000
.*                                       (IEAVTSFR BR TABLE)       @D1C 29050000
         AGO   .INITR2                                         @G381P2F 29100000
.SAVXM   ANOP                                                  @G381P2F 29150000
&CTRLNK  SETA  &CTRLNK+16                OFFSET FOR EUT, MODE OR        29190000
.*                                       CANCEL AND SAVING CROSS MEMORY 29230000
.*                                       STATUS (IEAVTSFR BRANCH TABLE) 29270000
.*                                                                 @D1C 29310000
.INITR2  ANOP                                                  @G381P2F 29350000
         LA    2,&MODFLG                 IND PARAMETERS CHOSEN @G381P2F 29400000
.OPTS    ANOP                                                  @G381P2F 29450000
         AIF   ('&OPT' NE 'R').BALR      CHK IF REPLACE        @G381P2F 29500000
&CTRLNK  SETA  &CTRLNK+24                OFFSET FOR REPLACE    @G381P2F 29550000
         AGO   .BALR                                           @G381P2F 29600000
.*                                                             @G381P2F 29650000
.DELPUR  ANOP                            DELETE OR PURGE       @G381P2F 29700000
         AIF        (T'&WRKREGS(1) NE 'N').LDREG1D  IF NOT SELF-        29750000
.*                                          DEFINING, BRANCH   @G381P2F 29800000
         AIF        (&R1 EQ 1).BRIFPUR      IF FIRST WORK REG PASSED    29850000
.*                                          IS REG 1, BRANCH   @G381P2F 29900000
.LDREG1D ANOP                                                  @G381P2F 29950000
         AIF   ('&SYSASCE' EQ 'P').DOLR2                           @L2A 30000000
         LAE   1,0(&R1,0)                COPY WITH ALET            @L2A 30050000
         AGO   .BRIFPUR                  SKIP LR                   @L2A 30100000
.DOLR2   LR    1,&R1                     SAVE STACK PTR        @G381P2F 30150000
.BRIFPUR ANOP                                                  @G381P2F 30200000
         AIF        ('&OPT' EQ 'P').PURGE2   GO TO PURGE       @G381P2F 30250000
.*                                                             @G381P2F 30300000
&CTRLNK  SETA  &CTRLNK+56                OFFSET FOR DELETE         @L2C 30350000
         AGO   .BALR                                           @G381P2F 30400000
.PURGE2  ANOP                                                  @G381P2F 30450000
&CTRLNK  SETA  &CTRLNK+64                OFFSET FOR PURGE          @L2C 30500000
         AGO   .BALR                                           @G381P2F 30550000
.*                                                                      30600000
.FLUSH2  ANOP                           SYNTAX CHECK AND CODE           30650000
.*                                      GENERATION FOR FLUSH   @G381P2F 30700000
.*                                                                      30750000
         AIF       ('&MODE' EQ '').FLEUT                       @G381P2F 30800000
         MNOTE     0,'MODE SPECIFIED FOR FLUSH - MODE IGNORED'          30850000
.*                                                             @G38LP2F 30900000
.FLEUT   ANOP                                                  @G381P2F 30950000
         AIF       ('&EUT' NE '').MSG11                        @G381P2F 31000000
         AIF       ('&CANCEL' NE '').MSG18                         @D1A 31012500
.*                                       CANCEL NOT ALLOWED ON          31025000
.*                                       FLUSH OPTION              @D1A 31037500
&CTRLNK  SETA  &CTRLNK+68                OFFSET FOR FLUSH          @L2C 31050000
&NAME    &LAA  &R1,PSASTAK-PSA(0,0)      NORMAL STACK ADDR         @L2C 31100000
         AIF   ('&SYSASCE' EQ 'P').NOSTAM2                         @L2A 31150000
         STAM  14,3,64(&R1)              SAVE ARS 14-3             @L2A 31200000
.NOSTAM2 ANOP                                                      @L2A 31250000
         STM   14,3,16(&R1)              SAVE REGS 14-3        @G381P2F 31300000
         AIF        (T'&WRKREGS(1) NE 'N').LDREG1E  IF NOT SELF-        31350000
.*                                          DEFINING, BRANCH   @G381P2F 31400000
         AIF        (&R1 EQ 1).BALR         IF FIRST WORK REG PASSED    31450000
.*                                          IS REG 1, BRANCH   @G381P2F 31500000
.LDREG1E ANOP                                                  @G381P2F 31550000
         AIF   ('&SYSASCE' EQ 'P').DOLR3                           @L2A 31600000
         LAE   1,0(&R1,0)                COPY WITH ALET            @L2A 31650000
         AGO   .BALR                     SKIP LR                   @L2A 31700000
.DOLR3   LR    1,&R1                     SAVE STACK PTR        @G381P2F 31750000
.*                                                                      31800000
.*                                       BALR TO IEAVTSFR      @G381P2F 31850000
.*                                                                      31900000
.BALR    ANOP                                                  @G381P2F 31950000
         L     15,16(0,0)                LOAD CVT ADDRESS      @G381P2F 32000000
         L     15,276(15,0)              ADDR OF IEAVTSFR          @L2C 32050000
         L     15,&CTRLNK.(15,0)         ADDR OF ENTRY POINT       @L2C 32100000
         BALR  14,15                     GO TO IEAVTSFR        @G381P2F 32150000
         AIF       ('&OPT' EQ 'F').LMREGS                      @G382P2F 32200000
         AIF       ('&OPT' EQ 'P' OR '&OPT' EQ 'D').LMNSS      @G382P2F 32250000
.*                                                             @G381P2F 32300000
.*                                 IF OPTION IS ADD, REPLACE, OR        32350000
.*                                 ADDFLUSH CHECK PARMAD       @G381P2F 32400000
.*                                                             @G381P2F 32450000
         AIF   ('&PARMAD' EQ '').LMREGS  CHECK IF PARMAD       @G381P2F 32500000
         AIF   ('&PARMAD'(1,1) EQ '(').C19                     @G381P2F 32550000
         AIF   (T'&PARMAD EQ 'N').MSG4                         @G381P2F 32600000
         LM    14,3,16(1)                RESTORE REGS          @G381P2F 32650000
         AIF   ('&SYSASCE' EQ 'P').NOARLM1                         @L2A 32700000
         LAE   &R1,0(&R1,0)              GET 0 ALET                @L2A 32750000
         LAM   14,3,64(&R1)              RESTORE ARS 14-3          @L2A 32800000
.NOARLM1 ANOP                                                      @L2A 32850000
         L     &R1,FRRSCURR-FRRS(&R1,0)  CURRENT ENTRY             @L2C 32900000
         LA    &R1,FRRSPARM-FRRSENTR(&R1,0) FRR PARM ADDRESS       @L2C 32950000
         ST    &R1,&PARMAD               RETURN ADDR TO USER   @G381P2F 33000000
         AGO   .ASST1                                          @G38LP1S 33050000
.C19     ANOP                                                  @G381P2F 33100000
         AIF   (T'&PARMAD(1) NE 'N').LM1ST  IF NOT SELF-DEFINING,       33150000
.*                                          BRANCH             @G381P2F 33200000
         AIF   ('&SYSASCE' NE 'P' AND T'&R1 NE 'N').LM1ST          @L2A 33250000
         AIF   ('&SYSASCE' NE 'P' AND '&R3' EQ '&R1').LM1ST        @L2A 33300000
         AIF   (&R3 GT 2 AND &R3 LT 14).PARM1ST                @G381P2F 33350000
.LM1ST   ANOP                                                  @G381P2F 33400000
         LM    14,3,16(1)                RESTORE REGS          @G381P2F 33450000
         AIF   ('&SYSASCE' EQ 'P').NOARLM2                         @L2A 33500000
         LAE   &R1,0(&R1,0)              GET 0 ALET                @L2A 33550000
         LAM   14,3,64(&R1)              RESTORE ARS 14-3          @L2A 33600000
.NOARLM2 ANOP                                                      @L2A 33650000
         L     &R1,FRRSCURR-FRRS(&R1,0)  CURRENT ENTRY             @L2C 33700000
         &LAA  &R3,FRRSPARM-FRRSENTR(&R1,0) FRR PARM ADDRESS       @L2C 33750000
         AGO   .ASST1                                          @G38LP1S 33800000
.PARM1ST ANOP                                                  @G381P2F 33850000
         &LAA  &R3,FRRSPARM-FRRSENTR(3,0) ADDR OF PARM AREA        @L2C 33900000
         AIF   (&R3 EQ 3).LMNOT3                               @G381P2F 33950000
.LMREGS  ANOP                                                  @G381P2F 34000000
         LM    14,3,16(1)                RESTORE REGS          @G381P2F 34050000
         AIF   ('&SYSASCE' EQ 'P').NOARLM3                         @L2A 34100000
         LAE   &R1,0(&R1,0)              GET 0 ALET                @L2A 34150000
         LAM   14,3,64(&R1)              RESTORE ARS 14-3          @L2A 34200000
.NOARLM3 ANOP                                                      @L2A 34250000
         AGO   .ASST1                                          @G38LP1S 34300000
.LMNOT3  ANOP                                                  @G381P2F 34350000
         LM    14,2,16(1)                RESTORE REGS          @G381P2F 34400000
         AIF   ('&SYSASCE' EQ 'P').NOARLM4                         @L2A 34450000
.*                                                                      34500000
.* &R1 IS RELOADED IN THIS PATH BECAUSE THE LM WOULD NOT                34550000
.* HAVE RESTORED IT IF &R1 = REG 3.                                     34600000
.*                                                                      34650000
         L     &R1,PSACSTK-PSA(0,0)      GET STACK ADDRESS         @L2A 34700000
         LAE   &R1,0(&R1,0)              GET 0 ALET                @L2A 34750000
         LAM   14,2,64(&R1)              RESTORE ARS 14-2          @L2A 34800000
.NOARLM4 ANOP                                                      @L2A 34850000
.ASST1   ANOP  ,                                               @G38LP1S 34900000
         AGO   .END                     THAT'S ALL                 @H1C 34950000
.*                                                               50@H1D 35000000
.LMNSS   ANOP                                                  @G381P2F 35050000
         AIF   ('&SYSASCE' EQ 'P').NOTAR1                          @L2A 35100000
*                  IEAVTSFR RETURNS HERE WHEN THE PSANSS BIT NEEDS @L2A 35150000
*                  TO BE SET OFF                                   @L2A 35200000
         B     B&SYSNDX                  TURN OFF PSANSS           @L2A 35250000
.NOTAR1  ANOP                                                      @L2A 35300000
         LM    14,3,16(1)                RESTORE REGS          @G382P2F 35350000
         AIF   ('&SYSASCE' EQ 'P').NOARLM5                         @L2A 35400000
         LAE   &R1,0(&R1,0)              GET 0 ALET                @L2A 35450000
         LAM   14,3,64(&R1)              RESTORE ARS 14-3          @L2A 35500000
.NOARLM5 ANOP                                                      @L2A 35550000
         B     A&SYSNDX                                            @L2C 35600000
*                  IEAVTSFR RETURNS HERE WHEN THE PSANSS       @G382P2F 35650000
*                  BIT (EUT FLAG) NEEDS TO BE SET OFF          @G382P2F 35700000
B&SYSNDX LM    14,3,16(1)                RESTORE REGS              @L2C 35750000
         AIF   ('&SYSASCE' EQ 'P').NOARLM6                         @L2A 35800000
         LAE   &R1,0(&R1,0)              GET 0 ALET                @L2A 35850000
         LAM   14,3,64(&R1)              RESTORE ARS 14-3          @L2A 35900000
.NOARLM6 ANOP                                                      @L2A 35950000
         NI    PSAMFLGS-PSA(0),X'7F'     SET PSANSS FLAG OFF   @G382P2F 36000000
A&SYSNDX DS    0H                        END OF EXPANSION          @L2A 36050000
         AGO   .END                                            @G382P2F 36100000
.MSG1    MNOTE     12,'WORK REGISTERS NOT SPECIFIED'                    36150000
         AGO       .END                                                 36200000
.MSG2    MNOTE     8,'WORK REGISTERS SPECIFIED INCORRECTLY'             36250000
.MSG5    MNOTE     8,'SPECIFY AS FOLLOWS - WRKREGS=(REGISTER,REGISTER)' 36300000
         AGO       .END                                                 36350000
.MSG3    MNOTE     8,'FRR ADDRESS NOT SPECIFIED FOR ADD/REPLACE'        36400000
         AGO        .END                                                36450000
.MSG4    MNOTE  8,'ADDRESS SPECIFIED FOR FRRAD/PARMAD IS SELF-DEFINING' 36500000
         AGO       .END                                        @G381P2F 36550000
.MSG6    MNOTE     8,'EUT NOT ALLOWED WITH INLINE=YES'         @G381P2F 36600000
         AGO       .END                                        @G381P2F 36650000
.MSG7    MNOTE    8,'MODE SPECIFIED INCORRECTLY WITH INLINE'   @G381P2F 36700000
         AGO        .END                                       @G381P2F 36750000
.MSG8    MNOTE     8,'EUT SPECIFIED INCORRECTLY'               @G381P2F 36800000
         AGO       .END                                        @G381P2F 36850000
.MSG9    MNOTE     8,'INLINE SPECIFIED INCORRECTLY'            @G381P2F 36900000
         AGO       .END                                        @G381P2F 36950000
.MSG10   MNOTE    12,'INVALID OPTION IN MODE SUBSTRING ELEMENT &I'      37000000
.*                                                             @G381P2F 37050000
         AGO        .END                                       @G381P2F 37100000
.MSG11   MNOTE     8,'EUT NOT ALLOWED WITH PURGE/FLUSH/ADDFLUSH'        37150000
.*                                                             @G381P2F 37200000
         AGO       .END                                        @ZM50139 37250000
.MSG12   MNOTE    12,'INVALID PARM &OPT2, PARENTHESIS MAY BE MISSING'   37300000
.*                                                             @ZM50139 37350000
         AGO   .END                                            @G38LP1S 37400000
.MSG13   MNOTE 8,'INVALID CLEAR OPTION'                        @G38LP1S 37450000
         AGO   .END                                            @G860P1F 37500000
.MSG14   MNOTE 12,'INVALID PARAMETER &AMODE'                   @G860P1F 37550000
         AGO   .END                                            @G860P1F 37600000
.MSG15   MNOTE 12,'AMODE=DEFINED IS INVALID WITH &OPT OPTION'  @G860P1F 37650000
         AGO   .END                                            @G860P1C 37700000
.MSG16   MNOTE 8,'CANCEL NOT ALLOWED WITH INLINE=YES'              @D1A 37707100
         AGO   .END                                                @D1A 37714200
.MSG17   MNOTE 8,'CANCEL SPECIFIED INCORRECTLY'                    @D1A 37721300
         AGO   .END                                                @D1A 37728400
.MSG18   MNOTE 8,'CANCEL NOT ALLOWED WITH PURGE/FLUSH/ADDFLUSH'    @D1A 37735500
         AGO   .END                                                @D1A 37742600
.S370    ANOP                                                  @G860P1C 37750000
&NAME    SETFRR7   &OPT,FRRAD=&FRRAD,PARMAD=&PARMAD,WRKREGS=&WRKREGS,  C37800000
               RELATED=&RELATED,CLEAR=&CLEAR,MODE=&MODE,EUT=&EUT,      C37850000
               INLINE=&INLINE,ASSIST=&ASSIST,&OPT2             @G860P1C 37900000
.END     MEND                                                           37950000
* END OF BAL SETFRR MACRO                                            */ 38000000
* SETFRR: /***********************************************************/ 38050000
*         /* INVOKE ?SETFRRP - PL/S VERSION OF THE SETFRR MACRO      */ 38100000
*         /***********************************************************/ 38150000
* MACRO                            /* ?SETFRR INVOKES ?SETFRRP       */ 38200000
*   KEYS(FRRAD,                    /* FRR ADDRESS                    */ 38250000
*        PARMAD,                   /* PARAMETER AREA ADDRESS         */ 38300000
*        MODE,                     /* MODE OPERAND(S)                */ 38350000
*        CLEAR,                    /* CLEAR OPERAND                  */ 38400000
*        EUT,                      /* EUT OPERAND                    */ 38450000
*        CANCEL,                   /* CANCEL OPERAND             @D1A*/ 38475000
*        RELATED,                  /* USED FOR DOCUMENTATION         */ 38500000
*        AMODE,                    /* ADDRESSING MODE - NOT USED     */ 38550000
*        WRKREGS,                  /* WORK REGS     - NOT NEEDED     */ 38600000
*        ASSIST,                   /* ASSIST        - NOT USED       */ 38650000
*        INLINE);                  /* INLINE EXPANSION NOT USED      */ 38700000
* ANS( '?' || MACLABEL || 'SETFRRP ' || MACLIST || MACKEYS || ';' );/*  38750000
*                                     INVOKE ?SETFRRP            @L1A*/ 38800000
*%END SETFRR;                                                           38850000
