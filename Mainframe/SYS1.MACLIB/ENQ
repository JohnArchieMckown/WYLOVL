*/*01* PROPRIETARY STATEMENT=                                        */ 00003300
*/***PROPRIETARY_STATEMENT********************************************/ 00006600
*/*                                                                  */ 00009900
*/*                                                                  */ 00013200
*/* LICENSED MATERIALS - PROPERTY OF IBM                             */ 00016500
*/* THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                      */ 00019800
*/* 5645-001 (C) COPYRIGHT IBM CORP. 1977, 1997                      */ 00023100
*/*                                                                  */ 00026400
*/* STATUS= HBB6603                                                  */ 00029700
*/*                                                                  */ 00033000
*/***END_OF_PROPRIETARY_STATEMENT*************************************/ 00036300
*%/*                                                               @P1A 00040000
         MACRO                                                          00080000
&NAME    ENQ   &P,&SMC=,&RET=,&UCB=,&ECB=,&TCB=,&GENERIC=NO,&MF=I,     X00100002
               &RNL=,&MASID=,&MTCB=,&RELATED=,&LOC=                @03C 00104000
.********************************************************************** 00108000
.*                                                                      00112000
.*01* MACRO-NAME = ENQ                                                  00113000
.*                                                                      00114000
.*01*  MACRO-DATE = 05/05/95                                       @03C 00114300
.*                                                                      00114600
.*01* DESCRIPTIVE-NAME = ENQ MACRO                                      00115000
.*                                                                      00121200
.*01* EXTERNAL CLASSIFICATION: GUPI                                     00121400
.*01* END OF EXTERNAL CLASSIFICATION:                                   00121600
.*                                                                      00122000
.*01* FUNCTION =                                                        00123000
.*                GENERATE ENQ SVC (SVC 56).  ALSO, GENERATE AND/OR     00124000
.*                MODIFY THE PARAMETER-LIST OF ENQ, RESERVE, OR DEQ.    00125000
.*                                                                      00126000
.*                                                                      00127000
.*01* MODULE-TYPE = MACRO                                               00128000
.*                                                                      00129000
.*01* PROCESSOR = ASSEMBLER                                             00130000
.*                                                                      00131000
.*01* MACROS = IHBERMAC, IHBINNRA, ENQP                                 00132000
.*                                                                      00133000
.*01* CHANGE-ACTIVITY =                                                 00134000
.*                                                                      00136200
.*  $L1=MASIDENQ JBB2125 830411 PD1L: Add MASID and MTCB operands.      00136300
.*                                    Modify generation of PEL prefix.  00136400
.*                                                                 @L1A 00136500
.*  $D1=DEO0156 HBB4410 890515 PDDX: Add support for RNL keyword        00136600
.*                                   DCR - 156                     @D1A 00136700
.*  $P1=PAJ0021 JBB2125 830411 PD1L: Fix Prolog for invocation as a     00136800
.*                                   PLS macro.                    @P1A 00136900
.*  $P2=PAJ0054 JBB2125 830411 PD1L: Store MASID/MTCB if MF=E macro     00137000
.*                                   with ECB=.                    @P2A 00137100
.*  $P3=PAJ0083 JBB2125 830527 PD1L: Store correct PELRET if MASID=     00137200
.*                                   with ECB=.                    @P3A 00137300
.*  $P4=PEO1730 HBB4410 890515 PDDX: Correct macro date and copyright.  00137400
.*                                                                 @P4A 00137500
.*  $P5=PEO2208 HBB4410 890626 PDDX: Fix RNL code to allow obscure      00137600
.*                                   types of the EXECUTE form.    @P5A 00137700
.*  $P6=PEO2299 HBB4410 890814 PDAW: Add continuation character.   @P6A 00137800
.*  $P7=PEO2246 HBB4410 891023 PDDX: Add a warning message when DEQ     00137900
.*                                   with UCB has a Scope other than    00138000
.*                                   SYSTEMS.                      @P7A 00138100
.*  $P8=PEO3322 HBB4410 900105 PDDX: Allow Scope to be omitted for a    00138200
.*                                   request with UCB.  Assume a Scope  00138300
.*                                   of SYSTEMS.                  @P8A  00138400
.*  $L2=UCBVP   HBB5510 940210 PDAW: Add DEVN keyword.             @L2A 00138500
.*  $P9=PN70247 HBB5520 940310 PDAW: Correct MACDATE.              @P9A 00138600
.*  $PA=PN70590 HBB5520 940602 PDAW: Add DEVN to RESERVE check.    @PAA 00138700
.*  $PB=PN71744 HBB5520 941022 PDAW: Add external class.           @PBA 00138800
.*                                                                      00139300
.* MACSTAT Y-3                                                 @ZA00466 00139400
.* MACSTAT Y-3                                                 @ZA14267 00139500
.* MACSTAT Y-3                                                 @ZA24620 00140000
.* MACSTAT Y-3 77.277/OZ26012                                  @ZA26012 00141000
.* MACSTAT Y-3 77.277/OZ26497                                  @ZA26497 00142000
.* MACSTAT Y-3 79.066/OZ37604 FIX DEQ EXECUTE WITH UCB         @ZA37604 00143000
.* MACSTAT Y-3 81.293/OZ53727 UPDATE PARAMETER BYTE WITH PARAMETERS     00144000
.*                           SPECIFIED IN EACH ELEMENT ON MULTIPLE      00145000
.*                           ENQUEUE.                          @ZA53727 00146000
.* OY12665 THE SETA STATEMENT USED IN CONJUNCTION WITH THE LENGTH       00146100
.*         ATTRIBUTE REQUIRES THAT THE DEFINED CONSTANT FOR THE RNAME   00146200
.*         BE DECLARED IN OPEN CODE.  THE SETA STATEMENT HAS BEEN       00146300
.*         CHANGED TO A DC TO ALLOW THE RNAME TO BE DECLARED OUTSIDE    00146400
.*         OF THE PROGRAM (FOR EXAMPLE WITHIN A MACROLIBRARY). @YA12665 00146500
.* OY18966 DETERMINE THE TYPE ATTRIBUTE OF THE RNAME ADDRESS TO         00146600
.*         DECIDE IF A DC OR SETA INSTRUCTION IS NEEDED TO RESOLVE      00146700
.*         THE RNAME LENGTH.                                   @YA18966 00146800
.* $01=OY56643 HBB4430 920821 PDEL: Restore &TYPER symbol.         @01A 00146900
.* $02=OY59863 HBB4430 930104 PDAW: Add better error checking for       00147000
.*                                  MASID and MTCB.                @02A 00147100
.* $03=OW11070 HBB4420 950505 PDHB: Remove/add support for DEVN/LOC     00147200
.*                                  keywords, respectively, for         00147300
.*                                  RESERVE and DEQ.  DCR 105.     @03A 00147400
.* $PC=PSD0270 JBB6602 950707 PDHB: MNOTE an ENQ with a UCB specified   00147500
.*                                  instead of letting it go unnoticed  00147600
.*                                  during macro expansion because it   00147700
.*                                  could later fail with an ABEND438.  00147800
.*                                  FIN of APAR OW13339.           @PCA 00147900
.*                                                                      00148000
.********************************************************************** 00149300
.*                                                                      00150000
.********************************************************************** 00153000
.*                                                                      00156000
.*  &B is used to control the bits within PELFLAG:                      00159000
.*                                                                      00162000
.*     &B(1) and &B(4) control PELSCPE1 and PELSCPE2 for SCOPE and      00165000
.*                     and UCB operands.                                00168000
.*                                                                      00171000
.*     &B(2) controls PELSYSMC (obsolete and reserved).                 00174000
.*                                                                      00177000
.*     &B(3) controls PELSTPMC for the SMC=STEP operand.                00180000
.*                                                                      00183000
.*     &B(5), &B(6), and &B(7) control PELRET1, PELRET2, and PELRET3    00186000
.*                             for the RET= and ECB= operands.          00189000
.*                                                                      00192000
.*     &B(8) controls PELSHARE for the SHARED/EXCLUSIVE operands.       00195000
.*                                                                      00198000
.*  &BA is used to control bits turned ON by an Or Immediate (OI):      00201000
.*                                                                      00204000
.*     &BA(1)=1 indicates that TCB= was specified.                      00207000
.*                                                                      00210000
.*     &BA(2)=1 indicates that GENERIC=YES was specified.               00213000
.*                                                                      00216000
.*     &BA(3)=1 indicates that RNL=NO was specified.               @D1A 00219000
.*                                                                      00222000
.*     &BA(4)=1 indicates that LOC=ANY was specified.              @03A 00225000
.*                                                                      00228000
.*  &BB is used to control bits turned OFF by an And Immediate (IN):    00231000
.*                                                                      00234000
.*     &BB(1)=1 indicates that SMC= was omitted (PELSYSMC).             00237000
.*                                                                      00240000
.*     &BB(2)=1 indicates that RET= was omitted (PELRET1, PELRET2,      00243000
.*              and PELRET3).                                           00246000
.*                                                                      00249000
.*     &BB(3)=1 indicates that an omitted EXCLUSIVE/SHARED operand was  00252000
.*              encountered (PELSHARE).                                 00255000
.*                                                                      00258000
.*     &BB(4) and &BB(5) are affected by the SCOPE and  UCB operands    00261000
.*                       (PELSCPE1 and PELSCPE2).                       00264000
.*                                                                      00267000
.*     &BB(6)=1 indicates that RNL=YES is specified with a MF=E         00270000
.*              invocation.                                        @D1A 00273000
.*                                                                      00276000
.*     &BB(7)=1 indicates that LOC=BELOW is specified with a MF=E       00279000
.*              invocation.                                        @D1A 00282000
.*                                                                      00285000
.*  &LIST is used to control the displacement within the parameter list 00288000
.*        of the bytes undated by the OI, NI, and ST instructions.      00291000
.*                                                                      00294000
.*  &LSTEND is used to control the bits of the PELLAST byte:            00297000
.*                                                                      00300000
.*     80-bit (128 decimal) = PELEOL                                    00303000
.*     40- "  ( 64    "   ) = PELIGNOR                                  00306000
.*     20- "  ( 32    "   ) = PELOCANY (LOC=ANY operand)           @03C 00309000
.*     08- "  (  8    "   ) = PELSAVE  (MASID= operand)                 00312000
.*     04- "  (  4    "   ) = PELNORNL (RNL= operand)              @D1A 00315000
.*     02- "  (  2    "   ) = PELGEN2  (GENERIC= operand)               00318000
.*     01- "  (  1    "   ) = PELTCBF  (TCB= operand)                   00321000
.*                                                                      00324000
.*  &PFLEN is the length of the PEL-Prefix.                             00327000
.*                                                                      00330000
.*  &PFXXXD is the displacement of field XXX from the beginning of the  00333000
.*          PEL-Prefix.  XXX is ECB, TCB, MAS, or MTC.                  00336000
.*                                                                      00339000
.********************************************************************** 00342000
         GBLB  &IHBRES                 RESERVE MACRO CALL INDICATOR     00350002
         GBLB  &IHBDEQ                 DEQ MACRO CALL INDICATOR         00400002
         GBLC  &LABEL                  USED TO BRANCH PAST PARM LIST    00450002
         LCLA  &QN,&RN,&ES,&RL,&SS     INDICES TO PARM SUB OPERANDS     00500002
         LCLA  &PFLEN,&PFTCBD,&PFECBD,&PFMASD,&PFMTCD                  X00516600
                                       PFX LENGTH AND DISPLACMENTS @L1A 00533200
         LCLA  &LEN                    LENGTH INTERMEDIARY              00550002
         LCLA  &LIST                   PARAMETER BUILD LIST POINTER     00600002
         LCLA  &LISTA                  PARAMETER BUILD LIST POINTER     00620002
         LCLA  &MASK0NI,&MASK0OI       BYTE TO 'AND' AND 'OR' BYTE 0    00631400
.*                                     OF AN EXECUTE FORM          @P5C 00642800
         LCLA  &MASK2NI,&MASK2OI       BYTE TO 'AND' AND 'OR' BYTE 2    00654200
.*                                     OF AN EXECUTE FORM          @P5C 00665600
         LCLB  &M(4)                   BITS INDICATING WHETHER TO       00677000
.*                                     PERFORM ABOVE 'AND'S AND 'OR'S   00688400
         LCLA  &NUMBER                 COUNT OF POSITIONAL PARMS        00700002
         LCLA  &BSIZE                  SIZE OF BRANCH TO TAKE WHEN      00712500
.*                                     GENERATING LOOP DURING EXPANSION 00725000
.*                                     OF EXECUTE FORM             @P5A 00737500
         LCLA  &LSTEND                 USED TO SET LISTEND BITS  X02113 00750002
         LCLB  &NQ                     ENQ/RES EXTRA PARM INDICATOR     00800002
         LCLB  &B(8),&BB(7),&BA(4)     Represents bits of code fields. X00833300
                                                                   @03C 00866600
         LCLC  &C                      TO GATHER REG PARM W/O PARENS    00900002
         LCLC  &TYPER                  TO TEST RNAME TYPE ATTRIBUTE     00904100
.*                                                                 @01A 00908300
         AIF   (&IHBDEQ OR &IHBRES).SKIPDAT                             00912500
*         MACRO-DATE = 95/03/03                                    @03C 00925000
.SKIPDAT ANOP                                                           00937500
.*                                                                      00956200
.********************************************************************** 00974900
.* VALIDITY-CHECK COUNT OF POSITIONAL SUB-OPERANDS                    * 00993600
.********************************************************************** 01012300
.*                                                                      01031000
&NQ      SETB  (NOT(&IHBDEQ))                                           01050002
         AIF   ('&MF(1)' NE 'E' AND '&P' EQ '').ERR1                    01100002
&NUMBER  SETA  N'&P                                                     01150002
         AIF   ('&NUMBER' GT '5' AND '&UCB' NE '').ERR7                 01200002
.*                                                                      01225300
.********************************************************************** 01250600
.* DETERMINE THE REQUIRED FORMAT AND LENGTH OF THE PEL-PREFIX         * 01275900
.********************************************************************** 01301200
.*                                                                      01326500
         AIF   ('&TCB' NE '' OR '&ECB' NE '').OLDPF                @L1A 01352200
         AIF   ('&MASID' EQ '').CKMTC                              @L1A 01354400
.NEWPF   ANOP                                                      @L1A 01356600
         AIF   ('&MTCB' EQ '').ERR20          MASID requires MTCB  @02A 01356800
         AIF   ('&TCB' NE '').ERR26           MASID & TCB conflict @02A 01357000
         AIF   ('&MF' NE 'L').NEWPF2                               @L1A 01357400
         AIF   ('&MASID' NE '0').ERR15A                            @L1A 01358200
         AIF   ('&MTCB' NE '0' AND '&MTCB' NE '').ERR15B           @L1A 01359000
.NEWPF2  ANOP                                                      @L1A 01359800
&PFLEN   SETA  20            PREFIX HAS MASID                      @L1A 01361000
&PFTCBD  SETA  0                                                   @L1A 01363200
&PFECBD  SETA  4                                                   @L1A 01365400
&PFMASD  SETA  8                                                   @L1A 01367600
&PFMTCD  SETA  12                                                  @L1A 01369800
         AGO   .NOPF                                               @L1A 01372000
.CKMTC   AIF   ('&MTCB' NE '').ERR11B                              @L1A 01372800
         AGO   .NOPF                                               @L1A 01373600
.OLDPF   AIF   ('&MASID' NE '').NEWPF                              @L1A 01374400
         AIF   ('&MTCB' NE '').ERR11B                              @L1A 01375200
         AIF   ('&ECB' NE '' AND '&TCB' NE '').PFECTC              @L1A 01376400
&PFLEN   SETA  4             PREFIX HAS ECB OR TCB                 @L1A 01378600
&PFTCBD  SETA  0                                                   @L1A 01380800
&PFECBD  SETA  0                                                   @L1A 01383000
         AGO   .NOPF                                               @L1A 01385200
.PFECTC  ANOP                                                      @L1A 01387400
&PFLEN   SETA  8             PREFIX HAS ECB AND TCB                @L1A 01389600
&PFTCBD  SETA  0                                                   @L1A 01391800
&PFECBD  SETA  4                                                   @L1A 01394000
.NOPF    ANOP                                                      @L1A 01396200
.*                                                                      01396600
.********************************************************************** 01397000
.********************************************************************** 01397400
.*  Validity check all keyword operands.  Applies to ALL entries.     * 01397800
.********************************************************************** 01398200
.********************************************************************** 01398600
.*                                                                      01399000
         AIF   (&IHBDEQ).CHKGEN                                  X02113 01400002
         AIF   ('&GENERIC' NE 'NO').ERR18                        X02113 01450002
         AGO   .NCHKGEN                                          X02113 01500002
.CHKGEN  ANOP                                                    X02113 01550002
         AIF   ('&GENERIC' NE 'NO' AND '&GENERIC' NE 'YES').ERR16       01600002
.*                                                               X02113 01650002
         AIF   ('&GENERIC' EQ 'YES' AND '&RET' NE 'HAVE').ERR17  X02113 01700002
.NCHKGEN ANOP                                                    X02113 01750002
         AIF   (&IHBRES OR &IHBDEQ).NOTENQ  Branch if not an ENQ.X02113 01757800
.*                                                                      01765600
.********************************************************************** 01773400
.*  Make some checks unique only to ENQ.                              * 01781200
.********************************************************************** 01789000
.*                                                                      01796800
         AIF   ('&TCB' NE '' AND '&ECB' NE '').BOTH2  RET NOT  @ZA14267 01805000
.*                                     PERMITTED WITH ECB AND  @ZA14267 01810000
.*                                     TCB (SAME AS ECB ONLY)  @ZA14267 01825000
         AIF   ('&RET' EQ 'HAVE' AND '&TCB' NE '').ERR13         X02113 01850002
         AIF   ('&RET' EQ 'NONE' AND '&TCB' NE '').ERR13         X02113 01900002
         AIF   ('&RET' EQ '' AND '&TCB' NE '').ERR13             X02113 01950002
.*                                     TCB NOT ALLOWED WITH      X02113 02000002
.*                                     RET=HAVE,NONE,OMITTED     X02113 02050002
.*                                     ON ENQ                    X02113 02100002
.BOTH2   ANOP                                                  @ZA14267 02110000
         AIF   ('&TCB' NE '' AND '&SMC' NE '').ERR12             X02113 02150002
.*                                     TCB WITH SMC INVALID      X02113 02200002
         AIF   ('&UCB' EQ '').NOUCB   If a UCB was not specified on     02200900
.*                                    this ENQ, branch around issuing   02201800
.*                                    a warning MNOTE.             @PCA 02202700
         MNOTE 4,' While a UCB is tolerated on an ENQ invocation, an ABX02203600
               END438 may be later received during execution.  ThereforX02204500
               e, consideration should be given in replacing this ENQ wX02205400
               ith a RESERVE macro.'                               @PCA 02206300
.NOUCB   ANOP                                                      @PCA 02207200
.NOTENQ  ANOP                                                    X02113 02208300
.*                                                                      02208800
.********************************************************************** 02209300
.*  Validity check the LOC keyword and issue a warning if bad.        * 02209800
.********************************************************************** 02210300
.*                                                                      02210800
         AIF   ('&LOC' NE '' AND '&LOC' NE 'ANY' AND '&LOC' NE 'BELOW')X02211300
               .ERR27               Invalid LOC specified.         @03C 02211800
.*                                                                1@03D 02212300
.*                                                                      02212800
.********************************************************************** 02213300
.*  Validity check the RNL keyword and issue a warning if bad.        * 02213800
.********************************************************************** 02214300
.*                                                                      02214800
         AIF   ('&RNL' NE '' AND '&RNL' NE 'NO' AND '&RNL' NE 'YES').ER*02216600
               R19                     INVALID RNL SPECIFIED       @D1A 02233200
.*                                                                      02242700
.********************************************************************** 02252200
.*  Validity check the ECB, SMC, and RET keywords and their combin-   * 02261700
.*  ations and issue appropriate warning messages if necessary.       * 02271200
.********************************************************************** 02280700
.*                                                                      02290200
         AIF   ('&ECB' NE '' AND '&SMC' NE '' OR '&ECB' NE '' AND '&RET*02300002
               ' NE '').ERR11            SMC, RET NOT ALLOWED WITH ECB  02350002
         AIF   ('&RET' EQ 'NONE' AND '&MASID' NE '').ERR21         @02A 02355500
         AIF   ('&RET' EQ 'USE' AND '&MASID' NE '').ERR22          @02A 02361000
         AIF   ('&RET' EQ 'CHNG' AND '&MASID' NE '').ERR24         @02A 02366500
         AIF   ('&RET' EQ '' AND '&MASID' NE '' AND '&ECB' EQ '').ERR23 02372000
.*                                     MASID/MTCB conflict with    @02A 02377500
.*                                     RET=NONE and RET=USE. Also  @02A 02383000
.*                                     don't let RET be omitted    @02A 02388500
.*                                     unless ECB is specified.    @02A 02394000
.SMC     AIF   ('&SMC' EQ '' OR '&SMC' EQ 'NONE').RET                   02400002
&B(2)    SETB  0                                               @ZA12435 02420000
&B(3)    SETB  ('&SMC' EQ 'STEP')                                       02500002
         AIF   (NOT &B(3)).ERR8                                @ZA12435 02520000
         AIF   ('&MASID' NE '').ERR25  MASID/MTCB & SMC conflict   @02A 02560000
.RET     AIF   ('&RET' EQ '' OR '&RET' EQ 'NONE').RETOK                 02600000
         AIF   (&IHBDEQ).RETDEQ                                         02650002
&B(5)    SETB  ('&RET' EQ 'TEST' OR '&ECB' NE '')                       02700002
&B(6)    SETB ('&RET' EQ 'TEST' OR '&RET' EQ 'USE' OR '&RET' EQ 'CHNG') 02750002
&B(7)    SETB ('&RET' EQ 'TEST' OR '&RET' EQ 'USE' OR '&RET' EQ 'HAVE') 02800002
         AGO   .RETCK                                                   02850002
.RETDEQ  ANOP                                                           02900002
&B(7)    SETB  ('&RET' EQ 'HAVE')                                       02950002
.RETCK   AIF   (NOT &B(5) AND NOT &B(6) AND NOT &B(7)).ERR5             03000002
.RETOK   ANOP                                                           03050000
.*                                                                      03068100
.********************************************************************** 03086200
.*  Validity check the Macro Form (MF=) operand.                      * 03104300
.********************************************************************** 03122400
.********************************************************************** 03140500
.*                  Branch to Execute Form if necessary --->>>        * 03158600
.********************************************************************** 03176700
.********************************************************************** 03194800
.*                                                                      03212900
         AIF   ('&MF(1)' EQ 'E').EROUT Go process Execute form --->>>   03231000
         AIF   ('&MF' EQ 'L').DS       SET NAME FIELD FOR LIST FORM     03250002
         AIF   ('&MF' NE 'I').ERR4     LAST POSSIBLE CHOICE             03300002
.*                                                                      03325000
.********************************************************************** 03350000
.*  Generate branch for Standard Form (MF=I) or MF= omitted.          * 03375000
.********************************************************************** 03400000
.*                                                                      03425000
&LABEL   SETC  'IHB'.'&SYSNDX'         UNIQUE TAG TO BRANCH AROUND LIST 03450002
         CNOP  0,4                                                      03500002
&NAME    BAL   1,&LABEL                BRANCH AROUND AND ADDRESS LIST   03550002
         AGO   .DS2                    GENERATE PARAMETER LIST     @L1C 03570000
.DS      ANOP                                                           03650002
         DS    0F                      ESTABLISH A FULLWORD BOUNDARY    03700000
.*                                                                      03725000
.********************************************************************** 03750000
.*  Generate parameter list for List (MF=L) or Standard (MF=I) form.  * 03775000
.********************************************************************** 03800000
.*                                                                      03825000
.DS2     AIF   (&PFLEN LT 20).CHKTCB1    NOT NEW-FORMAT PREFIX     @L1A 03850200
.*                                                                      03850400
.********************************************************************** 03850600
.*  Generate parameter list if MASID= present.                    @L1A* 03850800
.********************************************************************** 03851000
.*                                                                      03851200
         AIF   ('&MF' EQ 'L' AND '&TCB' NE '' AND '&TCB' NE '0').ERR15 X03851400
                       TCB MUST BE OMITTED OR ZERO ON MF=L         @L1A 03851700
         DC    A(0)                       TCB-ADDRESS              @L1A 03852000
&C       SETC  '0'                     ASSUME NO ECB-ADDRESS       @L1A 03852600
         AIF   ('&ECB' EQ '').PFNOEC                               @L1A 03852900
         AIF   (&IHBDEQ).ERR6          ECB NOT ALLOWED W. DEQ      @L1A 03853200
         AIF   ('&ECB'(1,1) EQ '(' AND '&MF' EQ 'L').ERR3          @L1A 03853500
&B(5)    SETB  1                       ECB INDICATOR (FOR PELRET)  @P3A 03853600
         AIF   ('&ECB'(1,1) EQ '(').PFNOEC                         @L1A 03853800
&C       SETC  '&ECB'                                              @L1A 03854100
.PFNOEC  DC    A(&C)                      ECB-ADDRESS              @L1A 03854400
         DC    A(0)                       MASID VALUE              @L1A 03854700
         DC    A(0)                       MTCB VALUE               @L1A 03855000
         DC    XL3'000000',AL1(&PFLEN)    PREFIX FORMAT-WORD       @L1A 03855300
&LSTEND  SETA  8                       SET PELSAVE FOR NEW PREFIX  @L1A 03855600
         AGO   .GENGEN                 DEFINE ELEMENTS             @L1A 03855900
.*                                                                      03856000
.********************************************************************** 03856100
.*  Generate parameter list if MASID= absent.  TCB= and/or ECB=   @L1A* 03856200
.*  may be present.                                               @L1C* 03856300
.********************************************************************** 03856400
.*                                                                      03856500
.CHKTCB1 AIF ('&TCB' EQ '').ECB        NOT TCB, CHECK ECB      @ZA14267 03857200
.*                                                                      03859000
.********************************************************************** 03860800
.*  Process the TCB= operand (PEL-PREFIX).                            * 03862600
.********************************************************************** 03864400
.*                                                                      03866200
&LSTEND  SETA  1                       SHOW DIRECTED ENQ/DEQ     X02113 03868000
         AIF   ('&MF' EQ 'I').STNDARD  IF LIST FORM, TCB=0       X02113 03874000
         AIF   ('&TCB' NE '0').ERR15   ERROR IN SPECIFYING TCB   X02113 03880000
.STNDARD ANOP                                                    X02113 03886000
.TCBREG  DC    A(0)                    PREFIX - TCB ADDRESS      X02113 03892000
.*                                                                      03895000
.********************************************************************** 03898000
.*  Process the ECB= operand (PEL-PREFIX).                            * 03901000
.********************************************************************** 03904000
.*                                                                      03907000
.ECB     AIF   ('&ECB' EQ '').GENGEN   IF NOT ECB, CONTINUE        @L1C 03910000
         AIF   (&IHBDEQ).ERR6          ECB NOT ALLOWED W. DEQ           04000002
&B(5)    SETB  1                       ECB INDICATOR                    04100002
         AIF   ('&ECB'(1,1) EQ '(').ECBREG     ADDRESS FOUND IN A REG   04150002
         DC    A(&ECB)                 PREFIX - ECB ADDRESS             04200002
         AGO   .GENGEN                                             @L1C 04250000
.ECBREG  AIF   ('&MF' EQ 'L').ERR3                                      04300002
         DC    A(0)                    PREFIX - ECB ADDRESS             04350002
.*                                                                      04400000
.********************************************************************** 04450000
.*  Process the Generic= operand and generate a label.                * 04500000
.********************************************************************** 04550000
.*                                                                      04600000
.GENGEN ANOP                                                       @L1C 04850000
         AIF   ('&GENERIC' EQ 'NO').NOGEN1                       X02113 04900002
&LSTEND  SETA  &LSTEND+2               INDICATE GENERIC DEQ      X02113 04950002
.NOGEN1  ANOP                                                    X02113 05000002
.*                                                                      05002000
.********************************************************************** 05004000
.*  Process the RNL= operand.                                         * 05006000
.********************************************************************** 05008000
.*                                                                      05010000
         AIF   ('&RNL' NE 'NO').SKIPRNL                            @D1A 05012500
&LSTEND  SETA  &LSTEND+4               INDICATE RNL(NO)            @D1A 05025000
.SKIPRNL ANOP                                                      @D1A 05037500
.*                                                                      05039000
.********************************************************************** 05040500
.********************************************************************** 05042000
.******      End validity check of all keyword operands.              * 05043500
.********************************************************************** 05045000
.********************************************************************** 05046500
.*                                                                      05048000
         AIF   ('&MF' EQ 'I').STNDFRM                            X02113 05050002
         AIF   ('&NAME' EQ '').STNDFRM                           X02113 05100002
&NAME    EQU   *                                                 X02113 05150002
.STNDFRM ANOP                                                    X02113 05200002
&QN      SETA  1                       INDEX TO QNAME POSITIONAL PARM   05250002
.*                                                                      05255000
.********************************************************************** 05260000
.********************************************************************** 05265000
.******      Loop to generate a PEL for each Resource Name.      ****** 05270000
.********************************************************************** 05275000
.******         Standard (MF=I) and List (MF=L) formats.         ****** 05280000
.********************************************************************** 05285000
.********************************************************************** 05290000
.*                                                                      05295000
.LOOP1   ANOP                                                           05300002
&RN      SETA  &QN+1                   RNAME - 2ND POSITIONAL PARM      05350002
&ES      SETA  &RN+&NQ                 EX/SHR - 3RD W. ENQ RES          05400002
&RL      SETA  &ES+1                   RNAME LENGTH - NEXT PARM         05450002
&SS      SETA  &RL+1                   STEP/SYSTEM - LAST PARM OF SEQ   05500002
.*                                                                      05514200
.********************************************************************** 05528400
.*  Handle PELSHR, PELSCPE1, PELSCPE2 for EXCLUSIVE/SHARED, SCOPE=,   * 05542600
.*  and UCB= keywords.                                            @03C* 05556800
.********************************************************************** 05571000
.*                                                                      05585200
&B(8)    SETB  0                       SHARED/EXCLUSIVE - EX DEFAULTS   05600002
&B(1)    SETB  0                       SCOPE - 1 EQ SYSTEM OR SYSTEMS   05650002
&B(4)    SETB  0                       0 EQ STEP; 1 EQ SYSTEMS or UCB   05679100
.*                                                                      05707500
.********************************************************************** 05735900
.*  EXCLUSIVE/SHARED parameter.  Valid for ENQ/RESERVE only.          * 05764300
.********************************************************************** 05792700
.*                                                                      05821100
         AIF   (&IHBDEQ).SCOPE                                          05850002
         AIF   ('&P(&ES)' EQ '' OR '&P(&ES)' EQ 'E').SCOPE              05900002
         AIF   ('&P(&ES)' NE 'S').ERR9                                  05950002
&B(8)    SETB  1                       SHARED REQUEST                   06000002
.*                                                                      06021400
.********************************************************************** 06042800
.*  SCOPE parameter (STEP/SYSTEM/SYSTEMS).                            * 06064200
.********************************************************************** 06085600
.*                                                                      06107000
.SCOPE   AIF   ('&UCB' NE '').UCB   Was a UCB keyword specified?   @03C 06128400
         AIF   ('&P(&SS)' EQ '' OR '&P(&SS)' EQ 'STEP').LISTEND         06150002
&B(1)    SETB  ('&P(&SS)' EQ 'SYSTEMS')                                 06200002
&B(4)    SETB  ('&P(&SS)' EQ 'SYSTEMS')                                 06250002
         AIF   (&B(1)).LISTEND                                          06300002
&B(1)    SETB  ('&P(&SS)' EQ 'SYSTEM')                                  06350002
         AIF   (NOT &B(1)).ERR10                                        06400002
         AGO   .LISTEND                                                 06450002
.UCB     ANOP                                                           06500002
         AIF   ('&P(&SS)' EQ 'SYSTEMS' OR '&P(&SS)' EQ '').UCB2         06504800
.*                                  Is SCOPE valid with UCB?       @03C 06509600
         AIF   (&IHBRES).BADRESV         NO, GIVE A WARNING MSG    @P8C 06514400
.*                                                                1@03D 06516800
         IHBERMAC 1015,&P(&SS),UCB,SYSTEMS  SCOPE IS INVALID W/UCB @P8C 06519200
         AGO   .UCB2                                               @P8A 06524000
.*                                                                3@03D 06526400
.BADRESV ANOP      A RESERVE SPECIFIED SCOPE OF STEP OR SYSTEM     @P8A 06528800
         IHBERMAC 1015,&P(&SS),RESERVE,SYSTEMS   SCOPE IS INVALID ON    06533600
.*                                       A RESERVE                 @P8A 06538400
.UCB2    ANOP                                                      @P7A 06543400
&B(4)    SETB  1                                                   SDS1 06550002
.*                                                                      06566600
.********************************************************************** 06583200
.*  Process the LOC keyword.                                          * 06599800
.********************************************************************** 06616400
.*                                                                      06633000
         AIF   ('&LOC' EQ '' OR '&LOC' EQ 'BELOW').SKIPLOC         @03C 06649600
.*                                  If LOC=ANY was specified then...    06666200
&LSTEND  SETA  &LSTEND+32           Set the PELOCANY flag.         @03C 06682800
.SKIPLOC ANOP                                                      @03C 06699400
.*                                                                      06716000
.********************************************************************** 06732600
.*  Process the PELIGNOR flag.                                        * 06749200
.********************************************************************** 06765800
.*                                                                      06782400
.LISTEND AIF   ('&LSTEND' NE '0').NOLD   If no new options...    X02113 06799000
&LSTEND  SETA  64                   ...set the PELIGNOR flag     X02113 06815600
.*                                   so bits 2-7 are ignored.    X02113 06832200
.NOLD    ANOP                                                    X02113 06850002
.*                                                                      06858300
.********************************************************************** 06866600
.*  Process the PELEOL flag.                                          * 06874900
.********************************************************************** 06883200
.*                                                                      06891500
         AIF   (&QN+4+&NQ LE &NUMBER).NOTLAST                    X02113 06900002
&LSTEND  SETA  &LSTEND+128             SET TO SHOW END OF LIST   X02113 06950002
.NOTLAST DC    AL1(&LSTEND)            PELLAST flag byte.        X02113 06971400
.*                                                                      06992800
.********************************************************************** 07014200
.*  Process the PELMILEN value (RNAME length).                        * 07035600
.********************************************************************** 07057000
.*                                                                      07078400
.LENGTH  AIF   ('&P(&RL)' EQ '' AND '&MF' EQ 'L').NAMEL                 07100002
         AIF   ('&P(&RN)' EQ '').SKIP                                   07150002
         AIF   ('&P(&RL)' EQ '' AND '&P(&RN)'(1,1) EQ '(').ERR2         07200002
.SKIP    AIF   ('&P(&RL)' EQ '').NAMEL                                  07250002
         AIF   ('&P(&RL)'(1,1) EQ '(').REGL                             07300002
         DC    AL1(&P(&RL))            PELMILEN - RNAME length.         07350000
         AGO   .CODE                                                    07400002
.REGL    AIF   ('&MF' EQ 'L').ERR3                                      07450002
.ZEROL   DC    AL1(0)                  PELMILEN - RNAME length.         07500000
         AGO   .CODE                                                    07550002
.NAMEL   AIF   ('&P(&RN)' EQ '').ZEROL                                  07600002
&TYPER   SETC  T'&P(&RN)               SET TYPE ATTRIBUTE     @YA18966  07607100
         AIF   ('&TYPER' EQ 'C').CTYPE TEST FOR CHARACTER               07614200
.*                                     CONSTANT ATTRIBUTE     @YA18966  07621300
         DC    AL1(L'&P(&RN))          PELMILEN - RNAME length.         07626000
.*                                                            @YA12665  07630700
         AGO   .CODE                                                    07635500
.CTYPE   ANOP                                                 @YA18966  07642600
&LEN     SETA  L'&P(&RN)                                                07650002
         DC    AL1(&LEN)               PELMILEN - RNAME length.         07667600
.*                                                                      07685200
.********************************************************************** 07702800
.*  Process the PELFLAG and PELRET indicators (Options and Return     * 07720400
.*  Code flags).                                                      * 07738000
.********************************************************************** 07755600
.*                                                                      07773200
.CODE    DC    BL1'&B(8)&B(1)&B(2)&B(3)&B(4)&B(5)&B(6)&B(7)'            07790800
*                                      PELFLAG - flag byte 2.           07808400
         DC    AL1(0)                  PELRET - return code byte.       07826000
.*                                                                      07843600
.********************************************************************** 07861200
.*  Process the PELMAJA and PELMINA fields (QNAME and RNAME           * 07878800
.*  addresses).  RNAME can and must be omitted for GENERIC=YES.       * 07896400
.********************************************************************** 07914000
.*                                                                      07931600
         AIF   ('&P(&QN)' EQ '' AND '&MF' EQ 'L').ZEROQ                 07950002
         AIF   ('&P(&QN)' EQ '').ERR2                                   08000002
         AIF   ('&P(&QN)'(1,1) EQ '(').REGQ   IF QNAME-ADDRESS IN REG   08050000
         DC    A(&P(&QN))              QNAME ADDRESS                    08100002
         AGO   .RNAME                                                   08150002
.REGQ    AIF   ('&MF' EQ 'L').ERR3                                      08200002
.ZEROQ   DC    A(0)                    QNAME ADDRESS                    08250002
.RNAME   AIF   ('&P(&RN)' EQ '' AND '&MF' EQ 'L').ZEROR                 08300002
         AIF   ('&GENERIC' EQ 'NO').NOGEN2                       X02113 08350002
         AIF   ('&P(&RN)' EQ '').ZEROR SHOULD BE NO RNAME W GEN. X02113 08400002
         IHBERMAC 1016,RNAME,GENERIC                             X02113 08450002
         AGO   .ZEROR                                            X02113 08500002
.NOGEN2  ANOP                                                    X02113 08550002
         AIF   ('&P(&RN)' EQ '').ERR2                                   08600002
         AIF   ('&P(&RN)'(1,1) EQ '(').REGR                             08650002
         DC    A(&P(&RN))              RNAME ADDRESS                    08700002
         AGO   .CONT                                                    08750002
.REGR    AIF   ('&MF' EQ 'L').ERR3                                      08800002
.ZEROR   DC    A(0)                    RNAME ADDRESS                    08850002
.CONT    ANOP                                                           08900002
&QN      SETA  &QN+4+&NQ                                                08950002
         AIF   (&QN LE &NUMBER).LOOP1                            X02113 09000002
.*                                                                      09015800
.********************************************************************** 09031600
.********************************************************************** 09047400
.******    End loop to generate a PEL for each Resource Name.    ****** 09063200
.********************************************************************** 09079000
.******         Standard (MF=I) and List (MF=L) formats.         ****** 09094800
.********************************************************************** 09110600
.********************************************************************** 09126400
.*                                                                      09142200
.END     ANOP                                                      @L2C 09158400
.*                                                                      09163000
.********************************************************************** 09167600
.*  Process the PELUCBAA field if UCB= was specified.                 * 09172200
.********************************************************************** 09176800
.*                                                                1@03D 09181400
         AIF   ('&UCB' EQ '').EXITML                               @L2C 09186000
.*                                  If no UCB keyword then exit.        09193000
         AIF   ('&UCB'(1,1) EQ '(').ENQ040                         SDS1 09200002
.*                                  If the UCB keyword is in register   09220000
.*                                  format then branch.                 09240000
         DC    A(&UCB)                 PELUCBAA - address to pointer    09260000
*                                                 to UCB.               09280000
         AGO   .EXITML                                             @L1C 09300000
.ENQ040  AIF   ('&MF' EQ 'L').ERR3  Go issue a terminating error        09306200
.*                                  message.                            09312400
         DC    A(0)                 UCB parameter value.                09318600
.*                                                                7@03D 09324800
.********************************************************************** 09331000
.*  Exit Macro if List Form (MF=L).  Otherwise, branch to process     * 09337200
.*  Standard Form.                                                    * 09343400
.********************************************************************** 09349600
.*                                                                      09355800
.EXITML  AIF   ('&MF' EQ 'I').STORE    Branch if Standard Form.    @L1C 09362000
&IHBDEQ  SETB  0                       No SVC is generated for MF=L.    09368200
&IHBRES  SETB  0                       Ditto.                      SDS1 09374400
.*                                                                      09380600
.********************************************************************** 09386800
.********************************************************************** 09393000
.******                List Form (MF=L) Macro Exit --->>>        ****** 09399200
.********************************************************************** 09405400
.********************************************************************** 09411600
.*                                                                      09417800
         MEXIT                      List Form (MF=L) Macro Exit --->>>  09424000
.*                                                                      09430200
.********************************************************************** 09436400
.********************************************************************** 09442600
.******               Process Standard Form (MF=I)               ****** 09448800
.********************************************************************** 09455000
.********************************************************************** 09461200
.*                                                                      09467400
.********************************************************************** 09473600
.*  Store values from registers, if necessary.                        * 09479800
.********************************************************************** 09486000
.*                                                                      09492200
.STORE   ANOP                                                           09500800
.*                                                                      09500900
.********************************************************************** 09501000
.*  Process the TCB= keyword (store in the PEL-PREFIX).               * 09501100
.********************************************************************** 09501200
.*                                                                      09501300
&LABEL   DS    0H                      OBJECT OF THE BAL                09501400
         AIF   ('&TCB' EQ '').CHKECB   IF NOT TCB, CHECK ECB   @ZA14267 09501500
         AIF   ('&TCB'(1,1) EQ '(').STRGTCB CHK FOR NONREG PTR @ZA14267 09501600
         L     0,&TCB                  PICK UP TCB ADDRESS     @ZA14267 09501700
         ST    0,&PFTCBD.(0,1)         PUT IN PREFIX               @L1C 09501800
         AGO   .CHKECB                 GO CHECK FOR ECB PFX    @ZA14267 09501900
.STRGTCB ANOP                          TCB PTR PASSED IN REG   @ZA14267 09502000
&LEN     SETA  K'&TCB-2                SET LEN OF REG NBR      @ZA14267 09502100
&C       SETC  '&TCB'(2,&LEN)          SET DC TO REG NBR       @ZA14267 09502200
         ST    &C,&PFTCBD.(0,1)        STORE TCB ADDRESS           @L1C 09502300
.CHKECB  ANOP                                                  @ZA14267 09502400
.*                                                                      09502500
.********************************************************************** 09502600
.*  Process the ECB= keyword (store in the PEL-PREFIX).               * 09502700
.********************************************************************** 09502800
.*                                                                      09502900
         AIF   ('&ECB' EQ '').CHKMAS   ECB NOT CODED               @P2C 09503000
         AIF   ('&ECB'(1,1) NE '(').CHKMAS                     @ZA14267 09503100
.* (IF ECB WAS CODED BUT NOT AS A REG, IT IS ALREADY IN PFX)   @ZA14267 09503200
&LEN     SETA  K'&ECB-2                SET LEN OF REG NBR      @ZA14267 09503300
&C       SETC  '&ECB'(2,&LEN)          SET &C TO REG NBR       @ZA14267 09503400
.*                                                                 @L1D 09503500
         ST    &C,&PFECBD.(0,1)        STORE ECB ADDRESS           @L1C 09503600
.*                                                                      09503700
.********************************************************************** 09503800
.*  Process the MASID= keyword.                                       * 09503900
.********************************************************************** 09504000
.*                                                                      09504100
.CHKMAS  AIF   ('&MASID' EQ '').CHKMTC        SKIP MASID SETUP     @L1A 09504200
         AIF   ('&MASID' EQ '0').CHKMTC                            @L1A 09504300
         AIF   ('&MASID'(1,1) EQ '(').IMASINR                      @L1A 09504500
         L     0,&MASID                PICK UP MASID VALUE         @L1A 09504700
&C       SETC  '0'                     REGISTER 0 IS MASID SOURCE  @L1A 09504900
         AGO   .IMASST                 STORE MASID IN LIST         @L1A 09505100
.IMASINR ANOP                          MF=I, MASID IS IN REGISTER  @L1A 09505300
&LEN     SETA  K'&MASID-2              SET &LEN TO LEN OF REG NBR  @L1A 09505500
&C       SETC  '&MASID'(2,&LEN)        REG NBR IS MASID SOURCE     @L1A 09505700
.IMASST  ST    &C,&PFMASD.(1)          SET MASID VALUE IN LIST     @L1A 09505900
.*                                                                      09506000
.********************************************************************** 09506100
.*  Process the MTCB= keyword.                                        * 09506200
.********************************************************************** 09506300
.*                                                                      09506400
.CHKMTC  AIF   ('&MTCB' EQ '').CHKEND         SKIP MTCB SETUP      @L1A 09506700
         AIF   ('&MTCB' EQ '0').CHKEND                             @L1A 09506900
         AIF   ('&MTCB'(1,1) EQ '(').IMTCINR                       @L1A 09507100
         L     0,&MTCB                 PICK UP MTCB VALUE          @L1A 09507300
&C       SETC  '0'                     REGISTER 0 IS MTCB SOURCE   @L1A 09507500
         AGO   .IMTCST                 STORE MTCB IN LIST          @L1A 09507700
.IMTCINR ANOP                          MF=I, MTCB IS IN REGISTER   @L1A 09507900
&LEN     SETA  K'&MTCB-2               SET &LEN TO LEN OF REG NBR  @L1A 09508100
&C       SETC  '&MTCB'(2,&LEN)         SET &C TO REG NBR           @L1A 09508300
.IMTCST  ST    &C,&PFMTCD.(1)          SET MTCB VALUE IN LIST      @L1A 09508500
.CHKEND  ANOP                                                      @L1A 09508700
.*                                                                      09508800
.********************************************************************** 09508900
.*  Adjust the parameter list pointer, Register 1, past the prefix,   * 09509000
.*  if present.                                                       * 09509100
.********************************************************************** 09509200
.*                                                                      09509300
.CHKLA   AIF   (&PFLEN EQ 0).SETUP     NO PREFIX                   @L1C 09509500
.*                                                                 @L1D 09509700
         LA    1,&PFLEN.(0,1)          MOVE POINTER PAST PREFIX    @L1C 09509900
.*                                                                2@L1D 09510100
.SETUP   ANOP                                                           09510300
&LIST    SETA  0                         INDEX TO PARAMETER LIST        09510500
&QN      SETA  1                                                        09510700
.*                                                                      09510800
.********************************************************************** 09510900
.********************************************************************** 09511000
.******      Loop to generate a PEL for each Resource Name.      ****** 09511100
.********************************************************************** 09511200
.******                  Standard Form (MF=I)                    ****** 09511300
.********************************************************************** 09511400
.********************************************************************** 09511500
.*                                                                      09511600
.LOOP2   ANOP                                                           09511700
&RN      SETA  &QN+1                                                    09511800
&RL      SETA  &QN+2+&NQ                                                09511900
&LIST    SETA  &LIST+1                  POINT INDEX TO RNAME LENGTH     09512100
         AIF   ('&P(&RL)' EQ '').NOREGL                                 09512300
         AIF   ('&P(&RL)'(1,1) NE '(').NOREGL                           09512500
&LEN     SETA  K'&P(&RL)-2                                              09512700
&C       SETC  '&P(&RL)'(2,&LEN)                                        09512900
         STC   &C,&LIST.(0,1)                     STORE RNAME LENGTH    09513100
.*                                                                      09513200
.********************************************************************** 09513300
.*  Process the PELMAJA field (QNAME address)                         * 09513400
.********************************************************************** 09513500
.*                                                                      09513600
.NOREGL  ANOP                                                           09513900
&LIST    SETA  &LIST+3                   ADDRESS QNAME ADDRESS SLOT     09514100
         AIF   ('&P(&QN)'(1,1) NE '(').NOREGQ                           09514300
&LEN     SETA  K'&P(&QN)-2                                              09514500
&C       SETC  '&P(&QN)'(2,&LEN)                                        09514700
         ST    &C,&LIST.(0,1)                     STORE QNAME ADDRESS   09514900
.*                                                                      09515000
.********************************************************************** 09515100
.*  Process the PELMINA field (RNAME address)                         * 09515200
.********************************************************************** 09515300
.*                                                                      09515400
.NOREGQ  ANOP                                                           09515700
&LIST    SETA  &LIST+4                                                  09515900
         AIF   ('&GENERIC' EQ 'YES').NOREGR                      X02113 09516100
.*                                     IGNORE RNAME IF GENERIC   X02113 09516300
         AIF   ('&P(&RN)'(1,1) NE '(').NOREGR                           09516500
&LEN     SETA  K'&P(&RN)-2                                              09516700
&C       SETC  '&P(&RN)'(2,&LEN)                                        09516900
         ST    &C,&LIST.(0,1)                     STORE RNAME ADDRESS   09517100
.NOREGR  ANOP                                                           09517300
&LIST    SETA  &LIST+4                                                  09517500
&QN      SETA  &QN+4+&NQ                                                09517700
         AIF   (&QN LE &NUMBER).LOOP2                            X02113 09517900
.*                                                                      09518000
.********************************************************************** 09518100
.********************************************************************** 09518200
.******    End loop to generate a PEL for each Resource Name.    ****** 09518300
.********************************************************************** 09518400
.******                  Standard Form (MF=I)                    ****** 09518500
.********************************************************************** 09518600
.********************************************************************** 09518700
.*                                                                      09518800
.********************************************************************** 09518900
.*  Process the PELUCBAA field if UCB= was specified.                 * 09519000
.********************************************************************** 09519100
.*                                                                      09519200
.END1    AIF   ('&UCB' EQ '').EXITMIE                              @03C 09519300
.*                                                                1@03D 09519400
         AIF   ('&UCB'(1,1) NE '(').EXITMIE                        SDS1 09519500
&LEN     SETA  K'&UCB-2                                            SDS1 09519600
&C       SETC  '&UCB'(2,&LEN)                                      SDS1 09519700
         ST    &C,&LIST.(0,1)     STORE UCB PARAMETER              SDS1 09519800
.EXITMIE AIF   (&IHBDEQ OR &IHBRES).MEXIT   EXIT MF=I OR MF=E      SDS1 09520800
         SVC   56                                                       09520900
.*                                                                      09521000
.********************************************************************** 09521100
.********************************************************************** 09521200
.*   Exit Macro without generating an SVC for both DEQ and RESERVE.   * 09521300
.********************************************************************** 09521400
.********************************************************************** 09521500
.*                                                                      09521600
.MEXIT   MEXIT                                                          09521700
.*                                                                      09521800
.********************************************************************** 09521900
.********************************************************************** 09522000
.******                 Process Execute Form (MF=E)              ****** 09522100
.********************************************************************** 09522200
.********************************************************************** 09522300
.*                                                                      09522400
.********************************************************************** 09522500
.*  Store values from registers, if necessary.                        * 09522600
.********************************************************************** 09522700
.*                                                                      09522800
.EROUT   ANOP                                                           09522900
         AIF   (N'&MF NE 2).ERR4                                        09523000
.*                                                                      09523100
.********************************************************************** 09523200
.*  Point Register 1 at the PEL Prefix, if necessary.                 * 09523300
.********************************************************************** 09523400
.*                                                                      09523500
         AIF   (&PFLEN EQ 0).INNRA     NO PREFIX                   @L1A 09523600
         AIF   ('&MF(2)'(1,1) EQ '(').GETPFL                       @L1A 09523700
&NAME    DS    0H                      INITIALIZE PARAMETER-LIST   @L1A 09523800
         AGO   .PFTCB                  TEST FOR TCB OPERAND        @L1A 09523900
.GETPFL  ANOP                                                      @L1A 09524100
&NAME    LA    0,&PFLEN.(0,0)          GET LENGTH OF PREFIX        @L1A 09524300
         AIF   (K'&MF(2) EQ 3 AND '&MF(2)'(2,1) EQ '1').INREG1     @L1M 09524500
.*                                     CHECK IF PARM LIST ADDR     @L1M 09524700
.*                                     IS IN REG 1                 @L1M 09524900
&LEN     SETA  K'&MF(2)-2              IF NOT IN REG1, GET REG     @L1M 09525100
&C       SETC  '&MF(2)'(2,&LEN)        AND PUT CONTENTS IN REG 1   @L1M 09525300
         LR    1,&C                    SET PARM LIST IN REG 1      @L1M 09525500
.INREG1  SR    1,0                     ADDRESS THE PREFIX          @L1M 09525700
.*                                                              002@L1D 09525900
.PFTCB   AIF   ('&TCB' EQ '').PFECB    GO CHECK FOR ECB            @L1C 09526100
.*                                                                      09526200
.********************************************************************** 09526300
.*  Process the TCB= keyword (store in the PEL-PREFIX).               * 09526400
.********************************************************************** 09526500
.*                                                                      09526600
&BA(1)   SETB  1                    TCB OPERAND IS PRESENT         @L1C 09526900
         AIF   ('&MF(2)'(1,1) EQ '(').RSVTCB                       @L1C 09527100
.*                                                                 @L1D 09527300
         AIF   ('&TCB'(1,1) EQ '(').STCBINR                        @L1C 09527500
         L     0,&TCB                  PICK UP TCB ADDRESS         @L1C 09527700
&C       SETC  '0'                                                 @L1C 09527900
         AGO   .STCBST                                             @L1C 09528100
.*                                                               X02113 09528300
.STCBINR ANOP                                                      @L1C 09528500
&LEN     SETA  K'&TCB-2                SET &LEN TO LEN OF REG NBRX02113 09528700
&C       SETC  '&TCB'(2,&LEN)          SET &C TO REG NBR         X02113 09528900
.STCBST  ST    &C,&MF(2)-&PFLEN+&PFTCBD   SET TCB ADDRESS IN LIST  @L1C 09529100
         AGO   .PFECB                          TCB OPERAND IS DONE @L1C 09529300
.*                                                              013@L1D 09529500
.RSVTCB ANOP                       MF=REG, SET VALUE OF TCB        @L1A 09529700
        AIF    ('&TCB'(1,1) EQ '(').RTCBINR                        @L1C 09529900
         L     0,&TCB                  PICK UP TCB ADDRESS       X02113 09530100
&C       SETC  '0'                                                 @L1A 09530300
.*                                                                 @L1D 09530500
         AGO   .RTCBST                                             @L1C 09530700
.*                                                               X02113 09530900
.RTCBINR ANOP                          TCB IS IN REG             X02113 09531100
&LEN     SETA  K'&TCB-2                                          X02113 09531300
&C       SETC  '&TCB'(2,&LEN)                                    X02113 09531500
.RTCBST  ST    &C,&PFTCBD.(0,1)        SET TCB IN PARM PREFIX      @L1C 09531700
.*                                                              004@L1D 09531900
.*                                                                      09532100
.********************************************************************** 09532200
.*  Process the ECB= keyword (store in the PEL-PREFIX).               * 09532300
.********************************************************************** 09532400
.*                                                                      09532500
.PFECB   AIF   ('&ECB' EQ '').PFMAS              CHECK FOR MASID   @L1A 09532900
         AIF   ('&MF(2)'(1,1) EQ '(').RSVECB                       @L1C 09533100
         AIF   ('&ECB'(1,1) EQ '(').SECBINR                        @L1C 09533300
         LA    0,&ECB                  . ADDRESS THE ECB           @L1C 09533500
&C       SETC  '0'                                                 @L1C 09533700
         AGO   .SECBST                                             @L1C 09533900
.*                                                                      09534100
.SECBINR ANOP                                                      @L1C 09534300
&LEN     SETA  K'&ECB-2                                          X02113 09534500
&C       SETC  '&ECB'(2,&LEN)          GET REGISTER NAME         X02113 09534700
.SECBST  ST    &C,&MF(2)-&PFLEN+&PFECBD   .SET ECB ADDR IN PREFIX  @L1C 09534900
         AGO   .PFMAS                    ECB OPERAND IS DONE       @L1C 09535100
.*                                                                 @L1D 09535300
.RSVECB  ANOP                      MF=REG, SET VALUE OF ECB        @L1C 09535500
.*                                                              006@L1D 09535700
         AIF   ('&ECB'(1,1) EQ '(').RECBINR                        @L1C 09535900
         LA    0,&ECB                  . AND THE ECB                    09536100
&C       SETC  '0'                                                 @L1C 09536300
.*                                                                 @L1D 09536500
         AGO   .RECBST                                             @L1C 09536700
.*                                                                      09536900
.RECBINR ANOP                                                      @L1C 09537100
&LEN     SETA  K'&ECB-2                                                 09537300
&C       SETC  '&ECB'(2,&LEN)                                           09537500
.RECBST  ST    &C,&PFECBD.(0,1)        . SET ECB IN PARM PREFIX    @L1C 09537700
.*                                                                2@L1D 09537800
.*                                                                      09537900
.********************************************************************** 09538000
.*  Process the MASID= keyword.                                       * 09538100
.********************************************************************** 09538200
.*                                                                      09538300
.PFMAS   AIF   ('&MASID' EQ '').PFMTC         SKIP MASID SETUP     @L1A 09538700
         AIF   ('&MASID' EQ '0').PFMTC                             @L1A 09538900
         AIF   ('&MF(2)'(1,1) EQ '(').RSVMAS   MF=(E,(REG)) MASID  @L1A 09539100
         AIF   ('&MASID'(1,1) EQ '(').SMASINR                      @L1A 09539300
         L     0,&MASID                PICK UP MASID VALUE         @L1A 09539500
&C       SETC  '0'                     SET &C TO 0                 @L1A 09539700
         AGO   .SMASST                 STORE MASID IN LIST         @L1A 09539900
.*                                                                 @L1A 09540100
.SMASINR ANOP                    MF=SYMBOL, SET VALUE OF MASID     @L1A 09540300
&LEN     SETA  K'&MASID-2              SET &LEN TO LEN OF REG NBR  @L1A 09540500
&C       SETC  '&MASID'(2,&LEN)        SET &C TO REG NBR           @L1A 09540700
.SMASST  ST    &C,&MF(2)-&PFLEN+&PFMASD   SET MASID VALUE IN LIST  @L1A 09540900
         AGO   .PFMTC                  MASID OPERAND DONE          @L1A 09541100
.RSVMAS  ANOP                    MF=REG, SET VALUE OF MASID        @L1A 09541300
         AIF   ('&MASID'(1,1) EQ '(').RMASINR                      @L1A 09541500
         L     0,&MASID                PICK UP MASID VALUE         @L1A 09541700
&C       SETC  '0'                     SET &C TO 0                 @L1A 09541900
         AGO   .RMASST                 STORE MASID IN LIST         @L1A 09542100
.*                                                                 @L1A 09542300
.RMASINR ANOP                    MF=REG, MASID IN REGISTER         @L1A 09542500
&LEN     SETA  K'&MASID-2              SET &LEN TO LEN OF REG NBR  @L1A 09542700
&C       SETC  '&MASID'(2,&LEN)        SET &C TO REG NBR           @L1A 09542900
.RMASST  ST    &C,&PFMASD.(1)             SET MASID VALUE IN LIST  @L1A 09543100
.*                                                                      09543200
.********************************************************************** 09543300
.*  Process the MTCB= keyword.                                        * 09543400
.********************************************************************** 09543500
.*                                                                      09543600
.PFMTC   AIF   ('&MTCB' EQ '').PFEND          SKIP MTCB SETUP      @L1A 09543900
         AIF   ('&MTCB' EQ '0').PFEND                              @L1A 09544100
         AIF   ('&MF(2)'(1,1) EQ '(').RSVMTC   MF=(E,(REG)) MTCB   @L1A 09544300
         AIF   ('&MTCB'(1,1) EQ '(').SMTCINR                       @L1A 09544500
         L     0,&MTCB                 PICK UP MTCB VALUE          @L1A 09544700
&C       SETC  '0'                     SET &C TO 0                 @L1A 09544900
         AGO   .SMTCST                 STORE MTCB IN LIST          @L1A 09545100
.*                                                                 @L1A 09545300
.SMTCINR ANOP                      MF=SYMBOL, SET VALUE OF MTCB    @L1A 09545500
&LEN     SETA  K'&MTCB-2               SET &LEN TO LEN OF REG NBR  @L1A 09545700
&C       SETC  '&MTCB'(2,&LEN)         SET &C TO REG NBR           @L1A 09545900
.SMTCST  ST    &C,&MF(2)-&PFLEN+&PFMTCD   SET MTCB VALUE IN LIST   @L1A 09546100
         AGO   .PFEND                  MTCB OPERAND DONE           @L1A 09546300
.RSVMTC  ANOP                      MF=REG, SET VALUE OF MTCB       @L1A 09546500
         AIF   ('&MTCB'(1,1) EQ '(').RMTCINR                       @L1A 09546700
         L     0,&MTCB                 PICK UP MTCB VALUE          @L1A 09546900
&C       SETC  '0'                     SET &C TO 0                 @L1A 09547100
         AGO   .RMTCST                 STORE MTCB IN LIST          @L1A 09547300
.*                                                                 @L1A 09547500
.RMTCINR ANOP                      MF=REGISTER, MTCB IN REGISTER   @L1A 09547700
&LEN     SETA  K'&MTCB-2               SET &LEN TO LEN OF REG NBR  @L1A 09547900
&C       SETC  '&MTCB'(2,&LEN)         SET &C TO REG NBR           @L1A 09548100
.RMTCST  ST    &C,&PFMTCD.(1)          SET MTCB VALUE IN LIST      @L1A 09548300
.PFEND   ANOP                                                      @L1A 09548500
.*                                                                      09548600
.********************************************************************** 09548700
.*  Adjust the parameter list pointer, Register 1, past the prefix,   * 09548800
.*  if present.                                                       * 09548900
.********************************************************************** 09549000
.*                                                                      09549100
         AIF   ('&MF(2)'(1,1) NE '(').PFSYM                        @L1A 09549300
         LA    1,&PFLEN.(0,1)          SKIP OVER PREFIX            @L1A 09549500
         AGO   .EXLOOPS                                            @L1C 09549700
.PFSYM   ANOP                                                      @L1A 09549900
         LA    1,&MF(2)                . ADDRESS THE LIST          @L1A 09550100
         AGO   .EXLOOPS                                                 09550300
.*                                                              068@L1D 09550500
.*                                                                      09550700
.INNRA   ANOP                                                           09550900
&NAME    IHBINNRA &MF(2)                                                09551100
.*                                                               X02113 09551300
.EXLOOPS ANOP                                                           09551500
.*                                                                      09551600
.********************************************************************** 09551700
.*  Prepare to set values of the keyword operands into each PEL.      * 09551800
.*  However, bypass this process if none of the following positional  * 09551900
.*  operands were specified:                                          * 09552000
.*  SMC=, RET=, UCB=, RNL=,TCB=, or LOC=.                         @03C* 09552100
.********************************************************************** 09552200
.*                                                                      09552300
&QN      SETA  1                                                        09552700
&LIST    SETA  0                                                        09552900
&BA(2)   SETB  ('&GENERIC' EQ 'YES')                                    09553000
&BA(3)   SETB  ('&RNL' EQ 'NO')     Turn on RNL bit if necessary.  @D1A 09553100
&BA(4)   SETB  ('&LOC' EQ 'ANY')    Turn on PELOCANY if necessary..@03A 09553200
&BB(1)   SETB  ('&SMC' EQ '')                                           09553300
&BB(2)   SETB  ('&RET' EQ '')                                           09553400
&BB(5)   SETB  ('&UCB' EQ '')                                      @03C 09553500
&BB(6)   SETB  ('&RNL' EQ 'YES')    Turn off RNL bit if necessary. @D1A 09553600
&BB(7)   SETB  ('&LOC' EQ 'BELOW')  Turn off PELOCANY if necessary.@03A 09553700
         AIF   ('&P' NE '').LLOOP                                       09553800
         AIF   (&BB(1) AND &BB(2) AND &BB(5) AND NOT &BA(1) AND ('&RNL'*09553900
               EQ '') AND ('&LOC' EQ '')).EXITMIE   --->>>         @03C 09554000
.*                                                                      09554100
.********************************************************************** 09554200
.*  Process omitted positional operands (EXCLUSIVE/SHARED/SCOPE).     * 09554300
.********************************************************************** 09554400
.*                                                                      09554500
&BB(3)   SETB  1                                                        09554900
&BB(4)   SETB  1                                                        09555100
         AIF   (&BB(5)).ENQ065      Skip if UCB omitted.           @01C 09555300
&BB(4)   SETB  0                                                   SDS1 09555500
&B(4)    SETB  1                                                   SDS1 09555700
.ENQ065  ANOP                                                      SDS1 09555900
&LIST    SETA  &LIST+2                                                  09556100
         AGO   .ENQ080                                             SDS1 09556300
.*                                                                      09556400
.********************************************************************** 09556500
.********************************************************************** 09556600
.******      Loop to generate a PEL for each Resource Name.      ****** 09556700
.********************************************************************** 09556800
.******                   Execute Form (MF=E)                    ****** 09556900
.********************************************************************** 09557000
.********************************************************************** 09557100
.*                                                                      09557200
.LLOOP   AIF   (&QN GT &NUMBER).ENQ110                        BH A33990 09557300
&RN      SETA  &QN+1                                                    09557400
&ES      SETA  &RN+&NQ                                                  09557500
&RL      SETA  &ES+1                                                    09557700
&SS      SETA  &RL+1                                                    09557900
.*                                                                      09558000
.********************************************************************** 09558100
.*  Process the PELSHARE flag (EXCLUSIVE/SHARED).                     * 09558200
.********************************************************************** 09558300
.*                                                                      09558400
&BB(3)   SETB  1                        ASSUME PARM IS MISSING     @P5A 09558600
         AIF   (&IHBDEQ).SHR                                            09558700
&BB(3)   SETB  ('&P(&ES)' EQ '')                                        09558900
.SHR     ANOP                                                           09559100
&BB(4)   SETB  ('&P(&SS)' EQ '')                                        09559300
&LIST    SETA  &LIST+1                                                  09559500
.*                                                                      09559600
.********************************************************************** 09559700
.*  Process the PELMILEN value (RNAME length).                        * 09559800
.********************************************************************** 09559900
.*                                                                      09560000
         AIF   ('&P(&RL)' EQ '').ECODES                                 09560300
         AIF   ('&P(&RL)'(1,1) EQ '(').EREGL                            09560500
         MVI   &LIST.(1),&P(&RL)       PELMILEN - RNAME length.         09560700
         AGO   .ECODES                                                  09560900
.EREGL   ANOP                                                           09561100
&LEN     SETA  K'&P(&RL)-2                                              09561300
&C       SETC  '&P(&RL)'(2,&LEN)                                        09561500
         STC   &C,&LIST.(0,1)                                           09561700
.ECODES  ANOP                                                           09561900
&LIST    SETA  &LIST+1                                                  09562100
.*                                                                      09562200
.********************************************************************** 09562300
.*  Bypass flag manipulation if none of the following are specified:  * 09562400
.*                                                                    * 09562500
.*  SMC=, RET=, E/S=, UCB=, TCB=, RNL=, or LOC=.                  @03C* 09562600
.********************************************************************** 09562700
.*                                                                      09562800
         AIF   (&BB(1) AND &BB(2) AND &BB(5) AND (&BB(3) OR &IHBDEQ) ANX09562900
               D &BB(4) AND NOT &BA(1) AND ('&RNL' EQ '') AND ('&LOC' EX09563000
               Q '')).ENQ090                                       @03C 09563100
         AIF   (&IHBDEQ).SHRD                                           09563200
&B(8)    SETB  ('&P(&ES)' EQ 'S')                                       09563300
         AIF   (NOT &B(8) AND NOT &BB(3) AND NOT '&P(&ES)' EQ 'E').ERR9 09563400
.SHRD    ANOP                                                           09563500
&BB(4)   SETB  0                                                   SDS1 09563600
&BB(5)   SETB  0                                                   SDS1 09563700
         AIF   (&IHBRES).ENQ070                                    @P8C 09563900
         AIF   ('&UCB' NE '').ENQ070                               @03C 09564100
&B(1)    SETB  ('&P(&SS)' EQ 'SYSTEMS')                            SDS1 09564300
&B(4)    SETB  ('&P(&SS)' EQ 'SYSTEMS')                            SDS1 09564500
         AIF   (&B(1)).ENQ080                                      SDS1 09564700
&B(1)    SETB  ('&P(&SS)' EQ 'SYSTEM')                             SDS1 09564900
         AIF   (&B(1)).ENQ080                                 BH A33990 09565100
         AIF   ('&P(&SS)' EQ 'STEP').ENQ080                    @ZA53727 09565300
         AIF   ('&P(&SS)' EQ '' AND ('&MF' EQ 'L')).ENQ080    BH A33990 09565500
&BB(4)   SETB  1                                              BH A33990 09565700
&BB(5)   SETB  1                                              BH A33990 09565900
.*                                                            BH A33990 09566100
         AIF   ('&P(&SS)' EQ '' AND ('&MF(1)' EQ 'E')).ENQ080 BH A33990 09566300
         AGO   .ERR10                                         BH A33990 09566500
.ENQ070  ANOP                       This is either a RESERVE or a DEQ   09566600
.*                                  with the UCB option.           @03C 09566700
         AIF   ('&P(&SS)' EQ 'SYSTEMS' OR '&P(&SS)' EQ '').ENQ075  IS   09566800
.*                                       SCOPE VALID WITH UCB ?    @P7A 09566900
         AIF   (&IHBRES).ENQ072          NO, GIVE A WARNING MSG    @P8C 09567000
.*                                                                1@03D 09567100
         IHBERMAC 1015,&P(&SS),UCB,SYSTEMS  SCOPE IS INVALID W/UCB @P7A 09567200
         AGO   .ENQ075                                             @P8A 09567300
.*                                                                3@03D 09567400
.ENQ072  ANOP      A RESERVE SPECIFIED SCOPE OF STEP OR SYSTEM     @P8A 09567600
         IHBERMAC 1015,&P(&SS),RESERVE,SYSTEMS   SCOPE IS INVALID ON    09567700
.*                                       A RESERVE                 @P8A 09567800
.ENQ075  ANOP                                                      @P7A 09567900
&B(4)    SETB  1                                                   SDS1 09568000
.ENQ080  ANOP                                                      SDS1 09568100
         AIF   (&BA(1) OR &BA(2) OR &BA(3) OR &BB(6) OR &BA(4)).ENQ083  09568200
.*                                  If either TCB=, GENERIC=YES,        09568300
.*                                  RNL=NO/YES, or LOC=ANY were         09568400
.*                                  specified then...go set the option  09568500
.*                                  masks.                         @03C 09568600
         AGO   .ENQ085                                                  09568700
.ENQ083  ANOP                                                           09568800
&LISTA   SETA  &LIST-2                                                  09568900
&MASK0NI SETA  255-4*&BB(6)                                             09569000
.*                                  Set AND option mask.                09569100
&MASK0OI SETA  32*&BA(4)+4*&BA(3)+2*&BA(2)+&BA(1)                  @03C 09569200
.*                                  Set OR option mask.                 09569300
         AIF   (&MASK0OI EQ 0).ENQ084 If there are not options to add,  09569400
.*                                    branch around turning them on.    09569500
         OI    &LISTA.(1),&MASK0OI  Turn on PELLAST option flags.       09569600
&MASK0NI SETA  &MASK0NI-64          Turn off PELIGNOR.                  09569700
.ENQ084  ANOP                                                           09569800
         NI    &LISTA.(1),&MASK0NI  Turn off PELLAST options flags that 09569900
.*                                  should not be set.                  09570000
.ENQ085  ANOP                            GENERATE THE NI AND OI@ZA53727 09570100
.*                                       TO UPDATE THE FLAG    @ZA53727 09570200
.*                                       BYTE IN THE RESOURCE  @ZA53727 09570300
.*                                       ELEMENTS SPECIFIED.   @ZA53727 09570400
&MASK2NI SETA  128*&BB(3)+64*&BB(4)+48*&BB(1)+8*&BB(5)+7*&BB(2)         09570500
         AIF   (&MASK2NI EQ 255).ENQ087                            @P5C 09570600
         NI    &LIST.(1),&MASK2NI        SET OPTIONS SPECIFIED @ZA00466 09570700
&MASK2OI SETA  128*&B(8)+64*&B(1)+32*&B(2)+16*&B(3)+8*&B(4)+4*&B(5)+2*&X09570800
               B(6)+&B(7)                                          SDS1 09570900
         AIF   (&MASK2OI EQ 0).ENQ087    GENERATE LOOP BUT NOT @ZA26497 09571000
.*                                       OI IF RET=NONE        @ZA26497 09571100
         OI    &LIST.(1),&MASK2OI        FOR THIS ELEMENT      @ZA00466 09571200
.ENQ087  ANOP                            CHECK WHETHER A LOOP MUST BE   09571300
.*                                       GENERATED                 @P5A 09571400
         AIF   ('&UCB' NE '').ENQ090     No loop if RESERVE.       @03C 09571600
         AIF   ('&MF(1)' NE 'E').ENQ090  IS IT EXEC FORM       @ZA00466 09571800
         AIF   (&QN GT 1).ENQ090         BRANCH AROUND BUILDING@ZA53727 09571900
.*                                       CODE FOR LOOP IF NOT  @ZA53727 09572100
.*                                       FIRST TIME THROUGH    @ZA53727 09572300
.*                                                             @ZA53727 09572500
&MASK0NI SETA  255-64*&BA(3)-4*&BB(6)    Turn off PELIGNOR or RNL bits. 09572600
&M(1)    SETB  (&MASK0NI NE 255)         BITS TO 'AND' ?           @P5A 09572700
&MASK0OI SETA  4*&BA(3)                  TURN ON RNL BIT           @P5A 09572800
&M(2)    SETB  (&MASK0OI NE 0)           BITS TO 'OR' ?            @P5A 09572900
&MASK2NI SETA  128+64+48*&BB(1)+8+7*&BB(2)                     @ZA53727 09573000
&M(3)    SETB  (&MASK2NI NE 255)         BITS TO 'AND' ?           @P5A 09573100
&MASK2OI SETA  32*&B(2)+16*&B(3)+4*&B(5)+2*&B(6)+&B(7)         @ZA53727 09573200
&M(4)    SETB  (&MASK2OI NE 0)           BITS TO 'OR' ?            @P5A 09573300
         AIF   (NOT (&M(1) OR &M(3))).ENQ090   NO LOOP IF NO BITS ARE   09573400
.*                                       TO BE CHANGED             @P5A 09573500
.*                                                                      09573600
.*                                       IT IS NECESSARY TO    @ZA53727 09573700
.*                                       GENERATE THE FOLLOWING@ZA53727 09573800
.*                                       LOOP BECAUSE ALL      @ZA53727 09573900
.*                                       RESOURCE ELEMENTS IN  @ZA53727 09574000
.*                                       THE PARM LIST MAY NOT @ZA53727 09574100
.*                                       BE SPECIFIED IN THE   @ZA53727 09574200
.*                                       EXECUTE FORM. IF RET  @ZA53727 09574300
.*                                       OR SMC PARAMETERS WERE@ZA53727 09574400
.*                                       SPECIFIED, THE FLAG   @ZA53727 09574500
.*                                       BYTE IN EACH ELEMENT  @ZA53727 09574600
.*                                       IN THE PARMLIST MUST  @ZA53727 09574700
.*                                       BE UPDATED.           @ZA53727 09574900
.*                                                             @ZA53727 09575100
.* IF RNL PARAMETER WAS SPECIFIED, THE CORRESPONDING BITS IN THE        09575200
.* FIRST FLAG BYTE MUST ALSO BE UPDATED ACCORDINGLY.               @P5A 09575300
.*                                                                      09575400
.* CALCULATE SIZE OF LOOP: TWELVE BYTES FOR TM, BO AND LA, PLUS         09575500
.* FOUR BYTES FOR EACH BIT OPERATION (NI, OI) TO BE DONE           @P5A 09575600
.*                                                                      09575700
&BSIZE   SETA  (12+4*(&M(1)*(1+&M(2))+&M(3)*(1+&M(4))))            @P5A 09575800
         LR    14,1                      PRESERVE REG 1        @ZA00466 09575900
         TM    0(14),128                 IS IT END OF LIST     @ZA00466 09576000
         BO    *+&BSIZE                  YES, GET OUT OF LOOP      @P5C 09576100
         LA    14,12(14)                 INDEX TO NEXT ENTRY   @ZA00466 09576200
         AIF   (NOT &M(1)).ENQNO0        BITS MUST BE RESET  ?     @P5A 09576300
         NI    &LISTA.(14),&MASK0NI      TURN OFF OPTIONS          @P5A 09576400
         AIF   (NOT &M(2)).ENQNO0        BITS MUST BE SET ?        @P5A 09576500
         OI    &LISTA.(14),&MASK0OI      TURN ON OPTIONS           @P5A 09576600
.ENQNO0  AIF   (NOT &M(3)).ENQNO2                              @ZA26497 09576700
         NI    &LIST.(14),&MASK2NI       SET RET AND SMC IN ALL@ZA53727 09576800
         AIF   (NOT &M(4)).ENQNO2                                       09576900
         OI    &LIST.(14),&MASK2OI       ELEMENTS IN LIST.     @ZA53727 09577000
.ENQNO2  ANOP                                                           09577100
         B     *-&BSIZE                  STAY IN LOOP              @P5C 09577200
.*                                                                      09577600
.********************************************************************** 09578000
.*  Process the PELMAJA field (QNAME address)                         * 09578400
.********************************************************************** 09578800
.*                                                                      09579200
.ENQ090  AIF   ('&P' EQ '').ENQ100                             SDS1     09579700
&LIST    SETA  &LIST+2                                                  09579900
         AIF   ('&P(&QN)' EQ '').ERN                                    09580100
         AIF   ('&P(&QN)'(1,1) EQ '(').EQNREG                           09580300
         LA    14,&P(&QN)                GET QNAME ADDRESS              09580500
         ST    14,&LIST.(0,1)            STORE QNAME ADDRESS            09580700
         AGO   .ERN                                                     09580900
.EQNREG  ANOP                                                           09581100
&LEN     SETA  K'&P(&QN)-2                                              09581300
&C       SETC  '&P(&QN)'(2,&LEN)                                        09581500
         ST    &C,&LIST.(0,1)            STORE QNAME ADDRESS            09581700
.ERN     ANOP                                                           09581900
&LIST    SETA  &LIST+4                                                  09582100
.*                                                                      09582200
.********************************************************************** 09582300
.*  Process the PELMINA field (RNAME address)                         * 09582400
.********************************************************************** 09582500
.*                                                                      09582600
         AIF   ('&P(&RN)' EQ '').EEND                                   09582900
         AIF   ('&GENERIC' EQ 'NO').NOGEN4                       X02113 09583100
         IHBERMAC 1016,RNAME,GENERIC                             X02113 09583300
         AGO   .EEND                                             X02113 09583500
.NOGEN4  ANOP                                                    X02113 09583700
         AIF   ('&P(&RN)'(1,1) EQ '(').ERNREG                           09583900
         LA    14,&P(&RN)                GET RNAME ADDRESS              09584100
         ST    14,&LIST.(0,1)            STORE RNAME ADDRESS            09584300
         AGO   .EEND                                                    09584500
.ERNREG  ANOP                                                           09584700
&LEN     SETA  K'&P(&RN)-2                                              09584900
&C       SETC  '&P(&RN)'(2,&LEN)                                        09585100
         ST    &C,&LIST.(0,1)            STORE RNAME ADDRESS            09585300
.EEND    ANOP                                                           09585500
&LIST    SETA  &LIST+4                                                  09585700
&QN      SETA  &QN+4+&NQ                                                09585900
         AGO   .LLOOP                                                   09586100
.*                                                                      09586200
.********************************************************************** 09586300
.********************************************************************** 09586400
.******    End loop to generate a PEL for each Resource Name.    ****** 09586500
.********************************************************************** 09586600
.******                   Execute Form (MF=E)                    ****** 09586700
.********************************************************************** 09586800
.********************************************************************** 09586900
.*                                                                      09587000
.ENQ100  ANOP                                                      SDS1 09587100
.*                                                                      09587200
.********************************************************************** 09587300
.*  Process the PELUCBAA field if UCB= was specified.                 * 09587400
.********************************************************************** 09587500
.*                                                                      09587600
&LIST    SETA  12                                                  SDS1 09587700
.ENQ110  ANOP                                                      @L2C 09587800
.*                                                                1@03D 09587900
         AIF   ('&UCB' EQ '').EXITMIE                              @L2C 09588000
         AIF   ('&UCB'(1,1) EQ '(').ENQ120                         SDS1 09588100
         LA    14,&UCB            GET UCB PARAMETER                SDS1 09588300
         ST    14,&LIST.(0,1)     STORE UCB PARAMETER              SDS1 09588500
         AGO   .EXITMIE                                            SDS1 09588700
.ENQ120  ANOP                                                      SDS1 09588900
&LEN     SETA  K'&UCB-2                                            SDS1 09589100
&C       SETC  '&UCB'(2,&LEN)                                      SDS1 09589300
         ST    &C,&LIST.(0,1)     STORE UCB PARAMETER              SDS1 09589500
         AGO   .EXITMIE                                            SDS1 09589700
.*                                                               10@03D 09590400
.*                                                                      09591100
.********************************************************************** 09591200
.*  Process error messages and exit.                                  * 09591300
.********************************************************************** 09591400
.*                                                                      09591500
.ERR1    IHBERMAC 2                    INVALID FIRST OPERAND            09591600
         AGO   .ERREX                                                   09591700
.ERR2    IHBERMAC  24                  REQ'D OPERANDS NOT SPECIFIED     09591800
         AGO   .ERREX                                                   09591900
.ERR3    IHBERMAC 69                   INVALID REG NOTATION WITH MF=L   09592000
         AGO   .ERREX                                                   09592100
.ERR4    IHBERMAC  35,,&MF             INVALID MF OPERAND SPEC - MF=XXX 09592200
         AGO   .ERREX                                                   09592300
.ERR5    IHBERMAC 157,RET,&RET         INVALID CODE FOR RET - IGNORED   09592500
         AGO   .ERREX                                                   09592700
.ERR6    IHBERMAC 1001,DEQ,,&ECB       INVALID DEQ OP SPEC - ECB=       09592900
         AGO   .ERREX                                                   09593100
.ERR7    IHBERMAC 196                 MORE THAN 5 POSITIONAL OPERANDS   09593300
&IHBRES  SETB  0                                                   SDS1 09593500
         MEXIT                                                          09593700
.ERR8    IHBERMAC 1001,SMC,&SMC       INVALID SMC SPECIFIED    @ZA12435 09593900
         AGO   .ERREX                                                   09594100
.ERR9    IHBERMAC 157,SCOPE,&P(&ES)   INVALID CODE FOR SCOPE-IGNORED    09594300
         AGO   .ERREX                                                   09594500
.ERR10   IHBERMAC 157,SYSTEMS,&P(&SS) INVALID CODE FOR SYSTEMS - IGNORE 09594700
         AGO   .ERREX                                                   09594900
.ERR11   IHBERMAC 1003,RET,SMC       RET AND/OR SMC PARAMETERS INVALID  09595100
         AGO   .ERREX                                            X02113 09595300
.ERR11B  MNOTE 12,'When MTCB is used, MASID must also be specified.'    09595400
.*                                                                 @02C 09595500
         AGO   .ERREX                                              @L1A 09595600
.ERR12   IHBERMAC 1020,SMC,TCB         SMC INVALID WITH TCB      X02113 09595700
         AGO   .ERREX                                            X02113 09595800
.ERR13   IHBERMAC 1003,RET,TCB         INVALID RET AND/OR TCB    X02113 09595900
         AGO   .ERREX                                            X02113 09596100
.ERR15   IHBERMAC 1001,TCB,&TCB        INVALID TCB SPECIFIED     X02113 09596300
         AGO   .ERREX                                            X02113 09596500
.ERR15A  IHBERMAC 1001,MASID,&MASID    INVALID MASID SPECIFIED     @L1A 09596700
         AGO   .ERREX                                              @L1A 09596900
.ERR15B  IHBERMAC 1001,MTCB,&MTCB      INVALID MTCB SPECIFIED      @L1A 09597100
         AGO   .ERREX                                              @L1A 09597300
.ERR16   IHBERMAC 1001,GENERIC,&GENERIC                          X02113 09597500
.*                                     INVALID GENERIC SPECIFIED X02113 09597700
         AGO   .ERREX                                            X02113 09597900
.ERR17   IHBERMAC 1003,RET,GENERIC     RET AND/OR GENERIC INVALIDX02113 09598100
         AGO   .ERREX                                            X02113 09598300
.ERR18   IHBERMAC 1014,GENERIC         GENERIC INVALID ON ENQ OR X02113 09598500
.*                                     RESERVE                   X02113 09598700
         AGO   .ERREX                                              @D1A 09598800
.ERR19   IHBERMAC 1001,RNL,&RNL        INVALID RNL SPECIFIED       @D1A 09598900
         AGO   .ERREX                                              @02A 09648900
.ERR20   MNOTE 12,'When MASID is used, MTCB must also be specified.'    09698900
.*                                                                 @02A 09748900
         AGO   .ERREX                                              @02A 09798900
.ERR21   MNOTE 12,'RET=NONE cannot be used with MASID or MTCB.'    @02A 09848900
         AGO   .ERREX                                              @02A 09898900
.ERR22   MNOTE 12,'RET=USE cannot be used with MASID or MTCB.'     @02A 09948900
         AGO   .ERREX                                              @02A 09998900
.ERR23   MNOTE 12,'A valid RET= value must be coded with MASID/MTCB.'   10048900
.*                                                                 @02A 10098900
         AGO   .ERREX                                              @02A 10148900
.ERR24   MNOTE 12,'RET=CHNG cannot be used with MASID or MTCB.'    @02A 10198900
         AGO   .ERREX                                              @02A 10248900
.ERR25   MNOTE 12,'SMC=STEP cannot be used with MASID or MTCB.'    @02A 10298900
         AGO   .ERREX                                              @02A 10348900
.ERR26   MNOTE 12,'TCB cannot be specified with MASID or MTCB.'    @02A 10398900
         AGO   .ERREX                                              @L2A 10408900
.ERR27   IHBERMAC 1001,LOC,&LOC     Invalid LOC specified.         @03C 10422200
.*                                                                1@03D 10435500
.ERREX   ANOP                                                           10448900
&IHBDEQ  SETB  0                                                        10498900
&IHBRES  SETB  0                                                   SDS1 10548900
         MEND                                                           25250002
**/                                                                     25300002
*   ENQ:/*************************************************************/ 25350002
*   /* PL/S VERSION OF ENQ MACRO                                     */ 25400002
*   /*****************************************************************/ 25450002
*      MACRO KEYS(MF,RET,RNL,ECB,SMC,TCB,LS,OUTR15,RELATED);            25500000
*        ANS('?'||MACLABEL||'ENQP '||MACLIST||MACKEYS||';');            25550002
*%END;                                                                  25600002
