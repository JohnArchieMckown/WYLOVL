*%/*                                                                    00025000
         MACRO                                                          00050000
&NAME    SCHEDULE  &SRB=,&SCOPE=LOCAL,&LLOCK=,&FRR=,&DISABLE,&CLEAR=,  X00100000
               &COMPAT=,&STOKEN=,&FEATURE=,&MODE=,&SPTOKEN=        @D2C 00140000
.********************************************************************** 00160000
.*                                                                      00180000
.*01*  MACRO NAME = SCHEDULE                                            00204400
.*                                                                      00228800
.*01*  COPYRIGHT =                                                 @L2C 00260400
.*                                                                      00292000
.*       5655-068                                                       00323600
.*       THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                    00355200
.*       (C) COPYRIGHT IBM CORP. 1977, 1993                             00386800
.*       LICENSED MATERIALS - PROPERTY OF IBM                           00418400
.*                                                                      00450000
.*     STATUS = HBB5510                                            @D2C 00500000
.*                                                                      00550000
.*01*  FUNCTION = PROVIDES INTERFACE WITH APPROPRIATE SCHEDULE ROUTINES 00550700
.*                RESIDING IN IEAVESC0 AND IEAVSCHA.                    00551400
.*                                                                      00552100
.*01*  NOTES =                                                          00552800
.*                                                                      00553500
.*02*    GENERAL =                                                      00554200
.*                                                                      00554900
.*    *  FFR AND LLOCK OPTIONS ARE SET USING THE &YBIT AND &NBIT        00555200
.*       LOCAL VARIABLES.  THE &YBIT AND &NBIT VARIABLES ARE REALLY     00555500
.*       MASKS THAT ARE USED TO MANIPULATE THE BIT STRING SRBFLGS1.     00555800
.*                                                                      00556100
.*    *  SCHEDULE ROUTES CONTROL TO MULTIPLE ROUTINES IN IEAVESC0 AND   00556400
.*       IEAVSCHA.                                                      00556700
.*                                                                      00557000
.*       THE ADDRESSES OF THESE ROUTINES ARE DEPENDENT ON THE           00557300
.*       OPTIONS SPECIFIED ON THE MACRO INVOCATION.  THE ADDRESSES      00557600
.*       OF THESE ROUTINES ARE STORED AT KNOWN OFFSETS IN THE PSA,      00557900
.*       SVT AND ECVT.                                                  00558200
.*                                                                      00558500
.*    *  THE OFFSETS OF THE ROUTINE ADDRESSES ARE STORED IN AN ARRAY    00558800
.*       USING A BIT MASK TECHNIQUE TO ADDRESS THE APPROPRIATE ENTRY    00559100
.*       IN THE ARRAY.  THE BIT MASK IS SIMULATED USING THE DECIMAL     00559400
.*       EQUIVALENT VALUE OF A BINARY NUMBER.  THE INDEX OF THE ARRAY,  00559700
.*       THUS, CAN BE THOUGHT OF AS A BIT STRING.  SIMPLY               00560000
.*       CONVERT ITS DECIMAL VALUE TO BINARY TO SEE WHICH BITS, OR      00560300
.*       IN THE CASE OF THIS MACRO, WHICH OPTIONS, WERE SPECIFIED.      00560600
.*                                                                      00560900
.*                                                                      00561200
.*02*    SYNTAX =                                                       00561500
.*                                                                      00561800
.*  <LABEL>  SCHEDULE                                                   00562100
.*                                                                      00562400
.*           SRB=(REG)                  <--- 1 THROUGH 12               00562700
.*               SRB ADDRESS            <--- RX ADDRESS                 00563000
.*                                                                      00563300
.*           <,SCOPE=LOCAL                                              00563600
.*                   GLOBAL>                                            00563900
.*                                                                      00564200
.*           <,LLOCK=YES                                                00564500
.*                   NO>                                                00564800
.*                                                                      00565100
.*           <,FRR=YES                                                  00565400
.*                 NO>                                                  00565700
.*                                                                      00566000
.*           <,MODE=NONXM                                               00566300
.*                  FULLXM>                                             00566600
.*                <,SPTOKEN=SPTOKEN ADDRESS>  <--- RX Address           00566700
.*                                                                      00566900
.*           <,STOKEN=STOKEN ADDRESS>   <--- RX ADDRESS                 00567200
.*                                                                      00567500
.*           <,FEATURE=CRYPTO>                                          00567600
.*                                                                      00567700
.*           <,DISABLED>                                                00567800
.*                                                                      00568100
.*                                                                      00568400
.*02* SYNTAX EXCEPTIONS =                                               00568700
.*                                                                      00569000
.*    *  MODE=FULLXM and SPTOKEN= keywords are mutually exclusive       00569200
.*       of DISABLED, STOKEN, and FEATURE keywords.                     00569400
.*    *  SPTOKEN only valid for MODE=FULLXM invocations.                00569600
.*    *  SCOPE=GLOBAL is mutually exclusive of the SPTOKEN keyword.     00569800
.*                                                                      00570200
.*01*  CHANGE ACTIVITY                                                  00570500
.*                                                                      00570800
.*                   G860PXD- HBB2102 SUPPORT                           00574800
.*  $D1=DCR0158  HBB3310  861029  PD162M: SUPPORT AR MODE INVOKERS      00577900
.*  $P1=PC40422  HBB3310  861027  PD162M: CLEAR AR 1 ON AR MODE         00578900
.*                                        INVOCATION                    00579900
.*  $L1=LOCKR    HBB4410  870316  PD16Q4: SCHEDULE WITH STOKEN SUPPORT  00580400
.*                   OY11561 - CALL SCHEDUL7 WITH CORRECT PARAMETERS    00580900
.*                             AND DELETE LABEL2 WITH CALL TO SCHEDUL7  00581400
.*                                                             @YA11561 00581900
.*  $01=OY27050  JBB3313  890417  PD16CU: ENCRYPTION ASYMMETRIC FEATURE 00582000
.*                                        SUPPORT                       00582100
.*  $L2=PR420    HBB4420  900122  PD16EJ: MACRO REWORK                  00582200
.*  $L3=APPC1    HBB4420  900122  PD16EJ: SCHEDULE WITH ADDRESSABILITY  00582300
.*  $D2=DIG0033  HBB5510  930115  PD16EJ: SCHEDULE with SPTOKEN         00582400
.*                                                                      00582500
.*01*  COMPONENT = SC1C5 (SUPERVISOR CONTROL)                           00582700
.*                                                                      00582900
.*01*  DISTRIBUTION LIBRARY = AMACLIB                                   00583100
.*                                                                      00583300
.********************************************************************** 00584100
.*A-000000-999999                                              @G860PXD 00587200
.*                                                                      00593400
.********************************************************************** 00607500
.*          GLOBAL MACRO VARIABLE DECLARATIONS                        * 00621600
.********************************************************************** 00635700
.*                                                                      00650000
         GBLC  &SYSSPLV                                                 00658300
         GBLC  &SYSASCE                GLOBAL FOR SYSSTATE MACRO   @D1A 00666600
.*                                                                      00667100
.********************************************************************** 00667600
.*          LOCAL MACRO VARIABLE DECLARATIONS                         * 00668100
.********************************************************************** 00668600
.*                                                                      00669100
         LCLA  &YBIT,&NBIT             SCHEDULE OPTION BITS             00669600
         LCLA  &FRRBIT                 DECIMAL VALUE OF FRR BIT    @L2A 00670100
         LCLA  &LLCKBIT                DECIMAL VALUE OF LLOCK BIT  @L2A 00670600
         LCLA  &IHBERR                 ERROR CODE                  @L2A 00671100
         LCLA  &MAXFEAT                THE CURRENT DIMENSION OF THE    -00671200
                                       VALID FEATURE ARRAY         @01A 00671300
         LCLA  &FEATIND                INDEX FOR FEATURE ARRAY     @01A 00671400
         LCLC  &OKFEAT(1)              ARRAY OF OK FEATURES FOR        -00671500
                                       FEATURE KEYWORD             @01A 00671600
         LCLA  &OFINDEX                INDEX INTO OFFSET ARRAY     @L2A 00671700
         LCLA  &LOCLMSK                SCOPE=LOCAL INDEX           @L2A 00672100
         LCLA  &GLBLMSK                SCOPE=GLOBAL INDEX          @L2A 00672600
         LCLA  &DSBLMSK                DISABLED INDEX              @L2A 00673100
         LCLA  &STKNMSK                STOKEN INDEX                @L2A 00673600
         LCLA  &SCHAMSK                SCHEDULE WITH ADDRESSABILITY    X00674100
                                       INDEX                       @L3A 00674600
         LCLC  &OFFSET(255)            ROUTINE ADDRESS OFFSET ARRAY    X00675100
                                                                   @L2A 00675600
         LCLC  &OF                     OFFSET OF ROUTINE ADDRESS   @L2A 00676100
         LCLC  &CBUSED                 CONTROL BLOCK WHERE ROUTINE     X00676600
                                       ADDRESS IS                  @L2A 00677100
         LCLA  &LINKREG                BALR RETURN ADDRESS         @L3A 00677600
         LCLA  &WORKNDX                WORK INDEX FOR OFFSET ARRAY @L3A 00678100
         LCLA  &REG0OPT                OPTIONS SPECIFIED IN REG 0  @L3A 00678600
.*                                                                      00679100
.********************************************************************** 00679600
.*        TEST CURRENT MACRO AND SYSTEM ENVIRONMENT                   * 00680100
.********************************************************************** 00680600
.*                                                                      00681100
         SPLEVEL TEST                  TEST THE SP LEVEL                00681600
         AIF ('&SYSSPLV' EQ '1').LEVEL1 IF SP LEVEL=1 THEN USE          00682100
.*                                     SCHEDUL7 MACRO                   00682600
         SYSSTATE TEST                 GET SYSASCE VALUE           @D1A 00683200
.*                                                                      00686000
.********************************************************************** 00688800
.*        INITIALIZE LOCAL VARIABLES                                  * 00691600
.********************************************************************** 00694400
.*                                                                      00697200
&YBIT    SETA  0                                                        00700000
&NBIT    SETA  255                                                      00750000
&MAXFEAT SETA  1                                                   @01A 00750300
&OKFEAT(1) SETC   'CRYPTO'                                         @01A 00750600
&FRRBIT  SETA  32                      FRR MASK   = X'20'          @L2A 00751000
&LLCKBIT SETA  128                     LLOCK MASK = X'80'          @L2A 00752000
&IHBERR  SETA  0                       INITIALIZE ERROR CODE       @L2A 00753000
&OF      SETC  'B44'                   INITIALIZE OFFSET TO DEFAULT    X00754000
                                                                   @L2A 00755000
&LOCLMSK SETA  0                       LOCAL ARRAY  MASK  '0000 0000'  X00756000
                                                                   @L2A 00757000
&GLBLMSK SETA  1                       GLOBAL ARRAY MASK  '0000 0001'  X00758000
                                                                   @L2A 00759000
&DSBLMSK SETA  2                       DISABLE ARRAY MASK '0000 0010'  X00760000
                                                                   @L2A 00761000
&STKNMSK SETA  4                       STOKEN ARRAY MASK  '0000 0100'  X00762000
                                                                   @L2A 00763000
&SCHAMSK SETA  8                       SCHEDULE WITH ADDRESSABILITY    X00764000
                                       ARRAY MASK         '0000 1000'  X00765000
                                                                   @L3A 00766000
&FEATMSK SETA  16                      FEATURE ARRAY MASK '0001 0000'  X00766300
                                                                   @01A 00766600
&OFINDEX SETA  &LOCLMSK                SET INDEX TO DEFAULT: LOCAL     X00767000
                                       ENABLED SCHEDULE REQUEST    @L2A 00768000
&CBUSED  SETC  'PSA'                   USE PSA CONTROL BLOCK BY        X00769000
                                       DEFAULT                     @L2A 00770000
&LINKREG SETA  0                       DEFAULT RETURN ADDRESS WILL BE  X00771000
                                       IN REGISTER 0.              @L3A 00772000
&REG0OPT SETA  1                       DEFAULT REGISTER 0 OPTION IS    X00773000
                                       LOCAL SCHEDULE              @L3A 00774000
.*                                                                      00775000
.********************************************************************** 00787500
.*        INITIALIZE OFFSET ARRAY                                     * 00800000
.********************************************************************** 00812500
.*                                                                      00825000
.*                                                                      00829900
.* '0000 0000'   ===>  ASSEMBLER-H DOES NOT ALLOW SUBSCRIPT OF ZERO     00834800
.*                                                                      00839700
.* &OFFSET(0) SETC 'B44'          ===> LOCAL ENABLED SCHEDULE REQUEST   00844600
.*                                                                      00849500
.* '0000 0001'                                                          00854400
&OFFSET(1)   SETC 'B3C'           ===> GLOBAL ENABLED SCHEDULE REQUEST X00859300
                                                                   @L2A 00864200
.* '0000 0010'                                                          00869100
&OFFSET(2)   SETC 'B48'           ===> LOCAL DISABLED SCHEDULE REQUEST X00874000
                                                                   @L2A 00878900
.* '0000 0011'                                                          00883800
&OFFSET(3)   SETC 'B40'           ===> GLOBAL DISABLED SCHEDULE        X00888700
                                       REQUEST                     @L2A 00893600
.* '0000 0100'                                                          00898500
&OFFSET(4)   SETC '248'           ===> LOCAL ENABLED SCHEDULE WITH     X00903400
                                       STOKEN REQUEST              @L2A 00908300
.* '0000 0101'                                                          00913200
&OFFSET(5)   SETC '240'           ===> GLOBAL ENABLED SCHEDULE WITH    X00918100
                                       STOKEN REQUEST              @L2A 00923000
.* '0000 0110'                                                          00927900
&OFFSET(6)   SETC '24C'           ===> LOCAL DISABLED SCHEDULE WITH    X00932800
                                       STOKEN REQUEST              @L2A 00937700
.* '0000 0111'                                                          00942600
&OFFSET(7)   SETC '244'           ===> GLOBAL DISABLED SCHEDULE WITH   X00947500
                                       STOKEN REQUEST              @L2A 00952400
.*                                                                      00957300
.* ===> ALL SCHEDULE WITH ADDRESSABILITY REQUESTS ARE HANDLED BY THE    00962200
.*      SAME ROUTINE                                                    00967100
.*                                                                      00972000
.* '0000 1XXX'                                                          00976900
&WORKNDX SETA &SCHAMSK            ===> INITIALIZE ENTRIES 8-15         X00981800
                                       MASKS '0000 1000' - '0000 1111' X00986700
                                                                   @L3A 00991600
.INIT01  ANOP                                                      @L3A 00996500
&OFFSET(&WORKNDX) SETC '80'       ===> SCHEDULE WITH ADDRESSABILITY'S  X01001400
                                       OFFSET WITHIN THE ECVT.     @L3A 01006300
&WORKNDX SETA (&WORKNDX+1)             BUMP INDEX TO NEXT ENTRY.   @L3A 01011200
         AIF (&WORKNDX LT 16).INIT01   INITIALIZE NEXT ENTRY IN OFFSET X01016100
                                       ARRAY.                      @L3A 01021000
.* '0001 0000'                                                          01021100
&OFFSET(16)   SETC '25C'          ===> LOCAL ENABLED SCHEDULE WITH     X01021200
                                       FEATURE REQUEST             @01A 01021300
.* '0001 0001'                                                          01021400
&OFFSET(17)   SETC '254'          ===> GLOBAL ENABLED SCHEDULE WITH    X01021500
                                       FEATURE REQUEST             @01A 01021600
.* '0001 0010'                                                          01021700
&OFFSET(18)   SETC '260'          ===> LOCAL DISABLED SCHEDULE WITH    X01021800
                                       FEATURE REQUEST             @01A 01021900
.* '0001 0011'                                                          01022000
&OFFSET(19)   SETC '258'          ===> GLOBAL DISABLED SCHEDULE WITH   X01022100
                                       FEATURE REQUEST             @01A 01022200
.* '0001 0100'                                                          01022300
&OFFSET(20)   SETC '25C'          ===> LOCAL ENABLED SCHEDULE WITH     X01022400
                                       STOKEN AND FEATURE REQUEST  @01A 01022500
.* '0001 0101'                                                          01022600
&OFFSET(21)   SETC '254'          ===> GLOBAL ENABLED SCHEDULE WITH    X01022700
                                       STOKEN AND FEATURE REQUEST  @01A 01022800
.* '0001 0110'                                                          01022900
&OFFSET(22)   SETC '260'          ===> LOCAL DISABLED SCHEDULE WITH    X01023000
                                       STOKEN AND FEATURE REQUEST  @01A 01023100
.* '0001 0111'                                                          01023200
&OFFSET(23)   SETC '258'          ===> GLOBAL DISABLED SCHEDULE WITH   X01023300
                                       STOKEN AND FEATURE REQUEST  @01A 01023400
.*  NOTE THAT &OFFSETS 24-31 ARE INVALID, BECAUSE THIS MACRO DOES       01023500
.*  NOT SUPPORT THE COMBINATION OF THE FEATURE KEYWORD AND THE          01023600
.*  MODE=FULLXM OPTION.                                                 01023700
.*                                                                      01023800
.********************************************************************** 01025900
*        MACDATE = 01/15/93                                        @D2C 01030800
.********************************************************************** 01035700
.*                                                                      01040600
.********************************************************************** 01045500
.*    ENSURE OBSOLETE KEYWORD COMPAT IS NOT USED                      * 01050400
.********************************************************************** 01055300
.*                                                                      01060200
.DOCPT   ANOP                                                      @L2A 01065100
         AIF   ('&COMPAT' NE '').CMPERR1                           @L2C 01070000
.ENDCPT  ANOP                                                      @L2A 01074900
.*                                                                      01079800
.********************************************************************** 01084700
.*    ENSURE OBSOLETE KEYWORD CLEAR IS NOT USED                       * 01089600
.********************************************************************** 01094500
.*                                                                      01103000
.*                                                                      01106000
.DOCLR   ANOP                                                      @L2C 01109000
         AIF   ('&CLEAR' NE '').CLRERR1                            @L2C 01112000
.ENDCLR  ANOP                                                      @L2A 01115000
.*                                                                      01118000
.********************************************************************** 01130700
.*    VALIDATE SRB KEYWORD                                            * 01143400
.********************************************************************** 01156100
.*                                                                      01169000
.DOSRB   ANOP                                                      @L2A 01170800
         AIF   (N'&SRB EQ 0).SRBERR1         SRB NOT SPECIFIED     @L2C 01172600
         AIF   (N'&SRB GT 1).SRBERR2         EXCESSIVE PARAMETERS  @L2A 01174400
.ENDSRB  ANOP                                                      @L2A 01176200
.*                                                                      01178000
.********************************************************************** 01181000
.*    VALIDATE FRR KEYWORD                                            * 01184000
.********************************************************************** 01187000
.*                                                                      01190000
.DOFRR   ANOP                                                      @L2A 01190400
         AIF   ('&FRR' EQ '').ENDFRR       SKIP UPDATE IF NULL     @L2C 01190800
         AIF   (N'&FRR GT 1).FRRERR1       EXCESSIVE PARAMETERS    @L2C 01191200
.CHKFRR1 ANOP                                                      @L2A 01191600
         AIF   ('&FRR(1)' EQ 'NO').CHKFRR2 SET NO BIT IF NO SPECIFIED  X01192000
                                                                   @L2C 01192400
         AIF   ('&FRR(1)' NE 'YES').FRRERR2  MNOTE FOR INVALID OPTION  X01192800
                                                                   @L2C 01193200
.*                                                                      01193600
&YBIT    SETA  (&YBIT+&FRRBIT)             INDICATE FRR SPECIFIED  @L2C 01194000
         AGO   .ENDFRR                                             @L2A 01194400
.*                                                                      01194800
.CHKFRR2 ANOP                                                      @L2C 01195200
&NBIT    SETA  (&NBIT-&FRRBIT)             RESET FRR REQUESTED FLAG    X01195600
                                                                   @L2C 01196000
.ENDFRR  ANOP                                                      @L2A 01196400
.*                                                                      01196800
.********************************************************************** 01197200
.*    VALIDATE LLOCK KEYWORD                                          * 01197600
.********************************************************************** 01198000
.*                                                                      01198400
.DOLLK   ANOP                                                      @L2A 01198800
         AIF   ('&LLOCK' EQ '').ENDLLK                             @L2C 01199200
         AIF   (N'&LLOCK GT 1).LLKERR1                             @L2A 01199600
.CHKLLK1 ANOP                                                      @L2A 01200000
         AIF   ('&LLOCK(1)' EQ 'NO').CHKLLK2    SET LOCAL LOCK NO BIT  X01200400
                                                                   @L2C 01200800
         AIF   ('&LLOCK(1)' NE 'YES').LLKERR2   MNOTE FOR INVALID      X01201200
                                                OPTION             @L2C 01201600
.*                                                                      01202000
&YBIT    SETA  (&YBIT+&LLCKBIT)              INDICATE LL REQUESTED @L2C 01202400
         AGO   .ENDLLK                                             @L2C 01202800
.*                                                                      01203200
.CHKLLK2 ANOP                                                           01203600
&NBIT    SETA  (&NBIT-&LLCKBIT)                                    @L2C 01204000
.ENDLLK  ANOP                                                      @L2A 01204400
.*                                                                      01204800
.********************************************************************** 01205200
.*    VALIDATE FEATURE KEYWORD                                        * 01205300
.********************************************************************** 01205400
.*                                                                      01205500
.DOFEAT  ANOP                                                      @01A 01205600
         AIF ('&FEATURE' EQ '').ENDFEAT                            @01A 01205700
         AIF (N'&FEATURE GT 1).FEAERR1                             @01A 01205800
.CHKFEA1 ANOP                                                      @01A 01205900
&FEATIND SETA  1                                                   @01A 01206000
.CHKFEA2 AIF   ('&FEATURE(1)' EQ '&OKFEAT(&FEATIND)').CHKFEA3 IF A     -01206100
                                       VALID FEATURE IS FOUND THEN     -01206200
                                       SET INDEX MASK              @01A 01206300
         AIF   (&FEATIND EQ &MAXFEAT).FEAERR2 PRINT ERROR MESSAGE      -01206400
                                             INDICATING NO VALID       -01206500
                                             FEATURE WAS SPECFIED  @01A 01206600
&FEATIND SETA  &FEATIND+1                                          @01A 01206700
         AGO   .CHKFEA2                                                 01206800
.CHKFEA3 ANOP                                                      @01A 01206900
&OFINDEX SETA  (&OFINDEX+&FEATMSK)     INDICATE FEATURE REQUEST    @01A 01207000
&CBUSED  SETC  'SVT'                   INDICATE THE OFFSET IS IN THE   X01207100
                                       SVT                         @01A 01207200
.ENDFEAT ANOP                                                      @01A 01207300
.*                                                                      01207400
.********************************************************************** 01207500
.*    VALIDATE STOKEN KEYWORD                                         * 01207600
.********************************************************************** 01207700
.*                                                                      01207800
.DOSTK   ANOP                                                      @L2C 01207900
         AIF ('&STOKEN' EQ '').ENDSTK                              @L2C 01208000
         AIF (N'&STOKEN GT 1).STKERR1                              @L2C 01208100
.CHKSTK1 ANOP                                                      @L1A 01208200
         AIF   ('&STOKEN'(1,1) EQ '(').STKERR2 PRINT ERROR MESSAGE     X01208400
                                       IF STOKEN IS IN A REGISTER  @L2A 01208800
&OFINDEX SETA  (&OFINDEX+&STKNMSK)     INDICATE STOKEN REQUEST     @L2A 01209200
&CBUSED  SETC  'SVT'                   INDICATE THE OFFSET IS IN THE   X01209600
                                       SVT                         @L2A 01210000
.ENDSTK  ANOP                                                      @L2A 01210400
.*                                                                      01210800
.********************************************************************** 01211200
.*    VALIDATE DISABLE KEYWORD                                        * 01211600
.********************************************************************** 01212000
.*                                                                      01212400
.DODIS   ANOP                                                      @L2A 01212800
         AIF   ('&DISABLE' EQ '').ENDDIS                           @L2C 01213200
         AIF   ('&DISABLE' NE 'DISABLED').DISERR1                  @L2C 01213600
&OFINDEX SETA  (&OFINDEX+&DSBLMSK)     INDICATE USER DISABLED      @L2A 01214000
.ENDDIS  ANOP                                                      @L2A 01214400
.*                                                                      01214800
.********************************************************************** 01215200
.*    VALIDATE MODE KEYWORD                                           * 01215600
.********************************************************************** 01216000
.*                                                                      01216400
.DOMOD   ANOP                                                      @L3A 01216800
         AIF   ('&MODE' EQ '').ENDMOD                              @L3A 01217200
         AIF   (N'&MODE GT 1).MODERR1                              @L3A 01217600
.CHKMOD1 ANOP                                                      @L3A 01218000
         AIF   ('&MODE(1)' EQ 'NONXM').ENDMOD                      @L3A 01218400
         AIF   ('&MODE(1)' NE 'FULLXM').MODERR2 MNOTE FOR INVALID      X01218800
                                                OPTION             @L3A 01219200
.CHKMOD2 ANOP                                                      @L3A 01219600
         AIF   ('&DISABLE' NE '').MODERR3  DISABLED KEYWORD NOT VALID  X01220000
                                    WITH MODE=FULLXM               @L3A 01220400
.CHKMOD3 ANOP                                                      @L3A 01220800
         AIF   ('&STOKEN' NE '').MODERR4   STOKEN KEYWORD NOT VALID    X01221200
                                    WITH MODE=FULLXM               @L3A 01221600
.CHKMOD4 ANOP                                                      @01A 01221700
         AIF   ('&FEATURE' NE '').MODERR5   FEATURE KEYWORD NOT VALID  X01221800
                                    WITH MODE=FULLXM               @01A 01221900
&LINKREG SETA 14                    BALR ADDRESS WILL BE REG 14    @L3A 01222000
&CBUSED  SETC 'ECVT'                SCHEDULE WITH ADDRESSABILITY       X01222400
                                    ADDRESS RESIDES IN ECVT        @L3A 01222800
&OFINDEX SETA (&OFINDEX+&SCHAMSK)   INDICATE SCHEDULE WITH             X01223200
                                    SCHEDULE WITH ADDRESSABILITY       X01223600
                                    REQUEST                        @L3A 01224000
.ENDMOD  ANOP                                                      @L3A 01224400
.*                                                                      01224800
.*                                                                      01225200
.********************************************************************** 01225600
.*    VALIDATE SCOPE KEYWORD                                          * 01226000
.********************************************************************** 01226400
.*                                                                      01226800
.*  NOTE:  THE SCOPE KEYWORD IS INITIALIZED TO 'LOCAL' EVEN IF THE      01227200
.*         INVOKER DID NOT SPECIFY THE SCOPE KEYWORD.  (SEE MACRO       01227600
.*         DECLARATION STATEMENT.)                                      01228000
.*                                                                      01228400
.DOSCP   ANOP                                                      @L2A 01228800
         AIF   (N'&SCOPE GT 1).SCPERR1        EXCESSIVE PARAMETERS @L2A 01229200
.CHKSCP1 ANOP                                                      @L2A 01229600
         AIF   ('&SCOPE(1)' EQ 'LOCAL').ENDSCP                     @L2C 01230000
         AIF   ('&SCOPE(1)' NE 'GLOBAL').SCPERR2  INVALID SCOPE    @L2C 01230400
&OFINDEX SETA  (&OFINDEX+&GLBLMSK)     INDICATE GLOBAL SCHEDULE    @L2A 01230800
&REG0OPT SETA  2                       INDICATE GLOBAL REQUEST     @L3A 01231200
.ENDSCP  ANOP                                                      @L2A 01231600
.*                                                                      01232000
.*                                                                      01232200
.********************************************************************** 01232400
.*    VALIDATE SPTOKEN KEYWORD                                        * 01232500
.********************************************************************** 01232600
.*                                                                      01232700
.*  NOTE:  MODE=FULLXM must be specified, and                           01232800
.*         SCOPE=GLOBAL must not be specified.                          01232900
.*                                                                      01233000
.*                                                                      01233100
.DOSPT   ANOP                                                      @D2A 01233200
         AIF ('&SPTOKEN' EQ '').ENDSPT   SPTOKEN is optional       @D2A 01233300
         AIF   (N'&SPTOKEN GT 1).SPTERR1  Excessive Parameters     @D2A 01233400
.CHKSPT1 ANOP                                                      @D2A 01233500
         AIF   ('&MODE(1)' NE 'FULLXM').SPTERR2  FULLXM required.  @D2A 01233600
.CHKSPT2 ANOP                                                      @D2A 01233700
         AIF   ('&SCOPE(1)' NE 'LOCAL').SPTERR3  SCOPE must be     @D2A 01233800
.*                                     LOCAL                            01233900
.CHKSPT3 ANOP                                                      @D2A 01234000
         AIF   ('&SPTOKEN'(1,1) EQ '(').SPTERR4 Print error        @D2A 01234100
.*                                     message if SPTOKEN address is in 01234200
.*                                     a register.                      01234300
&REG0OPT SETA  4                       Indicate that this is an    @D2A 01234400
.*                                     SPTOKEN request                  01234500
.ENDSPT  ANOP                                                      @D2A 01234600
.*                                                                      01234700
.********************************************************************** 01234800
.*    DETERMINE WHETHER OR NOT TO GENERATE CODE                       * 01234900
.********************************************************************** 01235000
.*                                                                      01235100
.CHK4ERR ANOP                                                      @L2A 01235200
         AIF   (&IHBERR EQ 0).GENCODE                              @L2A 01235300
         AGO   .ENDSCHD                      ERRORS FOUND -- EXIT  @L2A 01235400
.*                                                                      01235500
.********************************************************************** 01235600
.*         GENERATE CODE                                              * 01236000
.********************************************************************** 01236400
.*                                                                      01236800
.GENCODE ANOP                                                      @L2A 01237200
&NAME    DS    0H                                                       01237600
.*                                                                      01238000
.********************************************************************** 01238400
.*           ENSURE THAT SRB ADDRESS IS IN REGISTER 1                 * 01238800
.********************************************************************** 01239200
.*                                                                      01239600
.DOSRBA  ANOP                                                      @L2A 01240000
         AIF   ('&SRB'(1,1) NE '(').GENSRB1  SRB NOT A REGISTER    @L2C 01240400
         AIF   ('&SRB(1)' EQ '1').ENDSRBA    IF SRB ADDRESS ALREADY     01240800
.*                                           IN REG1, NO 'LR'           01249800
.*                                           INSTRUCTION IS NECESSARY   01266400
.*                                                                      01283000
         LR    1,&SRB(1)               .COPY SRB ADDRESS                01299600
         AGO   .ENDSRBA                                            @L2A 01333000
.GENSRB1 ANOP                                                      @L2A 01366400
         LA    1,&SRB(1)               .LOAD ADDRESS OF SRB             01400000
.ENDSRBA ANOP                                                      @L2A 01425000
.*                                                                      01450000
.********************************************************************** 01467100
.*           IF IN AR MODE, MAKE SURE AR REG 1 IS ZEROED              * 01484200
.********************************************************************** 01501300
.*                                                                      01518400
.DOAR    ANOP                                                      @L2A 01535500
         AIF   ('&SYSASCE' EQ 'P').ENDAR                           @L2C 01552600
         SLR   0,0                     .CLEAR REG 0 FOR SAR        @P1A 01570000
         SAR   1,0                     .CLEAR AR 1                 @P1A 01580000
.ENDAR   ANOP                                                      @L2A 01630000
.*                                                                      01750000
.********************************************************************** 01800000
.*           SET SRB FLAG BITS USING THE OPTIONS SPECIFIED            * 01850000
.********************************************************************** 01900000
.*                                                                      02016600
.DOOPT   ANOP                                                      @L2A 02066600
         AIF   (&YBIT EQ 0).GENOPT1    SKIP OI IF NO OPTIONS       @L2C 02116600
         OI    SRBFLGS-SRB(1),&YBIT    .SET LL/FRR FLAG BITS            03979000
.*                                                                      04024800
.GENOPT1 ANOP                                                      @L2A 04055300
         AIF   (&NBIT EQ 255).ENDOPT   SKIP NI IF NO NOT SPECIFIED @L2C 04085800
         NI    SRBFLGS-SRB(1),&NBIT    .RESET LL/FRR FLAG BITS          04116400
.ENDOPT  ANOP                                                      @L2A 04139300
.*                                                                      04140700
.********************************************************************** 04142100
.*  SCHEDULE WITH FEATURE REQUIRES THAT SRBCPAFF CONTAIN FEATURE      * 04143500
.*  AND STOKEN INFORMATION.                                           * 04144900
.********************************************************************** 04146300
.*                                                                      04147700
         AIF   ('&FEATURE' EQ '').NOFEAT IF FEATURE NOT SPECIFIED...   -04149100
                                                                   @01A 04150500
         AIF   ('&STOKEN' EQ '').NOSTKN  IF STOKEN NOT SPECIFIED...    -04151900
                                                                   @L1A 04153300
         MVI   SRBCPAFF-SRB(1),2                                   @01A 04154700
         AGO   .STFEAT                                             @01A 04156100
.NOSTKN  MVI   SRBCPAFF-SRB(1),1                                   @L1A 04157500
.STFEAT  MVI   SRBCPAFF-SRB+1(1),&FEATIND                          @01A 04158900
.NOFEAT  ANOP                                                      @01A 04160300
.*                                                                      04162200
.********************************************************************** 04176300
.*  SCHEDULE WITH ADDRESSABILITY REQUIRES THAT REGISTER 0 CONTAIN     * 04190400
.*  1 FOR LOCAL REQUESTS AND 2 FOR GLOBAL REQUESTS.                   * 04204500
.********************************************************************** 04218600
.*                                                                      04233000
.DOSWA   ANOP                                                      @L3A 04235500
         AIF   ('&MODE' NE 'FULLXM').ENDSWA   ONLY FOR SCHEDULE WITH   X04238000
                                       ADDRESSABILITY REQUESTS     @L3A 04240500
.*                                                                      04240700
.********************************************************************** 04240900
.*     Check for SPTOKEN request                                      * 04241100
.********************************************************************** 04241300
.*                                                                      04241500
         AIF   (N'&SPTOKEN NE 1).ENDSPTK  Only for SPTOKEN         @D2A 04241700
.*                                     Requests                         04241900
.DOSPTK  ANOP                                                      @D2A 04242100
         LA    0,&SPTOKEN              .Save SPTOKEN address       @D2A 04242300
         SAR   0,0                     .Copy to Interface reg      @D2A 04242500
.ENDSPTK ANOP                                                      @D2A 04242700
         LA    0,&REG0OPT              .INDICATE SCOPE OF REQUEST  @L3A 04243000
.ENDSWA  ANOP                                                      @L3A 04245500
.*                                                                      04248000
.********************************************************************** 04248800
.*     ENSURE APPROPRIATE SCHEDULE ROUTINE'S ADDRESS IS IN REG 15     * 04249600
.********************************************************************** 04250400
.*                                                                      04251200
.DOADR   ANOP                                                      @L2A 04252000
         AIF   ('&OFINDEX' EQ '0').GENADR1  OFFSET ALREADY CORRECT @L2A 04252800
&OF      SETC  '&OFFSET(&OFINDEX)'                                 @L2A 04253600
.GENADR1 ANOP                                                      @L2A 04254400
         AIF   ('&CBUSED' NE 'SVT').GENADR2                        @L3C 04255200
         L     15,X'B4C'(0,0)          .LOAD SVT ADDRESS                04256000
         L     15,X'&OF'(15,0)         .LOAD REG 15 WITH ADDRESS OF    X04256800
                                       .SCHEDULE ROUTINE           @L2C 04257600
         AGO   .ENDADR                                             @L2A 04258400
.GENADR2 ANOP                                                      @L2A 04259200
         AIF   ('&CBUSED' NE 'PSA').GENADR3                        @L3C 04260000
         L     15,X'&OF'(0,0)          .LOAD REG 15 WITH ADDRESS OF    X04260800
                                       .SCHEDULE ROUTINE                04261600
         AGO   .ENDADR                                             @L3A 04262400
.GENADR3 ANOP                                                      @L3A 04263200
         L     15,X'10'(0,0)           .LOAD CVT ADDRESS           @L3A 04264000
         L     15,X'8C'(15,0)          .LOAD ECVT ADDRESS          @L3A 04264800
         L     15,X'&OF'(15,0)         .LOAD REG 15 WITH ADDRESS OF    X04265600
                                       .SCHEDULE ROUTINE           @L3A 04266400
.ENDADR  ANOP                                                      @L2A 04267200
.*                                                                      04268000
.********************************************************************** 04268800
.*     IF STOKEN WAS SPECIFIED, LOAD THE STOKEN VALUE INTO ACCESS     * 04269600
.*     REGISTER PAIR AR0, AR1.                                        * 04270400
.********************************************************************** 04271200
.*                                                                      04272000
.DOARS   ANOP                                                      @L2A 04272800
         AIF   (T'&STOKEN EQ 'O').ENDARS                           @L2A 04273600
         LAM   0,1,&STOKEN             .LOAD THE STOKEN            @L1A 04274400
.ENDARS  ANOP                                                      @L2A 04275200
.*                                                                      04276000
.********************************************************************** 04276800
.*     GENERATE CORRECT LINKAGE TO SCHEDULE ROUTINE                   * 04277600
.********************************************************************** 04278400
.*                                                                      04279200
.DOCLL   ANOP                                                      @L2C 04280000
         AIF   ('&SYSASCE' EQ 'P').GENCLL1                         @L2C 04280800
         SAC   0                       .PRIMARY MODE               @D1A 04284700
.GENCLL1 ANOP                                                      @D1A 04287200
         BALR  &LINKREG,15             .LINK TO SCHEDULE ROUTINE   @L3C 04289700
         AIF   ('&SYSASCE' EQ 'P').ENDCLL                          @L2C 04292200
         SAC   X'200'                  .AR MODE                    @D1A 04294700
.ENDCLL  ANOP                                                      @L2C 04297200
         AGO   .ENDSCHD                                            @L2A 04300000
.*                                                                      04325000
.********************************************************************** 04350000
.*        MNOTE MESSAGE SKELETONS                                     * 04400000
.********************************************************************** 04450000
.*                                                                      04475000
.CMPERR1 ANOP                                                      @L2A 04525000
         MNOTE 8,'*** COMPAT KEYWORD IS OBSOLETE. '                @L2C 04575000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 04625000
         AGO   .ENDCPT                                             @L2A 04675000
.*                                                                      04800000
.CLRERR1 ANOP                                                      @L2A 04850000
         MNOTE 8,'*** CLEAR KEYWORD IS OBSOLETE. '                 @L2C 04900000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 04950000
         AGO   .ENDCLR                                                  05000000
.*                                                                      05580000
.SRBERR1 ANOP                                                      @L2C 05591200
         MNOTE 8,'*** SRB ADDRESS NOT SPECIFIED. '                 @L2C 05602400
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 05613600
         AGO .ENDSRB                                               @L2C 05624800
.*                                                                      05636000
.SRBERR2 ANOP                                                      @L2A 05644400
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''SRB'' KEYWORX05652800
               D. '                                                @L2A 05661200
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 05669600
         AGO   .ENDSRB                                             @L2A 05678000
.*                                                                      05686400
.FRRERR1 ANOP                                                           05697000
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''FRR'' KEYWORX05707600
               D. '                                                @L2A 05718200
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 05728800
         AGO   .CHKFRR1                                            @L2A 05739400
.*                                                                      05750000
.FRRERR2 ANOP                                                           05758300
         MNOTE 8,'*** INVALID FRR OPTION, SPECIFY YES OR NO. '     @L2C 05766600
         MNOTE 8,'*** FRR ADDRESS MUST BE IN SRB FIELD SRBFRRA. '       05774900
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 05783200
         AGO   .ENDFRR                                             @L2A 05791500
.*                                                                      05800000
.LLKERR1 ANOP                                                      @L2A 05850000
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''LLOCK'' KEYWX05900000
               ORD.'                                               @L2A 05950000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 06000000
         AGO   .CHKLLK1                                            @L2A 06050000
.LLKERR2 ANOP                                                      @L2A 06100000
         MNOTE 8,'*** INVALID LLOCK OPTION, SPECIFY YES OR NO. '   @L2C 06150000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 06200000
         AGO   .ENDLLK                                             @L2A 06250000
.*                                                                      07025000
.STKERR1 ANOP                                                      @L2A 07035000
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''STOKEN'' KEYX07045000
               WORD.'                                              @L2A 07055000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 07065000
         AGO   .CHKSTK1                                            @L2A 07075000
.STKERR2 ANOP                                                      @L2C 07085000
         MNOTE 8,'*** STOKEN PARAMETER NOT VALID: ''&STOKEN''.'    @L2C 07095000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 07105000
         AGO   .ENDSTK                                             @L2A 07115000
.*                                                                      07125000
.DISERR1 ANOP                                                      @L2A 07155000
         MNOTE 8,'*** POSITIONAL PARAMETER MUST BE ''DISABLED''.'  @L2A 07185000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 07215000
         AGO   .ENDDIS                                             @L2A 07245000
.*                                                                      07275000
.MODERR1 ANOP                                                      @L3A 07291600
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''MODE'' KEYWOX07308200
               RD.'                                                @L3A 07324800
&IHBERR  SETA  8                        SAVE ERROR CODE            @L3A 07341400
         AGO   .CHKMOD1                                            @L3A 07358000
.*                                                                      07375000
.MODERR2 ANOP                                                      @L3A 07395800
         MNOTE 8,'*** INVALID MODE OPTION, SPECIFY NONXM OR FULLXM. '  X07416600
                                                                   @L3A 07437400
&IHBERR  SETA  8                        SAVE ERROR CODE            @L3A 07458200
         AGO   .ENDMOD                                             @L3A 07479000
.*                                                                      07500000
.MODERR3 ANOP                                                      @L3A 07500400
         MNOTE 8,'*** MODE=FULLXM NOT VALID WITH ''DISABLED'' KEYWORD. X07500800
               '                                                   @L3A 07501200
&IHBERR  SETA  8                        SAVE ERROR CODE            @L3A 07501600
         AGO   .CHKMOD3                                            @L3A 07502000
.*                                                                      07502400
.MODERR4 ANOP                                                      @L3A 07502800
         MNOTE 8,'*** MODE=FULLXM NOT VALID WITH ''STOKEN'' KEYWORD. ' X07503200
                                                                   @L3A 07503600
&IHBERR  SETA  8                        SAVE ERROR CODE            @L3A 07504000
         AGO   .CHKMOD4                                            @01C 07504100
.*                                                                      07504200
.MODERR5 ANOP                                                      @01A 07504300
         MNOTE 8,'*** MODE=FULLXM NOT VALID WITH ''FEATURE'' KEYWORD. 'X07504400
                                                                   @01A 07504500
&IHBERR  SETA  8                        SAVE ERROR CODE            @01A 07504600
         AGO   .ENDMOD                                             @01A 07504700
.*                                                                      07504800
.SCPERR1 ANOP                                                      @L2A 07505200
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''SCOPE'' KEYWX07505600
               ORD.'                                               @L2A 07506000
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 07506400
         AGO   .CHKSCP1                                            @L2A 07506800
.*                                                                      07507200
.SCPERR2 ANOP                                                      @L2C 07507600
         MNOTE 8,'*** INVALID SCOPE OPTION, SPECIFY LOCAL OR GLOBAL. ' X07508000
                                                                   @L2A 07508400
&IHBERR  SETA  8                        SAVE ERROR CODE            @L2A 07508800
         AGO   .ENDSCP                                             @L2A 07509200
.*                                                                      07509300
.SPTERR1 ANOP                                                      @D2A 07509400
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''SPTOKEN'' KEX07509500
               YWORD.'                                             @D2A 07509600
&IHBERR  SETA  8                        SAVE ERROR CODE            @D2A 07509700
         AGO   .CHKSPT1                                            @D2A 07509800
.*                                                                      07509900
.SPTERR2 ANOP                                                      @D2C 07510000
         MNOTE 8,'*** MODE=FULLXM REQUIRED FOR ''SPTOKEN'' KEYWORD.'   X07510100
                                                                   @D2A 07510200
&IHBERR  SETA  8                        SAVE ERROR CODE            @D2A 07510300
         AGO   .CHKSPT2                                            @D2A 07510400
.*                                                                      07510500
.SPTERR3 ANOP                                                      @D2C 07510600
         MNOTE 8,'*** SCOPE=GLOBAL NOT VALID FOR ''SPTOKEN'' KEYWORD.' X07510700
                                                                   @D2A 07510800
&IHBERR  SETA  8                        SAVE ERROR CODE            @D2A 07510900
         AGO   .CHKSPT3                                            @D2A 07511000
.*                                                                      07511100
.SPTERR4 ANOP                                                      @D2C 07511200
         MNOTE 8,'*** SPTOKEN PARAMETER NOT VALID: ''&SPTOKEN''.'  @D2C 07511300
&IHBERR  SETA  8                        SAVE ERROR CODE            @D2A 07511400
         AGO   .ENDSPT                                             @D2A 07511500
.*                                                                      07511600
.FEAERR1 ANOP                                                      @01A 07511700
         MNOTE 8,'*** EXCESSIVE PARAMETERS SPECIFIED FOR ''FEATURE'' KEX07511800
               YWORD.'                                             @01A 07511900
&IHBERR  SETA  8                        SAVE ERROR CODE            @01A 07512000
         AGO   .CHKFEA1                                            @01A 07512100
.*                                                                      07512200
.FEAERR2 ANOP                                                      @01A 07512300
         MNOTE 8,'*** INVALID FEATURE OPTION, SPECIFY CRYPTO.'         X07512400
                                                                   @01A 07512500
&IHBERR  SETA  8                        SAVE ERROR CODE            @01A 07512600
         AGO   .ENDFEAT                                            @01A 07512700
.*                                                                      07512800
.********************************************************************** 07512900
.*       DELETE LABEL .LEVEL2 WITH CALL TO SCHEDUL7 THAT SET @YA11561 * 07513000
.*       COMPAT KEYWORD TO YES                               @YA11561 * 07513100
.********************************************************************** 07513200
.*                                                                      07513300
.LEVEL1  ANOP                                                           07515000
&NAME    SCHEDUL7 SRB=&SRB,SCOPE=&SCOPE,LLOCK=&LLOCK,FRR=&FRR,         X07545000
               CLEAR=&CLEAR,COMPAT=&COMPAT,&DISABLE                     07560000
.*                                                                      07590000
.*                                                                      07635000
.ENDSCHD ANOP                                                      @L2A 07640000
         MEXIT                                                          07645000
         MEND                                                           07650000
* */                                                                    07700000
* SCHEDULE: MACRO                                                       07750000
* KEYS(SRB,SCOPE,LLOCK,FRR,DISABLED,                                    07783300
*      STOKEN,MODE,SPTOKEN,FEATURE); /*                          @D2C*/ 07816600
* ANS('?'||MACLABEL||'SCHEDULP '||MACLIST||MACKEYS||';');               07850000
*% END;                                                                 07900000
