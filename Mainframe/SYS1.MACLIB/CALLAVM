*/*  START OF SPECIFICATIONS ****                                    */ 00050000
*/*                                                   01/30/84       */ 00100000
*/*01* MODULE NAME= CALLAVM                                          */ 00150000
*/*                                                                  */ 00200000
*/*01* DESCRIPTIVE NAME= Call Availability Manager Macro             */ 00250000
*/*                                                                  */ 00300000
*/*01* COPYRIGHT =                                                   */ 00350000
*/*              THIS PRODUCT CONTAINS RESTRICTED MATERIALS OF IBM.  */ 00400000
*/*              5740-XC6 COPYRIGHT IBM CORPORATION 1985.            */ 00450000
*/*                                                                  */ 00500000
*/*01* STATUS = OS/VS2 JBB2216                                       */ 00550000
*/*                                                                  */ 00600000
*/*01* FUNCTION= The CALLAVM macro provides the sole interface       */ 00650000
*/*              to the availability manager from other components.  */ 00700000
*/*              There are two types of users: subsystems (such as   */ 00750000
*/*              IMS) and the RTM component.                         */ 00800000
*/*                                                                  */ 00850000
*/*              A subsystem uses the CALLAVM macro when requesting  */ 00900000
*/*              AVM services for HARP functions.                    */ 00950000
*/*                                                                  */ 01000000
*/*              RTM uses the CALLAVM macro when invoking AVM's      */ 01050000
*/*              resource manager during address space termination.  */ 01100000
*/*                                                                  */ 01150000
*/*01* MODULE TYPE= Macro                                            */ 01200000
*/*                                                                  */ 01250000
*/*02*   PROCESSOR= PL/S-3 or Assembler                              */ 01300000
*/*                                                                  */ 01350000
*/*01* CHANGE ACTIVITY=                                              */ 01500000
*/*   $L0=HARP01  ,JBB2216,840222,PDL7: Harp release 1 support       */ 01550000
*/*                                                                  */ 01600000
*/*  END OF SPECIFICATIONS ****                                      */ 08950000
*/*                                                                     08975000
         MACRO                                                          09000000
&START   CALLAVM &MF=,&TYPE=,&SSID=,&RSE=,&SSTOKEN=,&ECB=,&STATUS=,    *09050000
               &MODE=,&IOPID=,&ETOKEN=,&RECORD=,&AVMKEY=,&BUFFER=       09100000
.*       DECLARE LOCAL VARIABLES                                        09150000
         LCLB  &IRSE,&ISSTOK,&ISTATUS,&IIOP,&IECB,&RETCODE,&IBUFFER     09200000
         LCLB  &IETOKEN,&IRECORD,&ISSID,&IVAR,&EVAR                     09250000
         LCLC  &LBL,&LVPARM,&VAR                                        09300000
* MACDATE = 9/21/83                                                     09350000
.*                                                                      09400000
.*       INITIALIZE VARIABLES                                           09450000
.*                                                                      09500000
&LBL     SETC  'AVF&SYSNDX'                                             09550000
&LVPARM  SETC  'NORMAL'                SET LEAVEAVM,LEAVERSE TO DEFAULT 09600000
.********************************************************************** 09650000
.*       CHECK FOR MF                                                 * 09700000
.********************************************************************** 09750000
         AIF   ('&MF' EQ '').E4             NO 'MF',ERROR               09800000
         AIF   ('&MF(1)' EQ 'E').MFEX       BRANCH IF EXECUTE FORM      09850000
         AIF   ('&MF' EQ 'L').NMF        BRANCH IF LIST FORM            09900000
         MNOTE 12,'''MF=&MF'' INVALID. SPECIFY ''L'' OR ''(E,LISTNAME)'*09950000
               '.'                                                      10000000
         AGO   .MERR                                                    10050000
.********************************************************************** 10100000
.*      MF=L                                                          * 10150000
.********************************************************************** 10200000
.*       CHECK FOR  EXTRANEOUS KEYWORDS                                 10250000
.* * IF PRESENT - RETURN CODE 4 AND WARNING MESSAGE *                   10300000
.NMF     AIF   ('&TYPE&SSID&RSE&SSTOKEN&ECB&STATUS&MODE&IOPID&ETOKEN&AV*10350000
               MKEY&BUFFER&RECORD' EQ '').MF2  TYPES SPECIFIED          10400000
         MNOTE 4,'ALL OTHER KEYWORDS IGNORED WHEN ''MF=L'' SPECIFIED.'  10450000
.*      CHECK FOR POSITIONAL PARAMETERS                                 10500000
.* * IF PRESENT - RETURN CODE 4 AND WARNING MESSAGE *                   10550000
.MF2     AIF   (N'&SYSLIST EQ 0).MFT                                    10600000
         MNOTE 4,'ALL POSITIONAL PARAMETERS IGNORED WHEN ''MF=L'' SPECI*10650000
               FIED.'                                                   10700000
.MFT     ANOP                                                           10750000
.********************************************************************** 10800000
.*      GENERATE DECLARES                                               10850000
.********************************************************************** 10900000
&START   DS    9F                      PARAMETER LIST AREA              10950000
         AGO   .OUT                                                     11000000
.********************************************************************** 11050000
.*      MF=(E,--------)                                                 11100000
.********************************************************************** 11150000
.MFEX    AIF    (N'&MF EQ 2).MFEX1         CHECK FOR 2 PARMS SPECIFIED  11200000
         MNOTE 12,'''MF=&MF'' INVALID. SPECIFY ''(E,LISTNAME)''.'       11250000
&RETCODE SETB   1                                                       11300000
         AGO    .CHKTP                                                  11350000
.MFEX1   ANOP                                                           11400000
&EVAR    SETB   ('&MF(2)'(1,1) NE '(')     EVAR=ON IF NOT A REGISTER    11450000
.********************************************************************** 11500000
.*       START VALID TYPE CHECK                                         11550000
.********************************************************************** 11600000
.CHKTP   AIF   ('&TYPE' EQ '').E1                                       11650000
.*                                                                      11700000
.*      CHECK FOR MORE THAN ONE TYPE PARAMETER                          11750000
.* * IF MORE THAN ONE PARM SPECIFIED -                                  11800000
.* * RETURN CODE 12 AND ERROR MESSAGE                                   11850000
.*                                                                      11900000
         AIF   (N'&TYPE GT 1).E2                                        11950000
.********************************************************************** 12000000
.*      CHECK FOR TYPE=JOINAVM                                          12050000
.********************************************************************** 12100000
         AIF   ('&TYPE' NE 'JOINAVM').JRSE                              12150000
.*                                                                      12200000
.* * IF SSID ABSENT - RETURN CODE 12 AND ERROR MESSAGE *                12250000
.*                                                                      12300000
         AIF   ('&SSID' NE '').S1                                       12350000
&RETCODE SETB  1                                                        12400000
         MNOTE 12,'''TYPE=JOINAVM'' REQUIRES KEYWORD ''SSID''.'         12450000
         AGO   .S3                                                      12500000
.S1      AIF   (N'&SSID EQ 1).S2                                        12550000
&RETCODE SETB  1                                                        12600000
         MNOTE 12,'''SSID=&SSID'' INVALID. ONLY ONE PARAMETER PERMITTED*12650000
               .'                                                       12700000
         AGO   .S3                                                      12750000
.*                                                                      12800000
.*     DO KEYWORD PARAMETER TEST                                        12850000
.*                                                                      12900000
.S2      ANOP                                                           12950000
&ISSID   SETB  ('&SSID'(1,1) NE '(')     SSID = FIELDNAME               13000000
.*                                                                      13050000
.* * IF SSTOKEN ABSENT - RETURN CODE 12 AND ERROR MESSAGE *             13100000
.*                                                                      13150000
.S3      AIF   ('&SSTOKEN' NE '').S4                                    13200000
&RETCODE SETB  1                                                        13300000
         MNOTE 12,'''TYPE=JOINAVM'' REQUIRES KEYWORD ''SSTOKEN''.'      13350000
         AGO   .EVAL                                                    14150000
.S4      AIF   (N'&SSTOKEN EQ 1).S5                                     14179100
&RETCODE SETB  1                                                        14208200
         MNOTE 12,'''SSTOKEN=&SSTOKEN'' INVALID. ONLY ONE PARAMETER PER*14237300
               MITTED.'                                                 14266400
         AGO   .EVAL                                                    14295500
.*                                                                      14324600
.*     DO KEYWORD PARAMETER TEST                                        14353700
.*                                                                      14382800
.S5      ANOP                                                           14411900
&ISSTOK  SETB  ('&SSTOKEN'(1,1) NE '(')     SSTOKEN = FIELDNAME         14441000
.*                                                                      14470100
.*    CHECK FOR EXTRANEOUS KEYWORDS                                     14500000
.* * IF SPECIFIED, RETURN CODE 4 AND WARNING MESSAGE                    14550000
.*                                                                      14600000
.EVAL    AIF   ('&RSE&ECB&STATUS&MODE&IOPID&ETOKEN&RECORD&AVMKEY&BUFFER*14650000
               ' EQ '').EVAL1                                           14700000
         MNOTE 4,'FOR ''TYPE=JOINAVM'' KEYWORDS ''SSID'' AND ''SSTOKEN'*14750000
               ' VALID. ALL OTHER KEYWORDS IGNORED.'                    14800000
.EVAL1  AIF    (N'&SYSLIST EQ 0).JTEXT                                  14850000
        MNOTE  4,'FOR ''TYPE=JOINAVM'' POSITIONAL PARAMETERS IGNORED.'  14900000
.*                                                                      14950000
.* * IF ERROR SEVERITY EQUAL 12 - RETURN ERROR MESSAGE AND EXIT *       15000000
.* * IF ERROR SEVERITY LOWER - GENERATE CODE *                          15050000
.*                                                                      15100000
.JTEXT   AIF   (&RETCODE NE 0).MERR                                     15125000
.********************************************************************** 15150000
.*     GENERATE TEXT                                                    15200000
.********************************************************************** 15250000
.*     CHECK FOR AVM INSTALLED - IF NOT BRANCH TO ERROR ROUTINE         15300000
.*                             - IF INSTALLED, GENERATE CODE            15350000
.********************************************************************** 15400000
&START   L     15,16                   GET CVT ADDRESS                  15500000
         L     15,328(15)              GET CVT EXTENSION                15550000
         ICM   15,B'1111',36(15)       CHECK FOR AVM INSTALLED          15600000
         BZ    &LBL.B                  IF AVM NOT INSTALLED, BRANCH     15650000
         ST    1,24(,13)               SAVE REGISTER 1 ACROSS LOAD      15675000
*        LOAD  EP=AVFJINIT,ERRET=AVFXXXXA  INITIALIZATION ROUTINE       15700000
         LOAD  EP=AVFJINIT,ERRET=&LBL.A                                 15750000
*                                                                       15800000
         LR    15,0                    SAVE ENTRY POINT ADDRESS         15850000
         L     1,24(,13)               RESTORE REGISTER 1 AFTER LOAD    15866600
         AIF   ('&MF(2)' EQ '(1)').JA1                                  15883200
         AIF   (&EVAR EQ 1).JA                                          15900000
&VAR     SETC  '&MF(2)'(2,K'&MF(2)-2)                                   15950000
         LR    1,&VAR                  GET PARAMETER LIST ADDRESS       16000000
         AGO   .JA1                                                     16050000
.JA      LA    1,&MF(2)                GET PARAMETER LIST ADDRESS       16100000
.JA1     XC    0(36,1),0(1)            ZERO OUT PARAMETER LIST          16150000
         MVC   0(12,1),&LBL.R          FILL IN HEADER                   16200000
         MVI   12(1),X'80'             INDICATE 'JOINAVM'               16250000
         AIF   (&ISSID EQ 1).SFLD                                       16300000
&VAR     SETC  '&SSID'(2,K'&SSID-2)                                     16350000
         ST    &VAR,20(1)              SSID ADDRESS                     16400000
         AGO   .NXT                                                     16450000
.SFLD    LA    0,&SSID                 SSID ADDRESS                     16500000
         ST    0,20(1)                                                  16900000
.NXT     AIF   (&ISSTOK EQ 1).EFLD                                      16950000
&VAR     SETC  '&SSTOKEN'(2,K'&SSTOKEN-2)                               17000000
         ST    &VAR,24(1)              SUBSYSTEM TOKEN FIELD ADDRESS    17050000
         AGO   .VL1                                                     17100000
.EFLD    LA    0,&SSTOKEN              SUBSYSTEM TOKEN FIELD ADDRESS    17150000
         ST    0,24(1)                                                  17250000
.VL1     BALR  14,15                   CALL JOINAVM INITIALIZATION      17300000
         STM   15,1,16(13)             SAVE REGISTERS AROUND DELETE     17350000
*        DELETE EP=AVFJINIT            DELETE INITIALIZATION ROUTINE    17400000
         DELETE EP=AVFJINIT                                             17450000
*                                                                       17500000
         LM    15,1,16(13)             RESTORE REGISTERS                17550000
         B     &LBL.C                  SKIP REMAINING CODE              17600000
&LBL.R   DC    C'AVPL'                 PARAMETER LIST HEADER            17650000
         DC    X'0024'                                                  17687500
         DC    X'0000'                                                  17725000
         DC    X'00000001'                                              17762500
&LBL.A   LR    14,15                   PUT LOAD REASON CODE IN REG 14   17784300
*                                      REGISTER 1 CONTAINS THE ABEND    17806100
*                                      FAILURE CODE FROM LOAD           17827900
         LA    15,12                   RETURN CODE = LOAD FAILURE       17850000
         LA    0,58                    REASON CODE =                    17866600
*                                       AVFJINIT COULD NOT BE LOADED    17883200
         B     &LBL.C                  SKIP REMAINING CODE              17900000
&LBL.B   LA    0,6                     REASON CODE = AVM NOT INSTALLED  17950000
         LA    15,16                   RETURN CODE = AVM NOT AVAILABLE  18000000
&LBL.C   DS    0H                                                       18050000
         AGO   .OUT                                                     18100000
.********************************************************************** 18150000
.*       CHECK FOR TYPE= JOINRSE                                        18200000
.********************************************************************** 18250000
.JRSE    AIF   ('&TYPE' NE 'JOINRSE').DP                                18300000
.*                                                                      18350000
.*      CHECK FOR REQUIRED KEYWORDS                                     18400000
.*                                                                      18450000
.* * IF RSE ABSENT - RETURN CODE 12 AND ERROR MESSAGE *                 18500000
         AIF   ('&RSE' NE '').R1                                        18550000
&RETCODE SETB  1                                                        18600000
         MNOTE 12,'''TYPE=JOINRSE'' REQUIRES KEYWORD ''RSE''.'          18650000
         AGO   .TLK                                                     18700000
.R1      AIF   (N'&RSE EQ 1).ROK              EXCESS PARAMETERS CHECK   18750000
&RETCODE SETB  1                                                        18800000
         MNOTE 12,'''RSE=&RSE'' INVALID. ONLY ONE PARAMETER PERMITTED.' 18850000
         AGO   .TLK                                                     18900000
.*                                                                      18950000
.*       DO KEYWORD PARAMETER TEST                                      19000000
.*                                                                      19050000
.ROK     ANOP                                                           19100000
&IRSE    SETB  ('&RSE'(1,1) NE '(')                                     19150000
.*                                                                      19200000
.* * IF SSTOKEN ABSENT - RETURN CODE 12 AND ERROR MESSAGE *             19250000
.*                                                                      19300000
.TLK     AIF   ('&SSTOKEN' NE '').TL1                                   19350000
&RETCODE SETB  1                                                        19400000
         MNOTE 12,'''TYPE=JOINRSE'' REQUIRES KEYWORD ''SSTOKEN''.'      19450000
         AGO   .EX                                                      19500000
.TL1     AIF   (N'&SSTOKEN EQ 1).TLOK          EXCESS PARAMETERS CHECK  19550000
         MNOTE 12,'''SSTOKEN=&SSTOKEN'' INVALID. ONLY ONE PARAMETER PER*19600000
               MITTED.'                                                 19650000
&RETCODE SETB  1                                                        19700000
         AGO   .EX                                                      19750000
.*                                                                      19800000
.*       DO KEYWORD PARAMETER TEST                                      19850000
.*                                                                      19900000
.TLOK    ANOP                                                           19950000
&ISSTOK  SETB  ('&SSTOKEN'(1,1) NE '(')                                 20000000
.*                                                                      20050000
.* * IF ETOKEN ABSENT - RETURN CODE 12 AND ERROR MESSAGE *              20100000
.*                                                                      20150000
.EX      AIF   ('&ETOKEN' NE '').EX1                                    20200000
&RETCODE SETB  1                                                        20250000
         MNOTE 12,'''TYPE=JOINRSE'' REQUIRES  KEYWORD ''ETOKEN''.'      20300000
         AGO   .IOPD                                                    20350000
.EX1     AIF   (N'&ETOKEN EQ 1).EXOK          EXCESS PARAMETERS CHECK   20400000
&RETCODE SETB  1                                                        20450000
         MNOTE 12,'''ETOKEN=&ETOKEN'' INVALID. ONLY ONE PARAMETER PERMI*20500000
               TTED.'                                                   20550000
         AGO   .IOPD                                                    20600000
.*                                                                      20650000
.*       DO KEYWORD PARAMETER TEST                                      20700000
.*                                                                      20750000
.EXOK    ANOP                                                           20800000
&IETOKEN SETB  ('&ETOKEN'(1,1) NE '(')                                  20850000
.*                                                                      20900000
.*      CHECK FOR OPTIONAL KEYWORDS                                     20950000
.*                                                                      21000000
.*      CHECK FOR IOPID                                                 21050000
.IOPD    AIF   ('&IOPID' EQ '').MD                                      21100000
         AIF   (N'&IOPID EQ 1).IPDOK          EXCESS PARAMETERS CHECK   21150000
&RETCODE SETB  1                                                        21200000
         MNOTE 12,'''IOPID=&IOPID'' INVALID. ONLY ONE PARAMETER PERMITT*21250000
               ED.'                                                     21300000
         AGO   .MD                                                      21350000
.*                                                                      21362500
.*       DO KEYWORD PARAMETER TEST                                      21375000
.*                                                                      21387500
.IPDOK   ANOP                                                           21400000
&IIOP    SETB  ('&IOPID'(1,1) NE '(')                                   21450000
.*                                                                      21500000
.*       CHECK FOR MODE                                                 21700000
.*                                                                      21750000
.MD      AIF   ('&MODE' EQ '').IVALID                                   21800000
.*                                                                      21850000
.* * IF MORE THAN ONE PARM - RETURN CODE 12 AND ERROR MESSAGE *         21900000
.*                                                                      21950000
         AIF   (N'&MODE EQ 1).MDB                                       22000000
&RETCODE SETB  1                                                        22050000
         MNOTE 12,'''MODE=&MODE'' INVALID. ONLY ''ACTIVE'' OR ''BACKUP'*22100000
               ' PERMITTED.'                                            22150000
         AGO   .IVALID                                                  22200000
.MDB     ANOP                                                           22250000
         AIF   ('&MODE' EQ 'ACTIVE' OR '&MODE' EQ 'BACKUP').IVALID      22300000
&RETCODE SETB  1                                                        22350000
         MNOTE 12,'''MODE=&MODE'' INVALID. SPECIFY ''ACTIVE'' OR ''BACK*22400000
               UP''.'                                                   22450000
.*                                                                      22500000
.*      CHECK FOR INVALID KEYWORDS AND POSITIONAL PARAMETERS            23250000
.* * IF SPECIFIED - RETURN CODE 4 AND WARNING MESSAGE *                 23300000
.*                                                                      23350000
.IVALID  AIF   ('&SSID&ECB&STATUS&RECORD&AVMKEY&BUFFER' EQ '').NVALID   23400000
         MNOTE 4,'FOR ''TYPE=JOINRSE'' KEYWORDS ''RSE,SSTOKEN,ETOKEN,IO*23450000
               PID,MODE'' ARE VALID. ALL OTHER KEYWORDS IGNORED.'       23500000
.*                                                                      23550000
.*     CHECK FOR EXTRANEOUS POSITIONAL PARAMETERS                       23600000
.*                                                                      23650000
.NVALID  AIF   (N'&SYSLIST EQ 0).JRTEXT                                 23700000
         MNOTE 4,'FOR ''TYPE=JOINRSE'' ALL POSITIONAL PARAMETERS IGNORE*23750000
               D.'                                                      23800000
.*                                                                      23850000
.* * IF ERROR SEVERITY EQUAL 12 - RETURN ERROR MESSAGE AND EXIT *       23900000
.* * IF ERROR SEVERITY LOWER - GENERATE CODE *                          23950000
.*                                                                      24000000
.JRTEXT  AIF   (&RETCODE NE 0).MERR                                     24050000
.********************************************************************** 24100000
.*     GENERATE TEXT                                                    24150000
.********************************************************************** 24200000
.*     CHECK FOR AVM INSTALLED - IF NOT BRANCH TO ERROR ROUTINE         24250000
.*                             - IF INSTALLED, GENERATE CODE            24300000
.********************************************************************** 24350000
&START   L     15,16                   GET CVT ADDRESS                  24400000
         L     15,328(15)              GET CVT EXTENSION                24450000
         ICM   15,B'1111',36(15)       CHECK FOR AVM INSTALLED          24500000
         BZ    &LBL.B                  IF AVM NOT INSTALLED, BRANCH     24550000
         SLL   15,1                    SHIFT OUT HIGH ORDER BIT         24600000
         SRA   15,1                    SHIFT AND CHECK FOR ZERO ADDRESS 24650000
         BZ    &LBL.A                  IF AVM NOT RUNNING, BRANCH       24700000
         AIF   ('&MF(2)' EQ '(1)').JX1 ESTABLISH ADDRESSABILITY         24750000
         AIF   (&EVAR EQ 1).JX                                          24800000
&VAR     SETC  '&MF(2)'(2,K'&MF(2)-2)                                   24850000
         LR    1,&VAR                  GET PARAMETER LIST ADDRESS       24900000
         AGO   .JX1                                                     24950000
.JX      LA    1,&MF(2)                GET PARAMETER LIST ADDRESS       25000000
.JX1     XC    0(36,1),0(1)            ZERO OUT PARAMETER LIST          25050000
         MVC   0(12,1),&LBL.R          FILL IN HEADER                   25100000
         MVI   12(1),X'20'             INDICATE 'JOINRSE'               25150000
         AIF   ('&MODE' NE 'ACTIVE').BKUP                               25200000
         OI    16(1),X'40'             INDICATE 'ACTIVE' MODE           25250000
         AGO   .R                                                       25300000
.BKUP    AIF   ('&MODE' NE 'BACKUP').R                                  25350000
         OI    16(1),X'20'             INDICATE 'BACKUP' MODE           25400000
.R       AIF   (&IRSE EQ 1).RR                                          25450000
&VAR     SETC  '&RSE'(2,K'&RSE-2)                                       25500000
         ST    &VAR,24(1)              RSE NAME ADDRESS                 25550000
         AGO   .X                                                       25600000
.RR      LA    0,&RSE                  RSE NAME ADDRESS                 25650000
         ST    0,24(1)                                                  26350000
.X       AIF   (&IETOKEN EQ 1).RE                                       26353800
&VAR     SETC  '&ETOKEN'(2,K'&ETOKEN-2)                                 26357600
         ST    &VAR,28(1)              RSE TOKEN FIELD ADDRESS          26361400
         AGO   .AVL                                                     26365200
.RE      LA    0,&ETOKEN               RSE TOKEN FIELD ADDRESS          26369000
         ST    0,28(1)                                                  26372800
.AVL     AIF   (&ISSTOK EQ 1).FVL                                       26376600
&VAR     SETC  '&SSTOKEN'(2,K'&SSTOKEN-2)                               26380400
         ST    &VAR,20(1)              SUBSYSTEM TOKEN ADDRESS          26384200
         AGO   .AIP                                                     26388000
.FVL     LA    0,&SSTOKEN              SUBSYSTEM TOKEN ADDRESS          26391800
         ST    0,20(1)                                                  26395600
.AIP     AIF   ('&IOPID' EQ '').ATL    IF IOPID NOT SPECIFIED BRANCH    26400000
         AIF   (&IIOP EQ 1).FI                                          26450000
&VAR     SETC  '&IOPID'(2,K'&IOPID-2)                                   26500000
         ST    &VAR,32(1)              IOPID ADDRESS                    26550000
         AGO   .ATL                                                     26600000
.FI      LA    0,&IOPID                IOPID ADDRESS                    26650000
         ST    0,32(1)                                                  26700000
.ATL     L     15,20(15)               GET ROUTINE ADDRESS              26750000
         BALR  14,15                   CALL INTERFACE ROUTINE           27050000
         B     &LBL.D                  SKIP REMAINING CODE              27100000
&LBL.R   DC    C'AVPL'                 PARAMETER LIST HEADER            27150000
         DC    X'0024'                                                  27187500
         DC    X'0000'                                                  27225000
         DC    X'00000001'                                              27262500
&LBL.A   LA    0,4                     REASON CODE = AVM NOT RUNNING    27293700
         B     &LBL.C                                                   27324900
&LBL.B   LA    0,6                     REASON CODE = AVM NOT INSTALLED  27356100
&LBL.C   LA    15,16                   RETURN CODE = AVM NOT AVAILABLE  27387300
&LBL.D   DS    0H                                                       27418500
         AGO   .OUT                                                     27450000
.********************************************************************** 27500000
.*      CHECK FOR TYPE=PUTREC OR TYPE=DELREC OR TYPE=GETREC             27550000
.********************************************************************** 27600000
.DP      AIF   ('&TYPE' NE 'PUTREC' AND '&TYPE' NE 'DELREC' AND '&TYPE'*27633300
                NE 'GETREC').LVE                                        27666600
.*                                                                      27700000
.* * IF ETOKEN ABSENT - RETURN CODE 12 AND ERROR MESSAGE *              27750000
.*                                                                      27800000
         AIF   ('&ETOKEN' NE '').EP1                                    27850000
&RETCODE SETB  1                                                        27900000
         MNOTE 12,'''TYPE=&TYPE'' REQUIRES KEYWORD ''ETOKEN''.'         27950000
         AGO   .RP                                                      28000000
.EP1     AIF   (N'&ETOKEN EQ 1).EP2 EXCESS PARAMETERS SPECIFIED         28050000
&RETCODE SETB  1                                                        28100000
         MNOTE 12,'''ETOKEN=&ETOKEN'' INVALID. ONLY ONE PARAMETER PERMI*28150000
               TTED.'                                                   28200000
         AGO   .RP                                                      28250000
.*                                                                      28300000
.*    DO KEYWORD PARAMETER TEST                                         28350000
.*                                                                      28400000
.EP2     ANOP                                                           28450000
&IETOKEN SETB  ('&ETOKEN'(1,1) NE '(')                                  28500000
.*                                                                      28550000
.* * IF RECORD ABSENT - RETURN CODE 12 AND ERROR MESSAGE                28600000
.*                                                                      28650000
.RP      AIF   ('&TYPE' EQ 'GETREC').BP                                 28683300
         AIF   ('&RECORD' NE '').RP1                                    28716600
&RETCODE SETB  1                                                        28750000
         MNOTE 12,'''TYPE=&TYPE'' REQUIRES KEYWORD ''RECORD''.'         28800000
         AGO   .ECB                                                     28850000
.RP1     AIF   (N'&RECORD EQ 1).RP2                                     28900000
&RETCODE SETB  1                                                        28950000
         MNOTE 12,'''RECORD=&RECORD'' INVALID. ONLY ONE PARAMETER PERMI*29000000
               TTED.'                                                   29050000
         AGO   .ECB                                                     29075000
.RP2     ANOP                                                           29100000
&IRECORD SETB  ('&RECORD'(1,1) NE '(')                                  29150000
         AGO   .ECB                                                     29175000
.*                                                                      29200000
.* * IF BUFFER ABSENT - RETURN CODE 12 AND ERROR MESSAGE                29250000
.*                                                                      29300000
.BP      AIF   ('&BUFFER' NE '').BP1                                    29350000
&RETCODE SETB  1                                                        29450000
         MNOTE 12,'''TYPE=&TYPE'' REQUIRES KEYWORD ''BUFFER''.'         29460900
         AGO   .ECB                                                     29471800
.BP1     AIF   (N'&BUFFER EQ 1).BP2                                     29482700
&RETCODE SETB  1                                                        29493600
         MNOTE 12,'''BUFFER=&BUFFER'' INVALID. ONLY ONE PARAMETER PERMI*29504500
               TTED.'                                                   29515400
.BP2     ANOP                                                           29526300
&IBUFFER SETB  ('&BUFFER'(1,1) NE '(')                                  29537200
.*                                                                      29548100
.*      CHECK FOR ECB AND STATUS                                        29559000
.*                                                                      29569900
.ECB     AIF   ('&ECB' EQ '' AND '&STATUS' EQ '').TKEY                  29580800
         AIF   ('&ECB' NE '' AND '&STATUS' NE '').ECBST                 29591700
&RETCODE SETB  1                                                        29602600
         MNOTE 12,'''ECB'' AND ''STATUS'' MUST EITHER BOTH BE SPECIFIED*29613500
                OR BOTH OMITTED.'                                       29624400
         AGO   .TKEY                                                    29635300
.ECBST   AIF   (N'&ECB EQ 1).ECBOK            EXCESS PARAMETERS CHECK   29646200
&RETCODE SETB  1                                                        29657100
         MNOTE 12,'''ECB=&ECB'' INVALID. ONLY ONE PARAMETER PERMITTED.' 29668000
         AGO   .STAT                                                    29678900
.ECBOK   ANOP                                                           29689800
&IECB    SETB  ('&ECB'(1,1) NE '(')                                     29700700
.STAT    AIF   (N'&STATUS EQ 1).STATOK        EXCESS PARAMETERS CHECK   29711600
&RETCODE SETB  1                                                        29722500
         MNOTE 12,'''STATUS=&STATUS'' INVALID. ONLY ONE PARAMETER PERMI*29733400
               TTED.'                                                   29744300
         AGO   .TKEY                                                    29755200
.STATOK  ANOP                                                           29766100
&ISTATUS SETB  ('&STATUS'(1,1) NE '(')                                  29777000
.*                                                                      29787900
.*      CHECK FOR  AVMKEY                                               29800000
.*                                                                      29850000
.TKEY    AIF   ('&TYPE' EQ 'DELREC').EKWDR                              29900000
         AIF   ('&TYPE' EQ 'GETREC').EKWGR                              29925000
         AIF   ('&AVMKEY' EQ '').EKW                                    29950000
         AIF   ('&AVMKEY' NE 'YES').NO                                  30000000
&IVAR    SETB  1                                                        30050000
         AGO   .EKW                                                     30100000
.NO      AIF   ('&AVMKEY' EQ 'NO').EKW                                  30150000
&RETCODE SETB  1                                                        30200000
         MNOTE 12,'AVMKEY=&AVMKEY INVALID. SPECIFY ''YES'' OR ''NO''.'  30250000
.*                                                                      30300000
.*      CHECK FOR INVALID KEYWORDS AND POSITIONAL PARAMETERS            30350000
.* * IF SPECIFIED - RETURN CODE 4 AND WARNING MESSAGE *                 30400000
.*                                                                      30450000
.EKW     AIF   ('&SSID&RSE&SSTOKEN&MODE&IOPID&BUFFER' EQ '').PARMT      30500000
         MNOTE 4,'FOR ''TYPE=PUTREC'' KEYWORDS ''ETOKEN,RECORD,AVMKEY,E*30600000
               CB,STATUS'' ARE VALID.  ALL OTHER KEYWORDS IGNORED.'     30650000
         AGO   .PARMT                                                   30700000
.EKWDR   AIF   ('&SSID&RSE&SSTOKEN&MODE&IOPID&BUFFER&AVMKEY' EQ '').PAR*30750000
               MT                                                       30800000
         MNOTE 4,'FOR ''TYPE=DELREC'' KEYWORDS ''ETOKEN,RECORD,ECB,STAT*30850000
               US'' ARE VALID.  ALL OTHER KEYWORDS IGNORED.'            30900000
         AGO   .PARMT                                                   30950000
.EKWGR   AIF   ('&SSID&RSE&SSTOKEN&MODE&IOPID&RECORD&AVMKEY' EQ '').PAR*31000000
               MT                                                       31050000
         MNOTE 4,'FOR ''TYPE=GETREC'' KEYWORDS ''ETOKEN,BUFFER,ECB,STAT*31100000
               US'' ARE VALID.  ALL OTHER KEYWORDS IGNORED.'            31150000
.*                                                                      31200000
.*     CHECK FOR EXTRANEOUS POSITIONAL PARAMETERS                       31250000
.*                                                                      31300000
.PARMT   AIF   (N'&SYSLIST EQ 0).PTEXT                                  31350000
         MNOTE 4,'FOR ''TYPE=&TYPE'' ALL POSITIONAL PARAMETERS IGNORED.*31400000
               '                                                        31450000
.PTEXT   AIF   (&RETCODE NE 0).MERR                                     31750000
.********************************************************************** 31800000
.*     GENERATE TEXT                                                    31850000
.********************************************************************** 31900000
.*     CHECK FOR AVM INSTALLED - IF NOT BRANCH TO ERROR ROUTINE         31950000
.*                             - IF INSTALLED, GENERATE CODE            32000000
.********************************************************************** 32050000
&START   L     15,16                   GET CVT ADDRESS                  32100000
         L     15,328(15)              GET CVT EXTENSION                32150000
         ICM   15,B'1111',36(15)       CHECK FOR AVM INSTALLED          32200000
         BZ    &LBL.B                  IF AVM NOT INSTALLED, BRANCH     32250000
         SLL   15,1                    SHIFT OUT HIGH ORDER BIT         32300000
         SRA   15,1                    SHIFT AND CHECK FOR ZERO ADDRESS 32350000
         BZ    &LBL.A                  IF AVM NOT RUNNING, BRANCH       32400000
         AIF   ('&MF(2)' EQ '(1)').JX5   ESTABLISH ADDRESSABILITY       32450000
         AIF   (&EVAR EQ 1).JX4                                         32500000
&VAR     SETC  '&MF(2)'(2,K'&MF(2)-2)                                   32550000
         LR    1,&VAR                  GET PARAMETER LIST ADDRESS       32600000
         AGO   .JX5                                                     32650000
.JX4     LA    1,&MF(2)                GET PARAMETER LIST ADDRESS       32700000
.JX5     XC    0(36,1),0(1)            ZERO OUT PARAMETER LIST          32750000
         MVC   0(12,1),&LBL.R          FILL IN HEADER                   32800000
         AIF   ('&ECB' EQ '').JX7                                       32850000
         AIF   (&IECB EQ 1).JX6                                         32900000
&VAR     SETC  '&ECB'(2,K'&ECB-2)                                       32950000
         ST    &VAR,28(1)              ECB ADDRESS                      33000000
         AGO   .JX7                                                     33050000
.JX6     LA    14,&ECB                 ECB ADDRESS                      33066600
         ST    14,28(1)                                                 33083200
.JX7     AIF   ('&STATUS' EQ '').JX9                                    33099800
         AIF   (&ISTATUS EQ 1).JX8                                      33116400
&VAR     SETC  '&STATUS'(2,K'&STATUS-2)                                 33133000
         ST    &VAR,32(1)              STATUS ADDRESS                   33149600
         AGO   .JX9                                                     33166200
.JX8     LA    14,&STATUS              STATUS ADDRESS                   33182800
         ST    14,32(1)                                                 33199400
.JX9     AIF   ('&TYPE' EQ 'GETREC').DAT2                               33216000
         AIF   (&IRECORD EQ 1).PFLD                                     33232600
&VAR     SETC  '&RECORD'(2,K'&RECORD-2)                                 33250000
         ST    &VAR,24(1)              RECORD ADDRESS                   33300000
         AGO   .PLA                                                     33350000
.PFLD    LA    14,&RECORD              RECORD ADDRESS                   33400000
         ST    14,24(1)                                                 33450000
         AGO   .PLA                                                     33500000
.DAT2    ANOP                                                           33550000
         AIF   (&IBUFFER EQ 1).DAT3                                     33600000
&VAR     SETC  '&BUFFER'(2,K'&BUFFER-2)                                 33650000
         ST    &VAR,24(1)              BUFFER ADDRESS                   33700000
         AGO   .PLA                                                     33750000
.DAT3    LA    14,&BUFFER              BUFFER ADDRESS                   33800000
         ST    14,24(1)                                                 33850000
.PLA     AIF   (&IVAR EQ 0).PLB                                         34000000
         OI    16(1),X'80'             AVMKEY=YES                       34040000
.PLB     AIF   ('&TYPE' EQ 'DELREC').PLC                                34080000
         AIF   ('&TYPE' EQ 'GETREC').PLD                                34120000
         MVI   12(1),X'08'             INDICATE 'PUTREC'                34160000
         AGO   .PLE                                                     34200000
.PLC     MVI   12(1),X'04'             INDICATE 'DELREC'                34225000
         AGO   .PLE                                                     34250000
.PLD     MVI   12(1),X'02'             INDICATE 'GETREC'                34275000
.PLE     AIF   (&IETOKEN EQ 1).PEF                                      34300000
&VAR     SETC  '&ETOKEN'(2,K'&ETOKEN-2)                                 34350000
         ST    &VAR,20(1)              RSE TOKEN ADDRESS                34400000
         AGO   .PC                                                      34450000
.PEF     LA    14,&ETOKEN              RSE TOKEN ADDRESS                34487500
         ST    14,20(1)                                                 34525000
.PC      L     15,20(15)               GET ROUTINE ADDRESS              34562500
         BALR  14,15                   CALL INTERFACE ROUTINE           34600000
         B     &LBL.D                  SKIP REMAINING CODE              34650000
&LBL.R   DC    C'AVPL'                 PARAMETER LIST HEADER            34700000
         DC    X'0024'                                                  34737500
         DC    X'0000'                                                  34775000
         DC    X'00000001'                                              34812500
&LBL.A   LA    0,4                     REASON CODE = AVM NOT RUNNING    34843700
         B     &LBL.C                                                   34874900
&LBL.B   LA    0,6                     REASON CODE = AVM NOT INSTALLED  34906100
&LBL.C   LA    15,16                   RETURN CODE = AVM NOT AVAILABLE  34937300
&LBL.D   DS    0H                                                       34968500
         AGO   .OUT                                                     35000000
.********************************************************************** 35050000
.*      CHECK FOR TYPE=LEAVERSE                                         35100000
.********************************************************************** 35150000
.LVE     AIF   ('&TYPE' NE 'LEAVERSE').LVET                             35200000
.*                                                                      35250000
.* * IF ETOKEN ABSENT - RETURN CODE 12 AND ERROR MESSAGE                35300000
.*                                                                      35350000
         AIF   ('&ETOKEN' NE '').LET                                    35400000
&RETCODE SETB  1                                                        35450000
         MNOTE 12,'''TYPE=LEAVERSE'' REQUIRES KEYWORD ''ETOKEN''.'      35500000
         AGO   .CPOS                                                    35550000
.LET     AIF   (N'&ETOKEN  EQ 1).LET1                                   35600000
&RETCODE SETB  1                                                        35650000
         MNOTE 12,'''ETOKEN=&ETOKEN'' INVALID. ONLY ONE PARAMETER PERMI*35700000
               TTED.'                                                   35750000
         AGO   .CPOS                                                    35800000
.*                                                                      35850000
.*     DO KEYWORD PARAMETER TEST                                        35900000
.*                                                                      35950000
.LET1    ANOP                                                           36000000
&IETOKEN SETB  ('&ETOKEN'(1,1) NE '(')                                  36050000
.*                                                                      36100000
.* * IF MORE THAN 1 POSITIONAL PARM - RETURN CODE 12 AND ERROR MSG      36150000
.*                                                                      36200000
.CPOS    AIF   (N'&SYSLIST EQ 0).EKYS                                   36250000
         AIF   (N'&SYSLIST EQ 1).CPOS1                                  36300000
&RETCODE SETB  1                                                        36350000
         MNOTE 12,'''TYPE=LEAVERSE'' INVALID. ONLY ONE POSITIONAL PARAM*36400000
               ETER PERMITTED.'                                         36450000
         AGO   .EKYS                                                    36500000
.CPOS1   ANOP                                                           36550000
&LVPARM  SETC  '&SYSLIST(1)'                                            36600000
         AIF   ('&LVPARM' EQ 'TAKEOVER' OR '&LVPARM' EQ 'IOP' OR '&LVPA*36650000
               RM' EQ 'NORMAL').EKYS                                    36700000
&RETCODE SETB  1                                                        36750000
         MNOTE 12,'FOR ''TYPE=LEAVERSE'' ''&LVPARM'' INVALID. SPECIFY '*36800000
               'TAKEOVER'' OR ''IOP'' OR ''NORMAL''.'                   36850000
.*                                                                      36900000
.*      CHECK FOR EXTRANEOUS KEYWORDS                                   36950000
.* * IF SPECIFED - RETURN CODE 4 AND WARNING MESSAGE                    37000000
.*                                                                      37050000
.EKYS    AIF   ('&SSID&RSE&SSTOKEN&ECB&STATUS&MODE&IOPID&RECORD&AVMKEY&*37100000
               BUFFER' EQ '').LTEXT                                     37150000
         MNOTE 4,'FOR ''TYPE=LEAVERSE'' KEYWORD ''ETOKEN'' IS VALID. AL*37200000
               L OTHER KEYWORDS IGNORED.'                               37250000
.********************************************************************** 37300000
.*     GENERATE CODE                                                    37350000
.********************************************************************** 37400000
.*     CHECK FOR AVM INSTALLED - IF NOT BRANCH TO ERROR ROUTINE         37450000
.*                             - IF INSTALLED, GENERATE CODE            37500000
.********************************************************************** 37550000
.LTEXT  AIF    (&RETCODE NE 0).MERR                                     37600000
&START   L     15,16                   GET CVT ADDRESS                  37650000
         L     15,328(15)              GET CVT EXTENSION                37700000
         ICM   15,B'1111',36(15)       CHECK FOR AVM INSTALLED          37750000
         BZ    &LBL.B                  IF AVM NOT INSTALLED, BRANCH     37800000
         SLL   15,1                    SHIFT OUT HIGH ORDER BIT         37850000
         SRA   15,1                    SHIFT AND CHECK FOR ZERO ADDRESS 37900000
         BZ    &LBL.A                  IF AVM NOT RUNNING, BRANCH       37950000
         AIF   ('&MF(2)' EQ '(1)').LX1   ESTABLISH ADDRESSABILITY       38000000
         AIF   (&EVAR EQ 1).LX                                          38050000
&VAR     SETC  '&MF(2)'(2,K'&MF(2)-2)                                   38100000
         LR    1,&VAR                  GET PARAMETER LIST ADDRESS       38150000
         AGO   .LX1                                                     38200000
.LX      LA    1,&MF(2)                GET PARAMETER LIST ADDRESS       38250000
.LX1     XC    0(36,1),0(1)            ZERO OUT PARAMETER LIST          38300000
         MVC   0(12,1),&LBL.R          FILL IN HEADER                   38350000
         MVI   12(1),X'10'             INDICATE 'LEAVERSE'              38400000
         AIF   ('&LVPARM' NE 'TAKEOVER').IOP1                           38450000
         OI    16(1),X'10'             TAKEOVER OPTION                  38500000
         AGO   .CONT                                                    38550000
.IOP1    AIF   ('&LVPARM' NE 'IOP').CONT                                38600000
         OI    16(1),X'08'             IOP OPTION                       38650000
.CONT    AIF   (&IETOKEN EQ 1).FLR                                      38850000
&VAR     SETC  '&ETOKEN'(2,K'&ETOKEN-2)                                 38900000
         ST    &VAR,20(1)              RSE TOKEN ADDRESS                38950000
         AGO   .PARM                                                    39000000
.FLR     LA    14,&ETOKEN              RSE TOKEN ADDRESS                39037500
         ST    14,20(1)                                                 39075000
.PARM    L     15,20(15)               GET ROUTINE ADDRESS              39112500
         BALR  14,15                   CALL INTERFACE ROUTINE           39150000
         B     &LBL.D                  SKIP REMAINING CODE              39200000
&LBL.R   DC    C'AVPL'                 PARAMETER LIST HEADER            39250000
         DC    X'0024'                                                  39287500
         DC    X'0000'                                                  39325000
         DC    X'00000001'                                              39362500
&LBL.A   LA    0,4                     REASON CODE = AVM NOT RUNNING    39393700
         B     &LBL.C                                                   39424900
&LBL.B   LA    0,6                     REASON CODE = AVM NOT INSTALLED  39456100
&LBL.C   LA    15,16                   RETURN CODE = AVM NOT AVAILABLE  39487300
&LBL.D   DS    0H                                                       39518500
         AGO   .OUT                                                     39550000
.********************************************************************** 39600000
.*      CHECK FOR TYPE=LEAVEAVM                                         39650000
.********************************************************************** 39700000
.LVET    AIF   ('&TYPE' NE 'LEAVEAVM').E3                               39750000
.*                                                                      39800000
.* * IF SSTOKEN ABSENT - RETURN CODE 12 AND ERROR MESSAGE               39850000
.*                                                                      39900000
         AIF   ('&SSTOKEN' NE '').LTL                                   39950000
&RETCODE SETB  1                                                        40000000
         MNOTE 12,'''TYPE=LEAVEAVM'' REQUIRES KEYWORD ''SSTOKEN''.'     40050000
         AGO   .LPOS                                                    40100000
.LTL     AIF   (N'&SSTOKEN EQ 1).LTL1                                   40150000
&RETCODE SETB  1                                                        40200000
         MNOTE 12,'''SSTOKEN=&SSTOKEN'' INVALID. ONLY ONE PARAMETER PER*40250000
               MITTED.'                                                 40300000
         AGO   .LPOS                                                    40350000
.*                                                                      40400000
.*     DO KEYWORD PARAMETER TEST                                        40450000
.*                                                                      40500000
.LTL1    ANOP                                                           40550000
&ISSTOK  SETB  ('&SSTOKEN'(1,1) NE '(')                                 40600000
.LPOS    AIF   (N'&SYSLIST EQ 0).LKYS                                   40650000
         AIF   (N'&SYSLIST EQ 1).LPOS1                                  40700000
&RETCODE SETB  1                                                        40750000
         MNOTE 12,'FOR ''TYPE=LEAVEAVM'' ONLY ONE POSITIONAL PARAMETER *40800000
               PERMITTED.'                                              40850000
         AGO   .LKYS                                                    40900000
.LPOS1   ANOP                                                           40950000
&LVPARM  SETC  '&SYSLIST(1)'                                            41000000
         AIF   ('&LVPARM' EQ 'ABEND' OR '&LVPARM' EQ 'NORMAL').LKYS     41050000
&RETCODE SETB  1                                                        41100000
         MNOTE 12,'FOR ''TYPE=LEAVEAVM'' ''&LVPARM'' INVALID. SPECIFY '*41150000
               'ABEND'' OR ''NORMAL''.'                                 41200000
.*                                                                      41250000
.*     CHECK FOR EXTRANEOUS KEYWORDS AND POSITIONAL PARAMETERS          41300000
.* * IF SPECIFIED RETURN CODE 4 AND WARNING MESSAGE                     41350000
.*                                                                      41400000
.LKYS    AIF    ('&SSID&RSE&ETOKEN&ECB&STATUS&MODE&IOPID&RECORD&AVMKEY&*41450000
               BUFFER' EQ '').LTTEXT                                    41500000
         MNOTE 4,'FOR ''TYPE=LEAVEAVM'' KEYWORD ''SSTOKEN'' VALID. ALL *41550000
               OTHER KEYWORDS IGNORED.'                                 41600000
.********************************************************************** 41650000
.*     GENERATE CODE                                                    41700000
.********************************************************************** 41750000
.*     CHECK FOR AVM INSTALLED - IF NOT BRANCH TO ERROR ROUTINE         41800000
.*                             - IF INSTALLED, GENERATE CODE            41850000
.********************************************************************** 41900000
.LTTEXT  AIF   (&RETCODE NE 0).MERR                                     41950000
&START   L     15,16                   GET CVT ADDRESS                  42000000
         L     15,328(15)              GET CVT EXTENSION                42050000
         ICM   15,B'1111',36(15)       CHECK FOR AVM INSTALLED          42100000
         BZ    &LBL.B                  IF AVM NOT INSTALLED, BRANCH     42150000
         SLL   15,1                    SHIFT OUT HIGH ORDER BIT         42200000
         SRA   15,1                    SHIFT AND CHECK FOR ZERO ADDRESS 42250000
         BZ    &LBL.A                  IF AVM NOT RUNNING, BRANCH       42300000
         AIF   ('&MF(2)' EQ '(1)').LA1   ESTABLISH ADDRESSABILITY       42350000
         AIF   (&EVAR EQ 1).LA                                          42400000
&VAR     SETC  '&MF(2)'(2,K'&MF(2)-2)                                   42450000
         LR    1,&VAR                  GET PARAMETER LIST ADDRESS       42500000
         AGO   .LA1                                                     42550000
.LA      LA    1,&MF(2)                GET PARAMETER LIST ADDRESS       42600000
.LA1     XC    0(36,1),0(1)            ZERO OUT PARAMETER LIST          42650000
         MVC   0(12,1),&LBL.R          FILL IN HEADER                   42700000
         MVI   12(1),X'40'             INDICATE 'LEAVEAVM'              42750000
         AIF   ('&LVPARM' NE 'ABEND').CONT2                             42800000
         OI    16(1),X'10'             ABEND OPTION                     42850000
.CONT2   AIF   (&ISSTOK EQ 1).FLT                                       42900000
&VAR     SETC  '&SSTOKEN'(2,K'&SSTOKEN-2)                               42950000
         ST    &VAR,20(1)              SUBSYSTEM TOKEN ADDRESS          43000000
         AGO   .CP                                                      43150000
.FLT     LA    0,&SSTOKEN              SUBSYSTEM TOKEN ADDRESS          43187500
         ST    0,20(1)                                                  43225000
.CP      L     15,20(15)               GET ROUTINE ADDRESS              43262500
         BALR  14,15                   CALL INTERFACE ROUTINE           43300000
         B     &LBL.D                  SKIP REMAINING CODE              43350000
&LBL.R   DC    C'AVPL'                 PARAMETER LIST HEADER            43400000
         DC    X'0024'                                                  43437500
         DC    X'0000'                                                  43475000
         DC    X'00000001'                                              43512500
&LBL.A   LA    0,4                     REASON CODE = AVM NOT RUNNING    43543700
         B     &LBL.C                                                   43574900
&LBL.B   LA    0,6                     REASON CODE = AVM NOT INSTALLED  43606100
&LBL.C   LA    15,16                   RETURN CODE = AVM NOT AVAILABLE  43637300
&LBL.D   DS    0H                                                       43668500
         AGO   .OUT                                                     43700000
.E1      MNOTE 12,'''TYPE'' MUST BE SPECIFIED.'                         43750000
         AGO   .MERR                                                    43800000
.E2     MNOTE  12,'''TYPE=&TYPE'' INVALID. ONLY ONE PARAMETER PERMITTED*43850000
               .'                                                       43900000
         AGO   .MERR                                                    43950000
.E3      MNOTE 12,'''&TYPE'' NOT A VALID ''TYPE'' PARAMETER.'           44000000
         AGO   .MERR                                                    44050000
.E4      MNOTE 12,'''MF'' MUST BE SPECIFIED.'                           44100000
.MERR    MNOTE *,'NO SOURCE CODE GENERATED.'                            44150000
.OUT     MEND                                                           44200000
**/                                                                     44250000
*%CALLAVM:                                                              44316600
* MACRO KEYS(TYPE,RMPLAD);                                              44350000
*/*                                                                  */ 44400000
*/*        INTERNAL DECLARES                                         */ 44450000
*/*                                                                  */ 44500000
*DCL    OVER2         FIXED;        /* VAR FOR MACCOL + 2            */ 44550000
*DCL    RCODE         FIXED;        /* RET CODE FOR ERROR SEVERITY   */ 44600000
*DCL    VALIDTYPE     FIXED;        /* VALID-TYPE-FOUND FLAG         */ 44650000
*DCL    INVOKE        CHAR;         /* INVOCATION OF MACRO COMMENT   */ 44700000
*DCL    IRMPLAD       CHAR;         /* INTERNAL VAR FOR RMPLAD       */ 44750000
*DCL    NOTEXT        CHAR;         /* NO-TEXT-GENERATED MSG         */ 44800000
*DCL    ITOOLONG      CHAR;         /* TOO-MANY-PARAMS MSG           */ 44850000
*DCL    I13           CHAR;         /* FOR MESSAGE IDS               */ 44900000
*DCL    I23           CHAR;         /* FOR MESSAGE IDS               */ 44950000
*DCL    I31           CHAR;         /* FOR MESSAGE IDS               */ 45000000
*DCL    I51           CHAR;         /* FOR MESSAGE IDS               */ 45050000
*DCL    INOTSUPPL     CHAR;         /* FOR MESSAGES                  */ 45100000
*/*     EXTERNAL DECLARES                                            */ 45150000
*DCL    EHARC         FIXED    EXT;                                     45200000
*DCL    EHAREGS       CHAR     EXT;                                     45250000
*DCL    EHAMAPS       CHAR     EXT;                                     45300000
*/*                                                                  */ 45350000
*/*        INITIALIZE VARIABLES                                      */ 45400000
*/*                                                                  */ 45450000
*/* INITIALIZE COUNTERS AND RETURN CODE TO ZERO                      */ 45500000
*VALIDTYPE=0;                                                           45550000
*RCODE=0;                                                               45600000
*OVER2=MACCOL+2;   /* INITIALIZE VAR TO MACCOL + 2                   */ 45650000
*/* INITIALIZE ERROR MESSAGE VARIABLES                               */ 45700000
*NOTEXT=' NO SOURCE CODE GENERATED.';                                   45750000
*I13='AHA0013 ';                                                        45800000
*I23='AHA0023 ';                                                        45850000
*I31='AHA0031 ''';                                                      45900000
*I51='AHA0051 ';                                                        45950000
*I53='AHA0053 ''';                                                      46000000
*INOTSUPPL=' REQUIRED BUT NOT SUPPLIED. '||NOTEXT;                      46050000
*ITOOLONG=''' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ';               46100000
*INVAL=''' IS INVALID.';                                                46150000
*/*                                                                  */ 46200000
*/*  CHECK FOR POSITIONAL PARAMETERS                                 */ 46250000
*/*                                                                  */ 46300000
*IF MACLIST^='' THEN                                                    46350000
*  DO;                                                                  46400000
*  /* IF THERE ARE POSITIONAL PARAMETERS, PERFORM ERROR ROUTINE      */ 46450000
*    RCODE=4;                                                           46500000
*    ANS MSG(I51||'THE MACLIST '||QUOTE(MACLIST)||' IS NOT ALLOWED.'    46550000
*        ||' IT IS IGNORED.') SKIP;                                     46600000
*  END;                                                                 46650000
*/*                                                                  */ 46700000
*/*           VALIDATE KEYWORDS                                      */ 46750000
*/*                                                                  */ 46800000
*/* CHECK FOR SPECIFICATION OF MACRO KEYWORDS                        */ 46850000
*IF MACKEYS='' THEN                                                     46900000
* DO;                                                                   46950000
* /* NO KEYWORDS SPECIFIED. PERFORM ERROR ROUTINE - NO SOURCE TEXT   */ 47000000
*   RCODE=12;                                                           47050000
*   ANS MSG(I13||'KEYWORDS ARE REQUIRED BUT NOT SUPPLIED.'              47100000
*       ||NOTEXT) SKIP;                                                 47150000
* END;                                                                  47200000
*/* ARE KEYWORDS SPECIFIED?                                          */ 47250000
*IF MACKEYS^='' THEN                                                    47300000
*  DO;                                                                  47350000
*    IF MACLABEL^='' THEN                                               47400000
*      ANS(MACLABEL) COL(MACLMAR) SKIP;                                 47450000
*    INVOKE=' CALLAVM '||MACLIST||MACKEYS||' - MACDATE 9/21/83 ';       47500000
*    ANS('DO;') COL(MACCOL);                                            47550000
*    ANS(COMMENT(INVOKE)) COL(37) ;                                     47600000
*  /* WAS "TYPE" SPECIFIED?                                          */ 47650000
*    IF TYPE(1)='' THEN                                                 47700000
*      DO;                                                              47750000
*    /* TYPE NOT SPECIFIED. PERFORM ERROR ROUTINE.                   */ 47800000
*        RCODE=12;                                                      47850000
*        ANS MSG(I13||'''TYPE(ARGUMENT)'''||INOTSUPPL) SKIP;            47900000
*        ANS MSG('VALID TYPES ARE: RTM.');                              47950000
*      END;                                                             48000000
*    ELSE                                                               48050000
*  /* IF TYPE WAS SPECIFIED, IS THERE MORE THAN 1 PARAMETER?         */ 48100000
*      DO;                                                              48150000
*        IF NUMBER(TYPE)>1 THEN                                         48200000
*          DO;                                                          48250000
*     /* TOO MANY PARAMETERS. PERFORM ERROR ROUTINE                  */ 48300000
*            RCODE=12;                                                  48350000
*      ANS MSG(I31||'TYPE'' IS TOO LONG. ONLY ONE PARAMETER PERMITTED.' 48400000
*              ||NOTEXT) SKIP;                                          48450000
*          END;                                                         48500000
*        ELSE                                                           48550000
*          DO;                                                          48600000
*     /* TYPE WAS SPECIFIED. BEGIN CHECKS FOR SPECIFIC TYPES         */ 48650000
*/********************************************************************/ 48700000
*/*       CHECK FOR         "TYPE=RTM"                               */ 48750000
*            IF TYPE(1)='RTM' THEN                                      48800000
*              DO;                                                      48850000
*                IF RMPLAD(1)='' THEN                                   48900000
*                  DO;                                                  48950000
*      /* RMPLAD NOT SPECIFIED. PERFORM ERROR PROCESS                */ 49000000
*                    RCODE=12;                                          49050000
*         ANS MSG(I13||'''RMPLAD(ARGUMENT)'' IS '||INOTSUPPL) SKIP;     49100000
*                  END;                                                 49150000
*                ELSE                                                   49200000
*                  DO;                                                  49250000
*      /* RMPLAD SPECIFIED. TOO MANY PARAMETERS?                     */ 49300000
*                    IF NUMBER(RMPLAD)>1 THEN                           49350000
*                      DO;                                              49400000
*         /* TOO MANY PARAMETERS. PERFORM ERROR PROCESS              */ 49450000
*                        IF RCODE^=12 THEN                              49500000
*                          RCODE=4;                                     49550000
*                        ANS MSG(I31||'RMPLAD'''||ITOOLONG              49600000
*                            ||QUOTE(RMPLAD(1))||'.') SKIP;             49650000
*                      END;                                             49700000
*                    IRMPLAD = 'ADDR('||RMPLAD(1)||')';                 49750000
*                  END;                                                 49800000
* /* IF NO SEVERE ERRORS DETECTED, FORMAT SOURCE CODE.               */ 49850000
*                IF RCODE^=12 THEN                                      49900000
*                  DO;                                                  49950000
*    /*   FORMAT SOURCE CODE                                         */ 50000000
*         IF INDEX(EHAMAPS,'XM@')=0 THEN                                50050000
*           EHAMAPS=EHAMAPS||'XM@';                                     50100000
*         IF INDEX(EHAREGS,'01P')=0 THEN                                50150000
*           EHAREGS=EHAREGS||'01P';                                     50200000
*         ANS('IF (((XM@CVT+328)->I031P+36)->I031F ^= 0) & ')           50250000
*             COL(OVER2) SKIP;                                          50300000
*         ANS('   (((XM@CVT+328)->I031P+36)->I256C(1:4) ^='             50350000
*                  ||' ''80000000''X) & ') COL(OVER2) SKIP;             50400000
*         ANS('   ((((XM@CVT+328)->I031P+36)->I031P)->'                 50450000
*                  ||'I256C(1:4) = ''AVVT'') THEN') COL(OVER2) SKIP;    50500000
*         ANS('  DO;') COL(OVER2) SKIP;                                 50550000
*         ANS('    RFY GPR01P RSTD;') COL(OVER2) SKIP;                  50600000
*         ANS('    GPR01P = '||IRMPLAD||';') COL(OVER2) SKIP;           50650000
*         ANS('    CALL ((((XM@CVT+328)->I031P+36)->'                   50700000
*                  ||'I031P+24)->I031P)->IPDEF;')                       50750000
*             COL(OVER2) SKIP;                                          50800000
*         ANS('    RFY GPR01P UNRSTD;') COL(OVER2) SKIP;                50850000
*         ANS('  END;') COL(OVER2) SKIP;                                50900000
*                  END;                                                 50950000
*  /* INDICATE THAT A VALID TYPE WAS FOUND.                          */ 51000000
*                VALIDTYPE=1;                                           51050000
*              END;                                                     51100000
*  /* END OF CHECKS FOR SPECIFIC TYPES.                              */ 51150000
*  /******************************************************************/ 51200000
*  /*                CHECK FOR PRESENCE OF VALID TYPE                */ 51250000
*    /* HAS A VALID TYPE BEEN SPECIFED.?                             */ 51300000
*            IF VALIDTYPE^=1 THEN                                       51350000
*              DO;                                                      51400000
*      /* NO VALID TYPE SPECIFIED. PERFORM ERROR ROUTINE.            */ 51450000
*                RCODE=12;                                              51500000
*         ANS MSG(I23||QUOTE(TYPE(1))||' IS INVALID. ''TYPE'' MUST'     51550000
*                    ||' BE ''RTM''.'                                   51600000
*                    ||NOTEXT) SKIP NORESCAN;                           51650000
*              END;                                                     51700000
*          END;                                                         51750000
*      END;                                                             51800000
*   /* GENERATE "END" STATEMENT                                      */ 51850000
*    ANS('END;') COL(MACCOL) ;                                          51900000
*    ANS(COMMENT(INVOKE)) COL(37) SKIP;                                 51950000
*  END;                                                                 52000000
*/* RETURN ERROR CODE.                                               */ 52050000
*EHARC=RCODE;                                                           52100000
*RETURN CODE(RCODE);                                                    52150000
*%END CALLAVM;                                                          52200000
