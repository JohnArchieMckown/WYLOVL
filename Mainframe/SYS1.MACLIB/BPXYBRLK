*        %GOTO BRLKPRO  ;         /* Bilingual header                   00050000
         MACRO                                                          00100000
         BPXYBRLK  &DSECT=YES,&LIST=YES                       8@D1A     00150000
         GBLB  &BRLK411                                                 00200000
         AIF   (&BRLK411 EQ 1).E411                                     00250000
&BRLK411 SETB  1                                                        00300000
         AIF   ('&LIST' EQ 'YES').A411                                  00350000
         PUSH  PRINT  BPXYBRLK: Byte Range Locking interface            00400000
         PRINT OFF              control block                           00450000
         AGO   .A411                                                    00500000
*                                  */                                   00550000
*%BRLKPRO : ;                                                           00600000
*/****START OF SPECIFICATIONS****************************************** 00650000
*                                                                       00700000
*    $MAC (BPXYBRLK) COMP(SCPX1) PROD(BPX):                             00750000
*                                                                       00800000
*01* MACRO NAME: BPXYBRLK                                               00850000
*                                                                       00900000
*01* DSECT NAME: BRLK                                                   00950000
*                                                                       01000000
*01* DESCRIPTIVE NAME: Byte Range Locking interface control block       01050000
*                                                                       01100000
*02*   ACRONYM: BRLK                                                    01150000
**/                                                                     01200000
*/*01* PROPRIETARY STATEMENT=                                        */ 01250000
*/***PROPRIETARY_STATEMENT********************************************/ 01300000
*/*                                                                  */ 01350000
*/*                                                                  */ 01400000
*/* LICENSED MATERIALS - PROPERTY OF IBM                             */ 01450000
*/* THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                      */ 01500000
*/* 5647-A01 (C) COPYRIGHT IBM CORP. 1993,2000                       */ 01550000
*/*                                                                  */ 01650000
*/* STATUS= HBB7703                                                  */ 01700000
*/*                                                                  */ 01750000
*/***END_OF_PROPRIETARY_STATEMENT*************************************/ 01800000
*/*                                                                     01850000
*                                                                       01875000
*01* EXTERNAL CLASSIFICATION:  GUPI                                     01900000
*01* END OF EXTERNAL CLASSIFICATION:                                    01950000
*                                                                       02000000
*01* FUNCTION:                                                          02050000
*                                                                       02100000
*      The BRLK defines the third input parameter to the FCNTL()        02150000
*      system call, which contains the byte range locking information.  02200000
*                                                                       02250000
*01* METHOD OF ACCESS:                                                  02300000
*                                                                       02350000
*02*   PL/X:                                                            02400000
*                                                                       02450000
*        %INCLUDE SYSLIB(BPXYBRLK)                                      02500000
*        By default, the BRLK is based on BrlkPtr. If                   02550000
*        other basing is desired, use %BRLKBASE='BASED(XXXXXX)'.        02600000
*        If %BRLKBASE='BASED(BrlkPtr)' is coded, a Declare for          02650000
*        BrlkPtr is also generated.                                     02700000
*                                                                       02750000
*02*   ADM:                                                             02800000
*        With DSECT=NO, storage is allocated in line                    02850000
*        and addressability is provided thru that DSECT or CSECT.       02900000
*        With DSECT=YES, a DSECT is produced and "USING BRLK,reg"       02950000
*        is required for addressability.  Here "reg" contains the       03000000
*        address of BRLK#LENGTH bytes of storage.                       03050000
*        The default is DSECT=YES.                                      03100000
*                                                                       03150000
*01* SIZE: BRLK#LENGTH                                                  03200000
*                                                                       03250000
*01* POINTED TO BY: BrlkPtr                                             03300000
*                                                                       03350000
*01* CREATED BY: Caller of system call                                  03400000
*                                                                       03450000
*01* DELETED BY: Caller of system call                                  03500000
*                                                                       03550000
*01* STORAGE ATTRIBUTES:                                                03600000
*02*   SUBPOOL/DATASPACE:                                               03650000
*02*   KEY:                N/A                                          03700000
*02*   RESIDENCY:          N/A                                          03750000
*                                                                       03800000
*01* FREQUENCY: 1 per call to FCNTL                                     03850000
*                                                                       03900000
*01* SERIALIZATION: N/A                                                 03950000
*                                                                       04000000
*01* DEPENDENCIES: None                                                 04050000
*                                                                       04100000
*01* NOTES                                                              04150000
*           The valid values for l_whence are                           04200000
*           declared in BPXYSEEK.                                       04250000
*                                                                       04300000
*01* COMPONENT: OpenMVS (SCPX1)                                         04350000
*                                                                       04400000
*01* DISTRIBUTION LIBRARY:  AMACLIB                                     04450000
*                                                                       04500000
*01* EYE-CATCHER: None                                                  04550000
*02*   OFFSET:                                                          04600000
*02*   LENGTH:                                                          04650000
*                                                                       04700000
*01* CHANGE-ACTIVITY:                                                   04750000
*                                                                       04800000
* $L0=POSIXXF  HOM1110 921201 PDJS: OpenMVS Initial Release             04850000
* $D1=DL70019  HOM1110 921201 PDJM: Assembler macro fixup               04900000
* $P2=PL70366  HOM1110 920908 PDSV: Macro commentary                    04950000
* $P3=PL70597  HOM1110 930104 PDJM: Use "OpenMVS"                       05000000
****END OF SPECIFICATIONS*********************************************/ 05050000
*        %GOTO BRLKPLS  ;         /* Bilingual header                   05100000
.A411    ANOP  ,                                                        05150000
** BPXYBRLK: External Byte Range Locking interface control block        05200000
**  Used By: FCT                                                        05250000
         AIF   ('&DSECT' EQ 'NO').B411                        7@D1A     05300000
BRLK                 DSECT ,                                            05350000
         AGO   .C411                                                    05400000
.B411    ANOP  ,                                                        05450000
BRLK                 DS    0F                                           05500000
.C411    ANOP  ,                                                        05550000
L_TYPE               DS    H      Requested lock type:                  05600000
F_RDLCK              EQU   1       Shared or read lock                  05650000
F_WRLCK              EQU   2       Exclusive or write lock              05700000
F_UNLCK              EQU   3       Unlock                               05750000
                     SPACE ,                                            05800000
L_WHENCE             DS    H      Flag for starting offset              05850000
L_START              DS    0CL8   Relative offset in bytes              05900000
L_START_H            DS    F      High word of relative offset          05950000
L_START_L            DS    F      Low word of relative offset           06000000
L_LEN                DS    0CL8   Size of lock in bytes                 06050000
L_LEN_H              DS    F      High word of size of lock in bytes    06100000
L_LEN_L              DS    F      Low word of size of lock in bytes     06150000
L_PID                DS    F      Process ID of process holding lock    06200000
BRLK#LENGTH          EQU   *-BRLK Length of this area                   06250000
** BPXYBRLK End                                                         06300000
         SPACE 3                                                        06350000
         AIF   ('&LIST' EQ 'YES').E411                        6@D1A     06400000
         POP   PRINT                                                    06450000
.E411    ANOP  ,                                                        06500000
         MEND                                                           06550000
  Terminating PL/X comment                                          */  06600000
 %BRLKPLS: ;                                                            06650000
 %IF BRLKBASE='' %THEN                                                  06700000
   %DO;                                                                 06750000
     %BRLKBASE='BASED(BrlkPtr)';                                        06800000
   %END;                                                                06850000
  %IF BRLKBASE='BASED(BrlkPtr)' %THEN                                   06900000
    %DO;                                                                06950000
      DCL BrlkPtr Ptr(31);            /* Pointer to the Brlk          */07000000
    %END;                                                               07050000
 DCL                                                                    07100000
  1 Brlk BRLKBASE,                                                      07150000
                                                                        07200000
   3 l_type        Fixed(15),  /* Requested lock type               */  07250000
   3 l_whence      Fixed(15),  /* Flag for starting offset          */  07300000
   3 l_start       Char(8) Bdy(Word),   /* Relative offset in bytes */  07350000
    5 l_start_h    Fixed(31),  /*                                   */  07400000
    5 l_start_l    Fixed(32),  /*                                   */  07450000
   3 l_len         Char(8) Bdy(Word),      /* Size of lock in bytes */  07500000
    5 l_len_h      Fixed(31),  /*                                   */  07550000
    5 l_len_l      Fixed(32),  /*                                   */  07600000
   3 l_pid         Fixed(32);  /* Process ID of process holding lock*/  07650000
                                                                        07700000
              /* l_type constant values       */                        07750000
 DCL F_RDLCK Fixed(31) Constant(1); /* Shared or read lock          */  07800000
 DCL F_WRLCK Fixed(31) Constant(2); /* Exclusive or write lock      */  07850000
 DCL F_UNLCK Fixed(31) Constant(3); /* Unlock                       */  07900000
