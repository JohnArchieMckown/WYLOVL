* % FSIREQ: MACRO KEYS(REQUEST,TARGET,PARM,FSID,MODE);                  00100000
*/********************************************************************/ 00200000
*/*                                                                  */ 00300000
*/* MODULE NAME = IAZFSREQ (FSIREQ MACRO)                            */ 00400000
*/*                                                                  */ 00500000
*/* DESCRIPTIVE NAME = JES FSI REQUEST MACRO                         */ 00600000
*/*                                                                  */ 00700000
*/* COPYRIGHT = LICENSED MATERIALS-PROPERTY OF IBM                   */ 00800000
*/*             THIS MACRO IS "RESTRICTED MATERIALS OF IBM"          */ 00900000
*/*             5645-001 (C) COPYRIGHT IBM CORP 1983, 1997           */ 01000000
*/*                                                                  */ 01200000
*/* STATUS = HBB6603                                                 */ 01300000
*/*                                                                  */ 01400000
*/*01* EXTERNAL CLASSIFICATION:  PSPI                                */ 01410000
*/*01* END OF EXTERNAL CLASSIFICATION:                               */ 01420000
*/*                                                                  */ 01430000
*/* FUNCTION = INVOKE THE JES FSI FACILITY                           */ 01500000
*/*                                                                  */ 01600000
*/*   OPERATION =                                                    */ 01700000
*/*   - VERIFY THE TARGET AND MODE PARAMETERS AND IF VALID THEN      */ 01800000
*/*     GENERATE THE INSTRUCTIONS TO ISSUE THE SUBSYSTEM INTERFACE   */ 01900000
*/*     REQUEST (FSICON OR FSIDCON) OR ENTER THE FSI SERVICE ROUTINE.*/ 02000000
*/*   - OTHERWISE ISSUE AN ERROR MNOTE SPECIFYING THE ERROR(S).      */ 02100000
*/*   - IF THE REQUEST PARAMETER HAS NOT BEEN CODED THEN THE REQUEST */ 02200000
*/*     FLAG IS ASSUMED TO HAVE BEEN STORED IN THE PARM LIST.        */ 02300000
*/*     NOTE THAT THIS PARAMETER MUST BE CODED IF THE FSI REQUEST    */ 02400000
*/*     BEING MADE IS FSICON OR FSIDCON.                             */ 02500000
*/*   - IF THE MODE PARAMETER IS NOT 'PC' IT IS ASSUMED THE          */ 02600000
*/*     CODE GENERATED WILL NOT BE EXECUTED IN A CROSS-MEMORY        */ 02700000
*/*     'PC' ROUTINE.  IF MODE=PC IS USED THEN IT MIGHT BE.          */ 02800000
*/*   - IF THE PARM PARAMETER HAS NOT BEEN CODED THEN THE PARM       */ 02900000
*/*     ADDRESS IS ASSUMED TO BE IN REGISTER 1.                      */ 03000000
*/*   - THE TARGET PARAMETER SPECIFIES WHOSE ROUTINES WILL RECEIVE   */ 03100000
*/*     CONTROL - IT DEFAULTS TO JES.                                */ 03200000
*/*   - THE FSID PARAMETER SPECIFIES THE FSS/FSA TO GET CONTROL.     */ 03300000
*/*     IF IT IS NOT SPECIFIED IT IS ASSUMED TO BE IN THE PARM LIST. */ 03400000
*/*                                                                  */ 03500000
*/*   DEPENDENCIES =                                                 */ 03600000
*/*   - THE CALLER MUST INCLUDE THE CVT, FSVT, FSCT, AND FSIP        */ 03700000
*/*     MAPPING MACROS.  IF REQUEST IS NOT FSICON OR FSIDCON THEN    */ 03800000
*/*     THE ASCB MAPPING MACRO IS NEEDED.                            */ 03900000
*/*   - IF REQUEST IS NOT FSICON OR FSIDCON THEN IF MODE=PC THE      */ 04000000
*/*     ASVT MAPPING MACRO IS NEEDED AND IF MODE IS NOT PC THE       */ 04100000
*/*     PSA MAPPING MACRO IS NEEDED.                                 */ 04200000
*/*   - IF REQUEST=FSICON OR FSIDCON THEN CONTIGUOUS SPACE FOR THE   */ 04300000
*/*     SSOB AND SSIB PAIR (SSIB ON WORD BOUNDARY) MUST HAVE BEEN    */ 04400000
*/*     ACQUIRED AND ITS ADDRESS STORED IN THE PARM LIST AND THE     */ 04500000
*/*     SSOB, SSIB, JESCT MAPPING MACROS MUST BE INCLUDED.           */ 04600000
*/*   - IN PLS, THE CALLER MUST CODE THE ?EPILOG MACRO.              */ 04700000
*/*   - IN PLS, IF THE SSOB MAPPING MACRO IS USED THEN SET           */ 04800000
*/*     %SSOBSSOB = 'BASED' BEFORE %INCLUDING THE MACRO.             */ 04900000
*/*                                                                  */ 05000000
*/* MODULE TYPE = MACRO                                              */ 05100000
*/*                                                                  */ 05200000
*/* ENTRY POINT = N/A                                                */ 05300000
*/*                                                                  */ 05400000
*/*   INPUT =                                                        */ 05500000
*/*   THE FOLLOWING MAY BE SPECIFIED AS PARAMETERS TO FSIREQ:        */ 05600000
*/*                                                                  */ 05700000
*/*     BAL INVOCATION -                                             */ 05800000
*/*                                                                  */ 05900000
*/*   REQUEST=VALUE  WHERE VALUE IS ONE OF EQUS SPECIFIED FOR THE    */ 06000000
*/*                  FSIFUNC FIELD IN THE FSIP MAPPING MACRO.        */ 06100000
*/*                  (VALUE MAY BE EQU OR (REGISTER)).               */ 06200000
*/*                                                                  */ 06300000
*/*   PARM=ADDRESS OF THE PARAMETER LIST (FIELD NAME OR (REGISTER))  */ 06400000
*/*                                                                  */ 06500000
*/*   TARGET=ROUTINES TO RECEIVE CONTROL (JES | FSS)                 */ 06600000
*/*                                                                  */ 06700000
*/*   FSID=VALUE OF THE FSID (FIELD NAME OR (REGISTER))              */ 06800000
*/*                                                                  */ 06900000
*/*   MODE=PC IF EXPANDED CODE MAY RUN AS CROSS MEMORY PC ROUTINE    */ 07000000
*/*                                                                  */ 07100000
*/*                                                                  */ 07200000
*/*     PLS INVOCATION - NOTE REGISTER SPECIFICATIONS FOR PLS        */ 07300000
*/*                      INVOKATIONS MUST USE DOUBLE PARENS, E.G.    */ 07400000
*/*                           ?FSIREQ PARM((REG2))                   */ 07500000
*/*                                                                  */ 07600000
*/*   REQUEST(VALUE) WHERE VALUE IS ONE OF CONSTANTS SPECIFIED FOR   */ 07700000
*/*                  FSIFUNC FIELD IN THE FSIP MAPPING MACRO.        */ 07800000
*/*                  (VALUE MAY BE EQU OR (REGISTER))                */ 07900000
*/*                                                                  */ 08000000
*/*   PARM(NAME OF THE PARAMETER LIST OR (REGISTER))                 */ 08100000
*/*                                                                  */ 08200000
*/*   TARGET(VALUE) WHERE VALUE IS JES OR FSS                        */ 08300000
*/*                                                                  */ 08400000
*/*   FSID(NAME OF VARIABLE CONTAINING FSID OR (REGISTER))           */ 08500000
*/*                                                                  */ 08600000
*/*   MODE(PC) IF EXPANDED CODE MAY RUN AS CROSS MEMORY PC ROUTINE   */ 08700000
*/*                                                                  */ 08800000
*/*   OUTPUT =                                                       */ 08900000
*/*   THE OUTPUT FROM THE FSIREQ MACRO CONSISTS OF INSTRUCTIONS TO   */ 09000000
*/*   ISSUE AN SSI REQUEST (FSICON OR FSIDCON REQUEST) OR TO         */ 09100000
*/*   PUT THE FSCT ADDRESS INTO REGISTER 0, PUT THE ADDRESS OF THE   */ 09200000
*/*   PARAMETER LIST INTO REGISTER 1, AND INVOKE THE JES FSI         */ 09300000
*/*   FACILITY.                                                      */ 09400000
*/*                                                                  */ 09500000
*/*   EXIT - NORMAL                                                  */ 09600000
*/*                                                                  */ 09700000
*/*      CONDITIONS = NO ERRORS DETECTED                             */ 09800000
*/*      OUTPUT = FSI OR SSI REQUEST                                 */ 09900000
*/*                                                                  */ 10000000
*/*   EXIT - ERROR                                                   */ 10100000
*/*                                                                  */ 10200000
*/*      CONDITIONS = MACRO PARAMETER NOT SPECIFIED OR INCORRECT.    */ 10300000
*/*      OUTPUT = ERROR MNOTE ISSUED                                 */ 10400000
*/*                                                                  */ 10500000
*/* EXTERNAL REFERENCES =                                            */ 10600000
*/*                                                                  */ 10700000
*/* TABLES = N/A                                                     */ 10800000
*/*                                                                  */ 10900000
*/* MESSAGES =                                                       */ 11000000
*/*   IAZ1001 (4)  THE MACLIST --- IS NOT ALLOWED. IT IS IGNORED.    */ 11100000
*/*   IAZ200X (4)  --- IS TOO LONG. ARGUMENTS AFTER --- ARE IGNORED. */ 11200000
*/*   IAZ3001 (12) TARGET MUST BE SPECIFIED AS JES OR FSS OR         */ 11300000
*/*                DEFAULTED TO JES, NO TEXT GENERATED               */ 11400000
*/*   IAZ3002 (12) MODE MAY ONLY BE SPECIFIED AS PC, NO TEXT         */ 11500000
*/*                GENERATED                                         */ 11600000
*/*                                                                  */ 11700000
*/* ABEND CODES = N/A                                                */ 11800000
*/*                                                                  */ 11900000
*/* SERIALIZATION = N/A                                              */ 12000000
*/*                                                          @OY21384*/ 12010000
*/*                                                          @OY21384*/ 12100000
*/*CHANGE ACTIVITY                                           @OY21384*/ 12110000
*/*                                                                  */ 12120000
*/*               MVS/SP RELEASE 3 LEVEL 3 (SP1.3.3, JBB1329)        */ 12130000
*/*      @OY21384 JBB2220 FSI TRACE SPE                      @OY21384*/ 12135000
*/*$VC1PB36=PTM      HJE6603 951109 VLC:  BCP Ext.Classific  @OY21384*/ 12136000
*/*$VC1P036=PTM      HJE6603 951208 VLC:  BCP PR20036 Ext.C  @OY21384*/ 12137000
*/*                                                                  */ 12140000
*/* A000000-999999          Created for MVS  1.3.3               @133*/ 12150000
*/********************************************************************/ 12200000
*                                                                       12300000
*/* EXTERNAL DECLARATIONS */                                            12400000
*                                                                       12500000
*  DCL EHAREGS CHAR EXT;          /* REGS TO BE DECLARED BY EPILOG  */  12600000
*  DCL EHARC FIXED EXT;           /* RETURN CODE                    */  12700000
*                                                                       12800000
*/* INITIALIZE EXTERNAL VARIABLES */                                    12900000
*                                                                       13000000
*  EHARC=0;                       /* INITIALIZE THE RETURN CODE     */  13100000
*                                                                       13200000
*/* INTERNAL DECLARATIONS */                                            13300000
*                                                                       13400000
*  DCL IREQSTMT CHAR;             /* INPUT MACRO STATEMENT          */  13500000
*  DCL IERRMSG CHAR;              /* ERROR MESSAGE                  */  13600000
*  DCL FMSG    CHAR;            /* FSI TRACE GENERATED TEXT  @OY21384*/ 13610000
*  DCL ICOMCOL FIXED;             /* COMMENT COLUMN                 */  13700000
*                                                                       13800000
*/* INITIALIZE INTERNAL VARIABLES */                                    13900000
*                                                                       14000000
*  ICOMCOL=MACRMAR-35;            /* SET COMMENT COLUMN             */  14100000
*                                                                       14200000
*/*******************************************************************/  14300000
*/*                                                                 */  14400000
*/* CHECK IF ANY POSITIONAL PARAMETERS WERE SPECIFIED.  IF SO,      */  14500000
*/* ISSUE AN ERROR MNOTE SPECIFYING THAT THE POSITIONAL PARAMETERS  */  14600000
*/* ARE IGNORED.                                                    */  14700000
*/*                                                                 */  14800000
*/*******************************************************************/  14900000
*  IF NUMBER(MACLIST) ^= 0 THEN DO;                                     15000000
*    EHARC = 4;                   /* SET WARNING RETURN CODE        */  15100000
*    IERRMSG = 'IAZ1001 THE MACLIST ' || MACLIST ||                     15200000
*               ' IS NOT ALLOWED. IT IS IGNORED.';                      15300000
*    ANS MSG(IERRMSG) NORESCAN;                                         15400000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         15500000
*    END;                                                               15600000
*/*******************************************************************/  15700000
*/*                                                                 */  15800000
*/* CHECK IF MORE THAN ONE ARGUMENT WAS SPECIFIED FOR ANY OPTION    */  15900000
*/* PARAMETER.  IF SO, ISSUE AN ERROR MNOTE SPECIFYING THAT THE     */  16000000
*/* OTHER ARGUMENTS ARE IGNORED.                                    */  16100000
*/*                                                                 */  16200000
*/*******************************************************************/  16300000
*  IF NUMBER(REQUEST) > 1 THEN DO;                                      16400000
*    EHARC = 4;                                                         16500000
*    IERRMSG = 'IAZ2001 ' || REQUEST ||                                 16600000
*      ' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ' || REQUEST(1);      16700000
*    ANS MSG(IERRMSG) NORESCAN;                                         16800000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         16900000
*    END;                                                               17000000
*  IF NUMBER(PARM) > 1 THEN DO;                                         17100000
*    EHARC = 4;                                                         17200000
*    IERRMSG = 'IAZ2002 ' || PARM ||                                    17300000
*      ' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ' || PARM(1);         17400000
*    ANS MSG(IERRMSG) NORESCAN;                                         17500000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         17600000
*    END;                                                               17700000
*  IF NUMBER(TARGET) > 1 THEN DO;                                       17800000
*    EHARC = 4;                                                         17900000
*    IERRMSG = 'IAZ2003 ' || TARGET ||                                  18000000
*      ' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ' || TARGET(1);       18100000
*    ANS MSG(IERRMSG) NORESCAN;                                         18200000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         18300000
*    END;                                                               18400000
*  IF NUMBER(FSID) > 1 THEN DO;                                         18500000
*    EHARC = 4;                                                         18600000
*    IERRMSG = 'IAZ2004 ' || FSID ||                                    18700000
*      ' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ' || FSID(1);         18800000
*    ANS MSG(IERRMSG) NORESCAN;                                         18900000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         19000000
*    END;                                                               19100000
*  IF NUMBER(MODE) > 1 THEN DO;                                         19200000
*    EHARC = 4;                                                         19300000
*    IERRMSG = 'IAZ2005 ' || MODE ||                                    19400000
*      ' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ' || MODE(1);         19500000
*    ANS MSG(IERRMSG) NORESCAN;                                         19600000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         19700000
*    END;                                                               19800000
*/*******************************************************************/  19900000
*/*                                                                 */  20000000
*/* VERIFY THE TARGET AND MODE OPTIONS.  IF OK SETUP REGS, OUTPUT   */  20100000
*/* MACLABEL IF ANY, RESERVED REGS, ETC.                            */  20200000
*/*                                                                 */  20300000
*/*******************************************************************/  20400000
*  IF (TARGET(1) = 'JES' | TARGET(1) = 'FSS' | NUMBER(TARGET) = 0) &    20500000
*     (MODE(1) = 'PC' | NUMBER(MODE) = 0)                               20600000
*     THEN DO;                                                          20700000
*         IF INDEX(EHAREGS,'00F')=0 THEN                                20800000
*             EHAREGS=EHAREGS || '00F';   /* HAVE EPILOG DCL REG 0   */ 20900000
*         IF INDEX(EHAREGS,'01P')=0 THEN                                21000000
*             EHAREGS=EHAREGS || '01P';   /* HAVE EPILOG DCL REG 1   */ 21100000
*         IF INDEX(EHAREGS,'14F')=0 THEN                                21200000
*             EHAREGS=EHAREGS || '14F';   /* HAVE EPILOG DCL REG 1   */ 21300000
*         IF INDEX(EHAREGS,'15F')=0 THEN                   /*@OY21384*/ 21310000
*             EHAREGS=EHAREGS || '15F';                    /*@OY21384*/ 21320000
*         IF INDEX(EHAREGS,'15P')=0 THEN                   /*@OY21384*/ 21330000
*             EHAREGS=EHAREGS || '15P';                    /*@OY21384*/ 21340000
*                                                                       21400000
*  IF MACLABEL ^= '' THEN                                               21500000
*    ANS(MACLABEL) COLUMN(MACLMAR) NORESCAN;                            21600000
*                                                                       21700000
*  IREQSTMT = 'FSIREQ ' || MACLIST || ' ' || MACKEYS;                   21800000
*  ANS('DO;') COLUMN(MACCOL) NORESCAN;                                  21900000
*  ANS(COMMENT(IREQSTMT)) COLUMN(ICOMCOL) NORESCAN;                     22000000
*  ANS('RFY (GPR00F,GPR01P) RSTD;') COLUMN(MACCOL+2) NORESCAN;          22100000
*/*******************************************************************/  22200000
*/*                                                                 */  22300000
*/* VERIFY THE PARM PARAMETER, LOAD ITS POINTER REG                 */  22400000
*/* (IF PARM NOT SPECIFIED REG 1 ASSUMED)                           */  22500000
*/*                                                                 */  22600000
*/*******************************************************************/  22700000
*  IF NUMBER(PARM) > 0 THEN DO;                                         22800000
*      IF PARM(1,1:1) = '(' THEN                                        22900000
*          ANS('GPR01P='||PARM(1,1)||';') COLUMN(MACCOL+2) NORESCAN;    23000000
*      ELSE ANS('GPR01P=ADDR('||PARM(1)||');')                          23100000
*          COLUMN(MACCOL+2) NORESCAN;                                   23200000
*      ANS(COMMENT('GET FSIP ADDRESS')) COLUMN(ICOMCOL) NORESCAN;       23300000
*      END;                                                             23400000
*  ELSE ANS(COMMENT('FSIPARM LIST ADDRESS ASSUMED IN REG 1'))           23500000
*              COLUMN(MACCOL+2) NORESCAN;                               23600000
*  ANS('FSIPPTR=GPR01P;') COLUMN(MACCOL+2) NORESCAN;                    23700000
*/*******************************************************************/  23800000
*/*                                                                 */  23900000
*/* VERIFY THE FSID PARAMETER, PLACE VALUE IN FSIPARM IF NEED TO    */  24000000
*/* (IF NOT SPECIFIED ASSUME IT IS ALREADY STORED IN THE FSIPARM)   */  24100000
*/*                                                                 */  24200000
*/*******************************************************************/  24300000
*  IF NUMBER(FSID) > 0 THEN DO;                                         24400000
*      IF FSID(1,1:1) = '(' THEN                                        24500000
*          ANS('FSIFSID='||FSID(1,1)||';') COLUMN(MACCOL+2) NORESCAN;   24600000
*      ELSE ANS('FSIFSID='||FSID(1)||';') COLUMN(MACCOL+2) NORESCAN;    24700000
*      ANS(COMMENT('GET FSID OF REQUESTOR')) COLUMN(ICOMCOL) NORESCAN;  24800000
*      END;                                                             24900000
*  ELSE ANS(COMMENT('FSID ASSUMED TO HAVE BEEN STORED IN FSIPARM'))     25000000
*              COLUMN(MACCOL+2) NORESCAN;                               25100000
*/*******************************************************************/  25200000
*/*                                                                 */  25300000
*/* VERIFY THE REQUEST PARAMETER, PLACE VALUE IN FSIPARM IF NEED TO */  25400000
*/* (IF NOT SPECIFIED ASSUME IT IS ALREADY STORED IN THE FSIPARM)   */  25500000
*/*                                                                 */  25600000
*/*******************************************************************/  25700000
*  IF NUMBER(REQUEST) > 0 THEN                             /*@OY21384*/ 25710000
*    DO;                                                   /*@OY21384*/ 25800000
*      IF REQUEST(1,1:1) = '(' THEN                                     25900000
*         ANS('FSIFUNC='||REQUEST(1,1)||';') COLUMN(MACCOL+2) NORESCAN; 26000000
*     ELSE ANS('FSIFUNC='||REQUEST(1)||';') COLUMN(MACCOL+2) NORESCAN;  26100000
*     ANS(COMMENT('SPECIFY FSI REQUEST')) COLUMN(ICOMCOL) NORESCAN;     26200000
*     END;                                                              26300000
*  ELSE ANS(COMMENT('REQUEST ASSUMED TO HAVE BEEN STORED IN FSIPARM'))  26400000
*      COLUMN(MACCOL+2) NORESCAN;                                       26500000
*                                                                       26600000
*/********************************************************** @OY21384*/ 26601000
*/*                                                          @OY21384*/ 26602000
*/* DETERMINE IF THE FSI TRACE SUPPORT IS INSTALLED.  BIT    @OY21384*/ 26603000
*/* JESFSIT IN JESFLG BYTE OF THE JESCT IS ON IF THE TRACE   @OY21384*/ 26604000
*/* SUPPORT IS INSTALLED.                                    @OY21384*/ 26605000
*/*                                                          @OY21384*/ 26606000
*/********************************************************** @OY21384*/ 26607000
*  FMSG = 'RESPECIFY (GPR00F,GPR14F,GPR15P) RESTRICTED;';  /*@OY21384*/ 26608000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26609000
*                                                          /*@OY21384*/ 26610000
*  FMSG = 'GPR15P = 16;   ' ||                             /*@OY21384*/ 26611000
*         COMMENT('CVT ADDRESS FROM PSA LOCATION 16');     /*@OY21384*/ 26612000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26613000
*                                                          /*@OY21384*/ 26614000
*  FMSG = 'GPR15P = GPR15P->I031P;   ' ||                  /*@OY21384*/ 26615000
*         COMMENT('PICK UP POINTER TO THE CVT');           /*@OY21384*/ 26616000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26617000
*                                                          /*@OY21384*/ 26618000
*  FMSG = 'GPR15P = (GPR15P+296)->I031P;   ' ||            /*@OY21384*/ 26619000
*         COMMENT('PICK UP POINTER TO THE JESCT');         /*@OY21384*/ 26620000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26621000
*                                                          /*@OY21384*/ 26622000
*  FMSG = 'IF (((GPR15P+70)->I001C) & ''40''X) ^= 0 '      /*@OY21384*/ 26623000
*         'THEN' || COMMENT('JESFSIT BIT IN JESFLG ON?');  /*@OY21384*/ 26624000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26625000
*                                                          /*@OY21384*/ 26626000
*  FMSG = 'DO;   ';                                        /*@OY21384*/ 26627000
*  ANS(FMSG) COLUMN(MACCOL+4) NORESCAN;                    /*@OY21384*/ 26628000
*                                                          /*@OY21384*/ 26629000
*  FMSG = COMMENT('YES, FSI TRACE INSTALLED,' ||           /*@OY21384*/ 26630000
*         ' CALL IAZFSIT');                                /*@OY21384*/ 26631000
*  ANS(FMSG) COLUMN(MACCOL+6) NORESCAN;                    /*@OY21384*/ 26632000
*                                                          /*@OY21384*/ 26633000
*  FMSG = 'GPR15P = (GPR15P+100)->I031P;   ' ||            /*@OY21384*/ 26634000
*         COMMENT('PICK UP POINTER TO THE JESCT EXT.');    /*@OY21384*/ 26635000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26636000
*                                                          /*@OY21384*/ 26637000
*  FMSG = 'GPR15P = (GPR15P+100)->I031P;   ' ||            /*@OY21384*/ 26638000
*         COMMENT('PICK UP POINTER TO FSIBASE.');          /*@OY21384*/ 26639000
*  ANS(FMSG) COLUMN(MACCOL+6) NORESCAN;                    /*@OY21384*/ 26640000
*                                                          /*@OY21384*/ 26641000
*  FMSG = 'GPR15P = (GPR15P+8)->I031P;   ' ||              /*@OY21384*/ 26642000
*         COMMENT('PICK UP ADDRESS OF IAZFSIT');           /*@OY21384*/ 26643000
*  ANS(FMSG) COLUMN(MACCOL+6) NORESCAN;                    /*@OY21384*/ 26644000
*                                                          /*@OY21384*/ 26645000
*/********************************************************** @OY21384*/ 26646000
*/* THE FSITRACE ROUTINE NEEDS TO KNOW THE DESTINATION       @OY21384*/ 26647000
*/* OF THIS CALL TO CALCULATE THE ADDRESS OF THE ROUTINE     @OY21384*/ 26648000
*/* IT WILL CALL AFTER POSSIBLE TRACING. IF THE DESTINATION  @OY21384*/ 26649000
*/* IS JES REGISTER 0 MUST BE 1, OTHERWISE REGISTER 0        @OY21384*/ 26650000
*/* MUST BE 0.                                               @OY21384*/ 26651000
*/********************************************************** @OY21384*/ 26652000
*  IF TARGET(1) = 'JES' THEN                               /*@OY21384*/ 26653000
*      FMSG = 'GPR00F = 1;';                               /*@OY21384*/ 26654000
*  ELSE                                                    /*@OY21384*/ 26655000
*      FMSG = 'GPR00F = 0;';                               /*@OY21384*/ 26656000
*  ANS(FMSG) COLUMN(MACCOL+6) NORESCAN;                    /*@OY21384*/ 26657000
*                                                          /*@OY21384*/ 26658000
*  FMSG = COMMENT('BRANCH TO IAZFSIT');                    /*@OY21384*/ 26659000
*  ANS(FMSG) COLUMN(2) NORESCAN;                           /*@OY21384*/ 26660000
*                                                          /*@OY21384*/ 26661000
*  FMSG = 'GEN SETS(GPR14F) REFS(GPR15P) (BASSM 14,15);';  /*@OY21384*/ 26662000
*                                                          /*@OY21384*/ 26663000
*  ANS(FMSG) COLUMN(MACCOL+6) NORESCAN;                    /*@OY21384*/ 26664000
*                                                          /*@OY21384*/ 26665000
*  FMSG = 'RESPECIFY (GPR00F,GPR14F,GPR15P) UNRESTRICTED;';/*@OY21384*/ 26666000
*  ANS(FMSG) COLUMN(MACCOL+2);                             /*@OY21384*/ 26667000
*                                                          /*@OY21384*/ 26668000
*  FMSG = 'END;   ';                                       /*@OY21384*/ 26669000
*  ANS(FMSG) COLUMN(MACCOL+4) NORESCAN;                    /*@OY21384*/ 26670000
*                                                          /*@OY21384*/ 26671000
*  FMSG = '@SPACE;';                                       /*@OY21384*/ 26672000
*  ANS(FMSG) COLUMN(2) NORESCAN;                           /*@OY21384*/ 26673000
*                                                          /*@OY21384*/ 26674000
*  FMSG = 'ELSE   ';                                       /*@OY21384*/ 26675000
*  ANS(FMSG) COLUMN(MACCOL+2) NORESCAN;                    /*@OY21384*/ 26676000
*                                                          /*@OY21384*/ 26677000
*  FMSG = 'DO;   ';                                        /*@OY21384*/ 26678000
*  ANS(FMSG) COLUMN(MACCOL+4) NORESCAN;                    /*@OY21384*/ 26679000
*                                                          /*@OY21384*/ 26680000
*/*******************************************************************/  26700000
*/*                                                                 */  26800000
*/* GET THE ADDRESS OF THE FSI ROUTINE REQUESTED AND ENTER IT       */  26900000
*/* IF THE REQUEST IS NOT CONNECT OR DISCONNECT.                    */  27000000
*/*                                                                 */  27100000
*/*******************************************************************/  27200000
*  IF REQUEST(1) ^= 'FSICON' & REQUEST(1) ^= 'FSIDCON' THEN DO;         27300000
*    IF MODE(1) = 'PC' THEN DO;                                         27400000
*      ANS('RFY GPR14F RSTD;') COLUMN(MACCOL+2) NORESCAN;               27500000
*      ANS('GENERATE SETS(GPR14F) (EPAR GPR14F);') COLUMN(MACCOL+2)     27600000
*          NORESCAN;                                                    27700000
*      ANS('ASVTPTR=CVTASVT;') COLUMN(MACCOL+2) NORESCAN;               27800000
*      ANS('ASCBPTR=ASVTENTY(GPR14F);') COLUMN(MACCOL+2) NORESCAN;      27900000
*      ANS('RFY GPR14F UNRSTD;') COLUMN(MACCOL+2) NORESCAN;             28000000
*      END;                                                             28100000
*    ELSE ANS('ASCBPTR=PSAAOLD;') COLUMN(MACCOL+2) NORESCAN;            28200000
*    ANS('ASXBPTR=ASCBASXB;') COLUMN(MACCOL+2) NORESCAN;                28300000
*    ANS('FSVTPTR=ASXBJSVT;') COLUMN(MACCOL+2) NORESCAN;                28400000
*    IF NUMBER(TARGET) = 0 THEN ANS('FSCTPTR=FSVTJESP(FSIFSAID+1);')    28500000
*        COL(MACCOL+2) NORESCAN;                                        28600000
*    ELSE ANS('FSCTPTR=FSVT'||TARGET(1)||'P(FSIFSAID+1);')              28700000
*        COL(MACCOL+2) NORESCAN;                                        28800000
*    ANS('GPR00F=FSCTPTR;') COLUMN(MACCOL+2) NORESCAN;                  28900000
*    ANS('FSIRTNP=FSCTRTN(FSIFUNC);') COLUMN(MACCOL+2) NORESCAN;        29000000
*    ANS('CALL FSIRTN;') COLUMN(MACCOL+2) NORESCAN;                     29100000
*    END;                                                               29200000
*/*******************************************************************/  29300000
*/*                                                                 */  29400000
*/* ELSE FOR CONNECT AND DISCONNECT ISSUE THE FSI SSI REQUEST.      */  29500000
*/*                                                                 */  29600000
*/*******************************************************************/  29700000
*  ELSE DO;                                                             29800000
*    ANS('CDFSTORH=''0''B;') COLUMN(MACCOL+2) NORESCAN;        @ZA73542 29810000
*    ANS('RFY SSOB BASED(CDFSTOR);') COLUMN(MACCOL+2) NORESCAN;         29900000
*    ANS(COMMENT('SETUP SSOB/SSIB FOR SSI')) COLUMN(ICOMCOL) NORESCAN;  30000000
*    ANS('SSOBID=''SSOB'';') COLUMN(MACCOL+2) NORESCAN;                 30100000
*    ANS('SSOBFUNC=CDFSSIID;') COLUMN(MACCOL+2) NORESCAN;               30200000
*    ANS('SSOBLEN=LENGTH(SSOB);') COLUMN(MACCOL+2) NORESCAN;            30300000
*    ANS('SSOBINDV=GPR01P;') COLUMN(MACCOL+2) NORESCAN;                 30400000
*    ANS('SSIBPTR=ADDR(SSOB)+LENGTH(SSOB);') COLUMN(MACCOL+2) NORESCAN; 30500000
*    ANS('SSOBSSIB=SSIBPTR;') COLUMN(MACCOL+2) NORESCAN;                30600000
*    ANS('SSIBID=''SSIB'';') COLUMN(MACCOL+2) NORESCAN;                 30700000
*    ANS('SSIBSSNM=CDFSSID;') COLUMN(MACCOL+2) NORESCAN;                30800000
*    ANS('SSIBLEN=LENGTH(SSIB);') COLUMN(MACCOL+2) NORESCAN;            30900000
*    ANS('CDFSTORH=''1''B;') COLUMN(MACCOL+2) NORESCAN;                 31000000
*    ANS('GPR01P=ADDR(CDFSTOR);') COLUMN(MACCOL+2) NORESCAN;            31100000
*    ANS(COMMENT('INVOKE FSI SSI REQUEST')) COLUMN(ICOMCOL) NORESCAN;   31200000
*    ANS('RFY (GPR15F) RSTD;') COLUMN(MACCOL+2) NORESCAN;               31300000
*    ANS('? IEFSSREQ;') COLUMN(MACCOL+2) ;                              31400000
*    ANS('RFY SSOB BASED(SSOBPTR);') COLUMN(MACCOL+2) NORESCAN;         31500000
*    ANS('IF GPR15F = 0 THEN') COLUMN(MACCOL+2) NORESCAN;               31510000
*      ANS('DO;') COLUMN(MACCOL+4) NORESCAN;                            31520000
*        ANS('SSOBPTR=GPR01P;') COLUMN(MACCOL+6) NORESCAN;              31530000
*        ANS('FSIPPTR=SSOBINDV;') COLUMN(MACCOL+6) NORESCAN;            31540000
*        ANS('FSIRESN=GPR15F;') COLUMN(MACCOL+6) NORESCAN;              31550000
*        ANS('IF SSOBRETN ^= 0 THEN') COLUMN(MACCOL+6) NORESCAN;        31560000
*          ANS('GPR15F = 4;')COLUMN(MACCOL+8) NORESCAN;                 31570000
*        ANS('ELSE;') COLUMN(MACCOL+6) NORESCAN;                        31580000
*      ANS('END;') COLUMN(MACCOL+4) NORESCAN;                           31590000
*    ANS('ELSE') COLUMN(MACCOL+2) NORESCAN;                             31600000
*      ANS('DO;') COLUMN(MACCOL+4) NORESCAN;                            31700000
*        ANS('SSOBPTR=GPR01P->I031P;') COLUMN(MACCOL+6) NORESCAN;       31800000
*        ANS('FSIPPTR=SSOBINDV;') COLUMN(MACCOL+6) NORESCAN;            31900000
*        ANS('FSIRESN=GPR15F;') COLUMN(MACCOL+6) NORESCAN;              32000000
*        ANS('GPR15F = 4;') COLUMN(MACCOL+6) NORESCAN;                  32100000
*      ANS('END;') COLUMN(MACCOL+4) NORESCAN;                           32200000
*    ANS('RFY (GPR15F) UNRSTD;') COL(MACCOL+2) NORESCAN;   /*@OY21384*/ 32210000
*    END;                                                               32300000
*                                                                       32400000
*  ANS(COMMENT('INVOKE FSI REQUEST FACILITY')) COLUMN(ICOMCOL)          32500000
*    NORESCAN;                                                          32600000
*  ANS('RFY (GPR00F,GPR01P) UNRSTD;') COL(MACCOL+2)        /*@OY21384*/ 32700000
*      NORESCAN;                                                        32800000
*  ANS('END;') COLUMN(MACCOL) NORESCAN;                                 32900000
*  ANS(COMMENT(IREQSTMT)) COLUMN(ICOMCOL) NORESCAN;                     33000000
*                                                                       33100000
*  FMSG = 'END;   ' ||                                     /*@OY21384*/ 33110000
*         COMMENT('FSI TRACE NOT INSTALLED.');             /*@OY21384*/ 33120000
*  ANS(FMSG) COLUMN(MACCOL+4) NORESCAN;                    /*@OY21384*/ 33130000
*                                                          /*@OY21384*/ 33140000
*  END;    /* END OF THE TEXT GENERATING CODE FOR VALID REQUESTS */     33200000
*/*******************************************************************/  33300000
*/*                                                                 */  33400000
*/* IF THE REQUEST PARAMETER DOES NOT SPECIFY A VALID FUNCTION      */  33500000
*/* THEN ISSUE AN ERROR MNOTE SPECIFYING THAT THE REQUEST           */  33600000
*/* PARAMETER WAS SPECIFIED INCORRECTLY.                            */  33700000
*/*                                                                 */  33800000
*/*******************************************************************/  33900000
*  ELSE DO;                                                             34000000
*    EHARC=12;                                                          34100000
*    IF MODE(1) = 'PC' | MODE(1) = '' THEN                              34200000
*        IERRMSG = 'IAZ3001 TARGET MUST BE SPECIFIED AS JES OR FSS OR ' 34300000
*        || 'DEFAULTED TO JES, NO TEXT GENERATED';                      34400000
*    ELSE IERRMSG = 'IAZ3002 MODE MAY ONLY BE SPECIFIED AS PC, NO TEXT' 34500000
*        || ' GENERATED';                                               34600000
*    ANS MSG(IREQSTMT) NORESCAN;                                        34700000
*    ANS MSG(IERRMSG) NORESCAN;                                         34800000
*    ANS(COMMENT(IERRMSG)) COLUMN(10) NORESCAN;                         34900000
*    END;                                                               35000000
*                                                                       35100000
*  RETURN CODE(EHARC);                                                  35200000
* % END FSIREQ;                                                         35300000
* % GOTO ENDMAC;                               /*                       35400000
         MACRO                                                          35500000
&NAME    FSIREQ &REQUEST=,&TARGET=JES,&PARM=,&FSID=,&MODE=              35600000
         LCLC  &IAZLB                                                   35700000
&IAZLB   SETC  'IAZ&SYSNDX'                                    @OY21384 35710000
.*********************************************************************  35800000
.*                                                                   *  35900000
.* IF A LABEL WAS SPECIFIED ON THE MACRO INVOCATION THEN             *  36000000
.* GENERATE AN EQU FOR THE LABEL.                                    *  36100000
.*                                                                   *  36200000
.*********************************************************************  36300000
         AIF   ('&NAME' EQ '').SKIPLBL                                  36400000
&NAME    DS    0H                                                       36500000
.SKIPLBL ANOP                                                           36600000
.*********************************************************************  36700000
.*                                                                   *  36800000
.*       VERIFY MACRO PARAMETERS, GENERATE CODE                      *  36900000
.*                                                                   *  37000000
.*********************************************************************  37100000
.*                                                                      37200000
         AIF   ('&TARGET' NE 'JES' AND '&TARGET' NE 'FSS').ERR2         37300000
         AIF   ('&MODE' NE '' AND '&MODE' NE 'PC').ERR3                 37400000
.*                                                                      37500000
         AIF   ('&PARM' EQ '' OR '&PARM' EQ '(1)').PARMD                37600000
         AIF   ('&PARM'(1,1) EQ '(').PARM1                              37700000
         LA    1,&PARM                   GET PARAMETER ADDRESS          37800000
         AGO   .PARMD                                                   37900000
.PARM1   LR    1,&PARM(1)                GET PARAMETER ADDRESS          38000000
.*                                                                      38100000
.PARMD   ANOP                                                           38200000
         AIF   ('&FSID' EQ '').FSIDD                                    38300000
         AIF   ('&FSID'(1,1) EQ '(').FSID1                              38400000
         L     15,&FSID                  GET FSID VALUE                 38500000
         ST    15,FSIFSID-FSIPARM(0,1)   SAVE FSID IN PARM LIST         38600000
         AGO   .FSIDD                                                   38700000
.FSID1   ST    &FSID(1),FSIFSID-FSIPARM(0,1) SAVE FSID IN PARM LIST     38800000
.*                                                                      38900000
.FSIDD   ANOP                                                           39000000
         AIF   ('&REQUEST' EQ '').REQD                                  39100000
         AIF   ('&REQUEST'(1,1) EQ '(').REQ1                            39200000
         LA    15,&REQUEST               GET REQUEST VALUE              39300000
         ST    15,FSIFUNC-FSIPARM(0,1)   SAVE REQUEST IN PARM LIST      39400000
         AGO   .REQD                                                    39500000
.REQ1    ST    &REQUEST(1),FSIFUNC-FSIPARM(0,1) SAVE REQUEST IN FSIP    39600000
.*                                                                      39700000
.REQD    ANOP                                                           39800000
.*                                                             @OY21384 39801000
.**********************************************************    @OY21384 39804000
.* DETERMINE IF THE FSI TRACE SUPPORT IS INSTALLED.  BIT  *    @OY21384 39807000
.* JESFSIT IN JESFLG BYTE OF THE JESCT IS ON IF THE TRACE *    @OY21384 39810000
.* SUPPORT IS INSTALLED.                                  *    @OY21384 39813000
.**********************************************************    @OY21384 39816000
         LA    15,16      GET CVT ADDRESS                      @OY21384 39819000
         L     15,0(15)                                        @OY21384 39822000
         L     15,296(15) GET JESCT ADDRESS                    @OY21384 39825000
         TM    70(15),X'40' JESFSIT BIT IN JESFLG ON?          @OY21384 39828000
         BNO   &IAZLB.A   NO! SKIP TRACE ROUTINE CALL          @OY21384 39831000
.*                                                             @OY21384 39834000
.**********************************************************    @OY21384 39837000
.* THE TRACE ROUTINE HAS BEEN INSTALLED, CALL IT INSTEAD  *    @OY21384 39840000
.* OF EXECUTING THE OLDER BALR/SSI CALL.                  *    @OY21384 39843000
.**********************************************************    @OY21384 39846000
         L     15,100(15) GET JESCT EXTENSION ADDRESS          @OY21384 39849000
         L     15,100(15) GET IAZBASE CONTROL BLOCK ADDRESS    @OY21384 39852000
         L     15,8(15)   GET IAZFSIT ROUTINE ADDRESS          @OY21384 39855000
         AIF   ('&TARGET' NE 'JES').NOTJES                     @OY21384 39858000
         LA    0,1        PLACE A 1 IN REG0, INDICATE JES CALL @OY21384 39861000
         AGO   .CCALL     BYPASS NON-JES CALL INITIALIZATION   @OY21384 39864000
.NOTJES  ANOP             TARGET NOT JES.                      @OY21384 39867000
         LA    0,0        INDICATE TARGET NOT JES              @OY21384 39870000
.CCALL   ANOP             CONTINUE WILL FSI TRACE CALL         @OY21384 39873000
         BASSM 14,15      CALL FSI TRACE ROUTINE.              @OY21384 39876000
         B     &IAZLB.X   BYPASS OLD INTERFACE CODE.           @OY21384 39879000
.*                                                             @OY21384 39882000
&IAZLB.A DS    0H                                              @OY21384 39885000
         AIF   ('&REQUEST' EQ 'FSICON' OR '&REQUEST' EQ 'FSIDCON').SSI  39900000
         AIF   ('&MODE' NE 'PC').NOPC                                   40000000
         L     15,CVTPTR                 GET CVT ADDRESS                40100000
         L     15,CVTASVT-CVT(0,15)      GET ASVT ADDRESS               40200000
         EPAR  14                        GET PRIMARY ADDR SPC ASID      40300000
         SLL   14,2                      GET INDEX FOR ASCB INTO ASVT   40400000
         L     15,ASVTENTY-ASVT-4(14,15) GET ASCB ADDRESS               40500000
         AGO   .GETASCB                                                 40600000
.NOPC    L     15,PSAAOLD-PSA(0,0)       GET ASCB ADDRESS               40700000
.GETASCB L     15,ASCBASXB-ASCB(0,15)    GET THE ASXB                   40800000
         L     15,ASXBJSVT-ASXB(0,15)    GET THE FSVT POINTER           40900000
         LH    14,FSIFSAID-FSIPARM(0,1)  GET FSA ID                     41000000
         SLL   14,3                      INDEX INTO THE FSVT            41100000
         L     15,FSVT&TARGET.P-FSVT(14,15)    GET FSCT ADDRESS         41200000
         LR    0,15                      COPY FSCT ADDRESS FOR ROUTINE  41300000
         L     14,FSIFUNC-FSIPARM(0,1)   GET FUNCTION CODE              41400000
         SLL   14,2                      INDEX INTO FSCT                41500000
         L     15,FSCTRTN-FSCT-4(14,15)  GET SERVICE ROUTINE ADDRESS    41600000
         BALR  14,15                     ENTER FSI SERVICE ROUTINE      41700000
         AGO   .MEXIT                                          @OY21384 41800000
.*                                                                      41900000
.SSI     NI    CDFSTOR-FSIPARM(1),255-CDFSTORH  RESET HI BYTE  @ZA73542 42000000
         L     15,CDFSTOR-FSIPARM(0,1)   GET SSOB/SSIB ADDRESS @ZA73542 42010000
         B     &IAZLB.E                  SKIP IDS IN EXPANSION          42200000
&IAZLB.O DC    CL(L'SSOBID)'SSOB'        SSOBID                         42300000
&IAZLB.I DC    CL(L'SSIBID)'SSIB'        SSIBID                         42400000
&IAZLB.E MVC   SSOBID-SSOB(L'SSOBID,15),&IAZLB.O                        42500000
         LA    14,CDFSSIID               GET CON/DISCON SSI FUNCTION    42600000
         STH   14,SSOBFUNC-SSOB(0,15)    SAVE IN SSOB                   42700000
         ST    1,SSOBINDV-SSOB(0,15)     SET FSI PARM AS SSOB EXTENSION 42800000
         LA    14,SSOBHSIZ               GET SSOB HEADER SIZE           42900000
         STH   14,SSOBLEN-SSOB(0,15)     SAVE IN SSOB                   43000000
         ALR   14,15                     GET ADDRESS OF SSIB            43100000
         ST    14,SSOBSSIB-SSOB(0,15)    SAVE IN SSOB                   43200000
         MVC   SSIBID-SSIB(L'SSIBID,14),&IAZLB.I                        43300000
         MVC   SSIBSSNM-SSIB(L'SSIBSSNM,14),CDFSSID-FSIPARM(1)          43400000
         LA    15,SSIBSIZE               GET SSIB SIZE                  43500000
         STH   15,SSIBLEN-SSIB(0,14)     SAVE IN SSIB                   43600000
         LA    1,CDFSTOR-FSIPARM(0,1)    GET ADDR OF SSOB FOR SSI       43700000
         OI    0(1),CDFSTORH             SET THE HIGH ORDER BYTE        43800000
         IEFSSREQ                        ISSUE SSI REQUEST              43900000
         LTR   15,15                     SSI FAILURE...            @220 43910000
         BZ    &IAZLB.G                  NO, R1 IS A(SSOB)         @220 43920000
         L     1,0(,1)                   YES, R1 IS INDIRECT       @220 43930000
&IAZLB.G L     14,SSOBINDV-SSOB(,1)      GET FSIPARM ADDRESS       @220 44000000
         ST    15,FSIRESN-FSIPARM(,14)   SAVE SSI RETURN CODE           44100000
         LTR   15,15                     SSI FAILURE ...                44200000
         BNZ   &IAZLB.F                  YES, SET RETURN CODE           44300000
         OC    SSOBRETN-SSOB(,1),SSOBRETN-SSOB(1) FSI RETURN OK...      44400000
         BZ    &IAZLB.X                  YES, EXIT                      44500000
&IAZLB.F LA    15,4                      SET FSI ERROR RETURN CODE      44600000
.MEXIT   ANOP                            EXIT FSIREQ           @OY21384 44610000
&IAZLB.X DS    0H                        EXIT FSIREQ           @OY21384 44700000
         MEXIT                                                          44800000
.*                                                                      44900000
.ERR2    MNOTE 12,'IAZ3001 TARGET MUST BE SPECIFIED AS JES OR FSS OR DEC45000000
               FAULTED TO JES, NO TEXT GENERATED'                       45100000
         MEXIT                                                          45200000
.ERR3    MNOTE 12,'IAZ3002 MODE MAY ONLY BE SPECIFIED AS PC, NO TEXT GEC45300000
               NERATED'                                                 45400000
         MEND , - */                                                    45500000
%ENDMAC: ;                                                              99999999
