*/*     CLOSING DELIMITER AT END BEFORE PL/X-370 INVOCATION             00001100
*/*                                                      */             00002200
*/*PROPRIETARY V3 STATEMENT                              */             00004200
*/*LICENSED MATERIALS - PROPERTY OF IBM                  */             00006200
*/*"RESTRICTED MATERIALS OF IBM"                         */             00008200
*/*5695-DF1                                              */             00010200
*/*(C) COPYRIGHT 1992  IBM CORP.                         */             00012200
*/*END PROPRIETARY V3 STATEMENT                          */             00015500
*/*     START OF PL/X COMMENT ENDING IN %MACRO STATEMENT          @L2A  00018800
         MACRO                                                          00020000
&NAME    FIND  &DCB,&AREA,&TYPE                                         00040000
.* $01=OY51276,HDP3330,,SJPLGEC: DCB ADDRESS REQUIRED FOR FIND.   @01A  00045000
.* $L1=31BIT,JDZ1110,,SJPLRK:  INVOCABLE IN 31-BIT MODE           @L1A  00047500
.* $L2=PLX,JDZ1110,,SJPLMET: PL/X SUPPORT                         @L2A  00048700
         LCLB  &ERR(4)                                                  00050000
&ERR(1)  SETB  ('&DCB' EQ '')                                           00060000
&ERR(2)  SETB  ('&AREA' EQ '')                                          00070000
&ERR(3)  SETB  ('&TYPE' EQ '')                                          00080000
&ERR(4)  SETB  (NOT &ERR(3) AND '&TYPE' NE 'C' AND '&TYPE' NE 'D')      00090000
         AIF   (&ERR(1)+&ERR(2)+&ERR(3)+&ERR(4) NE 0).E0                00100000
         AIF   ('&TYPE' NE 'D').CTYPE                                   00120000
&NAME    IHBINNRA &DCB,&AREA                                            00140000
         LTR   1,1                               IS DCB ADDRESS 0       00143300
         BNZ   *+16                              NO, BRANCH             00146600
         LA    15,8                              SET RETURN CODE        00149900
         LA    0,16                              SET REASON CODE        00153200
         B     *+8                               BR AROUND FIND SVC     00156500
         LCR   1,1                               INDICATE TYPE D        00160000
         SVC   18                                ISSUE FIND SVC         00180000
         MEXIT                                                          00200000
.CTYPE   ANOP                                                           00220000
&NAME    IHBINNRA &DCB                                                  00240000
         AIF   ('&AREA'(1,1) EQ '(').REG                                00260000
         LA    15,&AREA                          LOAD AREA ADDRESS      00280000
         AGO   .CONT                                                    00300000
.REG     LR    15,&AREA(1)                       LOAD AREA ADDRESS      00320000
.CONT    ANOP                                                           00323600
*  IF DCBE EXISTS THEN SET TTR IN DCBE AND POINT R0 TO DCBERELA         00327200
         TM    32(1),X'84'                       IS THERE A DCBE        00330800
         BNO   *+22                              NO, BRANCH             00334400
         L     14,0(0,1)                         GET DCBE ADDRESS       00338000
         MVC   12(4,14),0(15)                    MOVE RELAD TO DCBE     00341600
         LA    0,12(0,14)                        INDICATE TYPE C        00345200
         B     *+12                              CONTINUE               00348800
*  NO DCBE...MOVE RELAD INTO DCB AND POINT RO TO DCBRELAD               00352400
         MVC   0(4,1),0(15)                      MOVE RELAD TO DCB      00356000
         LR    0,1                               INDICATE TYPE C        00360000
         SLR   15,15                         CLEAR REGISTER     @L1C    00373300
         ICM   15,7,85(1)                    LOAD FIND RTN ADDR @L1C    00386600
         BAL   14,4(0,15)                    LINK TO FIND ROUTINE       00400000
         MEXIT                                                          00420000
.E0      AIF   (NOT &ERR(1)).E1                                         09420000
         IHBERMAC 6                     &DCB MISSING                    18420000
.E1      AIF   (NOT &ERR(2)).E2                                         27420000
         IHBERMAC 13                    &AREA MISSING                   36420000
.E2      AIF   (NOT &ERR(3)).E3                                         45420000
         IHBERMAC 25                    &TYPE MISSING                   54420000
.E3      AIF   (NOT &ERR(4)).MEND                                       63420000
         IHBERMAC 48,,&TYPE             &TYPE INVALID                   72420000
.MEND    MEND                                                           81420000
**/%FIND:  MACRO KEYS(1:1(DCB_ADDR,DCB_NAME),0:1(AREA_ADDR,    /*@L2A*/ 81470000
*     AREA_NAME),0:1(RELAD_NAME,RELAD_ADDR),RETCODE,RSNCODE);  /*@L2A*/ 81520000
*  ANS('? '||MACLABEL||' FINDP '||MACKEYS||';') RESCAN SKIP;   /*@L2A*/ 81570000
*  %END FIND;                                                  /*@L2A*/ 81620000
