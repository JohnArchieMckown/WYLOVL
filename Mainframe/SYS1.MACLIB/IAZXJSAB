*%/*                                                                    00010000
         MACRO -- IAZXJSAB - MVS JSAB ACCESS MACRO                      00020000
&LABEL   IAZXJSAB &FUNC,           IAZXJSAB FUNCTION                   C00030000
               &TYPE=,             TYPE OF JSAB                        C00040000
               &ASCB=,             ADDRESS SPACE CONTROL BLOCK ADDRESS C00050000
               &COMPID=,           CREATING COMPONENT'S ID             C00060000
               &CODELEV=,          CREATING COMPONENT'S CODE LEVEL     C00070000
               &WORKID=,           WORK UNIT ID                        C00080000
               &JOBID=,            JOB ID                              C00090000
               &JOBNAME=,          JOB NAME                            C00100000
               &PREFIX=,           PREFIX USED IN MESSAGES             C00110000
               &USERID=,           USER ID                             C00120000
               &ENTRYST=,          PROGRAM ENTRY START TIME            C00130000
               &EXECST=,           PROGRAM EXECUTION START TIME        C00140000
               &USERPTR=,          USER AREA POINTER                   C00150000
               &XCFGPNM=,          XCF Group Name              @520LSDSC00152000
               &JESTAT=,           JES status for this ASCB    @OW17398C00153000
               &JSABLVL=,          Level of JSAB used for read @R05LOPIC00154000
               &CLEANUP=NO         End of memory clean up      @R05LOPI 00155000
.* **PROPRIETARY STATEMENT********************************************* 00155200
.*                                                                    * 00155600
.*   LICENSED MATERIALS-PROPERTY OF IBM                               * 00156000
.*   THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                      * 00156400
.*   5647-A01 (C) COPYRIGHT IBM CORP 1990, 2000                       * 00156800
.*                                                                    * 00157600
.*   STATUS:  HBB7703                                                 * 00158000
.*                                                                    * 00158400
.*01* EXTERNAL CLASSIFICATION:  GUPI                                  * 00158500
.*01* END OF EXTERNAL CLASSIFICATION:                                 * 00158600
.*                                                                    * 00158700
.* **END-OF-PROPRIETARY-STATEMENT************************************** 00158800
.********************************************************************** 00160000
.*                                                                    * 00170000
.* MODULE NAME = IAZXJSAB                                             * 00180000
.*                                                                    * 00190000
.*                                                                    * 00280000
.*  FUNCTION:                                                         * 00290000
.*                                                                    * 00300000
.*        IAZXJSAB PROVIDES AN INTERFACE TO THE JOB SCHEDULER         * 00310000
.*        ADDRESS SPACE CONTROL BLOCK.                                * 00320000
.*                                                                    * 00330000
.*        IAZXJSAB PROVIDES THE FOLLOWING SERVICES:                   * 00340000
.*                                                                    * 00350000
.*        1. CREATE A JSAB.                                           * 00360000
.*                                                                    * 00370000
.*        2. READ FROM A JSAB.                                        * 00380000
.*                                                                    * 00390000
.*        3. UPDATE A JSAB.                                           * 00400000
.*                                                                    * 00410000
.*        4. DELETE A JSAB.                                           * 00420000
.*                                                                    * 00430000
.*--------------------------------------------------------------------* 00440000
.*                                                                    * 00450000
.*  PARAMETERS:                                                       * 00460000
.*                                                                    * 00470000
.*        KEYWORD -                                                   * 00480000
.*                                                                    * 00490000
.*              DESCRIPTION   - DESCRIBES WHAT KEYWORD IS FOR         * 00500000
.*              TYPE          - INDICATES IF POSITIONAL, KEYWORD      * 00510000
.*                              OPTIONAL OR REQUIRED                  * 00520000
.*              FORM          - HOW KEYWORD IS CODED                  * 00530000
.*              DEFAULT       - IF MACRO TAKES ANY DEFAULT            * 00540000
.*                                                                    * 00550000
.*--------------------------------------------------------------------* 00560000
.*                                                                    * 00570000
.*        FUNC -                                                      * 00580000
.*                                                                    * 00590000
.*              DESCRIPTION - USED TO INDICATE WHAT TYPE OF SERVICE   * 00600000
.*                            IS REQUIRED.                            * 00610000
.*                                                                    * 00620000
.*              TYPE - POSITIONAL, REQUIRED                           * 00630000
.*                                                                    * 00640000
.*              FORM - CREATE, READ, UPDATE, DELETE                   * 00650000
.*                                                                    * 00660000
.*              DEFAULT - NONE                                        * 00670000
.*                                                                    * 00680000
.*--------------------------------------------------------------------* 00690000
.*                                                                    * 00700000
.*        TYPE -                                                      * 00710000
.*                                                                    * 00720000
.*              DESCRIPTION - THE TYPE OF JSAB TO BE CREATED OR       * 00730000
.*                            DELETED                                 * 00740000
.*                                                                    * 00750000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE AND DELETE        * 00760000
.*                              NOT VALID FOR READ AND UPDATE         * 00770000
.*                                                                    * 00780000
.*              FORM - ADDRSP OR SUBTASK                              * 00790000
.*                                                                    * 00800000
.*              DEFAULT - ADDRSP                                      * 00810000
.*                                                                    * 00820000
.*--------------------------------------------------------------------* 00830000
.*                                                                    * 00840000
.*        ASCB -                                                      * 00850000
.*                                                                    * 00860000
.*              DESCRIPTION - ADDRESS SPACE CONTROL BLOCK ADDRESS     * 00870000
.*                                                                    * 00880000
.*              TYPE - KEYWORD, OPTIONAL FOR READ AND DELETE          * 00890000
.*                              NOT VALID FOR CREATE AND UPDATE       * 00900000
.*                                                                    * 00910000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 00920000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 00930000
.*                                                                    * 00940000
.*                     E.G.  STORPTR  DS    A                         * 00950000
.*                                                                    * 00960000
.*                           ASCB=(4)                                 * 00970000
.*                           ASCB=STORPTR                             * 00980000
.*                                                                    * 00990000
.*              DEFAULT - HOME ADDRESS SPACE CONTROL BLOCKS USED      * 01000000
.*                                                                    * 01010000
.*--------------------------------------------------------------------* 01020000
.*                                                                    * 01030000
.*        COMPID -                                                    * 01040000
.*                                                                    * 01050000
.*              DESCRIPTION - SPECIFIES THE COMPONENT ID WHEN         * 01060000
.*                            CREATING THE JSAB                       * 01070000
.*                                                                    * 01080000
.*              TYPE - KEYWORD, REQUIRED FOR CREATE                   * 01090000
.*                              OPTIONAL FOR READ                     * 01100000
.*                              NOT VALID FOR UPDATE AND DELETE       * 01110000
.*                                                                    * 01120000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 01130000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 01140000
.*                                                                    * 01150000
.*                     E.G.  STORAGE  DS    CL4                       * 01160000
.*                                                                    * 01170000
.*                           COMPID=(4)                               * 01180000
.*                           COMPID=STORAGE                           * 01190000
.*                                                                    * 01200000
.*              DEFAULT - NONE                                        * 01210000
.*                                                                    * 01220000
.*--------------------------------------------------------------------* 01230000
.*                                                                    * 01240000
.*        CODELEV -                                                   * 01250000
.*                                                                    * 01260000
.*              DESCRIPTION - THE CODE LEVEL OF THE CREATING          * 01270000
.*                            COMPONENT (SHOULD BE SET TO THE         * 01280000
.*                            JSAB VERSION WHEN THE JSAB CREATION     * 01290000
.*                            CODE IS LAST UPDATED... SHOULD NOT      * 01300000
.*                            BE HARDCODED TO JSABVRSN HOWEVER)       * 01310000
.*                                                                    * 01320000
.*              TYPE - KEYWORD, REQUIRED FOR CREATE                   * 01330000
.*                              OPTIONAL FOR READ                     * 01340000
.*                              NOT VALID FOR UPDATE AND DELETE       * 01350000
.*                                                                    * 01360000
.*              FORM - SYMBOL           - ARITHMETIC SYMBOL           * 01370000
.*                                        (FOR CREATE)                * 01380000
.*                                                                    * 01390000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 01400000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 01410000
.*                                        (FOR READ)                  * 01420000
.*                                                                    * 01430000
.*                     E.G.  SYMBOL   EQU   1                         * 01440000
.*                           STORAGE  DS    XL1                       * 01450000
.*                                                                    * 01460000
.*                           CODELEV=SYMBOL   (CREATE)                * 01470000
.*                                                                    * 01480000
.*                           CODELEV=(4)      (READ)                  * 01490000
.*                           CODELEV=STORAGE  (READ)                  * 01500000
.*                                                                    * 01510000
.*              DEFAULT - NONE                                        * 01520000
.*                                                                    * 01530000
.*--------------------------------------------------------------------* 01540000
.*                                                                    * 01550000
.*        WORKID -                                                    * 01560000
.*                                                                    * 01570000
.*              DESCRIPTION - WORK UNIT ID                            * 01580000
.*                                                                    * 01590000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 01600000
.*                              NOT VALID FOR DELETE                  * 01610000
.*                                                                    * 01620000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 01630000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 01640000
.*                                                                    * 01650000
.*                     E.G.  STORAGE  DS    CL8                       * 01660000
.*                                                                    * 01670000
.*                           WORKID=(4)                               * 01680000
.*                           WORKID=STORAGE                           * 01690000
.*                                                                    * 01700000
.*              DEFAULT - NONE                                        * 01710000
.*                                                                    * 01720000
.*--------------------------------------------------------------------* 01730000
.*                                                                    * 01740000
.*        JOBID -                                                     * 01750000
.*                                                                    * 01760000
.*              DESCRIPTION - JOB ID                                  * 01770000
.*                                                                    * 01780000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 01790000
.*                              NOT VALID FOR DELETE                  * 01800000
.*                                                                    * 01810000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 01820000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 01830000
.*                                                                    * 01840000
.*                     E.G.  STORAGE  DS    CL8                       * 01850000
.*                                                                    * 01860000
.*                           JOBID=(4)                                * 01870000
.*                           JOBID=STORAGE                            * 01880000
.*                                                                    * 01890000
.*              DEFAULT - NONE                                        * 01900000
.*                                                                    * 01910000
.*--------------------------------------------------------------------* 01920000
.*                                                                    * 01930000
.*        JOBNAME -                                                   * 01940000
.*                                                                    * 01950000
.*              DESCRIPTION - JOB NAME                                * 01960000
.*                                                                    * 01970000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 01980000
.*                              NOT VALID FOR DELETE                  * 01990000
.*                                                                    * 02000000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 02010000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 02020000
.*                                                                    * 02030000
.*                     E.G.  STORAGE  DS    CL8                       * 02040000
.*                                                                    * 02050000
.*                           JOBNAME=(4)                              * 02060000
.*                           JOBNAME=STORAGE                          * 02070000
.*                                                                    * 02080000
.*              DEFAULT - NONE                                        * 02090000
.*                                                                    * 02100000
.*--------------------------------------------------------------------* 02110000
.*                                                                    * 02120000
.*        PREFIX -                                                    * 02130000
.*                                                                    * 02140000
.*              DESCRIPTION - PREFIX USED IN MESSAGES                 * 02150000
.*                             JES2 -> EQUAL TO JOBID                 * 02160000
.*                             JES3 -> EQUAL TO JOBNAME               * 02170000
.*                             DISPLAYED ON CONSOLE WHEN MFORM=(J)    * 02180000
.*                                                                    * 02190000
.*                                                                    * 02200000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 02210000
.*                              NOT VALID FOR DELETE                  * 02220000
.*                                                                    * 02230000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 02240000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 02250000
.*                                                                    * 02260000
.*                     E.G.  STORAGE  DS    CL8                       * 02270000
.*                                                                    * 02280000
.*                           PREFIX=(4)                               * 02290000
.*                           PREFIX=STORAGE                           * 02300000
.*                                                                    * 02310000
.*              DEFAULT - NONE                                        * 02320000
.*                                                                    * 02330000
.*--------------------------------------------------------------------* 02340000
.*                                                                    * 02350000
.*        USERID -                                                    * 02360000
.*                                                                    * 02370000
.*              DESCRIPTION - USER ID                                 * 02380000
.*                                                                    * 02390000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 02400000
.*                              NOT VALID FOR DELETE                  * 02410000
.*                                                                    * 02420000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 02430000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 02440000
.*                                                                    * 02450000
.*                     E.G.  STORAGE  DS    CL8                       * 02460000
.*                                                                    * 02470000
.*                           USERID=(4)                               * 02480000
.*                           USERID=STORAGE                           * 02490000
.*                                                                    * 02500000
.*              DEFAULT - NONE                                        * 02510000
.*                                                                    * 02520000
.*--------------------------------------------------------------------* 02530000
.*                                                                    * 02540000
.*        ENTRYST -                                                   * 02550000
.*                                                                    * 02560000
.*              DESCRIPTION - PROGRAM ENTRY START TIME                * 02570000
.*                                                                    * 02580000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 02590000
.*                              NOT VALID FOR DELETE                  * 02600000
.*                                                                    * 02610000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 02620000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 02630000
.*                                                                    * 02640000
.*                     E.G.  STORAGE  DS    D                         * 02650000
.*                                                                    * 02660000
.*                           ENTRYST=(4)                              * 02670000
.*                           ENTRYST=STORAGE                          * 02680000
.*                                                                    * 02690000
.*              DEFAULT - NONE                                        * 02700000
.*                                                                    * 02710000
.*--------------------------------------------------------------------* 02720000
.*                                                                    * 02730000
.*        EXECST -                                                    * 02740000
.*                                                                    * 02750000
.*              DESCRIPTION - PROGRAM EXECUTION START TIME            * 02760000
.*                                                                    * 02770000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 02780000
.*                              NOT VALID FOR DELETE                  * 02790000
.*                                                                    * 02800000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 02810000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 02820000
.*                                                                    * 02830000
.*                     E.G.  STORAGE  DS    D                         * 02840000
.*                                                                    * 02850000
.*                           EXECST=(4)                               * 02860000
.*                           EXECST=STORAGE                           * 02870000
.*                                                                    * 02880000
.*              DEFAULT - NONE                                        * 02890000
.*                                                                    * 02900000
.*--------------------------------------------------------------------* 02910000
.*                                                                    * 02920000
.*        USERPTR -                                                   * 02930000
.*                                                                    * 02940000
.*              DESCRIPTION - USER AREA POINTER                       * 02950000
.*                                                                    * 02960000
.*              TYPE - KEYWORD, OPTIONAL FOR CREATE, READ, AND UPDATE * 02970000
.*                              NOT VALID FOR DELETE                  * 02980000
.*                                                                    * 02990000
.*              FORM - REGISTER         - ADDRESS IN REGISTER         * 03000000
.*                     STORAGE LOCATION - NAME OF STORAGE FIELD       * 03010000
.*                                                                    * 03020000
.*                     E.G.  STORPTR  DS    A                         * 03030000
.*                                                                    * 03040000
.*                           STORPTR=(4)                              * 03050000
.*                           USERPTR=STORPTR                          * 03060000
.*                                                                    * 03070000
.*              DEFAULT - NONE                                        * 03080000
.*                                                                    * 03090000
.*--------------------------------------------------------------------* 03090600
.*                                                                    * 03091200
.*        CLEANUP -                                                   * 03091800
.*                                                                    * 03092400
.*              DESCRIPTION - END OF MEMORY DELETE INDICATOR          * 03093000
.*                            Use of this keyword is limited to       * 03093600
.*                             the initiator (IEFIRECM)               * 03094200
.*                                                                    * 03094800
.*              TYPE - KEYWORD, OPTIONAL FOR DELETE                   * 03095400
.*                              NOT VALID FOR CREATE, READ, UPDATE    * 03095600
.*                                                                    * 03095800
.*              FORM - YES OR NO                                      * 03096000
.*                                                                    * 03096200
.*              DEFAULT - NO                                          * 03096400
.*                                                                    * 03096600
.*------------------------------------------------------------ @520LSDS 03096800
.*                                                             @520LSDS 03097000
.*        XCFGPNM -                                            @520LSDS 03097200
.*                                                             @520LSDS 03097400
.*              DESCRIPTION - XCF Group Name for the JESplex   @520LSDS 03097600
.*                                                             @520LSDS 03097800
.*              TYPE - KEYWORD, Optional for CREATE, READ,     @520LSDS 03098000
.*                           and UPDATE. Not valid for DELETE  @520LSDS 03098200
.*                                                             @520LSDS 03098400
.*              FORM - REGISTER         - Address in register  @520LSDS 03098600
.*                     STORAGE LOCATION - Name of storage fld  @520LSDS 03098800
.*                                                             @520LSDS 03099000
.*                     E.G.  STORAGE  DS    CL8                @520LSDS 03099200
.*                                                             @520LSDS 03099400
.*                           XCFGPNM=(4)                       @520LSDS 03099600
.*                           XCFGPNM=STORAGE                   @520LSDS 03099800
.*                                                             @520LSDS 03100000
.*              DEFAULT - NONE                                 @520LSDS 03100200
.*                                                             @520LSDS 03100400
.*--------------------------------------------------------------------* 03100600
.*                                                             @OW17398 03100800
.*        JESTAT -                                             @OW17398 03101000
.*                                                             @OW17398 03101200
.*              DESCRIPTION - JES status for this address      @OW17398 03101600
.*                            space                            @OW17398 03101800
.*                                                             @OW17398 03102000
.*              TYPE - KEYWORD, Optional for CREATE, READ,     @OW17398 03102200
.*                           and UPDATE.  Not valid for DELETE @OW17398 03102400
.*                                                             @OW17398 03102600
.*              FORM - REGISTER         - Address in register  @OW17398 03102800
.*                     STORAGE LOCATION - Name of storage fld  @OW17398 03103000
.*                     *REGISTER        - Address of status    @R10LMSD 03103050
.*                                        field returned       @R10LMSD 03103100
.*                                        (UPDATE only)        @R10LMSD 03103150
.*                                                             @OW17398 03103200
.*                     E.G.  STORAGE  DS    XL8                @OW17398 03103400
.*                                                             @OW17398 03103600
.*                           JESTAT=(4)                        @OW17398 03103800
.*                           JESTAT=STORAGE                    @OW17398 03104000
.*                           JESTAT=*3                         @R10LMSD 03104200
.*                                                             @R10LMSD 03104300
.*              DEFAULT - NONE                                 @OW17398 03104400
.*                                                             @OW17398 03104600
.*------------------------------------------------------------ @OW17398 03104800
.*                                                             @R05LOPI 03105000
.*        JSABLVL -                                            @R05LOPI 03105200
.*                                                             @R05LOPI 03105400
.*              Description - Return level of JSAB used for    @R05LOPI 03105600
.*                            READ request.                    @R05LOPI 03105800
.*                            0 = Address space level JSAB     @R05LOPI 03106000
.*                            4 = Subtask level JSAB           @R05LOPI 03106200
.*                                                             @R05LOPI 03106400
.*              TYPE - KEYWORD, Optional for READ only.        @R05LOPI 03106600
.*                            Not valid for CREATE, UPDATE, or @R05LOPI 03106800
.*                            DELETE.                          @R05LOPI 03107000
.*                                                             @R05LOPI 03107200
.*              FORM - REGISTER         - Address in register  @R05LOPI 03107400
.*                                        (R0, R2-R14 only)    @R05LOPI 03107600
.*                     STORAGE LOCATION - Name of 1 byte       @R05LOPI 03107800
.*                                        storage field        @R05LOPI 03108000
.*                                                             @R05LOPI 03108200
.*                     E.G.  STORAGE  DS    XL1                @R05LOPI 03108400
.*                                                             @R05LOPI 03108600
.*                           JSABLVL=(4)                       @R05LOPI 03108800
.*                           JSABLVL=STORAGE                   @R05LOPI 03109000
.*                                                             @R05LOPI 03109200
.*              DEFAULT - NONE                                 @R05LOPI 03109400
.*                                                             @R05LOPI 03109600
.*------------------------------------------------------------ @R05LOPI 03109800
.*                                                                    * 03110000
.*  PARAMETER INTERDEPENDENCIES:                                      * 03120000
.*                                                                    * 03130000
.*        THE JOBID AND PREFIX SHOULD BE THE SAME FOR JES2.           * 03140000
.*                                                                    * 03150000
.*        THE JOBNAME AND PREFIX SHOULD BE THE SAME FOR JES3.         * 03160000
.*                                                                    * 03170000
.*        ASCB SHOULD NOT BE SPECIFIED WITH TYPE=SUBTASK.             * 03180000
.*                                                                    * 03190000
.*        JOBID AND WORKID MAP TO THE SAME AREA IN THE JSAB.          * 03200000
.*                                                                    * 03210000
.********************************************************************** 03220000
.*                                                                    * 03230000
.*  EXAMPLES:                                                         * 03240000
.*                                                                    * 03250000
.*        1. IAZXJSAB CREATE,TYPE=ADDRSP,COMPID=JES2,CODELEV=1,       * 03260000
.*                    JOBID=STOR2,PREFIX=STOR2,                @520LSDS 03270000
.*                    XCFGPNM=$XCFGPNM                         @520LSDS 03275000
.*                                                                    * 03280000
.*           TYPE=    THE TYPE OF JSAB TO CREATE IS SPECIFIED  @520LSDS 03290000
.*                    AS AN ADDRESS SPACE LEVEL TYPE.          @520LSDS 03300000
.*           COMPID=  THE COMPONENT ID OF THE JOB SCHEDULER    @520LSDS 03310000
.*                    IS SET AS JES2.                          @520LSDS 03320000
.*           CODELEV= THE COMPONENT'S CODE LEVEL (THE JSAB     @520LSDS 03330000
.*                    VERSION THE LAST TIME THE JSAB-CREATING  @520LSDS 03340000
.*                    CODE WAS UPDATED)                        @520LSDS 03350000
.*           JOBID=   THE JOB ID IS SET FROM STOR2.            @520LSDS 03360000
.*           PREFIX=  THE PREFIX IS SET FROM STOR2.            @520LSDS 03370000
.*           XCFGPNM= The XCF group name is set from the       @520LSDS 03372000
.*                    $XCFGPNM field.                          @520LSDS 03375000
.*                                                                    * 03380000
.*                                                                    * 03390000
.*        2. IAZXJSAB READ,ENTRYST=TDOUBLE1,EXECST=TDOUBLE2,   @OW17398 03400000
.*                    JESTAT=RMFDATA                           @OW17398 03410000
.*                                                             @OW17398 03415000
.*           ENTRYST=- THE ENTRY START TIME IS PLACED IN TDOUBLE1.    * 03420000
.*           EXECST= - THE EXECUTION START TIME IS PLACED IN          * 03430000
.*                     TDOUBLE2.                                      * 03440000
.*           JESTAT= - The set of JES status indicators are    @OW17398 03450000
.*                     placed in the 8 bytes called RMFDATA.   @OW17398 03455000
.*                                                                    * 03460000
.*        3. LA    4,STOR3                                            * 03470000
.*           IAZXJSAB UPDATE,USERID=(4)                               * 03480000
.*                                                                    * 03490000
.*           USERID= - THE USER ID IS SET FROM THE AREA POINTED       * 03500000
.*                     TO BY REGISTER 4 (IN THIS CASE, STOR3).        * 03510000
.*                                                                    * 03520000
.*                                                                    * 03530000
.*        4. IAZXJSAB DELETE,TYPE=ADDRSP,ASCB=(4)                     * 03540000
.*                                                                    * 03550000
.*           ASCB=   - THE JSAB IS DELETED FROM THE ADDRESS SPACE     * 03560000
.*                     LEVEL JSAB CHAIN SPECIFIED BY THE ASCB         * 03570000
.*                     ADDRESS IN REGISTER 4.                         * 03580000
.*                                                                    * 03590000
.*                                                                    * 03600000
.********************************************************************** 03610000
.*                                                                    * 03620000
.*  ENVIRONMENT:                                                      * 03630000
.*                                                                    * 03640000
.*        31 BIT ADDRESSING MODE.                                     * 03650000
.*                                                                    * 03660000
.*  AR CONSIDERATIONS:                                                * 03670000
.*                                                                    * 03680000
.*        This macro does support AR ASC mode invocations.            * 03690000
.*                                                                    * 03700000
.*  SERIALIZATION CONCERNS:                                           * 03710000
.*                                                                    * 03720000
.*        Serialization is implied since the JSAB remains             * 03730000
.*        available until initiator end-of-memory.  The JSAB          * 03732000
.*        is not physically deleted until after the CSCB is           * 03734000
.*        no longer available.                                        * 03736000
.*                                                                    * 03740000
.*  SRB CONSIDERATIONS:                                               * 03750000
.*                                                                    * 03760000
.*        USE OF THE IAZXJSAB MACRO IS PROVIDED FOR ADDRESS SPACE     * 03770000
.*        LEVEL JSABS ONLY IN SRB MODE.  FOR READ AND UPDATE,         * 03780000
.*        THE ADDRESS SPACE LEVEL JSAB IS USED.  IF THERE IS          * 03790000
.*        NO ADDRESS SPACE LEVEL JSAB, THE JSAB NOT FOUND RETURN      * 03800000
.*        CODE IS RETURNED.  FOR CREATE AND DELETE, TYPE=SUBTASK      * 03810000
.*        CAUSES UNPREDICTABLE RESULTS.                               * 03820000
.*                                                                    * 03830000
.********************************************************************** 03840000
.*                                                                    * 03850000
.*  REGISTER USAGE (ENTRY/EXIT):                                      * 03860000
.*                                                                    * 03870000
.*     REG       VALUE ON ENTRY         VALUE ON EXIT                 * 03880000
.*                                                                    * 03890000
.*     0         N/A                    DESTROYED BY STORAGE MACRO    * 03900000
.*                                       (CREATE AND DELETE ONLY)     * 03910000
.*     1         N/A                    DESTROYED              @OW17398 03920000
.*     2         N/A                    Destroyed by MODESET   @OW17398 03922000
.*                                       macro (CREATE,        @OW17398 03924000
.*                                       UPDATE and DELETE     @OW17398 03926000
.*                                       only)                 @OW17398 03928000
.*     3-13      N/A                    UNCHANGED unless a     @R10LMSD 03930000
.*                                        register is selected @R10LMSD 03932000
.*                                        by JESTAT=*r where r @R10LMSD 03934000
.*                                        represents a reg no. @R10LMSD 03936000
.*     14        N/A                    DESTROYED BY STORAGE MACRO    * 03940000
.*                                       (CREATE AND DELETE ONLY)     * 03950000
.*                                       AND BY LOOKING FOR JSAB      * 03951000
.*                                       (ALL FUNCTIONS)              * 03954000
.*     15        N/A                    RETURN CODE                   * 03960000
.*                                                                    * 03970000
.*  RETURN CODES (15 ON EXIT):                                        * 03980000
.*                                                                    * 03990000
.*         0 - PROCESSING SUCCESSFUL (NO ERRORS)                      * 04000000
.*         4 - STORAGE WAS NOT OBTAINED OR RELEASED FOR THE JSAB      * 04010000
.*             (CREATE AND DELETE ONLY)                               * 04020000
.*         8 - JSAB NOT FOUND                                         * 04030000
.*             (READ, UPDATE, AND DELETE ONLY)                        * 04040000
.*                                                                    * 04050000
.*  RESTRICTIONS:                                                     * 04052000
.*                                                                    * 04054000
.*         Access to the JSAB can only occur while a CSCB exists.     * 04056000
.*                                                                    * 04058000
.*  OTHER CONSIDERATIONS:                                             * 04060000
.*                                                                    * 04070000
.*         OTHER MVS DSECTS THAT ARE NECESSARY FOR THE OPERATION      * 04080000
.*         OF THIS MACRO ARE:  IAZJSAB, IHAASCB, IHAASSB, IHAPSA,     * 04090000
.*         IHASTCB, AND IKJTCB.                                       * 04100000
.*                                                                    * 04110000
.*         FOR A DESCRIPTION OF THE SUBPOOLS USED FOR EACH TYPE       * 04120000
.*         OF JSAB, SEE THE IAZJSAB MACRO.                            * 04130000
.*                                                                    * 04140000
.*         THE STORAGE MACRO IS USED FOR JSAB CREATE AND DELETE.      * 04150000
.*                                                                    * 04160000
.*         THE MODESET MACRO IS USED TO CHANGE TO KEY 0 TO ACCESS     * 04170000
.*         THE JSAB FOR CREATE, UPDATE, AND DELETE.                   * 04180000
.*                                                                    * 04190000
.********************************************************************** 04200000
.*                                                                    * 04210000
.*  CHANGE ACTIVITY:                                                  * 04220000
.*                                                                    * 04230000
.*         MVS/SP RELEASE 4 LEVEL 1 (SP4.1.0, HBB4410)                * 04240000
.*                                                                    * 04242000
.*  $410D001=DCRR   HBB4410 890509 R_W:  JSAB CHANGES                 * 04245000
.*                                                                    * 04250000
.*  $420P493=PTM    HBB4420 900914 R_W:  3 or more JSABs on chain     * 04252000
.*                                                                    * 04252500
.*  $520LSDS=SDSFIV   HBB5520 940520 W_C1: SDSF SYSPLEX Wide DA       * 04253000
.*  $VC1PB36=PTM      HJE6603 951109 VLC:  BCP Ext.Classifications    * 04253100
.*  $VC1P036=PTM      HJE6603 951208 VLC:  BCP PR20036 Ext.Class      * 04253400
.*                                                                    * 04253600
.* $R05LOPI=OPI      HJE6605 970526 JMS:  OPI DYNALLOC support        * 04253800
.* $R05P424=OPI      HJE6605 970911 TJW:  Task level read error       * 04253900
.*                                                                    * 04253910
.* $R10LMSD=MSDUMP   HJE7703 991206 E_S7: Multi System Dump           * 04253940
.* $R10LMSD=SPLALLOC HJE7703 991217 E_S7: Multi System Dump           * 04253970
.* $R10LFP0=WLM      HJE7703 000128 TJW:  Enable FLAG(PAGE0)          * 04253980
.*                                                                    * 04254000
.*  A000000-999999  Created for 4.1.0                          @410LJSB 04256000
.********************************************************************** 04260000
.*                                                                      04280000
.*--------------------------------------------------------------------* 04290000
.*       LOCAL VARIABLES                                              * 04300000
.*--------------------------------------------------------------------* 04310000
.*                                                                      04320000
         GBLC  &SYSASCE                 System State           @410D001 04325000
         LCLA  &RET                                                     04330000
         LCLC  &ASCBREG                                                 04340000
         LCLC  &LAB1,&LAB2,&LAB3,&LAB4,&LAB5,&LAB6,&LAB7,&LAB8,&LAB9   C04350000
               &LAB10,&LAB11,&LAB12                            @410D001 04355000
&RET     SETA  0                   1 - READ, 2 - UPDATE                 04360000
&LAB1    SETC  'JSB1'.'&SYSNDX'(1,4)  SET LABEL FOR ERRORS              04370000
&LAB2    SETC  'JSB2'.'&SYSNDX'(1,4)  SET LABEL FOR STORAGE SUCCESS     04380000
&LAB3    SETC  'JSB3'.'&SYSNDX'(1,4)  SET LABEL FOR DELETE CODE         04390000
&LAB4    SETC  'JSB4'.'&SYSNDX'(1,4)  SET LABEL FOR DELETE CODE         04400000
&LAB5    SETC  'JSB5'.'&SYSNDX'(1,4)  SET LABEL FOR DELETE CODE         04410000
&LAB6    SETC  'JSB6'.'&SYSNDX'(1,4)  SET LABEL FOR FIND JSAB CODE      04420000
&LAB7    SETC  'JSB7'.'&SYSNDX'(1,4)  SET LABEL FOR FIND JSAB CODE      04430000
&LAB8    SETC  'JSB8'.'&SYSNDX'(1,4)  Label, JSAB not found    @410D001 04431000
&LAB9    SETC  'JSB9'.'&SYSNDX'(1,4)  Label, use/reuse JSAB    @410D001 04432000
&LAB10   SETC  'JSBA'.'&SYSNDX'(1,4)  Label, reuse clear       @410D001 04433000
&LAB11   SETC  'JSBB'.'&SYSNDX'(1,4)  Label, reuse skip chain  @410D001 04434000
&LAB12   SETC  'JSBC'.'&SYSNDX'(1,4)  Label, reuse skip clear  @410D001 04435000
&LAB13   SETC  'JSBD'.'&SYSNDX'(1,4)  Label, reuse skip clear  @420P493 04436000
.*                                                             @R05LOPI 04436100
.*-----------------------------------------------------------* @R05LOPI 04436200
.*       Process JSABLVL= keyword                            * @R05LOPI 04436300
.*-----------------------------------------------------------* @R05LOPI 04436400
.*                                                             @R05LOPI 04436500
         LCLC  &JLVC,&JLVO                                     @R05LOPI 04436600
.*                                                             @R05LOPI 04436700
&JLVC    SETC  ''                  Clear opcode and            @R05LOPI 04436800
&JLVO    SETC  ''                    operand to set JSABLVL    @R05LOPI 04436900
         AIF   ('&JSABLVL' EQ '').JSBNLVL,                     @R05LOPIC04437000
               ('&FUNC' NE 'READ').JSBELVL                     @R05LOPI 04437100
&JLVC    SETC  'LA'                Assume that JSABLVL         @R05LOPI 04437200
&JLVO    SETC  '&JSABLVL(1)'         specifies a register      @R05LOPI 04437300
         AIF   ('&JSABLVL'(1,1) NE '(').JSBMLVL                @R05LOPI 04437400
         AIF   ('&JSABLVL(1)'(1,1) NE '(').JSBNLVL             @R05LOPI 04437500
.JSBMLVL ANOP                                                  @R05LOPI 04437600
&JLVC    SETC  'MVI'               Indicate that JSABLVL       @R05LOPI 04437700
&JLVO    SETC  '&JSABLVL'            must be a field           @R05LOPI 04437800
         AGO   .JSBNLVL                                        @R05LOPI 04437900
.JSBELVL MNOTE 8,'IAZXJSAB -- JSABLVL= IS NOT VALID ON &FUNC'  @R05LOPI 04438000
.JSBNLVL ANOP                                                  @R05LOPI 04438100
.*                                                                      04440000
.*--------------------------------------------------------------------* 04450000
.*       SET LABEL IF NECESSARY AND PROCESS FUNCTION.                 * 04460000
.*--------------------------------------------------------------------* 04470000
.*                                                                      04480000
         AIF   ('&LABEL' EQ '').JSBNOL                                  04490000
&LABEL   DS    0H                                                       04500000
.JSBNOL  ANOP                                                           04510000
         SPACE 1                                                        04520000
         USING JSAB,1              SET ADDRESSABILITY TO JSAB           04530000
&UPLA    SETC  'LA'                Assume Primary environ      @R10LMSD 04530500
         SYSSTATE TEST                                         @OW17398 04531000
         AIF   ('&SYSASCE' EQ 'P').NOTAR1   SYSSTATE PRIMARY?  @410D001 04532000
&UPLA    SETC  'LAE'               For AR environ, use LAE     @R10LMSD 04532500
         LAE   1,0                 Ensure Access Registers     @OW17398 04533000
         CPYA  14,1                 used by this macro         @OW17398 04534000
         CPYA  15,1                  are cleared               @OW17398 04535000
.NOTAR1  ANOP                                                  @410D001 04537000
         SPACE 1                                                        04540000
         LA    15,JSABOK           SET RETURN CODE TO OK INITIALLY      04550000
         SPACE 1                                                        04560000
.*                                                                      04570000
         AIF   ('&FUNC' EQ '').JSBNOF,                                 C04580000
               ('&FUNC' EQ 'CREATE').JSBCR,                            C04590000
               ('&FUNC' EQ 'READ').JSBRD,                              C04600000
               ('&FUNC' EQ 'UPDATE').JSBUP,                            C04610000
               ('&FUNC' EQ 'DELETE').JSBDL                              04620000
         MNOTE 8,'IAZXJSAB -- INCORRECT FUNCTION SPECIFIED'             04630000
         AGO   .JSBMERG                                                 04640000
.JSBNOF  ANOP                                                           04650000
         MNOTE 8,'IAZXJSAB -- FUNCTION IS A REQUIRED PARAMETER'         04660000
.*                                                                      04670000
.*--------------------------------------------------------------------* 04680000
.*       END OF THE MACRO.                                            * 04690000
.*--------------------------------------------------------------------* 04700000
.*                                                                      04710000
.JSBMERG ANOP                      RETURN POINT FROM FUNCTIONS          04720000
.*                                                                      04730000
         SPACE 1                                                        04740000
         DROP  1                   DROP JSAB ADDRESSABILITY             04750000
         SPACE 1                                                        04760000
&LAB1    DS    0H                  ERROR LABEL                          04770000
         MEXIT                                                          04780000
.*                                                                      04790000
.********************************************************************** 04800000
.*       CREATE                                                       * 04810000
.********************************************************************** 04820000
.*                                                                      04830000
.JSBCR   ANOP                                                           04840000
* CAUTION: R2 WILL BE DESTROYED BY THE MODESET MACRO.          @OW17398 04842000
         SPACE 1                                               @OW17398 04845000
         AIF   ('&ASCB' EQ '').JSBCNAS  ASCB SPECIFIED?                 04850000
         MNOTE 4,'IAZXJSAB -- ASCB IS NOT VALID ON CREATE'              04860000
.JSBCNAS ANOP                                                           04870000
         AIF   ('&CLEANUP' NE 'YES').JSBXNCL  CLEANUP?         @410D001 04872000
         MNOTE 4,'IAZXJSAB -- CLEANUP IS NOT VALID ON CREATE'  @410D001 04874000
.JSBXNCL ANOP                                                  @410D001 04876000
         AIF   ('&TYPE' EQ '').JSBCADD         TYPE NOT SPECIFIED?      04880000
         AIF   ('&TYPE' EQ 'ADDRSP').JSBCADD   TYPE = ADDR SPACE?       04890000
         AIF   ('&TYPE' NE 'SUBTASK').JSBCNSB  TYPE = SUBTASK?          04900000
         L     14,PSATOLD-PSA(,0)       Get TCB address        @410D001 04900500
         L     14,TCBSTCB-TCB(14,0)     Get STCB address       @410D001 04901400
         ICM   1,B'1111',STCBJSAB-STCB(14) First JSAB address  @410D001 04902300
         JZ    &LAB8                    None available, get a new JSAB C04903200
                                                               @410D001 04904100
         SPACE 1                                               @410D001 04905000
         TM    JSABFLG1,JSABNVAL        Marked not valid?      @410D001 04905900
         JO    &LAB2                    Yes, reuse this JSAB   @410D001 04906800
         SPACE 1                                               @410D001 04907700
&LAB8    DS    0H                                              @410D001 04908600
*        STORAGE OBTAIN,LENGTH=JSABSIZE,ADDR=(1),SP=253,                04910000
*              LOC=ANY,COND=YES,RTCD=(15)                               04920000
.*                                                                      04930000
         STORAGE OBTAIN,LENGTH=JSABSIZE,ADDR=(1),SP=253,               C04940000
               LOC=ANY,COND=YES,RTCD=(15)                               04950000
         AGO   .JSBCRC             GO TEST THE RETURN CODE              04960000
.*                                                                      04970000
.JSBCNSB ANOP                                                           04980000
         MNOTE 8,'IAZXJSAB -- INCORRECT TYPE SPECIFIED'                 04990000
.JSBCADD ANOP                      ADDRESS SPACE LEVEL JSAB             05000000
         L     14,PSAAOLD-PSA(,0)       Get ASCB address       @410D001 05001000
         L     14,ASCBASSB-ASCB(14,0)   Get ASSB address       @410D001 05002000
         ICM   1,B'1111',ASSBJSAB-ASSB(14) First JSAB address  @410D001 05003000
         JZ    &LAB8                    None available, get a new JSAB  05004000
         SPACE 1                                               @410D001 05005000
         TM    JSABFLG1,JSABNVAL        Marked not valid?      @410D001 05006000
         JO    &LAB2                    Yes, reuse this JSAB   @410D001 05007000
         SPACE 1                                               @410D001 05008000
&LAB8    DS    0H                                              @410D001 05009000
*        STORAGE OBTAIN,LENGTH=JSABSIZE,ADDR=(1),SP=245,                05010000
*              LOC=ANY,COND=YES,RTCD=(15)                               05020000
.*                                                                      05030000
         STORAGE OBTAIN,LENGTH=JSABSIZE,ADDR=(1),SP=245,               C05040000
               LOC=ANY,COND=YES,RTCD=(15)                               05050000
.JSBCRC  ANOP                                                           05060000
         SPACE 1                                                        05070000
&LAB9    DS    0H                                              @410D001 05075000
         LTR   15,15               WAS STORAGE OBTAIN SUCCESSFUL?       05080000
         JZ    &LAB10              Yes, go initialize JSAB     @410D001 05090000
         SPACE 1                                                        05100000
         LA    15,JSABNOST         INDICATE NO STORAGE AVAILABLE        05110000
         J     &LAB1               GO TO ERROR LABEL                    05120000
         SPACE 1                                               @410D001 05130000
&LAB10   DS    0H                                              @410D001 05131000
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  Change to key zero   @410D001 05132000
.*                                                             @410D001 05133000
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  Change to key zero   @410D001 05134000
         SPACE 1                                               @410D001 05135000
*********************************************************************** 05135100
*                                                                     * 05135200
*        SET ENTIRE JSAB STORAGE TO ZEROES AND THEN INITIALIZE.       * 05135300
*                                                                     * 05135400
*********************************************************************** 05135500
         SPACE 1                                                        05135600
         XC    JSAB(JSABSIZE),JSAB  Clear JSAB storage         @410D001 05136000
         SPACE 1                                               @410D001 05137000
         J     &LAB12               Continue initializing JSAB @410D001 05138000
         SPACE 1                                               @410D001 05139000
&LAB2    DS    0H                                                       05200000
.*                                                             @420P493 05200200
.*-----------------------------------------------------------* @420P493 05200800
.*       A reusable JSAB has been found.  Determine if there * @420P493 05201400
.*       are any more.                                       * @420P493 05202000
.*-----------------------------------------------------------* @420P493 05202600
.*                                                             @420P493 05203200
         ICM   14,B'1111',JSABNEXT      Any more in chain?     @420P493 05203800
         JZ    &LAB13                   No, reuse this one     @420P493 05204400
         SPACE 1                                               @420P493 05205000
         TM    JSABFLG1-JSAB(14),JSABNVAL  Is next reusable?   @420P493 05205600
         JNO   &LAB13                   No, reuse this one     @420P493 05206200
         SPACE 1                                               @420P493 05206800
         LR    1,14                     Set next as current    @420P493 05207400
         J     &LAB2                    Look for any more      @420P493 05208000
         SPACE 1                                                        05210000
&LAB13   DS    0H                                              @420P493 05215000
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            05220000
.*                                                                      05230000
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            05240000
         SPACE 1                                                        05250000
         XC    JSABCLR(JSABCLRL),JSABCLR  Clear re-use area    @410D001 05260000
         SPACE 1                                               @410D001 05262000
&LAB12   DS    0H                                              @410D001 05265000
         MVI   JSABBLST,C' '        SET FIRST CHARACTER TO BLANK        05270000
         MVC   JSABBLST+1(JSABBLSZ-1),JSABBLST  AND PROPOGATE IT        05280000
         SPACE 1                                                        05290000
.*                                                                      05300000
.*--------------------------------------------------------------------* 05310000
.*       INITIALIZE THE EYE-CATCHER AND CONTROL BLOCK VERSION.        * 05320000
.*--------------------------------------------------------------------* 05330000
.*                                                                      05340000
         MVC   JSABID,=CL4'JSAB'        SET EYE-CATCHER                 05350000
         MVC   JSABLEN,=A(JSABSIZE)     Control block length   @410D001 05355000
         MVI   JSABVERS,JSABVRSN        Control block version  @410D001 05360000
.*                                                                      05370000
.*--------------------------------------------------------------------* 05380000
.*       CHECK FOR THE REQUIRED PARAMETER CODELEV.  IF IT IS SPECI-   * 05390000
.*       FIED, SET THE CODE LEVEL IN THE JSAB.  IF NOT, ISSUE AN      * 05400000
.*       MNOTE.                                                       * 05410000
.*--------------------------------------------------------------------* 05420000
.*                                                                      05430000
         AIF   ('&CODELEV' EQ '').JSBCNCL  CODE LEVEL SPECIFIED?        05440000
         MVI   JSABCLEV,&CODELEV        Set code level         @410D001 05460000
         AGO   .JSBCCID                 GO CHECK COMPONENT ID           05470000
.JSBCNCL ANOP                                                           05480000
         MNOTE 8,'IAZXJSAB -- CODELEV IS A REQUIRED PARAMETER FOR CREATC05490000
               E'                                                       05500000
.*                                                                      05510000
.*--------------------------------------------------------------------* 05520000
.*       CHECK FOR THE REQUIRED PARAMETER COMPID.  IF IT IS SPECI-    * 05530000
.*       FIED SET THE COMPONENT ID IN THE JSAB.  IF NOT, ISSUE        * 05540000
.*       AN MNOTE.                                                    * 05550000
.*--------------------------------------------------------------------* 05560000
.*                                                                      05570000
.JSBCCID ANOP                                                           05580000
         AIF   ('&COMPID' EQ '').JSBCNCI  COMPONENT SPECIFIED?          05590000
         AIF   ('&COMPID'(1,1) NE '(').JSBCSCI  REGISTER FORMAT?        05600000
         MVC   JSABSCID,0(&COMPID(1))   SET SCHEDULING COMPONENT ID     05610000
         AGO   .JSBCWID                 GO CHECK WORK ID                05620000
.JSBCSCI ANOP                                                           05630000
         MVC   JSABSCID,&COMPID         SET SCHEDULING COMPONENT ID     05640000
         AGO   .JSBCWID                 GO CHECK WORK ID                05650000
.JSBCNCI ANOP                                                           05660000
         MNOTE 8,'IAZXJSAB -- COMPID IS A REQUIRED PARAMETER FOR CREATEC05670000
               '                                                        05680000
.*                                                                      05690000
.*--------------------------------------------------------------------* 05700000
.*       CHECK FOR THE OPTIONAL PARAMETERS.  IF THEY ARE SPECIFIED,   * 05710000
.*       SET THE CORRESPONDING FIELD IN THE JSAB.  THE FIELDS MAY     * 05720000
.*       EITHER BE SET FROM A STORAGE LOCATION OR A REGISTER.         * 05730000
.*--------------------------------------------------------------------* 05740000
.*                                                                      05750000
.JSBCWID ANOP                                                           05760000
         AIF   ('&WORKID' EQ '').JSBCJID  WORK ID SPECIFIED?            05770000
         AIF   ('&WORKID'(1,1) NE '(').JSBCSWI  REGISTER FORMAT?        05780000
         MVC   JSABWKID,0(&WORKID(1))   SET WORK ID                     05790000
         AGO   .JSBCJID                 GO CHECK JOB ID                 05800000
.JSBCSWI ANOP                                                           05810000
         MVC   JSABWKID,&WORKID         SET WORK ID                     05820000
.*                                                                      05830000
.JSBCJID ANOP                                                           05840000
         AIF   ('&JOBID' EQ '').JSBCJNM  JOB ID SPECIFIED?              05850000
         AIF   ('&JOBID'(1,1) NE '(').JSBCSJI  REGISTER FORMAT?         05860000
         MVC   JSABJBID,0(&JOBID(1))    SET JOB ID                      05870000
         AGO   .JSBCJNM                 GO CHECK JOB NAME               05880000
.JSBCSJI ANOP                                                           05890000
         MVC   JSABJBID,&JOBID          SET JOB ID                      05900000
.*                                                                      05910000
.JSBCJNM ANOP                                                           05920000
         AIF   ('&JOBNAME' EQ '').JSBCPFX  JOB NAME SPECIFIED?          05930000
         AIF   ('&JOBNAME'(1,1) NE '(').JSBCSJN  REGISTER FORMAT?       05940000
         MVC   JSABJBNM,0(&JOBNAME(1))  SET JOB NAME                    05950000
         AGO   .JSBCPFX                 GO CHECK PREFIX                 05960000
.JSBCSJN ANOP                                                           05970000
         MVC   JSABJBNM,&JOBNAME        SET JOB NAME                    05980000
.*                                                                      05990000
.JSBCPFX ANOP                                                           06000000
         AIF   ('&PREFIX' EQ '').JSBCUID  PREFIX SPECIFIED?             06010000
         AIF   ('&PREFIX'(1,1) NE '(').JSBCSPF  REGISTER FORMAT?        06020000
         MVC   JSABPREF,0(&PREFIX(1))   SET PREFIX                      06030000
         AGO   .JSBCUID                 GO CHECK USER ID                06040000
.JSBCSPF ANOP                                                           06050000
         MVC   JSABPREF,&PREFIX         SET PREFIX                      06060000
.*                                                                      06070000
.JSBCUID ANOP                                                           06080000
         AIF   ('&USERID' EQ '').JSBCEST  USER ID SPECIFIED?            06090000
         AIF   ('&USERID'(1,1) NE '(').JSBCSUI  REGISTER FORMAT?        06100000
         MVC   JSABUSID,0(&USERID(1))   SET USER ID                     06110000
         AGO   .JSBCEST                 GO CHECK ENTRY START TIME       06120000
.JSBCSUI ANOP                                                           06130000
         MVC   JSABUSID,&USERID         SET USER ID                     06140000
.*                                                                      06150000
.JSBCEST ANOP                                                           06160000
         AIF   ('&ENTRYST' EQ '').JSBCXST  ENTRY ST TIME SPECIFIED?     06170000
         AIF   ('&ENTRYST'(1,1) NE '(').JSBCSES  REGISTER FORMAT?       06180000
         MVC   JSABESTK,0(&ENTRYST(1))  SET ENTRY START TIME            06190000
         AGO   .JSBCXST                 GO CHECK EXECUTION ST TIME      06200000
.JSBCSES ANOP                                                           06210000
         MVC   JSABESTK,&ENTRYST        SET ENTRY START TIME            06220000
.*                                                                      06230000
.JSBCXST ANOP                                                           06240000
         AIF   ('&EXECST' EQ '').JSBCUSR  EXECUTION ST TIME SPECIFIED?  06250000
         AIF   ('&EXECST'(1,1) NE '(').JSBCSEX  REGISTER FORMAT?        06260000
         MVC   JSABXSTK,0(&EXECST(1))   SET EXECUTION ST TIME           06270000
         AGO   .JSBCUSR                 GO CHECK USER AREA              06280000
.JSBCSEX ANOP                                                           06290000
         MVC   JSABXSTK,&EXECST         SET EXECUTION ST TIME           06300000
.*                                                                      06310000
.JSBCUSR ANOP                                                           06320000
         AIF   ('&USERPTR' EQ '').JSBCXCF USER AREA SPECIFIED? @520LSDS 06330000
         AIF   ('&USERPTR'(1,1) NE '(').JSBCSUS  REGISTER FORMAT?       06340000
         MVC   JSABUSER,0(&USERPTR(1))  SET EXECUTION ST TIME           06350000
         AGO   .JSBCXCF                 GO CHECK XCF grp name  @520LSDS 06360000
.JSBCSUS ANOP                                                           06370000
         MVC   JSABUSER,&USERPTR        SET USER AREA ADDRESS           06380000
.*                                                             @520LSDS 06381000
.JSBCXCF ANOP                                                  @520LSDS 06382000
         AIF   ('&XCFGPNM' EQ '').JSBCJST  No XCF Group Name?  @OW17398 06383000
         AIF   ('&XCFGPNM'(1,1) NE '(').JSBCSXC  Reg format?   @520LSDS 06384000
         MVC   JSABGPNM,0(&XCFGPNM(1))   Set XCF group name    @520LSDS 06385000
         AGO   .JSBCJST                 Go check JSAB type     @OW17398 06386000
.JSBCSXC ANOP                                                  @520LSDS 06387000
         MVC   JSABGPNM,&XCFGPNM        Set XCF group name     @520LSDS 06388000
.*                                                             @520LSDS 06389000
.JSBCJST AIF   ('&JESTAT' EQ '').JSBCTYP  No JES Status?       @OW17398 06389100
         AIF   ('&JESTAT'(1,1) NE '(').JSBCSST  Reg format?    @OW17398 06389200
         MVC   JSABJSTA,0(&JESTAT(1))   Copy JES status        @OW17398 06389300
         AGO   .JSBCTYP                 Go check JSAB type     @OW17398 06389400
.JSBCSST MVC   JSABJSTA,&JESTAT         Copy JES status        @OW17398 06389500
.*                                                                      06390000
.*--------------------------------------------------------------------* 06400000
.*       THE JSAB IS NOW INITIALIZED.  IF THIS IS AN ADDRESS SPACE    * 06410000
.*       TYPE JSAB, SET THE JSAB ADDRESS IN THE ASSB AND COPY THE     * 06420000
.*       ASSB JSAB POINTER TO THE JSABNEXT FIELD.  IF THIS IS A       * 06430000
.*       SUBTASK-TYPE JSAB, SET THE JSAB ADDRESS IN THE STCB (THERE   * 06440000
.*       WILL NOT BE ANY JSAB CHAINING FOR SUBTASK JSABS).            * 06450000
.*--------------------------------------------------------------------* 06460000
.*                                                                      06470000
.JSBCTYP ANOP                                                           06480000
         SPACE 1                                               @410D001 06485000
         TM    JSABFLG1,JSABNVAL        Is this being re-used? @410D001 06490000
         JO    &LAB11                   Skip chaining if so    @410D001 06492000
         SPACE 1                                               @410D001 06495000
         AIF   ('&TYPE' EQ '').JSBCAS          TYPE NOT SPECIFIED?      06500000
         AIF   ('&TYPE' EQ 'ADDRSP').JSBCAS    TYPE = ADDR SPACE?       06510000
         AIF   ('&TYPE' NE 'SUBTASK').JSBCAS   TYPE = SUBTASK? @410D001 06520000
         OI    JSABFLG1,JSABSTSK        Ind subtask level JSAB @R05LOPI 06525000
         L     14,PSATOLD-PSA(,0)       GET TCB ADDRESS                 06530000
         L     14,TCBSTCB-TCB(,14)      GET STCB ADDRESS                06540000
         ST    1,STCBJSAB-STCB(,14)     SET JSAB ADDRESS IN STCB        06550000
         AGO   .JSBCENC                 GO RETURN                       06560000
.JSBCAS  ANOP                                                           06570000
         L     14,PSAAOLD-PSA(,0)       GET ASCB ADDRESS                06580000
         L     14,ASCBASSB-ASCB(,14)    GET ASSB ADDRESS                06590000
         MVC   JSABNEXT,ASSBJSAB-ASSB(14)  SET ASSB JSAB PTR IN JSAB    06600000
         ST    1,ASSBJSAB-ASSB(,14)     SET JSAB ADDR IN ASSB           06610000
.*                                                                      06620000
.JSBCENC ANOP                                                           06630000
         SPACE 1                                               @410D001 06640000
&LAB11   DS    0H                                              @410D001 06642000
         NI    JSABFLG1,FF-JSABNVAL     Turn off non valid bit @410D001 06645000
*        MODESET KEYADDR=(2)            RESTORE CALLER'S KEY            06650000
.*                                                                      06660000
         MODESET KEYADDR=(2)            RESTORE CALLER'S KEY            06670000
         AGO   .JSBMERG                 RETURN TO MAINLINE              06680000
.*                                                                      06690000
.********************************************************************** 06700000
.*       READ                                                         * 06710000
.********************************************************************** 06720000
.*                                                                      06730000
.JSBRD   ANOP                                                           06740000
         AIF   ('&TYPE' EQ '').JSBRNTY     TYPE NOT SPECIFIED?          06750000
         MNOTE 4,'IAZXJSAB -- TYPE IS NOT VALID ON READ'                06760000
.JSBRNTY ANOP                                                           06770000
         AIF   ('&CLEANUP' NE 'YES').JSBYNCL  CLEANUP?         @410D001 06772000
         MNOTE 4,'IAZXJSAB -- CLEANUP IS NOT VALID ON READ'    @410D001 06774000
.JSBYNCL ANOP                                                  @410D001 06776000
         AIF   ('&CODELEV' NE '').JSBRVPA,                             C06780000
               ('&COMPID' NE '').JSBRVPA,                              C06790000
               ('&WORKID' NE '').JSBRVPA,                              C06800000
               ('&JOBID' NE '').JSBRVPA,                               C06810000
               ('&JOBNAME' NE '').JSBRVPA,                             C06820000
               ('&PREFIX' NE '').JSBRVPA,                              C06830000
               ('&USERID' NE '').JSBRVPA,                              C06840000
               ('&ENTRYST' NE '').JSBRVPA,                             C06850000
               ('&EXECST' NE '').JSBRVPA,                              C06860000
               ('&USERPTR' NE '').JSBRVPA,                     @520LSDSC06870000
               ('&JESTAT' NE '').JSBRVPA,                      @OW17398C06875000
               ('&JSABLVL' NE '').JSBRVPA,                     @R05LOPIC06875500
               ('&XCFGPNM' NE '').JSBRVPA                      @R05LOPI 06876000
         MNOTE 4,'IAZXJSAB -- NO VALID KEYWORDS SPECIFIED ON READ'      06880000
.JSBRVPA ANOP                                                           06890000
&RET     SETA  1                   1 - READ, 2 - UPDATE                 06900000
         AGO   .JSBFJSB            GO FIND JSAB                         06910000
.JSBRRET ANOP                                                           06920000
.*                                                                      06960000
.*--------------------------------------------------------------------* 06970000
.*       CHECK FOR THE OPTIONAL PARAMETERS.  IF THEY ARE SPECIFIED,   * 06980000
.*       SET THE STORAGE LOCATION FROM THE CORRESPONDING JSAB FIELD.  * 06990000
.*--------------------------------------------------------------------* 07000000
.*                                                                      07010000
         AIF   ('&CODELEV' EQ '').JSBRNCL  CODE LEVEL SPECIFIED?        07020000
         AIF   ('&CODELEV'(1,1) NE '(').JSBRSCL  REGISTER FORMAT?       07030000
         MVC   0(L'JSABCLEV,&CODELEV(1)),JSABCLEV  READ CODE LEVEL      07040000
         AGO   .JSBRNCL                 GO CHECK COMPONENT ID           07050000
.JSBRSCL ANOP                                                           07060000
         MVC   &CODELEV.(L'JSABCLEV),JSABCLEV  READ CODE LEVEL          07070000
.JSBRNCL ANOP                                                           07080000
.*                                                                      07090000
         AIF   ('&COMPID' EQ '').JSBRNCI   COMPONENT ID SPECIFIED?      07100000
         AIF   ('&COMPID'(1,1) NE '(').JSBRSCI  REGISTER FORMAT?        07110000
         MVC   0(L'JSABSCID,&COMPID(1)),JSABSCID   READ COMPONENT ID    07120000
         AGO   .JSBRNCI                 GO CHECK WORK ID                07130000
.JSBRSCI ANOP                                                           07140000
         MVC   &COMPID.(L'JSABSCID),JSABSCID   READ COMPONENT ID        07150000
.JSBRNCI ANOP                                                           07160000
.*                                                                      07170000
         AIF   ('&WORKID' EQ '').JSBRNWI   WORK ID SPECIFIED?           07180000
         AIF   ('&WORKID'(1,1) NE '(').JSBRSWI  REGISTER FORMAT?        07190000
         MVC   0(L'JSABWKID,&WORKID(1)),JSABWKID   READ WORK ID         07200000
         AGO   .JSBRNWI                 GO CHECK JOB ID                 07210000
.JSBRSWI ANOP                                                           07220000
         MVC   &WORKID.(L'JSABWKID),JSABWKID   READ WORK ID             07230000
.JSBRNWI ANOP                                                           07240000
.*                                                                      07250000
         AIF   ('&JOBID' EQ '').JSBRNJI    JOB ID SPECIFIED?            07260000
         AIF   ('&JOBID'(1,1) NE '(').JSBRSJI  REGISTER FORMAT?         07270000
         MVC   0(L'JSABJBID,&JOBID(1)),JSABJBID    READ JOB ID          07280000
         AGO   .JSBRNJI                 GO CHECK JOB NAME               07290000
.JSBRSJI ANOP                                                           07300000
         MVC   &JOBID.(L'JSABJBID),JSABJBID    READ JOB ID              07310000
.JSBRNJI ANOP                                                           07320000
.*                                                                      07330000
         AIF   ('&JOBNAME' EQ '').JSBRNJN  JOB NAME SPECIFIED?          07340000
         AIF   ('&JOBNAME'(1,1) NE '(').JSBRSJN  REGISTER FORMAT?       07350000
         MVC   0(L'JSABJBNM,&JOBNAME(1)),JSABJBNM  READ JOB NAME        07360000
         AGO   .JSBRNJN                 GO CHECK PREFIX                 07370000
.JSBRSJN ANOP                                                           07380000
         MVC   &JOBNAME.(L'JSABJBNM),JSABJBNM  READ JOB NAME            07390000
.JSBRNJN ANOP                                                           07400000
.*                                                                      07410000
         AIF   ('&PREFIX' EQ '').JSBRNPR   PREFIX SPECIFIED?            07420000
         AIF   ('&PREFIX'(1,1) NE '(').JSBRSPR  REGISTER FORMAT?        07430000
         MVC   0(L'JSABPREF,&PREFIX(1)),JSABPREF   READ PREFIX          07440000
         AGO   .JSBRNPR                 GO CHECK USER ID                07450000
.JSBRSPR ANOP                                                           07460000
         MVC   &PREFIX.(L'JSABPREF),JSABPREF   READ PREFIX              07470000
.JSBRNPR ANOP                                                           07480000
.*                                                                      07490000
         AIF   ('&USERID' EQ '').JSBRNUI   USER ID SPECIFIED?           07500000
         AIF   ('&USERID'(1,1) NE '(').JSBRSUI  REGISTER FORMAT?        07510000
         MVC   0(L'JSABUSID,&USERID(1)),JSABUSID   READ USER ID         07520000
         AGO   .JSBRNUI                 GO CHECK ENTRY ST TIME          07530000
.JSBRSUI ANOP                                                           07540000
         MVC   &USERID.(L'JSABUSID),JSABUSID   READ USER ID             07550000
.JSBRNUI ANOP                                                           07560000
.*                                                                      07570000
         AIF   ('&ENTRYST' EQ '').JSBRNES  ENTRY START TIME SPEC?       07580000
         AIF   ('&ENTRYST'(1,1) NE '(').JSBRSES  REGISTER FORMAT?       07590000
         MVC   0(L'JSABESTK,&ENTRYST(1)),JSABESTK  READ ENTRY ST TIME   07600000
         AGO   .JSBRNES                 GO CHECK EXEC START TIME        07610000
.JSBRSES ANOP                                                           07620000
         MVC   &ENTRYST.(L'JSABESTK),JSABESTK  READ ENTRY ST TIME       07630000
.JSBRNES ANOP                                                           07640000
.*                                                                      07650000
         AIF   ('&EXECST' EQ '').JSBRNXS   EXECUTION ST TIME SPEC?      07660000
         AIF   ('&EXECST'(1,1) NE '(').JSBRSXS  REGISTER FORMAT?        07670000
         MVC   0(L'JSABXSTK,&EXECST(1)),JSABXSTK   READ EXEC ST TIME    07680000
         AGO   .JSBRNXS                 GO CHECK USER PTR               07690000
.JSBRSXS ANOP                                                           07700000
         MVC   &EXECST.(L'JSABXSTK),JSABXSTK   READ EXEC ST TIME        07710000
.JSBRNXS ANOP                                                           07720000
.*                                                                      07730000
         AIF   ('&USERPTR' EQ '').JSBRNUS  USER PTR SPECIFIED?          07740000
         AIF   ('&USERPTR'(1,1) NE '(').JSBRSUS  REGISTER FORMAT?       07750000
         MVC   0(L'JSABUSER,&USERPTR(1)),JSABUSER  READ USER PTR        07760000
         AGO   .JSBRNUS                 GO RETURN                       07770000
.JSBRSUS ANOP                                                           07780000
         MVC   &USERPTR.(L'JSABUSER),JSABUSER  READ USER PTR            07790000
.JSBRNUS ANOP                                                           07800000
.*                                                             @520LSDS 07801000
         AIF   ('&XCFGPNM' EQ '').JSBRNXC  No XCF group name?  @520LSDS 07802000
         AIF   ('&XCFGPNM'(1,1) NE '(').JSBRSXC  Reg format?   @520LSDS 07803000
         MVC   0(L'JSABGPNM,&XCFGPNM(1)),JSABGPNM Read XCF grp @520LSDS 07804000
         AGO   .JSBRNXC                 Go return to mainline  @520LSDS 07805000
.JSBRSXC ANOP                                                  @520LSDS 07806000
         MVC   &XCFGPNM.(L'JSABGPNM),JSABGPNM  Read XCF grp nm @520LSDS 07807000
.JSBRNXC ANOP                                                  @520LSDS 07808000
.*                                                             @OW17398 07808200
         AIF   ('&JESTAT' EQ '').JSBRNJS  No JES status?       @OW17398 07808400
         AIF   ('&JESTAT'(1,1) NE '(').JSBRSJS  Reg format?    @OW17398 07808600
         MVC   0(L'JSABJSTA,&JESTAT(1)),JSABJSTA Read JES stat @OW17398 07808800
         AGO   .JSBRNJS                 Go return to mainline  @OW17398 07809000
.JSBRSJS MVC   &JESTAT.(L'JSABJSTA),JSABJSTA  Read JES stat    @OW17398 07809200
.JSBRNJS ANOP                                                  @OW17398 07809400
.*                                                                      07810000
         AGO   .JSBMERG                    RETURN TO MAINLINE           07820000
.*                                                                      07830000
.********************************************************************** 07840000
.*       UPDATE                                                       * 07850000
.********************************************************************** 07860000
.*                                                                      07870000
.JSBUP   ANOP                                                           07880000
* CAUTION: R2 WILL BE DESTROYED BY THE MODESET MACRO.          @OW17398 07881000
         SPACE 1                                               @OW17398 07884000
         AIF   ('&TYPE' EQ '' AND '&ASCB' EQ '' AND '&COMPID' EQ '' ANDC07890000
                '&CODELEV' EQ '').JSBUCON  Non valid keyword specified?C07900000
                                                               @410D001 07905000
         MNOTE 4,'IAZXJSAB -- NON VALID KEYWORD SPECIFIED ON UPDATE'   C07910000
                                                               @410D001 07915000
.JSBUCON ANOP                                                           07920000
         AIF   ('&CLEANUP' NE 'YES').JSBUNCL  CLEANUP?         @410D001 07922000
         MNOTE 4,'IAZXJSAB -- CLEANUP IS NOT VALID ON UPDATE'  @410D001 07924000
.JSBUNCL ANOP                                                  @410D001 07926000
         AIF   ('&WORKID' NE '').JSBUVPA,                              C07930000
               ('&JOBID' NE '').JSBUVPA,                               C07940000
               ('&JOBNAME' NE '').JSBUVPA,                             C07950000
               ('&PREFIX' NE '').JSBUVPA,                              C07960000
               ('&USERID' NE '').JSBUVPA,                              C07970000
               ('&ENTRYST' NE '').JSBUVPA,                             C07980000
               ('&EXECST' NE '').JSBUVPA,                              C07990000
               ('&XCFGPNM' NE '').JSBUVPA,                     @520LSDSC07995000
               ('&JESTAT' NE '').JSBUVPA,                      @OW17398C07996000
               ('&USERPTR' NE '').JSBUVPA                               08000000
         MNOTE 4,'IAZXJSAB -- NO VALID KEYWORDS SPECIFIED ON UPDATE'    08010000
.JSBUVPA ANOP                                                           08020000
&RET     SETA  2                   1 - READ, 2 - UPDATE                 08030000
.*                                                             @R10LMSD 08031000
.*       If UPDATE and JESTAT is requested, clear the register @R10LMSD 08032000
         AIF   ('&JESTAT' EQ '').JSBFJSB  No JES Status        @R10LMSD 08033000
         AIF   ('&JESTAT'(1,1) NE '*').JSBFJSB  Continue edit  @R10LMSD 08034000
&JESTATR SETC  '&JESTAT'(2,*)          Strip off the '*'       @R10LMSD 08035000
         &UPLA &JESTATR,0          Clear the JESTAT reg.       @R10LMSD 08036000
         AGO   .JSBFJSB            GO FIND JSAB                         08040000
.*                                                             @R10LMSD 08045000
.JSBURET ANOP                                                           08050000
.*                                                                      08090000
.*--------------------------------------------------------------------* 08100000
.*       CHECK FOR THE OPTIONAL PARAMETERS.  IF THEY ARE SPECIFIED,   * 08110000
.*       SET THE CORRESPONDING FIELD IN THE JSAB.                     * 08120000
.*--------------------------------------------------------------------* 08130000
.*                                                                      08140000
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            08150000
.*                                                                      08160000
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            08170000
         SPACE 1                                                        08180000
         AIF   ('&WORKID' EQ '').JSBUNWI   WORK ID SPECIFIED?           08190000
         AIF   ('&WORKID'(1,1) NE '(').JSBUSWI  REGISTER FORMAT?        08200000
         MVC   JSABWKID,0(&WORKID(1))   SET WORK ID                     08210000
         AGO   .JSBUNWI                 GO CHECK JOB ID                 08220000
.JSBUSWI ANOP                                                           08230000
         MVC   JSABWKID,&WORKID         SET WORK ID                     08240000
.JSBUNWI ANOP                                                           08250000
.*                                                                      08260000
         AIF   ('&JOBID' EQ '').JSBUNJI    JOB ID SPECIFIED?            08270000
         AIF   ('&JOBID'(1,1) NE '(').JSBUSJI  REGISTER FORMAT?         08280000
         MVC   JSABJBID,0(&JOBID(1))    SET JOB ID                      08290000
         AGO   .JSBUNJI                 GO CHECK JOB NAME               08300000
.JSBUSJI ANOP                                                           08310000
         MVC   JSABJBID,&JOBID          SET JOB ID                      08320000
.JSBUNJI ANOP                                                           08330000
.*                                                                      08340000
         AIF   ('&JOBNAME' EQ '').JSBUNJN  JOB NAME SPECIFIED?          08350000
         AIF   ('&JOBNAME'(1,1) NE '(').JSBUSJN  REGISTER FORMAT?       08360000
         MVC   JSABJBNM,0(&JOBNAME(1))  SET JOB NAME                    08370000
         AGO   .JSBUNJN                 GO CHECK PREFIX                 08380000
.JSBUSJN ANOP                                                           08390000
         MVC   JSABJBNM,&JOBNAME        SET JOB NAME                    08400000
.JSBUNJN ANOP                                                           08410000
.*                                                                      08420000
         AIF   ('&PREFIX' EQ '').JSBUNPF   PREFIX SPECIFIED?            08430000
         AIF   ('&PREFIX'(1,1) NE '(').JSBUSPF  REGISTER FORMAT?        08440000
         MVC   JSABPREF,0(&PREFIX(1))   SET PREFIX                      08450000
         AGO   .JSBUNPF                 GO CHECK USER ID                08460000
.JSBUSPF ANOP                                                           08470000
         MVC   JSABPREF,&PREFIX         SET PREFIX                      08480000
.JSBUNPF ANOP                                                           08490000
.*                                                                      08500000
         AIF   ('&USERID' EQ '').JSBUNUI   USER ID SPECIFIED?           08510000
         AIF   ('&USERID'(1,1) NE '(').JSBUSUI  REGISTER FORMAT?        08520000
         MVC   JSABUSID,0(&USERID(1))   SET USER ID                     08530000
         AGO   .JSBUNUI                 GO CHECK ENTRY START TIME       08540000
.JSBUSUI ANOP                                                           08550000
         MVC   JSABUSID,&USERID         SET USER ID                     08560000
.JSBUNUI ANOP                                                           08570000
.*                                                                      08580000
         AIF   ('&ENTRYST' EQ '').JSBUNES  ENTRY START TIME SPEC?       08590000
         AIF   ('&ENTRYST'(1,1) NE '(').JSBUSES  REGISTER FORMAT?       08600000
         MVC   JSABESTK,0(&ENTRYST(1))  SET ENTRY START TIME            08610000
         AGO   .JSBUNES                 GO CHECK EXEC START TIME        08620000
.JSBUSES ANOP                                                           08630000
         MVC   JSABESTK,&ENTRYST        SET ENTRY START TIME            08640000
.JSBUNES ANOP                                                           08650000
.*                                                                      08660000
         AIF   ('&EXECST' EQ '').JSBUNEX   EXEC START TIME SPEC?        08670000
         AIF   ('&EXECST'(1,1) NE '(').JSBUSEX  REGISTER FORMAT?        08680000
         MVC   JSABXSTK,0(&EXECST(1))   SET EXECUTION START TIME        08690000
         AGO   .JSBUNEX                 GO CHECK USER PTR               08700000
.JSBUSEX ANOP                                                           08710000
         MVC   JSABXSTK,&EXECST         SET EXECUTION START TIME        08720000
.JSBUNEX ANOP                                                           08730000
.*                                                                      08740000
         AIF   ('&USERPTR' EQ '').JSBUNUS  USER PTR SPECIFIED?          08750000
         AIF   ('&USERPTR'(1,1) NE '(').JSBUSUS  REGISTER FORMAT?       08760000
         MVC   JSABUSER,0(&USERPTR(1))  SET USER PTR                    08770000
         AGO   .JSBUNUS                 Go chk XCF group name  @520LSDS 08780000
.JSBUSUS ANOP                                                           08790000
         MVC   JSABUSER,&USERPTR        SET USER PTR                    08800000
.JSBUNUS ANOP                                                           08810000
.*                                                             @520LSDS 08811000
         AIF   ('&XCFGPNM' EQ '').JSBUNXC  No XCF Group Name   @520LSDS 08812000
         AIF   ('&XCFGPNM'(1,1) NE '(').JSBUSXC  Reg format?   @520LSDS 08813000
         MVC   JSABGPNM,0(&XCFGPNM(1))  Set XCF Group Name     @520LSDS 08814000
         AGO   .JSBUNXC                 Go return              @520LSDS 08815000
.JSBUSXC ANOP                                                  @520LSDS 08816000
         MVC   JSABGPNM,&XCFGPNM        Set XCF Group Name     @520LSDS 08817000
.JSBUNXC ANOP                                                  @520LSDS 08818000
.*                                                             @OW17398 08818200
         AIF   ('&JESTAT' EQ '').JSBUNJS  No JES Status        @OW17398 08818400
         AIF   ('&JESTAT'(1,1) NE '*').JSBUBDJ  Address not to @R10LMSDC08818420
                                        be returned            @R10LMSD 08818440
&JESTATR SETC  '&JESTAT'(2,*)           Strip off the '*'      @R10LMSD 08818460
         &UPLA &JESTATR,JSABJSTA        Return JESTAT addr     @R10LMSD 08818480
         AGO   .JSBUNJS                 Continue               @R10LMSD 08818500
.*                                                             @R10LMSD 08818520
.JSBUBDJ AIF   ('&JESTAT'(1,1) NE '(').JSBUSJS   Reg format?   @R10LMSD 08818600
         MVC   JSABJSTA,0(&JESTAT(1))   Copy JES status        @OW17398 08818800
         AGO   .JSBUNJS                 Go return              @OW17398 08819000
.JSBUSJS MVC   JSABJSTA,&JESTAT         Copy JES status        @OW17398 08819200
.JSBUNJS ANOP                                                  @OW17398 08819400
.*                                                                      08820000
         SPACE 1                                                        08830000
*        MODESET KEYADDR=(2)            RESTORE CALLER'S KEY            08840000
.*                                                                      08850000
         MODESET KEYADDR=(2)            RESTORE CALLER'S KEY            08860000
         AGO   .JSBMERG                 RETURN TO MAINLINE              08870000
.*                                                                      08880000
.********************************************************************** 08890000
.*       DELETE                                                       * 08900000
.********************************************************************** 08910000
.*                                                                      08920000
.JSBDL   ANOP                                                           08930000
* CAUTION: R2 WILL BE DESTROYED BY THE MODESET MACRO.          @OW17398 08931000
         SPACE 1                                               @OW17398 08934000
         AIF   ('&COMPID' NE '').JSBDNVP,                              C08940000
               ('&CODELEV' NE '').JSBDNVP,                             C08950000
               ('&WORKID' NE '').JSBDNVP,                              C08960000
               ('&JOBID' NE '').JSBDNVP,                               C08970000
               ('&JOBNAME' NE '').JSBDNVP,                             C08980000
               ('&PREFIX' NE '').JSBDNVP,                              C08990000
               ('&USERID' NE '').JSBDNVP,                              C09000000
               ('&ENTRYST' NE '').JSBDNVP,                             C09010000
               ('&EXECST' NE '').JSBDNVP,                              C09020000
               ('&USERPTR' NE '').JSBDNVP,                     @520LSDSC09030000
               ('&XCFGPNM' NE '').JSBDNVP,                     @OW17398C09035000
               ('&JESTAT' NE '').JSBDNVP                       @OW17398 09036000
         AGO   .JSBDCON                                                 09040000
.JSBDNVP ANOP                                                           09050000
         MNOTE 4,'IAZXJSAB -- NON VALID KEYWORD SPECIFIED ON DELETE'   C09060000
                                                               @410D001 09065000
.JSBDCON ANOP                                                           09070000
         AIF   ('&CLEANUP' EQ '').JSBDNCL  CLEANUP specified?  @410D001 09071000
         AIF   ('&CLEANUP' EQ 'YES').JSBDNCL  CLEANUP=YES specified?   C09072000
                                                               @410D001 09073000
         AIF   ('&CLEANUP' EQ 'NO').JSBDNCL  CLEANUP=NO specified?     C09074000
                                                               @410D001 09075000
         MNOTE 4,'IAZXJSAB -- CLEANUP VALUE SPECIFIED IS NOT VALID'    C09076000
                                                               @410D001 09077000
.JSBDNCL ANOP                                                  @410D001 09078000
         AIF   ('&TYPE' EQ 'SUBTASK').JSBDSUB                           09080000
         AIF   ('&TYPE' EQ 'ADDRSP').JSBDADR                            09090000
         AIF   ('&TYPE' EQ '').JSBDADR                                  09100000
         MNOTE 8,'IAZXJSAB -- INCORRECT TYPE SPECIFIED'                 09110000
.*                                                                      09120000
.*--------------------------------------------------------------------* 09130000
.*       ADDRESS SPACE LEVEL JSAB DELETION.  SET THE JSAB ADDRESS     * 09140000
.*       IN THE ASSB TO THE JSABNEXT FIELD AND RELEASE THE STORAGE.   * 09150000
.*--------------------------------------------------------------------* 09160000
.*                                                                      09170000
.JSBDADR ANOP                                                           09180000
         AIF   ('&ASCB' EQ '').JSBDPSA  ASCB SPECIFIED?                 09190000
         AIF   ('&ASCB'(1,1) NE '(').JSBDSTR  REGISTER FORMAT?          09200000
&ASCBREG SETC  '&ASCB'(2,K'&ASCB-2)           STRIP PARENTHESES         09210000
         LR    14,&ASCBREG         GET THE ASCB ADDRESS                 09220000
         AGO   .JSBDADD            CONTINUE WITH ADDRESS SPACE          09230000
.JSBDSTR ANOP                                                           09240000
         L     14,&ASCB            GET THE ASCB ADDRESS                 09250000
         AGO   .JSBDADD            CONTINUE WITH ADDRESS SPACE          09260000
.*                                                                      09270000
.JSBDPSA ANOP                                                           09280000
         L     14,PSAAOLD-PSA(,0)  GET THE ASCB ADDRESS                 09290000
.JSBDADD ANOP                                                           09300000
         L     14,ASCBASSB-ASCB(,14)  GET THE ASSB ADDRESS              09310000
         ICM   1,B'1111',ASSBJSAB-ASSB(14)  JSAB POINTER IN ASSB?       09320000
         JNZ   &LAB3               YES, GO PROCESS FUNCTION             09330000
         SPACE 1                                                        09340000
&LAB9    DS    0H                                              @410D001 09345000
         LA    15,JSABNFND         SET JSAB NOT FOUND                   09350000
         J     &LAB1               SKIP JSAB RELEASE                    09360000
         SPACE 1                                               @410D001 09360400
&LAB3    DS    0H                                              @410D001 09360800
         AIF   ('&CLEANUP' EQ 'YES').LABX                      @410D001 09361200
         TM    JSABFLG1,JSABNVAL   Marked not valid?           @410D001 09361600
         JNO   &LAB8               No, mark it for deletion    @410D001 09362000
         SPACE 1                                               @410D001 09362400
         ICM   1,B'1111',JSABNEXT  Another on the chain?       @410D001 09362800
         JNZ   &LAB3               Yes, try the next one       @410D001 09363200
         J     &LAB9               No, return, JSAB not found  @410D001 09363600
         SPACE 1                                               @410D001 09364000
&LAB8    DS    0H                                              @410D001 09364400
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  Change to key zero   @410D001 09364800
.*                                                             @410D001 09365200
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  Change to key zero   @410D001 09365600
         SPACE 1                                               @410D001 09366000
         OI    JSABFLG1,JSABNVAL   Mark the JSAB as not valid  @410D001 09366400
         SPACE 1                                               @410D001 09366800
*        MODESET KEYADDR=(2)            Restore caller's key   @410D001 09367200
.*                                                             @410D001 09367600
         MODESET KEYADDR=(2)            Restore caller's key   @410D001 09368000
         AGO   .JSBDMRG                                        @410D001 09368400
.LABX    ANOP                                                  @410D001 09368800
         EJECT                                                          09370000
*********************************************************************** 09380000
*                                                                     * 09390000
*        DECHAIN THE ADDRESS SPACE JSAB AND RELEASE THE STORAGE.      * 09400000
*                                                                     * 09410000
*********************************************************************** 09420000
         SPACE 1                                                        09450000
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            09460000
.*                                                                      09470000
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            09480000
         SPACE 1                                                        09490000
         MVC   ASSBJSAB-ASSB(L'JSABNEXT,14),JSABNEXT  DECHAIN THE JSAB  09500000
         SPACE 1                                                        09510000
*        MODESET KEYADDR=(2)       RESTORE THE CALLER'S KEY             09520000
.*                                                                      09530000
         MODESET KEYADDR=(2)       RESTORE THE CALLER'S KEY             09540000
         SPACE 1                                                        09550000
*        STORAGE RELEASE,LENGTH=JSABSIZE,ADDR=(1),SP=245,               09560000
*              COND=YES,RTCD=(15)                                       09570000
.*                                                                      09580000
         STORAGE RELEASE,LENGTH=JSABSIZE,ADDR=(1),SP=245,              C09590000
               COND=YES,RTCD=(15)                                       09600000
         SPACE 1                                               @410D001 09600400
         LTR   15,15               Storage release success?    @410D001 09600800
         JZ    &LAB5               Yes, continue               @410D001 09601200
         SPACE 1                                               @410D001 09601600
         LA    15,JSABNOST         Show storage not released   @410D001 09602000
         J     &LAB1               Go to error label           @410D001 09602400
         SPACE 1                                               @410D001 09602800
&LAB5    DS    0H                                              @410D001 09603200
         AIF   ('&ASCB' EQ '').JSBDPSX  ASCB specified?        @410D001 09603600
         AIF   ('&ASCB'(1,1) NE '(').JSBDSTX Register format?  @410D001 09604000
&ASCBREG SETC  '&ASCB'(2,K'&ASCB-2)        Strip parentheses   @410D001 09604400
         LR    14,&ASCBREG         Get the ASCB address        @410D001 09604800
         AGO   .JSBDADX            Go on with address space    @410D001 09605200
.JSBDSTX ANOP                                                  @410D001 09605600
         L     14,&ASCB            Get the ASCB address        @410D001 09606000
         AGO   .JSBDADX            Go on with address space    @410D001 09606400
.*                                                             @410D001 09606800
.JSBDPSX ANOP                                                  @410D001 09607200
         L     14,PSAAOLD-PSA(,0)  Get the ASCB address        @410D001 09607600
.JSBDADX ANOP                                                  @410D001 09608000
         L     14,ASCBASSB-ASCB(,14)  Get the ASSB address     @410D001 09608400
         ICM   1,B'1111',ASSBJSAB-ASSB(14)  JSAB ptr in ASSB?  @410D001 09608800
         JNZ   &LAB3               Yes, go process function    @410D001 09609200
         AGO   .JSBDMRG                                                 09610000
.*                                                                      09620000
.*--------------------------------------------------------------------* 09630000
.*       SUBTASK JSAB DELETION.  SET THE JSAB ADDRESS IN THE STCB     * 09640000
.*       TO ZERO AND RELEASE THE STORAGE.                             * 09650000
.*--------------------------------------------------------------------* 09660000
.*                                                                      09670000
.JSBDSUB ANOP                                                           09680000
         AIF   ('&ASCB' EQ '').JSBDAOK  ASCB SPECIFIED?                 09690000
         MNOTE 4,'IAZXJSAB -- ASCB NOT VALID WITH TYPE=SUBTASK'        C09700000
                                                               @410D001 09705000
.JSBDAOK ANOP                                                           09710000
         L     14,PSATOLD-PSA(,0)  GET THE TCB ADDRESS                  09720000
         L     14,TCBSTCB-TCB(,14) GET THE STCB ADDRESS                 09730000
         ICM   1,B'1111',STCBJSAB-STCB(14)  JSAB POINTER IN STCB?       09740000
         JNZ   &LAB3               YES, GO PROCESS FUNCTION             09750000
         SPACE 1                                                        09760000
&LAB9    DS    0H                                              @410D001 09765000
         LA    15,JSABNFND         SET JSAB NOT FOUND                   09770000
         J     &LAB1               SKIP JSAB RELEASE                    09780000
         SPACE 1                                               @410D001 09780400
&LAB3    DS    0H                                              @410D001 09780800
         AIF   ('&CLEANUP' EQ 'YES').LABY                      @410D001 09781200
         TM    JSABFLG1,JSABNVAL   Marked not valid?           @410D001 09781600
         JNO   &LAB8               No, mark it for deletion    @410D001 09782000
         SPACE 1                                               @410D001 09782400
         ICM   1,B'1111',JSABNEXT  Another on the chain?       @410D001 09782800
         JNZ   &LAB3               Yes, try the next one       @410D001 09783200
         J     &LAB9               No, return, JSAB not found  @410D001 09783600
         SPACE 1                                               @410D001 09784000
&LAB8    DS    0H                                              @410D001 09784400
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  Change to key zero   @410D001 09784800
.*                                                             @410D001 09785200
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  Change to key zero   @410D001 09785600
         SPACE 1                                               @410D001 09786000
         OI    JSABFLG1,JSABNVAL   Mark the JSAB as not valid  @410D001 09786400
         SPACE 1                                               @410D001 09786800
*        MODESET KEYADDR=(2)            Restore caller's key   @410D001 09787200
.*                                                             @410D001 09787600
         MODESET KEYADDR=(2)            Restore caller's key   @410D001 09788000
         AIF   ('&CLEANUP' NE 'YES').JSBDMRG                   @410D001 09788400
.LABY    ANOP                                                  @410D001 09788800
         EJECT                                                          09790000
*********************************************************************** 09800000
*                                                                     * 09810000
*        DECHAIN THE SUBTASK JSAB AND RELEASE THE STORAGE.            * 09820000
*                                                                     * 09830000
*********************************************************************** 09840000
         SPACE 1                                                        09870000
*        MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            09880000
.*                                                                      09890000
         MODESET EXTKEY=ZERO,SAVEKEY=(2)  CHANGE TO KEY ZERO            09900000
         SPACE 1                                                        09910000
         MVC   STCBJSAB-STCB(L'JSABNEXT,14),JSABNEXT  Dechain the JSAB C09920000
                                                               @410D001 09930000
         SPACE 1                                                        09940000
*        MODESET KEYADDR=(2)            RESTORE THE CALLER'S KEY        09950000
.*                                                                      09960000
         MODESET KEYADDR=(2)            RESTORE THE CALLER'S KEY        09970000
         SPACE 1                                                        09980000
*        STORAGE RELEASE,LENGTH=JSABSIZE,ADDR=(1),SP=253,               09990000
*              COND=YES,RTCD=(15)                                       10000000
.*                                                                      10010000
         STORAGE RELEASE,LENGTH=JSABSIZE,ADDR=(1),SP=253,              C10020000
               COND=YES,RTCD=(15)                                       10030000
.*                                                                      10040000
         SPACE 1                                                        10060000
         LTR   15,15               WAS STORAGE RELEASE SUCCESSFUL?      10070000
         JZ    &LAB5               YES, CONTINUE                        10080000
         SPACE 1                                                        10090000
         LA    15,JSABNOST         INDICATE STORAGE NOT RELEASED        10100000
         J     &LAB1               Go to error label           @410D001 10110000
         SPACE 1                                               @410D001 10115000
&LAB5    DS    0H                                              @410D001 10120000
         L     14,PSATOLD-PSA(,0)  Get the TCB address         @410D001 10122000
         L     14,TCBSTCB-TCB(,14) Get the STCB address        @410D001 10125000
         ICM   1,B'1111',STCBJSAB-STCB(14)  JSAB ptr in STCB?  @410D001 10130000
         JNZ   &LAB3               Yes, go process function    @410D001 10131000
.JSBDMRG ANOP                                                  @410D001 10134000
         AGO   .JSBMERG            RETURN TO MAINLINE                   10140000
.*                                                                      10150000
.********************************************************************** 10160000
.*       FINDJSAB SUBROUTINE                                          * 10170000
.*                                                                    * 10180000
.*       ON RETURN, REGISTER 1 CONTAINS THE JSAB POINTER AND          * 10190000
.*       REGISTER 14 CONTAINS EITHER THE STCB OR THE ASSB             * 10200000
.*       POINTER IF REGISTER 15 IS ZERO.                              * 10210000
.********************************************************************** 10220000
.*                                                                      10230000
.JSBFJSB ANOP                                                           10240000
.*                                                                      10250000
.*--------------------------------------------------------------------* 10260000
.*       IF ASCB IS SPECIFIED (AND THE FUNCTION IS READ OR DELETE),   * 10270000
.*       SET THE ADDRESS IN REGISTER 14 AND CONTINUE WITH ADDRESS     * 10280000
.*       SPACE LEVEL JSAB.  ASCB IS NOT VALID ON CREATE AND UPDATE.   * 10290000
.*--------------------------------------------------------------------* 10300000
.*                                                                      10310000
         AIF   ('&ASCB' EQ '').JSBFTCB  ASCB SPECIFIED?                 10320000
         AIF   ('&FUNC' EQ 'UPDATE').JSBFTCB  IF UPDATE, IGNORE         10330000
         AIF   ('&ASCB'(1,1) NE '(').JSBFSTR  REGISTER FORMAT?          10340000
&ASCBREG SETC  '&ASCB'(2,K'&ASCB-2)     STRIP PARENTHESES               10350000
         LR    14,&ASCBREG              GET THE ASCB ADDRESS            10360000
         AGO   .JSBFADD                 CONTINUE WITH ADDRESS SPACE     10370000
.JSBFSTR L     14,&ASCB                 GET THE ASCB ADDRESS            10380000
         AGO   .JSBFADD                 CONTINUE WITH ADDRESS SPACE     10390000
.*                                                                      10400000
.*--------------------------------------------------------------------* 10410000
.*       CHECK STCB FIRST AND THEN THE ASSB.                          * 10420000
.*--------------------------------------------------------------------* 10430000
.*                                                                      10440000
.JSBFTCB ANOP                                                           10450000
         AIF   ('&JLVC' EQ '').JSBFNLT                         @R05LOPI 10452000
         &JLVC &JLVO,4             Assume subtask level JSAB   @R05LOPI 10455000
.JSBFNLT ICM   14,B'1111',PSATOLD-PSA(0)  Get the TCB address  @R05LOPI 10460000
         JZ    &LAB6                    IF ZERO, GO CHECK ASCB          10470000
         SPACE 1                                               @410D001 10475000
         L     14,TCBSTCB-TCB(,14)      GET THE STCB ADDRESS            10480000
         ICM   1,B'1111',STCBJSAB-STCB(14)  JSAB POINTER IN STCB?       10490000
         JZ    &LAB6                          No, check ASCB   @R05P424 10500000
         TM    JSABFLG1,JSABNVAL   JSAB valid (not invalid)?   @R05P424 10503000
         JNO   &LAB8                 Yes, use this one         @R05P424 10506000
         SPACE 1                                                        10510000
.*                                                                      10520000
&LAB6    L     14,PSAAOLD-PSA(,0)       Get the ASCB address   @R05LOPI 10540000
.JSBFADD ANOP                                                           10550000
         AIF   ('&JLVC' EQ '').JSBFNLA                         @R05LOPI 10551000
         &JLVC &JLVO,0             Assume ASCB level JSAB      @R05LOPI 10554000
.JSBFNLA L     14,ASCBASSB-ASCB(,14)    Get the ASSB address   @R05LOPI 10560000
         ICM   1,B'1111',ASSBJSAB-ASSB(14)  JSAB POINTER IN ASSB?       10570000
         JZ    &LAB9                          No, return error @R05P424 10575000
         SPACE 1                                               @R05P424 10580000
&LAB7    TM    JSABFLG1,JSABNVAL   JSAB valid (not invalid)?   @R05P424 10585000
         JNO   &LAB8                 Yes, use this one         @R05P424 10590000
         ICM   1,B'1111',JSABNEXT  Is there another in chain?  @R05P424 10600000
         JNZ   &LAB7                 Yes, try the next one     @R05P424 10605000
         SPACE 1                                               @R05P424 10606000
&LAB9    LA    15,JSABNFND         Set JSAB not found          @R05P424 10610000
         J     &LAB1               Go to error label           @R05P424 10615000
         SPACE 1                                               @R05P424 10620000
&LAB8    DS    0H                                              @R05P424 10625000
.*                                                                      10630000
.*--------------------------------------------------------------------* 10640000
.*       RETURN TO THE CALLER OF FINDJSAB.                            * 10650000
.*--------------------------------------------------------------------* 10660000
.*                                                                      10670000
         AIF   (&RET EQ 1).JSBRRET      Caller READ, return    @410D001 10680000
         AGO   .JSBURET                 Caller UPDATE, return  @410D001 10710000
         MEND                                                           10720000
**/                                                                     10730000
* IAZXJSAB:                                                             10740000
* MACRO                                                                 10750000
*    KEYS(FUNCTION,TYPE,ASCB_PTR,COMPONENT_ID,CODE_LEVEL,               10760000
*         WORK_ID,JOB_ID,JOB_NAME,PREFIX,USER_ID,                       10770000
*         ENTRY_START_TIME,EXECUTION_START_TIME,USER_PTR,  /*@OW17398*/ 10780000
*         CLEANUP,XCF_GROUPNAME,JES_STATUS,JSAB_LEVEL,     /*@R05LOPI*/ 10785000
*         RTCD);                                           /*@R05LOPI*/ 10786000
*    ANS('?'||MACLABEL||'IAZXJSBP '||MACLIST||MACKEYS||';');            10790000
*                                                                       10800000
*%END IAZXJSAB;                                                         99999999
