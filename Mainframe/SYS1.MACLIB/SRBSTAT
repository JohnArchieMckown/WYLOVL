*  /*** START OF SPECIFICATIONS *************************************** 00050000
*                                                                     * 00097000
*01* MACRO-NAME = SRBSTAT                                             * 00144000
*                                                                     * 00191000
*01* DESCRIPTIVE-NAME = SAVE/RESTORE SRB EXECUTION STATUS             * 00238000
*                                                                     * 00285000
*01* COPYRIGHT =   5740-XYN COPYRIGHT IBM CORP. 1980,                 * 00332000
*                LICENSED MATERIAL PROGRAM, PROPERTY OF IBM,          * 00379000
*                REFER TO COPYRIGHT INSTRUCTIONS FORM NUMBER          * 00426000
*                G120-2083.                                           * 00473000
*                                                                     * 00520000
*01* STATUS = OS/VS2 JBB1226                                          * 00567000
*                                                                     * 00614000
*01* FUNCTION = USED TO SAVE/RESTORE/MODIFY THE EXECUTION STATUS OF   * 00661000
*               SRB MODE CALLERS IN SUPPLIED SAVE AREA AS WELL AS     * 00692300
*               PROVIDE THE ABILITY TO CHANGE THE FRR ENVIRONMENT.    * 00723600
*                                                                     * 00755000
*01* MODULE-TYPE = MACRO   (BILINGUAL)                                * 00802000
*                                                                     * 00849000
*02* PROCESSOR = ASSEMBLER/PLS COMPILER                               * 00896000
*                                                                     * 00943000
*02* MACRO-SIZE = 175 LOC                                             * 00990000
*                                                                     * 01037000
*01* MACRO PARAMETERS =                                               * 01084000
*         TYPE   - POSITIONAL, REQUIRED                               * 01097000
*                  SAVE    - SAVE CURRENT SRB STATUS IN SUPPLIED      * 01110000
*                            STATUS SAVE AREA                         * 01123000
*                  RESTORE - RESTORE SAVED SRB STATUS FROM            * 01136000
*                            SUPPLIED STATUS SAVE AREA                * 01149000
*                  MODIFY  - MODIFY THE PURGE ASID/TCB IN THE         * 01162000
*                            STSV OR LCCA                             * 01167500
*         STSV   - KEYWORD, REQUIRED                                  * 01173000
*                  - ADDRESS OF SRB STATUS SAVE AREA, RX-TYPE ADDRESS * 01178500
*                    OR REG (1)-(12)                                  * 01184000
*                  - 0, INDICATES AN LCCA MODIFICATION IS TO BE DONE  * 01189500
*                    (VALID FOR MODIFY ONLY)                          * 01195000
*         NEWFRR - KEYWORD, OPTIONAL (SAVE OR RESTORE ONLY)           * 01201000
*                  ADDRESS OF AN FRR TO BE USED BY SAVE/RESTORE       * 01206500
*                  FUNCTION, RX-TYPE ADDRESS OR REG (0), (2)-(12)     * 01212000
*         PRGAT  - KEYWORD, REQUIRED (MODIFY ONLY)                    * 01217500
*                  ADDRESS OF SIX-BYTE AREA OF STORAGE WHICH          * 01223000
*                  CONTAINS THE NEW PURGE ASID/TCB, RX-TYPE           * 01228500
*                  ADDRESS OR REG (2)-(12)                            * 01234000
*                                                                     * 01240000
*01* MACROS = IHBERMAC, IHAPSA AND IHASVT (NEEDED TO USE SRBSTAT)     * 01253000
*                                                                     * 01266000
*01* CHANGE-ACTIVITY =                                                * 01279000
*         ZMB0039 - PLS VERSION MUST CALL SERVICE ROUTINES WHOSE      * 01283300
*                   ADDRESSES ARE IN THE SVT.                         * 01287600
*         ZMB0118 - PLS VERSION MUST HAVE CHARACTERS ON A LINE BEFORE * 01289000
*                   LINE FLAGGING WITH AN "@".                        * 01290400
*         G38VPXY - ADDITION OF MODIFY REQUEST OPTION.                * 01292000
*         ZMB0281 - STSV=0 NOT ALLOWED WITH TYPE=SAVE OR              * 01303900
*                   TYPE=RESTORE                                      * 01315800
*                                                                     * 01327800
*** END OF SPECIFICATIONS ********************************************* 01363600
* A-000000-999999                                              @G38VPXY 01399400
*                                                                       01435200
*                                                                       01471000
         MACRO                                                          01506800
&LABEL   SRBSTAT &TYPE,&STSV=,&NEWFRR=,&PRGAT=                          01542600
.*                                                                      01578400
*        MACDATE = 80.084                                               01614200
.*                                                                      01650000
.********************************************************************** 01700000
.*       DECLARE VARIABLES                                            * 01750000
.********************************************************************** 01800000
         LCLC  &CHR,&SAVE                   &STSV INSTRUCTION VALUE     01850000
         LCLC  &CHF,&SAVEFRR                &NEWFRR INSTRUCTION VALUE   01900000
         LCLC  &CHP,&PSAVE                  &PRGAT INSTRUCTION VALUE    01924900
         LCLC  &EP                          SVT VCON IDENTIFIER         01950000
         LCLC  &OP1,&OP2                    IHBERMAC OPERANDS           02000000
.*                                                                      02050000
.********************************************************************** 02100000
.*       &TYPE MUST BE SPECIFIED AS 'SAVE', 'RESTORE', OR 'MODIFY'    * 02150000
.********************************************************************** 02200000
.*                                                                      02250000
         AIF   ('&LABEL' EQ '').GENL        BRANCH IF NO LABEL          02294400
&LABEL   EQU   *                                                        02316600
.GENL    ANOP                                                           02338800
.*                                                                      02361000
         AIF   (N'&SYSLIST GT 1).ERR1       ERROR IF > 1 POSITION PARMS 02383200
&OP1     SETC  'TYPE'                       FIRST OPERAND FOR IHBERMAC  02405400
         AIF   ('&TYPE' EQ '').ERR2         ERROR IF TYPE NOT SPECIFIED 02427600
         AIF   ('&TYPE' EQ 'MODIFY').MODIFY BRANCH IF MODIFY REQUEST    02449800
&OP2     SETC  '&TYPE'                      SECOND OPERAND FOR IHBERMAC 02477500
&EP      SETC  'SV'                         IDENTIFIER SUFFIX FOR SAVE  02505200
         AIF   ('&TYPE' EQ 'SAVE').PRGAT    CONTINUE IF SAVE SPECIFIED  02532900
         AIF   ('&TYPE' NE 'RESTORE').ERR3  ERROR IF RESTORE NOT SPEC   02560800
&EP      SETC  'RS'                         IDENTIFIER SUFFIX FOR REST  02605200
.*                                                                      02650000
.********************************************************************** 02700000
.*       ENSURE &PRGAT PARAMETER IS NOT SPECIFIED                     * 02704500
.********************************************************************** 02709000
.*                                                                      02713500
.PRGAT   ANOP                                                           02718000
&OP1     SETC  'PRGAT OPERAND'              FIRST OPERAND FOR IHBERMAC  02722500
&OP2     SETC  '&TYPE REQUEST'              SECOND OPERAND FOR IHBERMAC 02727000
         AIF   ('&PRGAT' NE '').ERR5        ERROR IF PRGAT IS GIVEN     02731500
&PSAVE   SETC  ''                           INDICATE PRGAT NOT GIVEN    02736000
.*                                                                      02740500
.********************************************************************** 02745000
.*       &STSV MUST BE SPECIFIED AS REGISTER OR RX-TYPE ADDRESS       * 02750000
.********************************************************************** 02800000
.*                                                                      02850000
.STSV    ANOP                                                           02900000
&OP1     SETC  'STSV'                       FIRST IHBERMAC OPERAND      02950000
         AIF   ('&STSV' EQ '').ERR2         ERROR IF STSV NOT SPEC      03000000
&OP1     SETC  'STSV=0'                     FIRST IHBERMAC     @ZMB0281 03008300
.*                                          OPERAND.           @ZMB0281 03016600
&OP2     SETC  '&TYPE'                      SECOND IHBERMAC    @ZMB0281 03024900
.*                                          OPERAND            @ZMB0281 03033200
         AIF   ('&STSV' EQ '0').ERR5        IF SPECIFIED-ERROR @ZMB0281 03041500
&OP2     SETC  '&STSV'                      SECOND IHBERMAC OPERAND     03050000
&CHR     SETC  'A'                          STSV INST SUFFIX RX-ADDR    03100000
&SAVE    SETC  '&STSV'                      STSV OPERAND RX-ADDR        03150000
         AIF   ('&STSV'(1,1) NE '(').NEWFRR    BR IF REG NOT SPEC       03200000
         AIF   (N'&STSV NE 1).ERR4          ERROR IF > 1 REG GIVEN      03250000
&CHR     SETC  'R'                          STSV INST SUFFIX   REGISTER 03300000
&SAVE    SETC  '&STSV(1)'                   STSV INST OPERAND REG       03350000
.*                                                                      03400000
.********************************************************************** 03450000
.*       &NEWFRR MAY BE SPECIFIED AS REGISTER OR RX-TYPE ADDRESS      * 03500000
.********************************************************************** 03534600
.*                                                                      03569200
.NEWFRR  ANOP                                                           03600900
&SAVEFRR SETC  ''                           NEWFRR NOT SPEC, DEFAULT    03632600
         AIF   ('&NEWFRR' EQ '').GEN        BR IF NEWFRR NO SPECIFIED   03664300
&OP1     SETC  'NEWFRR'                     FIRST IHBERMAC OPERAND      03696000
&OP2     SETC  '&NEWFRR'                    SECOND IHBERMAC OPERAND     03727700
&CHF     SETC  'A'                          NEWFRR INST SUFFIX RX-ADDR  03759400
&SAVEFRR SETC  '&NEWFRR'                    NEWFRR OPERAND RX-ADDR      03791100
         AIF   ('&NEWFRR'(1,1) NE '(').GEN  CONTINUE IF REG NOT SPEC    03822800
         AIF   (N'&NEWFRR NE 1).ERR4        ERROR IF > 1 REG GIVEN      03854500
&CHF     SETC  'R'                          NEWFRR INST SUFFIX REG      03886200
&SAVEFRR SETC  '&NEWFRR(1)'                 NEWFRR OPERAND REG          03917900
         AGO   .GEN                         GO GENERATE INTERFACE CODE  03918500
.*                                                                      03919100
.********************************************************************** 03919700
.*       PROCESS A MODIFY REQUEST                                     * 03920300
.********************************************************************** 03920900
.*                                                                      03921500
.MODIFY  ANOP                                                           03922100
&EP      SETC  'MD'                         IDENTIFIER SUFFIX FOR MOD   03922700
.*                                                                      03923300
.********************************************************************** 03923900
.*       ENSURE &NEWFRR PARAMETER IS NOT SPECIFIED                    * 03924500
.********************************************************************** 03925100
.*                                                                      03925700
&OP1     SETC  'NEWFRR OPERAND'             FIRST OPERAND FOR IHBERMAC  03926300
&OP2     SETC  'MODIFY REQUEST'             SECOND OPERAND FOR IHBERMAC 03926900
         AIF   ('&NEWFRR' NE '').ERR5       ERROR IF NEWFRR IS GIVEN    03927500
.*                                                                      03928100
.********************************************************************** 03928700
.*       &STSV MUST BE SPECIFIED AS REG OR RX-TYPE ADDRESS            * 03929300
.********************************************************************** 03929900
.*                                                                      03930500
.MSTSV   ANOP                                                           03931100
&OP1     SETC  'STSV'                       FIRST OPERAND FOR IHBERMAC  03931700
         AIF   ('&STSV' EQ '').ERR2         ERROR IF STSV NOT GIVEN     03932300
&OP2     SETC  '&STSV'                      SECOND OPERAND FOR IHBERMAC 03932900
&SAVE    SETC  ''                           INDICATE STSV IS ZERO       03933500
&CHF     SETC  'A'                          INDICATION TO LOAD REG 0    03934100
&SAVEFRR SETC  '8'                          DEFAULT TO MODIFY LCCA      03934700
         AIF   ('&STSV' EQ '0').MPRGAT      BRANCH IF MODIFY LCCA       03935300
&SAVEFRR SETC  '4'                          INDICATION TO MODIFY STSV   03935900
&CHR     SETC  'A'                          STSV INST SUFFIX RX-ADDR    03936500
&SAVE    SETC  '&STSV'                      STSV OPERAND RX-ADDR        03937100
         AIF   ('&STSV'(1,1) NE '(').MPRGAT BR IF REG NOT GIVEN         03937700
         AIF   (N'&STSV NE 1).ERR4          ERROR IF > 1 REG GIVEN      03938300
&CHR     SETC  'R'                          STSV INST SUFFIX REG        03938900
&SAVE    SETC  '&STSV(1)'                   STSV INST OPERAND REG       03939500
.*                                                                      03940100
.********************************************************************** 03940700
.*       &PRGAT MUST BE SPECIFIED AS REG OR RX-TYPE ADDRESS           * 03941300
.********************************************************************** 03941900
.*                                                                      03942500
.MPRGAT  ANOP                                                           03943100
&OP1     SETC  'PRGAT'                      FIRST OPERAND FOR IHBERMAC  03943700
         AIF   ('&PRGAT' EQ '').ERR2        ERROR IF PRGAT NOT GIVEN    03944300
&OP2     SETC  '&PRGAT'                     SECOND OPERAND FOR IHBERMAC 03944900
&CHP     SETC  'A'                          PRGAT INST SUFFIX RX-ADDR   03945500
&PSAVE   SETC  '&PRGAT'                     PRGAT INST OPERAND RX-ADDR  03946100
         AIF   ('&PRGAT'(1,1) NE '(').GEN   BRANCH IF REG NOT SPECIFIED 03946700
         AIF   (N'&PRGAT NE 1).ERR4         ERROR IF > 1 REG GIVEN      03947300
&CHP     SETC  'R'                          PRGAT INST SUFFIX REG       03947900
&PSAVE   SETC  '&PRGAT(1)'                  PRGAT INST OPERAND REG      03948500
.*                                                                      03950000
.********************************************************************** 04000000
.*       GENERATE INTERFACE CODE TO SRBSTAT SERVICE ROUTINE           * 04050000
.********************************************************************** 04100000
.*                                                                      04150000
.GEN     ANOP                                                           04167300
         AIF   ('&EP' EQ 'RS').GEN0         BRANCH IF RESTORE           04184600
         STM   14,12,12(13)                 .SAVE USER'S REGISTERS      04193200
.*                                                                      04201800
.GEN0    ANOP                                                           04210400
         AIF   ('&SAVEFRR' EQ '').GEN1      BR IF NEWFRR NOT GIVEN      04219200
         AIF   ('&CHF' EQ 'R' AND                                      X04236500
               '&SAVEFRR' EQ '0').GEN2      SKIP GEN IF REG 0 GIVEN     04253800
         L&CHF 0,&SAVEFRR                   .GET NEWFRR ADDRESS         04271100
         AGO   .GEN2                        CONTINUE GENERATION         04288400
.*                                                                      04305700
.GEN1    ANOP                                                           04323000
         SLR   0,0                          .INDICATE NEWFRR NOT GIVEN  04340300
.*                                                                      04357600
.GEN2    ANOP                                                           04374900
         AIF   ('&SAVE' EQ '').GEN2A        BR IF MODIFY OF LCCA        04392200
         AIF   ('&CHR' EQ 'R' AND                                      X04397600
               '&SAVE' EQ '1').GEN3         SKIP GEN IF REG 1 GIVEN     04403000
         L&CHR 1,&SAVE                      .GET SAVE AREA ADDRESS      04408400
         AGO   .GEN3                        CONTINUE FOR NEXT PARM      04413800
.*                                                                      04419200
.GEN2A   ANOP                                                           04424600
         SLR   1,1                          .CLEAR UNUSED REG 1         04430000
.*                                                                      04435400
.GEN3    ANOP                                                           04440800
         AIF   ('&PSAVE' EQ '').GEN4        SKIP GEN IF NOT MODIFY      04446200
         AIF   ('&CHP' EQ 'R' AND                                      X04451600
               '&PSAVE' EQ '2').GEN4        SKIP GEN IF REG 2 GIVEN     04457000
         L&CHP 2,&PSAVE                     .GET PRGAT ADDRESS          04462400
.*                                                                      04467800
.GEN4    ANOP                                                           04473200
         L     15,PSASVT-PSA(0,0)           .GET SVT ADDRESS            04478700
         L     15,SVTSRB&EP.-SVT(0,15)      .GET SRBSTAT EP ADDRESS     04496000
         BALR  14,15                        .CALL SRBSTAT ROUTINE       04513300
.*                                                                      04530600
         AIF   ('&EP' EQ 'RS').GEN5         BRANCH IF RESTORE           04534400
         LM    14,12,12(13)                 .RESTORE USER'S REGISTERS   04538300
.*                                                                      04542200
.GEN5    ANOP                                                           04546100
         MEXIT                                                          04550000
.*                                                                      04600000
.********************************************************************** 04650000
.*       PROCESS ERROR CONDITIONS                                     * 04700000
.********************************************************************** 04750000
.*                                                                      04800000
.*  IHB027 EXCESSIVE POSITIONAL PARAMETERS SPECIFIED.                   04850000
.ERR1    ANOP                                                           04900000
         IHBERMAC 238                                                   04950000
         MEXIT                                                          05000000
.*                                                                      05050000
.*  IHB001 XXX OPERAND REQUIRED, NOT SPECIFIED.                         05100000
.ERR2    ANOP                                                           05150000
         IHBERMAC 1006,&OP1                                             05200000
         MEXIT                                                          05250000
.*                                                                      05300000
.*  IHB002 INVALID XXX OPERAND SPECIFIED - YYY.                         05350000
.ERR3    ANOP                                                           05400000
         IHBERMAC 1001,&OP1,&OP2                                        05450000
         MEXIT                                                          05500000
.*                                                                      05550000
.*  IHB121 REGISTER SPECIFICATION INVALID. GENERATION TERMINATED.       05600000
.ERR4    ANOP                                                           05650000
         IHBERMAC 203                                                   05700000
         MEXIT                                                          05750000
.*                                                                      05768700
.*  IHB280 XXX INVALID WITH YYY.                                        05787400
.ERR5    ANOP                                                           05806100
         IHBERMAC 1020,&OP1,&OP2                                        05824800
         MEND                                                           05843500
* */                                                                    05862200
* % SRBSTAT: MACRO KEYS(STSV,NEWFRR,PRGAT);                             05880900
*                                                                       05900000
*        /* VARIABLE DECLARES */                                        05950000
*        DCL EHAREGS CHAR EXT;         /*REGS DCLD BY EPILOG*/          06000000
*        DCL EHAMAPS CHAR EXT;         /*REG SAVE AREA DCLD BY EPILOG*/ 06050000
*        DCL RC FIXED;                 /*MACRO GEN SEVERITY CODE*/      06200000
*        DCL CMT CHAR;                 /*DO-END COMMENT*/               06225000
*        DCL SAVAL CHAR;               /*STSV ASSIGNMENT VALUE*/        06250000
*        DCL NFVAL CHAR;               /*NEWFRR ASSIGNMENT VALUE*/      06275000
*        DCL ATVAL CHAR;               /*PRGAT ASSIGNMENT VALUE*/       06287400
*                                                                       06300000
*        /* INITIALIZE VARIABLE */                                      06350000
*                                                                       06400000
*        RC=0;                         /*NO MACRO ERROR*/               06450000
*                                                                       06550000
*        IF MACLABEL^='' THEN          /*LABEL ON MACRO CALL?*/         06558300
*          ANS(MACLABEL) COL(MACLMAR); /* YES: GEN LABEL*/              06566600
*        CMT='?'||' '||MACLABEL||' '||MACNAME||' '||MACLIST||           06574900
*                ' '||MACKEYS||' MACDATE(79.296)';                      06579000
*        ANS('DO; '||COMMENT(CMT)) COL(MACCOL);                         06610500
*                                                                       06642000
*        /* NO MORE THAN ONE MACLIST PARAMETERS MAY BE GIVEN */         06673500
*                                                                       06705000
*        IF NUMBER(MACLIST)=0 THEN     /*TYPE SPECIFIED?*/              06736500
*          DO;                         /*NO: ERROR*/                    06768000
*            ANS MSG('AHA0013  ONE POSITIONAL PARAMETER IS '||          06796500
*                'REQUIRED BUT NONE ARE SUPPLIED. NO TEXT IS '||        06825100
*                'GENERATED.');                                         06846500
*            RC=12;                    /*MACRO ERROR*/                  06867900
*            GOTO LHA03000;                                             06900000
*          END;                        /*YES: CONTINUE*/                06950000
*        IF NUMBER(MACLIST)>1 THEN     /*TOO MANY MACLIST ENTRIES? */   07000000
*          DO;                         /*YES: ERROR*/                   07030300
*            ANS MSG('AHA0073  TOO MANY POSITIONAL PARAMETERS '||       07060600
*                'ARE SPECIFIED; ONE IS REQUIRED. NO TEXT IS '||        07090900
*                'GENERATED.');                                         07121400
*            RC=12;                    /*MACRO ERROR*/                  07142800
*            GOTO LHA03000;                                             07164200
*          END;                        /*NO: CONTINUE*/                 07185600
*                                                                       07207000
*        /* TYPE PARAMETER MUST BE SPECIFIED AS 'SAVE',                 07228400
*           'RESTORE', OR 'MODIFY' */                                   07239100
*                                                                       07249800
*        IF MACLIST(1)='' THEN         /*TYPE SUPPLIED?*/               07271200
*          DO;                         /*NO: ERROR*/                    07292600
*            ANS MSG('AHA0013  ''TYPE'' IS REQUIRED BUT IS NOT '||      07314000
*                'SUPPLIED. IT MUST BE ''SAVE'', ''RESTORE'', OR '||    07335400
*                '''MODIFY''. NO TEXT IS GENERATED.');                  07346100
*            RC=12;                    /*MACRO ERROR*/                  07356800
*            GOTO LHA03000;                                             07378200
*          END;                        /*YES: CONTINUE*/                07399600
*        IF MACLIST(1)='MODIFY' THEN   /*MODIFY REQUEST?*/              07421000
*          GOTO LHA00500;              /*YES: GO PROCESS IT*/           07434300
*        IF MACLIST(1)^='SAVE' THEN    /*VALID TYPE SUPPLIED?*/         07447600
*          IF MACLIST(1)^='RESTORE' THEN                                07460900
*            DO;                       /*NO: ERROR*/                    07474200
*              ANS MSG('AHA0043  ''TYPE'' MUST BE ''SAVE'', '||         07487500
*                  '''RESTORE'', OR ''MODIFY''. NO TEXT IS '||          07500800
*                  'GENERATED.');                                       07514100
*              RC=12;                  /*MACRO ERROR*/                  07528000
*              GOTO LHA03000;                                           07550000
*            END;                      /*YES: CONTINUE*/                07600000
*                                                                       07650000
*        /* ENSURE PRGAT PARAMETER IS NOT SPECIFIED */                  07654500
*                                                                       07659000
*        IF NUMBER(PRGAT)^=0  THEN     /*PRGAT GIVEN?*/                 07663500
*          DO;                         /*YES: ERROR*/                   07668000
*            ANS MSG('AHA0023  ''PRGAT'' IS INVALID WITH '''||          07672500
*                MACLIST(1)||'''.  NO TEXT IS GENERATED.');             07677000
*            RC=12;                    /*MACRO ERROR*/                  07681500
*            GOTO LHA03000;                                             07686000
*          END;                        /*NO: CONTINUE*/                 07690500
*                                                                       07695000
*        /* STSV PARAMETER IS REQUIRED */                               07700000
*                                                                       07748000
*        IF NUMBER(STSV)=0 | STSV(1)='' THEN    /*STSV SUPPLIED?*/      07796000
*          DO;                         /*NO: ERROR*/                    07844000
*            ANS MSG('AHA0013  ''STSV'' IS REQUIRED BUT IS NOT '||      07892000
*                'SUPPLIED. NO TEXT IS GENERATED.');                    07940000
*            RC=12;                    /*MACRO ERROR*/                  07980000
*            GOTO LHA03000;                                             08020000
*          END;                        /*YES: CONTINUE*/                08040000
*        IF NUMBER(STSV)>1 | NUMBER(STSV(1))>1 THEN                     08060000
*                                      /*EXCESSIVE VALUES SUPPLIED?*/   08087800
*          DO;                         /*YES: ERROR*/                   08115600
*            ANS MSG('AHA0073  ''STSV'' PARAMETER HAS TOO MANY '||      08143400
*                'SUBPARAMETERS. NO TEXT IS GENERATED.');               08171200
*            RC=12;                    /*MACRO ERROR*/                  08202000
*            GO TO LHA03000;                                            08223000
*          END;                                                         08244000
*        IF STSV(1) = '0' THEN         /* NOT ALLOWED WITH    @ZMB0281*/08246000
*          DO;                         /* TYPE(SAVE) OR       @ZMB0281*/08248000
*            ANS MSG('AHA0023  STSV'|| /* TYPE(RESTORE).      @ZMB0281*/08250000
*                STSV||' IS INVALID '||/* GENERATE AN ERROR   @ZMB0281*/08252000
*                'WITH '||MACLIST(1)|| /* MESSAGE TO INVOKER  @ZMB0281*/08254000
*                '. NO TEXT IS GENERATED. ') NORESCAN;/*      @ZMB0281*/08256000
*            RC=12;                    /* MACRO ERROR         @ZMB0281*/08258000
*            GOTO LHA03000;            /* CONTINUE PROCESSING @ZMB0281*/08260000
*          END;                        /* END STSV ERROR      @ZMB0281*/08262000
*        IF STSV(1,1:1)='(' THEN       /*REGISTER FORMAT?*/             08265000
*          SAVAL=STSV(1,1);            /*YES: ASSIGN "REGISTER"*/       08288700
*        ELSE                          /*NO: ASSIGN ADDR(VALUE)*/       08312400
*          SAVAL='ADDR('||STSV(1)||')';                                 08336100
*                                                                       08360000
*        /* WHEN NEWFRR PARAMETER IS SUPPLIED, MUST BE REGISTER OR      08410000
*           RX-TYPE ADDRESS */                                          08460000
*                                                                       08510000
*        IF NUMBER(NEWFRR)=0 | NEWFRR(1)='' THEN /*NEWFRR SPECIFIED?*/  08810000
*          DO;                         /*NO: INDICATE SO*/              08823000
*            NFVAL='';                 /*INDICATE NO NEWFRR*/           08836000
*            GO TO LHA01000;           /* GO GENERATE CODE*/            08849000
*          END;                        /*YES: CONTINUE*/                08862000
*        IF NUMBER(NEWFRR)>1 | NUMBER(NEWFRR(1))>1 THEN                 08875400
*                                      /*EXCESSIVE VALUES SUPPLIED?*/   08891700
*          DO;                         /*YES: ERROR*/                   08908100
*            ANS MSG('AHA0073  ''NEWFRR'' PARAMETER HAS TOO MANY '||    08947300
*                'SUBPARAMETERS. NO TEXT IS GENERATED.');               08986500
*            RC=12;                    /*MACRO ERROR*/                  09025800
*            GO TO LHA03000;                                            09068300
*          END;                                                         09110800
*        ELSE                          /*NO:         */                 09153300
*          IF NEWFRR(1,1:1)='(' THEN   /*REGISTER FORMAT?*/             09195800
*            NFVAL=NEWFRR(1,1);        /*YES: ASSIGN "REGISTER"*/       09238300
*          ELSE                        /*NO: ASSIGN ADDR(VALUE)*/       09280800
*            NFVAL='ADDR('||NEWFRR(1)||')';                             09323300
*        GOTO LHA01000;                /* GO GENERATE CODE*/            09323800
*                                                                       09324300
*                                                                       09324800
*        /* PROCESS FOR MODIFY REQUEST */                               09325300
*                                                                       09325800
*LHA00500: ;                                                            09326300
*                                                                       09326800
*        /* ENSURE NEWFRR PARAMETER IS NOT SPECIFIED */                 09327300
*                                                                       09327800
*        IF NUMBER(NEWFRR)^=0  THEN    /*NEWFRR GIVEN?*/                09328300
*          DO;                         /*YES: ERROR*/                   09328800
*            ANS MSG('AHA0023  ''NEWFRR'' IS INVALID WITH ''MODIFY'''|| 09329300
*                '.  NO TEXT IS GENERATED.');                           09329800
*            RC=12;                    /*MACRO ERROR*/                  09330300
*            GOTO LHA03000;                                             09330800
*          END;                        /*NO: CONTINUE*/                 09331300
*                                                                       09331800
*        /* STSV PARAMETER IS REQUIRED */                               09332300
*                                                                       09332800
*        IF NUMBER(STSV)=0 | STSV(1)='' THEN    /*STSV SUPPLIED?*/      09333300
*          DO;                         /*NO: ERROR*/                    09333800
*            ANS MSG('AHA0013  ''STSV'' IS REQUIRED BUT IS NOT '||      09334300
*                'SUPPLIED. NO TEXT IS GENERATED.');                    09334800
*            RC=12;                    /*MACRO ERROR*/                  09335300
*            GOTO LHA03000;                                             09335800
*          END;                        /*YES: CONTINUE*/                09336300
*        IF NUMBER(STSV)>1 | NUMBER(STSV(1))>1 THEN                     09336800
*                                      /*EXCESSIVE VALUES SUPPLIED?*/   09337300
*          DO;                         /*YES: ERROR*/                   09337800
*            ANS MSG('AHA0073  ''STSV'' PARAMETER HAS TOO MANY '||      09338300
*                'SUBPARAMETERS. NO TEXT IS GENERATED.');               09338800
*            RC=12;                    /*MACRO ERROR*/                  09339300
*            GO TO LHA03000;                                            09339800
*          END;                                                         09340300
*        IF STSV(1)='0' THEN           /*MODIFY LCCA REQUEST?*/         09340800
*          DO;                         /*YES: INDICATE SO*/             09341300
*            NFVAL='8';                /*INDICATE LCCA MODIFY*/         09341800
*            SAVAL='0';                                                 09342300
*          END;                                                         09342800
*        ELSE                          /*NO: INDICATE STSV MODIFY*/     09343300
*          DO;                                                          09343800
*            NFVAL='4';                /*INDICATE STSV MODIFY*/         09344300
*            IF STSV(1,1:1)='(' THEN /*REGISTER FORMAT?*/               09344800
*              SAVAL=STSV(1,1);        /*YES: ASSIGN "REGISTER"*/       09345300
*            ELSE                      /*NO: ASSIGN ADDR(VALUE)*/       09345800
*              SAVAL='ADDR('||STSV(1)||')';                             09346300
*          END;                                                         09346800
*                                                                       09347800
*        /* PRGAT PARAMETER IS REQUIRED */                              09348300
*                                                                       09348800
*        IF NUMBER(PRGAT)=0 | PRGAT(1)='' THEN /*PRGAT SPECIFIED?*/     09349300
*          DO;                         /*NO: INDICATE SO*/              09349800
*            ANS MSG('AHA0013  ''PRGAT'' IS REQUIRED BUT IS NOT '||     09350300
*                'SUPPLIED.  NO TEXT IS GENERATED.');                   09350800
*            RC=12;                    /*MACRO ERROR*/                  09351300
*            GO TO LHA03000;                                            09351800
*          END;                        /*YES: CONTINUE*/                09352300
*        IF NUMBER(PRGAT)>1 | NUMBER(PRGAT(1))>1 THEN                   09352800
*                                      /*EXCESSIVE VALUES SUPPLIED?*/   09353300
*          DO;                         /*YES: ERROR*/                   09353800
*            ANS MSG('AHA0073  ''PRGAT'' PARAMETER HAS TOO MANY '||     09354300
*                'SUBPARAMETERS. NO TEXT IS GENERATED.');               09354800
*            RC=12;                    /*MACRO ERROR*/                  09355300
*            GO TO LHA03000;                                            09355800
*          END;                                                         09356300
*        IF PRGAT(1,1:1)='(' THEN      /*REGISTER FORMAT?*/             09356800
*          ATVAL=PRGAT(1,1);           /*YES: ASSIGN "REGISTER"*/       09359000
*        ELSE                          /*NO: ASSIGN ADDR(VALUE)*/       09361200
*          ATVAL='ADDR('||PRGAT(1)||')';                                09363400
*                                                                       09365900
*                                                                       09400000
*        /* GENERATE INTERFACE CODE */                                  09450000
*                                                                       09500000
* LHA01000: ;                                                           09550000
*                                                                       10450000
*        IF MACLIST(1)='MODIFY' THEN       /*MODIFY REQUEST?*/          10500000
*                                          /*YES: GEN MODIFY RFY*/      10511500
*          ANS('RESPECIFY (GPR00F,GPR01F,GPR02P,GPR12F,GPR13P,GPR14P'|| 10529000
*              ',GPR15P) RESTRICTED;') COL(MACCOL+2);                   10546500
*        ELSE                              /*NO: GEN RFY*/              10564000
*          ANS('RESPECIFY (GPR00F,GPR01F,GPR12F,GPR13P,GPR14P,GPR15P) ' 10581500
*              ||'RESTRICTED;') COL(MACCOL+2);                          10599000
*                                                                       10616500
*        IF MACLIST(1)^='RESTORE' THEN      /* SRB SAVE OPTION ? */     10634000
*          ANS('STM(GPR14P,GPR12F,SA@G1412);  /* SAVE USERS REGS */')   10651500
*            COL(MACCOL+2);                                             10669000
*                                                                       10686500
*        IF NFVAL='' THEN                                               10704000
*          ANS('GPR00F=0; /* INDICATE NO NEWFRR SPECIFIED */')          10721500
*            COL(MACCOL+2);                                             10739000
*        ELSE                                                           10756500
*          ANS('GPR00F='||NFVAL||'; /* ADDR OF NEWFRR */')              10774000
*            COL(MACCOL+2);                                             10791500
*                                                                       10809000
*        ANS('GPR01F='||SAVAL||'; /* ADDR OF STATUS SAVE AREA */')      10826500
*          COL(MACCOL+2);                                               10844000
*                                                                       10861500
*        IF MACLIST(1)='MODIFY' THEN   /*MODIFY REQUEST?*/              10879000
*          DO;                         /*YES: GEN CALL TO ROUTINE*/     10896500
*            ANS('GPR02P='||ATVAL||';  /* ADDRESS OF ASID/TCB AREA */') 10914000
*              COL(MACCOL+2);                                           10931500
*            ANS('GPR15P=SVTSRBMD; /* GET SRBSTAT MODIFY EP ADDR */')   10949000
*              COL(MACCOL+2);                                           10966500
*            ANS('GEN SETS(GPR14P) REFS(GPR15P) (BALR  GPR14P,'||       10984000
*              'GPR15P); /* CALL SRBSTAT MODIFY EP */') COL(MACCOL+2);  11001500
*            ANS('LM(GPR14P,GPR12F,SA@G1412); /* RESTORE USERS'||       11019000
*              ' REGS */') COL(MACCOL+2);                               11036500
*            ANS('RESPECIFY (GPR00F,GPR01F,GPR02P,GPR12F,GPR13P,'||     11054000
*                 'GPR14P,GPR15P) UNRESTRICTED;') COL(MACCOL+2);        11071500
*            GOTO LHA02000;            /*CONTINUE PROCESSING*/          11090300
*          END;                                                         11093400
*                                                                       11096500
*        IF MACLIST(1)='SAVE' THEN     /* SRB SAVE OPTION ? */          11100000
*          DO;                         /* YES: CALL IEAVESTS */         11150000
*            ANS('GPR15P=SVTSRBSV; /* GET SRBSTAT SAVE EP ADDR */')     11200000
*              COL(MACCOL+2);                             /* @ZMB0039*/ 11225000
*            ANS('GEN SETS(GPR14P) REFS(GPR15P) (BALR  GPR14P,'||       11275000
*              'GPR15P); /* CALL SRBSTAT SAVE EP */') COL(MACCOL+2);    11325000
*            ANS('LM(GPR14P,GPR12F,SA@G1412); /* RESTORE USERS'||       11375000
*              ' REGS */') COL(MACCOL+2);                               11425000
*          END;                                                         11650000
*        ELSE                          /*NO: MUST BE RESTORE OPTION*/   11700000
*          DO;                         /*CALL IEAVESTR*/                11750000
*            ANS('GPR15P=SVTSRBRS; /* GET SRBSTAT RESTORE EP ADDR */')  11800000
*              COL(MACCOL+2);                             /* @ZMB0039*/ 11850000
*            ANS('GEN SETS(GPR14P) REFS(GPR15P) (BALR  GPR14P,'||       11900000
*              'GPR15P); /* CALL SRBSTAT RESTORE EP */') COL(MACCOL+2); 11950000
*          END;                                                         12000000
*                                                                       12050000
*        ANS('RESPECIFY (GPR00F,GPR01F,GPR12F,GPR13P,GPR14P,GPR15P) '   12100000
*             ||'UNRESTRICTED;') COL(MACCOL+2);           /* @ZMB0039*/ 12150000
*                                                                       12200000
*                                                                       12350000
*        /* REQUEST GLOBAL VARIABLE DECLARES FROM EPILOG */             12400000
*                                                                       12450000
*LHA02000: ;                                                            12466600
*                                                                       12483200
*        IF INDEX(EHAREGS,'00F')=0 THEN /*DCL FOR R0 REQUESTED?*/       12500000
*          EHAREGS=EHAREGS||'00F';     /* NO: REQUEST IT*/              12550000
*        IF INDEX(EHAREGS,'01F')=0 THEN /*DCL FOR R1 REQUESTED?*/       12600000
*          EHAREGS=EHAREGS||'01F';     /* NO: REQUEST IT*/              12650000
*        IF MACLIST(1)='MODIFY' & INDEX(EHAREGS,'02P')=0 THEN           12662400
*                                      /*DCL FOR R2 REQUESTED?*/        12674900
*          EHAREGS=EHAREGS||'02P';     /* NO: REQUEST IT*/              12687400
*        IF INDEX(EHAREGS,'12F')=0 THEN /*DCL FOR R12 REQUESTED?*/      12699900
*          EHAREGS=EHAREGS||'12F';     /* NO: REQUEST IT*/              12749800
*        IF INDEX(EHAREGS,'13P')=0 THEN /*DCL FOR R13 REQUESTED?*/      12800000
*          EHAREGS=EHAREGS||'13P';     /* NO: REQUEST IT*/              12850000
*        IF INDEX(EHAREGS,'14P')=0 THEN /*DCL FOR R14 REQUESTED?*/      12900000
*          EHAREGS=EHAREGS||'14P';     /* NO: REQUEST IT*/              12950000
*        IF INDEX(EHAREGS,'15P')=0 THEN /*DCL FOR R15                   13000000
*                                               REQUESTED?   @ZMB0118*/ 13033300
*          EHAREGS=EHAREGS||'15P';     /* NO: REQUEST IT     @ZMB0039*/ 13066600
*                                                                       13100000
*        IF INDEX(EHAMAPS,'SA@')=0 THEN /*SAVE AREA DCL REQUESTED?*/    13150000
*          EHAMAPS=EHAMAPS||'SA@,';    /* NO: REQUEST IT*/              13200000
*                                                                       13250000
*LHA03000: ;                                                            13300000
*                                                                       13350000
*        ANS('END; '||COMMENT('SRBSTAT END')) COL(MACCOL);              13400000
*        RETURN CODE(RC);              /*MACRO END*/                    13450000
*%       END SRBSTAT;                                                   13500000
