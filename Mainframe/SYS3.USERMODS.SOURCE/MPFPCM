MPFPCM   TITLE '-----  Route Messages for PC Console  -----'            00001000
MPFPCM   CSECT                                                          00002000
MPFPCM   RMODE ANY                                                      00003000
MPFPCM   AMODE 31                                                       00004000
                                                                        00005000
*---------------------------------------------------------------------* 00006000
*                                                                     * 00007000
*   Program name:  MPFPCM                                             * 00008000
*                                                                     * 00009000
*   Purpose:       MCS WTO/WTP exit to route ABEND messages to PC     * 00010000
*                  console by adding route codes 14 and 15.           * 00011000
*                                                                     * 00012000
*   Author:        Mark C. Lawrence                                   * 00013000
*                                                                     * 00014000
*   Attributes:    RENT                                               * 00015000
*                                                                     * 00016000
*   Note:          This exit must be specified in MPFLSTxx for the    * 00017000
*                  message ids to be modified:                        * 00018000
*                                                                     * 00019000
*        IEF251I    JOB CANCELLED                                     * 00020000
*        IEF378I    JOB FAILED-CATDISPERR                             * 00021000
*        IEF450I    ABEND                                             * 00022000
*        IEF452I    JOB NOT RUN-JCL ERROR                             * 00023000
*        IEF453I    JOB FAILED-JCL ERROR                              * 00024000
*        IEC130I    DD STATEMENT MISSING                              * 00025000
*                                                                     * 00026000
*   Installation:  Stanford University                                * 00027000
*                                                                     * 00028000
*   Updates:                                                          * 00029000
*   1999/05/03  MCL - Written, using WTOXMS and code in HASPSSMX as   * 00030000
*                             a base.                                 * 00031000
*                                                                     * 00032000
*---------------------------------------------------------------------* 00033000
         REGISTER                                                       00034000
         EJECT                                                          00035000
         ENTER BASE=12,SAVE=0                                           00036000
         L     R10,0(,R1)          parm                                 00037000
         USING CTXT,R10                                                 00038000
         ICM   R9,B'1111',CTXTTXPJ      assume major                    00039000
         BZ    LEAVE                                                    00040000
         USING CTXTATTR,R9                                              00041000
         L     R8,CTXTIWKP         -> 8-byte data area                  00042000
         USING WORKD,R8               is our dynamic storage            00043000
                                                                        00044000
         HSPSRV  JOBCLASS               obtain job acct and class       00045000
         STM   R0,R1,ACCTNUM            save...                         00046000
         CLI   JOBCLASS,C'P'       Class=P                              00047000
         BE    PROCESS             OK, do it                            00048000
         CLI   JOBCLASS,C'X'       or X                                 00049000
         BE    PROCESS                                                  00050000
         CLC   ACCTGG,=C'GP'       or group code GP                     00051000
*-       CLC   ACCTGG,=C'GZ'       **debug** GZ                         00052000
         BNE   LEAVE               none of above, forget it             00053000
                                                                        00054000
PROCESS  OI    CTXTRFB1,CTXTRCMT        indicate we changed msg text    00055000
         L     R7,CTXTRCP          -> Route Codes                       00056000
         USING CTXTROUT,R7                                              00057000
         OI    CTXTR002,CTXTR14+CTXTR15  set codes 14,15                00058000
         OI    CTXTRFLG,CTXTRCRC   show codes changed                   00059000
         B     LEAVE                                                    00059500
         QSNAP CTXTROUT,16         DEBUG**                              00060000
                                                                        00061000
LEAVE    XC    WORKD0,WORKD0       clear work area                      00062000
         EXIT  RC=0                                                     00063000
         SPACE 3                                                        00064000
         LTORG ,                                                        00065000
                                                                        00066000
         EJECT ,                                                        00067000
WORKD    DSECT ,                   our dynamic area (8 bytes only!)     00068000
WORKD0   DS    0D                                                       00069000
ACCTNUM  DS    CL7                 HASPSERV JOBCLASS returns 8 byte     00070000
ACCTUUU  EQU   ACCTNUM+0,3,C'C'    UUU part of acct                     00071000
ACCTGG   EQU   ACCTNUM+3,2,C'C'    GG part of acct                      00072000
JOBCLASS DS    CL1                 job class is low byte of 8           00073000
                                                                        00074000
         EJECT                                                          00075000
         IEZVX100                                                       00076000
         END                                                            00077000
