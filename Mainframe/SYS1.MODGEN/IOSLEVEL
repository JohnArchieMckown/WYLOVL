* %/*                                                                   00050000
         MACRO                                                          00100000
&NAME    IOSLEVEL &TYPE,&LEVEL=NORMAL,&REDRIVE=,&UCB=,&RELATED=         00150000
         LCLC  &LEV                                                     00200000
         LCLC  &TYP                                                     00250000
         LCLC  &RDRV                                                    00300000
         LCLC  &S                                                       00350000
&S       SETC  '&SYSNDX'                                                00400000
&RDRV    SETC  '0'                                                      00450000
.*********************************************************************  00500000
.*01* MODULE NAME  =  IOSLEVEL                                       *  00550000
.*                                                                   *  00600000
.*01* DESCRIPTIVE NAME = LEVEL - IOS LEVEL Service                   *  00650000
.*                                                                   *  00700000
.*01* MACRO CALL                                                     *  00750000
.*                                                                   *  00800000
.*   ASSEMBLER-H -                                                   *  00850000
.*    LABEL IOSLEVEL OPTION,LEVEL=x,REDRIVE=x,RELATED=x,UCB=(Reg)    *  00900000
.*                                       or UCB=Label                *  00950000
.*   PLS3  -                                                         *  01000000
.*    ?LABEL: IOSLEVEL (option) LEVEL(x) REDRIVE(x) RELATED(x)       *  01050000
.*            UCB(variable name)                                     *  01100000
.*                                                                   *  01150000
.*                                                                   *  01200000
.*01* COPYRIGHT =                                                    *  01250000
.*     5655-068                                                  @L3C*  01300000
.*     THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                   *  01350000
.*     (C) COPYRIGHT IBM CORP. 1981, 1994                        @L3C*  01400000
.*     LICENSED MATERIALS - PROPERTY OF IBM                          *  01450000
.*                                                                   *  01500000
.*01* STATUS = HBB5520                                           @L3C*  01550000
.*                                                                   *  01600000
.*01*  FUNCTION  =                                                   *  01650000
.*                                                                   *  01700000
.*  OPTION-                                                          *  01750000
.*                                                                   *  01800000
.*                                                                   *  01850000
.*       GET  - This option requests the UCB level that is           *  01900000
.*              presently active.  Normally this IOSLEVEL value is   *  01950000
.*              is used in the IOSB.                                 *  02000000
.*                                                                   *  02050000
.*       TEST - This option is used to determine if the              *  02100000
.*              corresponding bit in the UCBLVMSK for the        @L3C*  02150000
.*              requested level is already set.                      *  02200000
.*              This option returns the level value in               *  02233300
.*              register 0.                                      @L3C*  02266600
.*              Normally this function is used to obtain a           *  02300000
.*              particular IOSLEVEL for storing in the IOSB.         *  02350000
.*                                                                   *  02400000
.*       SET  - This option sets the appropriate level in the UCB    *  02450000
.*              and returns the IOSLEVEL value to the caller in      *  02500000
.*              register 0.                                      @L3C*  02550000
.*              Normally this function is used to obtain a           *  02600000
.*              particular IOSLEVEL for storing in the IOSB.         *  02650000
.*                                                                   *  02700000
.*      RESET - This option will reset the requested IOSLEVEL in     *  02750000
.*              the UCBLEVEL (if applicable) and reset the           *  02800000
.*              corresponding bit in the UCBLVLMSK.              @L3C*  02850000
.*              If the requested IOSLEVEL is reset in the UCBLEVEL   *  02900000
.*              field, then the UCBLEVEL field is set to the next    *  02950000
.*              highest IOSLEVEL as indicated in the UCBLVLMSK.      *  03000000
.*                                                                   *  03050000
.*  LEVEL -                                                          *  03100000
.*                                                                   *  03150000
.*       Specifies the keyword identifying the function which        *  03200000
.*       requires a UCB level.                                       *  03250000
.*       Normal and quiesce IOS levels are the only keywords which   *  03300000
.*       are intended for NON-IOS driver usage.                      *  03350000
.*       All other level keywords are assigned for use by a          *  03400000
.*       particular IOS function (normally for serializing recovery  *  03450000
.*       functions).                                                 *  03500000
.*                                                                   *  03550000
.*      If the LEVEL parameter is not supplied, the LEVEL            *  03600000
.*      defaults to NORMAL.                                      @L3C*  03650000
.*                                                                   *  03700000
.*      The NORMAL level can only be used with the GET OPTION        *  03750000
.*      (and not with the TEST, SET or RESET OPTIONs).               *  03800000
.*                                                                   *  03850000
.*      The presently assigned keywords are as follows:              *  03900000
.*         NORMAL  - Normal level                                    *  03950000
.*         QUIESCE - Quiesce level                                   *  04000000
.*         DAVV    - IOS DASD volume verification processing         *  04050000
.*         DSTF    - IOS Device State Transition flushing            *  04100000
.*         SELFDESC- IOS Self Description processing             @04A*  04150000
.*         IOPM    - IOS path I/O processing                         *  04200000
.*         DDR     - DDR processing                                  *  04250000
.*         DYNPATH - IOS Dynamic pathing processing                  *  04300000
.*         DPSVAL  - IOS Dynamic pathing validation processing   @01A*  04350000
.*         RSTEVENT- IOS Reset Event Notification                @03A*  04400000
.*         UNCRSV  - IOS Unconditional processing                    *  04450000
.*         CHPRCVY - IOS Channel Path Recovery processing            *  04500000
.*         FDEVAL  - IOS Force Device Alias processing           @L3A*  04525000
.*         FDEV    - IOS Force Device processing                     *  04550000
.*         SCHRCVY - IOS Subchannel Recovery processing              *  04600000
.*                                                                   *  04650000
.*  REDRIVE-                                                         *  04700000
.*                                                                   *  04750000
.*      This parameter is valid only with the RESET option.          *  04800000
.*                                                                   *  04850000
.*      If YES is specified (or the parameter omitted, the default   *  04900000
.*      value), a subchannel redrive will be done after resetting    *  04950000
.*      the requested LEVEL value in the UCBLEVEL field.             *  05000000
.*                                                                   *  05050000
.*      If NO is specified, then noredrive will be performed.        *  05100000
.*      The user must invoke the IOS subchannel redrive function     *  05150000
.*      to ensure that queued I/O requests are redriven.             *  05200000
.*      NOTE: The 'NO' option should only be used by IOS or by       *  05250000
.*            IOS drivers who must SET or RESET the level out of     *  05300000
.*            their DIE routine.  'YES' should be used in all        *  05350000
.*            other cases.                                           *  05400000
.*                                                                   *  05450000
.*                                                                   *  05500000
.*  RELATED-                                                         *  05550000
.*                                                                   *  05600000
.*      Required for the SET or RESET option requests.               *  05650000
.*      Optional for the GET and TEST option requests.               *  05700000
.*                                                                   *  05750000
.*  LABEL-                                                           *  05800000
.*                                                                   *  05850000
.*      Optional                                                     *  05900000
.*                                                                   *  05950000
.*  UCB-  REGISTER or LABEL                                          *  06000000
.*                                                                   *  06050000
.*      Contains the UCB common segment address of the base UCB  @L3C*  06100000
.*      to be updated or tested.                                     *  06150000
.*                                                                   *  06162500
.*      Contains the UCB common segment address of the alias UCB @L3A*  06175000
.*      to be updated or tested when FDEVAL is specified.        @L3A*  06187500
.*                                                                   *  06200000
.*      Required for TEST, SET or RESET option requests.             *  06250000
.*                                                                   *  06300000
.*      An error will occur if the UCB parameter is specified with   *  06350000
.*      the GET option request.                                      *  06400000
.*                                                                   *  06450000
.*01* INPUT-                                                         *  06500000
.*                                                                   *  06550000
.*      Callers requesting the SET or RESET options must be in       *  06600000
.*      Supervisor state, key 0.                                     *  06650000
.*                                                                   *  06700000
.*      THE IOSLEVEL service module runs in callers addressing mode. *  06750000
.*                                                                   *  06800000
.*      Register 13 must point to an 18 word save area.              *  06850000
.*                                                                   *  06900000
.*      Registers 2 - 13 will be maintained across the interface.    *  06950000
.*                                                                   *  07000000
.*01* OUTPUT-                                                        *  07050000
.*                                                                   *  07100000
.*      Register  0 - Contains the level number if GET, TEST or      *  07150000
.*                    set option requested.                          *  07200000
.*                                                                   *  07250000
.*      Registers 2 - 13 are maintained across the interface.        *  07300000
.*                                                                   *  07350000
.*      Register 14 - Contains the entry point address to the        *  07400000
.*                    IOS service module IOSVLEVL.                   *  07450000
.*                                                                   *  07500000
.*      Register 15 - Return code from IOSLEVL.                      *  07550000
.*                    Meaning depends on the function specified,     *  07600000
.*                    as follows:                                    *  07650000
.*                                                                   *  07700000
.*                    GET                                            *  07750000
.*                         00 - Return code always 0                 *  07800000
.*                                                                   *  07850000
.*                    TEST                                           *  07900000
.*                         00 - Indicated level bit is not ON in UCB *  07950000
.*                         04 - Indicated level bit is ON in the UCB *  08000000
.*                                                                   *  08050000
.*                    SET                                            *  08100000
.*                         00 - Indicated level bit was set ON in    *  08150000
.*                              the UCB. A SET has been done.        *  08200000
.*                         04 - Indicated level bit was already set  *  08250000
.*                              in the UCB. A SET has not been done. *  08300000
.*                                                                   *  08350000
.*                    RESET                                          *  08400000
.*                         00 - Indicated level bit was on in the    *  08450000
.*                              UCB. The respecitve bit has been     *  08500000
.*                              reset.                               *  08550000
.*                         04 - Indicated level bit was not on in    *  08600000
.*                              the UCB, therefore the bit could     *  08650000
.*                              not be reset.                        *  08700000
.*                                                                   *  08750000
.*01* DEPENDENCIES -  None                                           *  08800000
.*                                                                   *  08850000
.*01* ATTRIBUTES   -  This macro expands as re-entrant code.         *  08900000
.*                                                                   *  08950000
.*01* RESTRICTIONS -  No locks may be held which preclude obtaining  *  09000000
.*                    the UCB lock. The UCB lock, if held, will      *  09050000
.*                    not be released.                               *  09100000
.*                                                                   *  09150000
.*                    Users of LEVEL=QUIESCE must be aware that      *  09200000
.*                    there is no serialization against other        *  09250000
.*                    users of the quiesce level.                    *  09300000
.*                                                                   *  09350000
.*                    FDEVAL level should only be used for an        *  09362500
.*                    alias UCB.                                 @L3A*  09375000
.*                                                                   *  09387500
.*01* MODULE TYPE  -  MACRO                                          *  09400000
.*                                                                   *  09450000
.*01* PROCESSOR    -  ASSEMBLER-H and PLS3                           *  09500000
.*                                                                   *  09550000
.*01* NOTES                                                          *  09600000
.*         The following macros are required:                        *  09650000
.*                CVT  DSECT=YES                                     *  09700000
.*                IECDIOCM                                           *  09750000
.*                IHAPSA (necessary only in PLS)                     *  09800000
.*                EPILOG (necessary only in PLS)                     *  09850000
.*                                                                   *  09900000
.*                                                                   *  09950000
.*         Registers 2 - 13 will be maintained across the        @L3C*  10000000
.*         interface.                                                *  10050000
.*                                                                   *  10100000
.*         Runs in caller's addressing mode.                         *  10150000
.*                                                                   *  10200000
.*01* EXTERNAL CLASSIFICATION: NONE                              @L3A*  10210000
.*                                                               @L3A*  10220000
.*01* END OF EXTERNAL CLASSIFICATION:                            @L3A*  10230000
.*                                                                   *  10240000
.*01* CHANGE ACTIVITY =                                              *  10250000
.*                                                                   *  10300000
.*  $MAC(IOSLEVEL),COMP(SC1C3): IOSLEVEL MACRO                       *  10350000
.*                                                                   *  10400000
.*  $L0=IOREWR  HBB2102 810301 PDLE: New macro for IOS MVS/XA rewrite*  10450000
.*  $L1=VERS    HBB3310 860416 PDLE: Versioning macro into product   *  10456200
.*                                                               @L1A*  10462400
.*  $L2=IOREC   JBB4422 900928 PDLH: IOREC Support               @L2A*  10468600
.*  $L3=PAVS    HBB5520 940602 PDLS: Parallel access volume          *  10474800
.*                                   support. Add new level FDEVAL   *  10481000
.*                                   for force device alias          *  10487200
.*                                   processing                  @L3A*  10493400
.*                                                                   *  10500000
.*  $01=OZ79979 JBB2110 840901 PDLE: Provide a dynamic pathing       *  10550000
.*                                   validation level                *  10600000
.*  $02=OZ98009 JBB2125 860801 PDLG: Provide a device state          *  10650000
.*                                   transition flushing level       *  10700000
.*  $03=OY09623 HBB3310 871101 PDLE: Reset event support         @03A*  10750000
.*  $04=OY21399 JBB2220 880201 PDLH: CUIR support                @04A*  10800000
.*  $P0=PKI0083 JBB4422 910301 PDLH: Change IOACTION command support *  10912400
.*                                   to set a level one above the    *  10918600
.*                                   QUIESCE level to allow IOS      *  10924800
.*                                   recovery to run for a device    *  10931000
.*                                   with I/O stopped via the        *  10937200
.*                                   IOACTION command.           @P0A*  10943400
.*                                                                   *  10950000
.********************************************************************** 11000000
         AIF   (N'&SYSLIST LT 1).PRMERR1                                11050000
         AIF   (N'&SYSLIST GT 1).PRMERR2                                11100000
.*********************************************************************  11150000
.*     EDIT PARAMETERS AND SET INDICATORS IN REGISTER 0 FOR          *  11200000
.*     REDRIVE, OPTION TYPE AND LEVEL.  REGISTER 0 WILL HAVE THE     *  11250000
.*     FORMAT OF  X'0000RTLV' WHERE R = THE REDRIVE INDICATOR,       *  11300000
.*     T = THE TYPE INDICATOR AND LV = LEVEL INDICATOR.              *  11350000
.*********************************************************************  11400000
.*                                                                      11450000
.*     CHECK TO SEE IF OPTION VALID. IF IT IS, SET TYPE INDICATOR.   *  11500000
         AIF   ('&TYPE' EQ 'GET').GETROUT                               11550000
         AIF   ('&TYPE' EQ 'TEST').TSTROUT                              11600000
         AIF   ('&TYPE' EQ 'SET').SETROUT                               11650000
         AIF   ('&TYPE' EQ 'RESET').RSTROUT                             11700000
         AGO   .TYPERR          ALL OTHER VALUES INVALID                11750000
.GETROUT ANOP                                                           11800000
&TYP     SETC  '1'              TYPE INDICATOR = 1 FOR GET              11850000
         AGO   .CHKLVL                                                  11900000
.TSTROUT ANOP                                                           11950000
&TYP     SETC  '2'              TYPE INDICATOR = 2 FOR TEST             12000000
         AGO   .CHKLVL                                                  12050000
.SETROUT ANOP                                                           12100000
&TYP     SETC  '3'              TYPE INDICATOR = 3 FOR SET              12150000
         AGO   .CHKLVL                                                  12200000
.RSTROUT ANOP                                                           12250000
&TYP     SETC  '4'              TYPE INDICATOR = 4 FOR RESET            12300000
.CHKLVL  ANOP                                                           12350000
.*     CHECK IF LEVEL PARAMETER VALID.  IF IT IS, SET LEVEL INDICATOR.  12400000
         AIF   ('&LEVEL' EQ 'NORMAL').NRMROUT                           12450000
         AIF   ('&LEVEL' EQ 'QUIESCE').QSCROUT                          12500000
         AIF   ('&LEVEL' EQ 'DAVV').DAVROUT                             12550000
         AIF   ('&LEVEL' EQ 'DSTF').DSTROUT                        @02A 12600000
         AIF   ('&LEVEL' EQ 'SELFDESC').SLFDOUT                    @04A 12650000
         AIF   ('&LEVEL' EQ 'IOPM').IOPMROUT                            12700000
         AIF   ('&LEVEL' EQ 'DDR').DDRROUT                              12750000
         AIF   ('&LEVEL' EQ 'DPSVAL').DPSROUT                      @01A 12800000
         AIF   ('&LEVEL' EQ 'DYNPATH').DPROUT                           12850000
         AIF   ('&LEVEL' EQ 'UNCRSV').URSROUT                           12900000
         AIF   ('&LEVEL' EQ 'CHPRCVY').CHPROUT                          12950000
         AIF   ('&LEVEL' EQ 'SCHRCVY').SCHROUT                          13000000
         AIF   ('&LEVEL' EQ 'FDEV').FDVROUT                             13050000
         AIF   ('&LEVEL' EQ 'RSTEVENT').RSETOUT                    @03A 13100000
         AIF   ('&LEVEL' EQ 'IOCMD').IOCMDOUT                      @P0A 13125000
         AIF   ('&LEVEL' EQ 'FDEVAL').FDVALOUT                     @L3A 13137500
         AGO   .LEVERR          ALL OTHER VALUES INVALID                13150000
.NRMROUT ANOP                                                           13200000
         AIF   ('&TYPE' NE 'GET').LEVERR2   NORMAL VALID ONLY WITH GET  13250000
.*                                          OPTION                      13300000
&LEV     SETC  '01'             LEVEL INDICATOR = 01 FOR NORMAL         13350000
         AGO   .CHKRLTD                                                 13400000
.QSCROUT ANOP                                                           13450000
&LEV     SETC  '02'             LEVEL INDICATOR = 02 FOR QUIESCE        13500000
         AGO   .CHKRLTD                                                 13550000
.DAVROUT ANOP                                                           13600000
&LEV     SETC  '03'             LEVEL INDICATOR = 03 FOR DAVV           13650000
         AGO   .CHKRLTD                                                 13700000
.DDRROUT ANOP                                                           13750000
&LEV     SETC  '04'             LEVEL INDICATOR = 04 FOR DDR            13800000
         AGO   .CHKRLTD                                                 13850000
.DPROUT  ANOP                                                           13900000
&LEV     SETC  '05'             LEVEL INDICATOR = 05 FOR DYNAMIC        13950000
.*                              PATHING                                 14000000
         AGO   .CHKRLTD                                                 14050000
.URSROUT ANOP                                                           14100000
&LEV     SETC  '06'             LEVEL INDICATOR = 06 FOR UNCONDITIONAL  14150000
.*                              RESERVE                                 14200000
         AGO   .CHKRLTD                                                 14250000
.CHPROUT ANOP                                                           14300000
&LEV     SETC  '07'             LEVEL INDICATOR = 07 FOR CHANNEL PATH   14350000
.*                              RECOVERY                                14400000
         AGO   .CHKRLTD                                                 14450000
.SCHROUT ANOP                                                           14500000
&LEV     SETC  '08'             LEVEL INDICATOR = 08 FOR SUBCHANNEL     14550000
.*                              RECOVERY                                14600000
         AGO   .CHKRLTD                                                 14650000
.FDVROUT ANOP                                                           14700000
&LEV     SETC  '09'             LEVEL INDICATOR = 09 FOR FORCE DEVICE   14750000
         AGO   .CHKRLTD                                                 14800000
.IOPMROUT ANOP                                                          14850000
&LEV     SETC  '0A'             LEVEL INDICATOR = 10 FOR IOPM  @PCC3189 14900000
         AGO   .CHKRLTD                                            @01A 14950000
.DPSROUT ANOP                                                      @01A 15000000
&LEV     SETC  '0B'             LEVEL INDICATOR = 11 FOR DPSVAL    @01A 15050000
         AGO   .CHKRLTD                                            @02A 15100000
.DSTROUT ANOP                                                      @02A 15150000
&LEV     SETC  '0C'             LEVEL INDICATOR = 12 FOR DSTF      @02A 15200000
         AGO   .CHKRLTD                                            @03A 15250000
.RSETOUT ANOP                                                      @03A 15300000
&LEV     SETC  '0D'             LEVEL INDICATOR = 13 FOR RSTE      @03A 15350000
         AGO   .CHKRLTD                                            @04A 15400000
.SLFDOUT ANOP                                                      @04A 15450000
&LEV     SETC  '0E'             LEVEL INDICATOR = 14 FOR SLFD.     @04A 15500000
         AGO   .CHKRLTD                                            @P0A 15512500
.IOCMDOUT ANOP                                                     @P0A 15525000
&LEV     SETC  '0F'             LEVEL INDICATOR = 15 FOR IOCMD     @P0A 15537500
         AGO   .CHKRLTD                                            @L3A 15540600
.FDVALOUT ANOP                                                     @L3A 15543700
&LEV     SETC  '10'             LEVEL INDICATOR = 16 FOR FDEVAL    @L3A 15546800
.CHKRLTD ANOP                                                           15550000
.*     CHECK RELATED PARAMETER - REQUIRED WITH SET & RESET              15600000
         AIF   ((('&TYPE' EQ 'SET') OR ('&TYPE' EQ 'RESET')) AND       X15650000
                (T'&RELATED EQ 'O')).RLTDERR                            15700000
.CHKRDRV ANOP                                                           15750000
.*     CHECK REDRIVE PARAMETER. REDRIVE PARAMETER IS VALID           *  15800000
.*     ONLY WITH THE RESET OPTION. THE REDRIVE INDICATOR IS          *  15850000
.*     INITIALLY SET TO 0 AT THE START OF THE MACRO AND IS RESET     *  15900000
.*     TO '1' ONLY IF NO REDRIVE IS SPECIFIED.                       *  15950000
         AIF   ((T'&REDRIVE EQ 'O') OR                                 X16000000
                (('&TYPE' EQ 'RESET') AND                              X16050000
                 ('&REDRIVE' EQ 'YES'))).CHKUCB                         16100000
         AIF   ('&TYPE' NE 'RESET').RDVERR1                             16150000
         AIF   ('&REDRIVE' NE 'NO').RDVERR2   INVALID VALUE CODED       16200000
.*                                            FOR REDRIVE PARAMETER     16250000
&RDRV    SETC  '1'                         INDICATE NO REDRIVE          16300000
.CHKUCB  ANOP                                                           16350000
         AIF   ((T'&UCB EQ 'O') AND                                    X16400000
                ('&TYPE' NE 'GET')).UCBERR1   ALL OPTION EXCEPT GET     16450000
.*                                            REQUIRE THE UCB PARAMETER 16500000
         AIF   ((T'&UCB NE 'O') AND                                    X16550000
                ('&TYPE' EQ 'GET')).UCBERR2   UCB INVALID WITH GET      16600000
.*                                                                      16650000
.*    GENERATE ASSEMBLER CODE                                           16700000
.*                                                                      16750000
&NAME    B     *+6                         BRANCH AROUND CONSTANT       16800000
LEVC&S   DC    XL2'&RDRV&TYP&LEV.'                                      16850000
         AIF   ('&TYPE' EQ 'GET').LEV010   NO UCB FOR GET OPTION        16900000
         AIF   ('&UCB' EQ '(1)').LEV010    UCB ADDR ALREADY IN REG1     16950000
         AIF   ('&UCB'(1,1) EQ '(').REG    UCB ADDRESS IN REGISTER      17000000
         L     1,&UCB                      LOAD UCB ADDRESS INTO REG1   17050000
         AGO   .LEV010                                                  17100000
.REG     ANOP                                                           17150000
         LR    1,&UCB(1)                   LOAD UCB ADDRESS INTO REG1   17200000
.LEV010  ANOP                                                           17250000
         SPACE                                                          17300000
         LH    0,LEVC&S                    PUT PARAMETER INDICATORS     17350000
*                                          IN REG 0.                    17400000
         SPACE                                                          17450000
         L     15,CVTPTR(0,0)              GET CVT POINTER              17500000
         L     15,CVTIXAVL-CVTMAP(0,15)    GET IOCOM POINTER            17550000
         L     15,IOCLEVL-IOCOM(0,15)      GET IOSLEVEL ENTRY POINT     17600000
         SPACE                                                          17650000
         BALR 14,15                        BRANCH TO IOS LEVEL ROUTINE  17700000
         MEXIT                                                          17750000
.PRMERR1 MNOTE 8,'*** THE REQUIRED POSITIONAL PARAMETER HAS NOT BEEN SUX17800000
               PPLIED. GET, TEST, SET OR RESET MUST BE SPECIFIED.'      17850000
         MEXIT                                                          17900000
.PRMERR2 MNOTE 8,'*** MORE THAN ONE POSITIONAL PARAMETER HAS BEEN SUPPLX17950000
               IED, ONLY ONE IS ALLOWED.'                               18000000
         MEXIT                                                          18050000
.TYPERR  MNOTE 8,'*** &TYPE IS AN INVALID OPTION. THE ONLY VALID VALUESX18100000
                ARE: GET, TEST, SET OR RESET.'                          18150000
         MEXIT                                                          18200000
.RDVERR1 MNOTE 8,'*** REDRIVE PARAMETER INVALID ON &TYPE OPTION.'       18250000
         MEXIT                                                          18300000
.RDVERR2 MNOTE 8,'*** REDRIVE=&REDRIVE INVALID. VALID VALUES ARE YES ORX18350000
                NO.'                                                    18400000
         MEXIT                                                          18450000
.RLTDERR MNOTE 8,'*** RELATED PARAMETER REQUIRED ON &TYPE OPTION.'      18500000
         MEXIT                                                          18550000
.LEVERR  MNOTE 8,'*** LEVEL=&LEVEL INVALID.'                            18600000
         MEXIT                                                          18650000
.LEVERR2 MNOTE 8,'*** LEVEL=&LEVEL VALID ONLY ON GET OPTION. &TYPE OPTIX18700000
               ON HAS BEEN SPECIFIED.'                                  18750000
         MEXIT                                                          18800000
.UCBERR1 MNOTE 8,'*** UCB PARAMETER REQUIRED BUT NOT SUPPLIED WITH &TYPX18850000
               E OPTION.'                                               18900000
         MEXIT                                                          18950000
.UCBERR2 MNOTE 8,'*** UCB PARAMETER INVALID ON GET OPTION.'             19000000
         MEND                                                           19050000
                                                                */      19100000
 IOSLEVEL:                                                              19150000
   MACRO                                                                19200000
   KEYS(LEVEL,REDRIVE,UCB,RELATED);                                     19250000
   /*  EXTERNAL VARIABLES                                        */     19300000
   DCL  EHAREGS  CHAR   EXT;       /* REGS TO BE DCLD BY EPILOG  */     19350000
   /*  INTERNAL VARIABLES                                        */     19400000
   DCL  INDENT   FIXED;            /* INDENT  TWO COLUMNS        */     19450000
   DCL  IMACRO   CHAR;             /* MACRO PARAMETERS           */     19500000
   DCL  IRDRV    CHAR;             /* REDRIVE INDICATOR          */     19550000
   DCL  ILEV     CHAR;             /* LEVEL INDICATOR            */     19600000
   DCL  ITYP     CHAR;             /* TYPE INDICATOR             */     19650000
   DCL  IRFY     CHAR;             /* USED TO RESPECIFY REG1 IF         19700000
                                      NECESSARY                  */     19750000
   DCL  IERRLVL  FIXED;            /* RETURN CODE IF ERRORS      */     19800000
   DCL  IERRMSG  CHAR;             /* ERROR MESSAGE PRINTED      */     19850000
   IMACRO=' ?'||MACLABEL||MACNAME||MACLIST||' '||MACKEYS||' ';          19900000
   INDENT=MACCOL+2;                                                     19950000
   IRDRV='0';                                                           20000000
   IERRLVL=0;                                                           20050000
   IF MACLABEL~='' THEN              /* GENERATE MACLABEL        */     20100000
      ANS(MACLABEL)  COL(MACLMAR);                                      20150000
   ANS('DO; '|| COMMENT(IMACRO)) COL(MACCOL); /* START CODE & LIST      20200000
                                                 MACRO PARAMETERS*/     20250000
   IF NUMBER(MACLIST) < 1 THEN                                          20300000
     DO;                                                                20350000
       IERRLVL = 8;                                                     20400000
       IERRMSG = 'THE REQUIRED POSITIONAL PARAMETER HAS NOT BEEN SUPPLIE20450000
 D. GET, TEST, SET OR RESET MUST BE SPECIFIED.';                        20500000
       ANS MSG(IERRMSG);                                                20550000
       ANS (COMMENT(IERRMSG)) COL(INDENT);                              20600000
       GOTO CHKLVL;                                                     20650000
     END;                                                               20700000
   IF NUMBER(MACLIST) > 1 THEN                                          20750000
     DO;                                                                20800000
       IERRLVL = 8;                                                     20850000
       IERRMSG = 'MORE THAN ONE POSITIONAL PARAMETER HAS BEEN SUPPLIED, 20900000
  ONLY ONE IS ALLOWED.';                                                20950000
       ANS MSG(IERRMSG);                                                21000000
       ANS (COMMENT(IERRMSG)) COL(INDENT);                              21050000
     END;                                                               21100000
   /**************************************************************/     21150000
   /*  EDIT PARAMETERS AND SET INDICATORS IN REGISTER 0 FOR      */     21200000
   /*  REDRIVE, OPTION TYPE AND LEVEL.  REGISTER 0 WILL HAVE THE */     21250000
   /*  FORMAT OF  '0000RTLV'X WHERE R = THE REDRIVE INDICATOR,   */     21300000
   /*  T = THE TYPE INDICATOR AND LV = LEVEL INDICATOR.          */     21350000
   /**************************************************************/     21400000
   /*                                                            */     21450000
   /*  CHECK TO SEE IF OPTION VALID. IF IT IS, SET TYPE INDICATOR*/     21500000
   /*                                                            */     21550000
   IF MACLIST(1)='GET' THEN                                             21600000
        ITYP='1';                  /* TYPE INDICATOR = 1 FOR GET */     21650000
   ELSE                                                                 21700000
      IF MACLIST(1)='TEST' THEN                                         21750000
        ITYP='2';                  /* TYPE INDICATOR = 2 FOR TEST */    21800000
      ELSE                                                              21850000
        IF MACLIST(1)='SET' THEN                                        21900000
           ITYP='3';               /* TYPE INDICATOR = 3 FOR SET  */    21950000
        ELSE                                                            22000000
          IF MACLIST(1)='RESET' THEN                                    22050000
             ITYP='4';             /* TYPE INDICATOR = 4 FOR RESET*/    22100000
          ELSE                                                          22150000
            DO;                    /* ALL OTHER VALUES INVALID   */     22200000
              IERRLVL=8;                                                22250000
              IERRMSG=MACLIST(1)||                                      22300000
                 ' IS AN INVALID OPTION.THE ONLY VALID VALUES ARE: GET, 22350000
  TEST, SET OR RESET.';                                                 22400000
              ANS MSG(IERRMSG);                                         22450000
              ANS(COMMENT(IERRMSG))        COL(INDENT);                 22500000
            END;                                                        22550000
 CHKLVL:                                                                22600000
   /*  CHECK IF LEVEL PARAMETER VALID.  IF IT IS SET LEVEL INDICATOR.*/ 22650000
   IF LEVEL=''  |                                                       22700000
      LEVEL(1)='NORMAL' THEN                                            22750000
      GOTO NRMROUT;                                                     22800000
   IF LEVEL(1)='QUIESCE'  THEN                                          22850000
      DO;                                                               22900000
        ILEV='02';                 /* LEVEL INDICATOR = 02 FOR          22950000
                                      QUIESCE                        */ 23000000
        GOTO CHKRLTD;                                                   23050000
      END;                                                              23100000
   IF LEVEL(1)='DAVV'  THEN                                             23150000
      DO;                                                               23200000
        ILEV='03';                 /* LEVEL INDICATOR = 03 FOR DAVV  */ 23250000
        GOTO CHKRLTD;                                                   23300000
      END;                                                              23350000
   IF LEVEL(1)='DDR'  THEN                                              23400000
      DO;                                                               23450000
        ILEV='04';                 /* LEVEL INDICATOR = 04 FOR DDR   */ 23500000
        GOTO CHKRLTD;                                                   23550000
      END;                                                              23600000
   IF LEVEL(1)='DYNPATH'  THEN                                          23650000
      DO;                                                               23700000
        ILEV='05';                 /* LEVEL INDICATOR = 05 FOR          23750000
                                      DYNPATH                        */ 23800000
        GOTO CHKRLTD;                                                   23850000
      END;                                                              23900000
   IF LEVEL(1)='UNCRSV'  THEN                                           23950000
      DO;                                                               24000000
        ILEV='06';                 /* LEVEL INDICATOR = 06 FOR UNCRSV*/ 24050000
        GOTO CHKRLTD;                                                   24100000
      END;                                                              24150000
   IF LEVEL(1)='CHPRCVY'  THEN                                          24200000
      DO;                                                               24250000
        ILEV='07';                 /* LEVEL INDICATOR = 07 FOR          24300000
                                      CHPRCVY                        */ 24350000
        GOTO CHKRLTD;                                                   24400000
      END;                                                              24450000
   IF LEVEL(1)='SCHRCVY'  THEN                                          24500000
      DO;                                                               24550000
        ILEV='08';                 /* LEVEL INDICATOR = 08 FOR          24600000
                                      SCHRCVY                        */ 24650000
        GOTO CHKRLTD;                                                   24700000
      END;                                                              24750000
   IF LEVEL(1)='FDEV'  THEN                                             24800000
      DO;                                                               24850000
        ILEV='09';                 /* LEVEL INDICATOR = 09 FOR          24900000
                                      FORCE DEVICE                   */ 24950000
        GOTO CHKRLTD;                                                   25000000
      END;                                                              25050000
   IF LEVEL(1)='IOPM'  THEN                                             25100000
      DO;                                                               25150000
        ILEV='0A';                 /* LEVEL INDICATOR = 10 FOR          25200000
                                      IOPM                   @PCC3189*/ 25250000
        GOTO CHKRLTD;                                                   25300000
      END;                                                              25350000
   IF LEVEL(1)='DPSVAL'  THEN                                           25400000
      DO;                          /*                            @01A*/ 25450000
        ILEV='0B';                 /* LEVEL INDICATOR = 11 FOR          25500000
                                      DPS VALIDATION             @01A*/ 25550000
        GOTO CHKRLTD;              /*                            @01A*/ 25600000
      END;                                                              25650000
   IF LEVEL(1)='DSTF' THEN         /*                            @02A*/ 25700000
      DO;                          /*                            @02A*/ 25750000
        ILEV='0C';                 /* LEVEL INDICATOR = 12 FOR          25800000
                                      DSTF                       @02A*/ 25850000
        GOTO CHKRLTD;              /*                            @02A*/ 25900000
      END;                         /*                            @02A*/ 25950000
   IF LEVEL(1)='RSTEVENT'  THEN    /*                            @03A*/ 26000000
      DO;                          /*                            @03A*/ 26050000
        ILEV='0D';                 /* LEVEL INDICATOR = 13 FOR          26100000
                                      RESET EVENT.               @03A*/ 26150000
        GOTO CHKRLTD;              /*                            @03A*/ 26200000
      END;                         /*                            @03A*/ 26250000
   IF LEVEL(1)='SELFDESC'  THEN    /*                            @04A*/ 26300000
      DO;                          /*                            @04A*/ 26350000
        ILEV='0E';                 /* LEVEL INDICATOR = 14 FOR          26400000
                                      SELF DESCRIPTION           @04A*/ 26450000
        GOTO CHKRLTD;              /*                            @04A*/ 26500000
      END;                         /*                            @04A*/ 26550000
   IF LEVEL(1)='IOCMD'  THEN       /*                            @P0A*/ 26557100
      DO;                          /*                            @L2A*/ 26564200
        ILEV='0F';                 /* LEVEL INDICATOR = 15 FOR          26571300
                                      IOACTION STOP/RESUME       @P0A*/ 26578400
        GOTO CHKRLTD;              /*                            @L2A*/ 26585500
      END;                         /*                            @L2A*/ 26592600
   IF LEVEL(1)='FDEVAL' THEN       /*                            @L3A*/ 26593600
      DO;                          /*                            @L3A*/ 26594600
        ILEV='10';                 /* LEVEL INDICATOR = 16 FOR          26595600
                                      FORCE DEVICE ALIAS         @L3A*/ 26596600
        GOTO CHKRLTD;              /*                            @L3A*/ 26597600
      END;                         /*                            @L3A*/ 26598600
   IERRMSG='LEVEL='||LEVEL||' IS INVALID.'; /* ALL OTHER VALUES         26600000
                                                INVALID              */ 26650000
   IERRLVL=8;                                                           26700000
   ANS MSG(IERRMSG);                                                    26750000
   ANS(COMMENT(IERRMSG))              COL(INDENT);                      26800000
   GOTO CHKRLTD;                                                        26850000
 NRMROUT:                                                               26900000
   IF MACLIST(1)~='GET'  THEN      /* NORMAL VALID ONLY WITH GET        26950000
                                      OPTION                         */ 27000000
      DO;                                                               27050000
        IERRMSG='LEVEL=NORMAL VALID ONLY ON GET OPTION. '||             27100000
            MACLIST(1)||' HAS BEEN SPECIFIED.';                         27150000
        IERRLVL=8;                                                      27200000
        ANS MSG(IERRMSG);                                               27250000
        ANS(COMMENT(IERRMSG))         COL(INDENT);                      27300000
      END;                                                              27350000
   ELSE                                                                 27400000
      ILEV='01';                   /* NORMAL INDICATOR = 01          */ 27450000
 CHKRLTD:                          /* CHECK RELATED PARAMETER        */ 27500000
   IF RELATED=''  &                /* RELATED PARAMETER NOT SUPPLIED */ 27550000
      (MACLIST(1)='SET' |          /* RELATED REQUIRED WITH SET AND  */ 27600000
       MACLIST(1)='RESET')  THEN   /* RESET OPTIONS                  */ 27650000
         DO;                       /* ERROR IF NOT SUPPLIED ON SET OR   27700000
                                      RESET                          */ 27750000
           IERRMSG='RELATED PARAMETER REQUIRED ON '||MACLIST(1)||       27800000
                ' OPTION.';                                             27850000
           IERRLVL=8;                                                   27900000
           ANS MSG(IERRMSG);                                            27950000
           ANS(COMMENT(IERRMSG))      COL(INDENT);                      28000000
         END;                                                           28050000
 CHKRDRV:                          /* CHECK REDRIVE PARAMETER        */ 28100000
       /* REDRIVE PARAMETER IS VALID ONLY WITH THE RESET OPTION. THE */ 28150000
       /* REDRIVE INDICATOR IS INITIALLY SET TO 0 AND IS RESET ONLY  */ 28200000
       /* IF NO REDRIVE IS SPECIFIED.                                */ 28250000
   IF REDRIVE='' THEN                                                   28300000
      GOTO CHKUCB;                                                      28350000
   IF MACLIST(1) ~='RESET' THEN    /* REDRIVE PARAMETER VALID ONLY      28400000
                                      WITH RESET                     */ 28450000
      DO;                          /* OTHERWISE AN ERROR             */ 28500000
        IERRMSG='REDRIVE PARAMETER INVALID ON '||MACLIST(1)||           28550000
           ' OPTION.';                                                  28600000
        ANS MSG(IERRMSG);                                               28650000
        ANS(COMMENT(IERRMSG))         COL(INDENT);                      28700000
        IERRLVL=8;                                                      28750000
        GOTO CHKUCB;                                                    28800000
      END;                                                              28850000
   IF REDRIVE(1)='YES' THEN                                             28900000
      GOTO CHKUCB;                                                      28950000
   IF REDRIVE(1)='NO' THEN         /* NO REDRIVE                     */ 29000000
      DO;                                                               29050000
        IRDRV='1';                 /* REDRIVE INDICATOR = 1          */ 29100000
        GOTO CHKUCB;                                                    29150000
      END;                                                              29200000
   IERRMSG='REDRIVE='||REDRIVE||   /* INVALID REDRIVE PARAM SUPPLIED */ 29250000
     ' INVALID. VALID VALUES ARE YES OR NO.';                           29300000
   IERRLVL=8;                                                           29350000
   ANS MSG(IERRMSG);                                                    29400000
   ANS(COMMENT(IERRMSG))              COL(INDENT);                      29450000
 CHKUCB:                                                                29500000
 IF UCB='' THEN                    /* UCB PARAMETER NOT SUPPLIED     */ 29550000
    IF MACLIST(1)='TEST' |         /* UCB REQUIRED WITH THE TEST,    */ 29600000
       MACLIST(1)='SET'  |         /* SET AND RESET OPTIONS          */ 29650000
       MACLIST(1)='RESET'    THEN                                       29700000
      DO;                                                               29750000
        IERRMSG='UCB PARAMETER REQUIRED BUT NOT SUPPLIED WITH '         29800000
        ||MACLIST(1)|| ' OPTION.';                                      29850000
        IERRLVL=8;                                                      29900000
        ANS MSG(IERRMSG);                                               29950000
        ANS (COMMENT(IERRMSG)) COL(INDENT);                             30000000
      END;                                                              30050000
    ELSE                           /* PARAMETER NOT REQUIRED         */ 30100000
        ;                                                               30150000
 ELSE                              /* UCB PARAM SUPPLIED             */ 30200000
      IF MACLIST(1)='GET' THEN     /* GET OPTION CODED               */ 30250000
         DO;                                                            30300000
           IERRMSG='UCB PARAMETER INVALID ON GET OPTION.';              30350000
           IERRLVL=8;                                                   30400000
           ANS MSG(IERRMSG);                                            30450000
           ANS(COMMENT(IERRMSG))      COL(INDENT);                      30500000
         END;                                                           30550000
 IF IERRLVL~=0  THEN               /* ANY PARAMETER ERRORS?          */ 30600000
    DO;                            /* YES                            */ 30650000
      ANS(COMMENT('INVALID PARAMETERS ENCOUNTERED. NO CODE GENERATED.'))30700000
         COL(INDENT);              /* PRINT ERROR MESSAGE            */ 30750000
      ANS('END; '||COMMENT(IMACRO)) COL(MACCOL);                        30800000
      RETURN CODE(IERRLVL);        /* RETURN WITH NON-ZERO RETURN       30850000
                                      CODE                           */ 30900000
    END;                                                                30950000
 IF INDEX(EHAREGS,'00F')=0 THEN    /* HAS REG0 BEEN DECLARED         */ 31000000
    EHAREGS=EHAREGS||'00F';        /* NO, ADD TO EHAREGS             */ 31050000
 IF MACLIST(1)~='GET' THEN         /* OTHER THAN GET OPTION?         */ 31100000
    DO;                                                                 31150000
     IRFY=',GPR01P';               /* YES, REG 1 MUST BE RESPECIFIED */ 31200000
      IF INDEX(EHAREGS,'01P')=0 THEN /* HAS REG1 BEEN DECLARED       */ 31250000
         EHAREGS=EHAREGS||'01P';   /* NO, ADD TO EHAREGS             */ 31300000
    END;                                                                31350000
 /*                 PRODUCE PLS CODE                                 */ 31400000
 ANS('RFY(GPR00F'||IRFY||') RSTD; ') COL(INDENT);                       31450000
 IF UCB(1)~='' THEN                                                     31500000
    ANS('GPR01P='||UCB(1)||'; '||                                       31550000
    COMMENT(' REG1 = UCB ADDRESS '))     COL(INDENT);                   31600000
 ANS('GPR00F=''0000'||IRDRV||ITYP||ILEV||'''X; '||                      31650000
    COMMENT(' PUT PARAMETER INDICATORS IN REG0 '))  COL(INDENT);        31700000
 ANS('CALL  FLCCVT->CVTIXAVL->IOCLEVL->IOCLEVLE; '||                    31750000
    COMMENT(' CALL IOS LEVEL ROUTINE '))  COL(INDENT);                  31800000
 ANS('RFY(GPR00F'||IRFY||') UNRSTD; ') COL(INDENT);                     31850000
 ANS('END; '||COMMENT(IMACRO))  COL(MACCOL); /* END CODE & LIST         31900000
                                                MACRO PARAMETERS    */  31950000
 %END IOSLEVEL;                                                         32000000
