         MACRO                                                          00030019
&NAME    IOSGEN &FUNC,&TABLE=,&UCB=,&REG=,&VAR=,&ID=,&GETLOCK=,        X00080000
               &DOM=SVC                                           @02C  00130000
.********************************************************************** 80905819
.*  COPYRIGHT =                                                         80906300
.*     5645-001                                                   @P5C  80906800
.*     THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                      80907300
.*     (C) COPYRIGHT IBM CORP. 1981, 1997                         @P5C  80907800
.*     LICENSED MATERIALS - PROPERTY OF IBM                             80908300
.*                                                                      80908800
.*  STATUS = HBB6603                                              @P5C  80909600
.********************************************************************** 80910400
.*                                                                      80926000
         GBLB  &IECIHDR                 HEADER SWITCH                   80941600
         GBLB  &IECIFLG                 FLG FIRST TIME SWITCH           80957200
         GBLB  &IECIDET                 DETECTOR FIRST TIME SWITCH      80972800
         GBLB  &IECITP                  TP FIRST TIME SWITCH            80988400
         GBLB  &IECISV                  SETVOID FIRST TIME SWITCH       81004000
         GBLB  &IECISVC                 SETVOIDC FIRST TIME SWITCH      81019600
.*                                                             @G860PLM 81035200
         GBLB  &IECIWTO                 FIRST TIME SWITCH          @D1A 81050800
         GBLB  &IECIBX                  BOX FIRST TIME SWITCH      @H1A 81066400
         LCLC  &LABEL                   LABEL GENERATION                81082000
         LCLC  &FIELD                   UCB FIELD                       81097600
         LCLC  &BIT,&INDEX,&GETL        UCB EQUATE NAME                 81113200
.*                                      OR BRANCH ENTRY (IECVGENA)      81128800
.*                                      OR TP ERRTAB               @02C 81144400
         AIF   ('&IECIHDR' EQ '1').IOSG010                              81160000
&IECIHDR SETB  1                        SET HEADER SWITCH               81175600
*****************************************************************       81191200
*                                                               *       81206800
*             IOSGEN MACRO                                      *       81222400
*                                                               *       81238000
*        OS/VS2                                                 *       81253600
*                                                               *       81269200
*        METHOD OF ACCESS                                       *       81284800
*              BAL - IOSGEN &FUNC,.....REQUIRED KEYWORDS        *       81300400
*              PLS - GEN REFS(....,....,MAPPING MACRO LABELS)   *       81316000
*                    (IOSGEN &FUNC,...REQUIRED KEYWORDS);       *       81331600
*                                                               *       81347200
*        THE MACRO FACILITIES OF IOSGEN ARE PROVIDED TO         *       81362800
*        SUPPORT FUNCTIONS WHICH REQUIRE A CHANGE TO OR         *       81378400
*        INFORMATION FROM THE RESOURCES WHICH GOVERN THE        *       81394000
*        CONTROL STRUCTURE OF THE I/O SUPERVISOR.  THESE        *       81409600
*        ARE NOT AN INTEGRAL PART OF IOS AND, THROUGH IOSGEN,   *       81425200
*        CAN REMAIN INDEPENDENT OF THE RESOURCE GOVERNING       *       81440800
*        STRUCTURE. IOSGEN IS A PRIVATE MACRO INTENDED FOR USE @G860PLT 81456400
*        ONLY BY AUTHORIZED SYSTEM ROUTINES.                   @G860PLT 81472000
*                                                               *       81474600
*                                                               *       81477200
*                                                               *       81479800
*   EXTERNAL CLASSIFICATION: NONE                           @P3A*       81482400
*   END OF EXTERNAL CLASSIFICATION                          @P3A*       81485000
*                                                               *       81487600
*   CHANGE ACTIVITY -                                           *       81518800
*                                                               *       81534400
*   $MAC(IOSGEN),COMP(SC1C3): IOS GEN macro                     *       81550000
*                                                               *       81565600
*     HBB2102 CHANGES                                          @G860PLT 81581200
*     SETVOIDC                                                 @G860PLM 81596800
*                                                               *       81612400
*     PN  REASON    RLSE    DATE  ORG  COMMENTS                 *       81628000
*     $D1=DCR38   JBB1326 801001  PDLH: ADD WTOID FUNCTION      *       81643600
*     $H1=3480AU  JBB2125 830130  PDLT: ASSIGN/UNASSIGN SUPPORT *       81659200
*                                       INCLUDING BOX SUPPORT   *       81674800
*     $01=OZ87557 JBB2220 850712  PDLJ: THE EQUATE FOR UCBFLG   *       81690400
*                                       OPTION OF IECIFREF      *       81706000
*                                       SHOULD BE 168 INSTEAD   *       81721600
*                                       OF 160.            @01A *       81737200
*     $P1=PA21056 JBB2220 860721  PDLG: CLEAR HIGH ORDER BYTE   *       81752800
*                                       OF UCB COMMON EXTENSION *       81768400
*                                       POINTER.                *       81784000
*     $L1=VERS    HBB3310 860416  PDLE: Versioning macro into   *       81799600
*                                       product                    @L1A 81815200
*     $L2=CNITG   HBB4410 890918  PDLU: Console Integration        @L2A 81823000
*     $L3=4DGIT   HBB5510 930304  PDKB: Four Digit Support         @L3A 81824300
*     $L4=UCBVP   HBB5520 940106  PDLU: UCB VSCR Support                81824500
*                                       Change UCB Common Extension     81824700
*                                       Addressability.            @L4A 81824900
*                                                                       81825100
*     $P2=PEO4224 HBB4410 900504  PDLU: Add error checking for          81825600
*                                       WTOID DOM keyword.         @P2A 81828200
*     $P3=PN71743 HBB5520 941020  PDLP: Add External Classification     81829000
*                                       in the PROLOG              @P3A 81829800
*     $P4=PN71885 HBB5520 941020  PDLC: Save and restore USINGs for     81830100
*                                       PURGE function             @P4A 81830400
*     $P5=PQC1623 HBB6603 960630  PDLZ: SETVOID notification exit       81831500
*                                       support                    @P5A 81832600
*     $02=OW12898 HBB4430 950630  PDCS: Add an option to get            81833700
*                                       lock prior to testing           81834800
*                                       UCBUDE                     @02A 81835900
*     $03=OW21043 HBB5520 970115  PDIU: Allow IOSGEN TP to be compiled  81836100
*                                       at HBB5520 up but still be able 81836300
*                                       to run at lower levels     @03A 81836500
*     $04=OW28441 HBB5520 970815  PDIU: Remove usage of 'R14' from      81836600
*                                       TP function. Assembler fails if 81836700
*                                       user's program does not have    81836800
*                                       'R14' declared.            @04A 81836900
*                                                               *       81837000
*                                                               *       81838600
*  OZ79766 - ADDED SPECIFICATION OF VAR=4 TO DETECTOR FUNCTION @ZA79766 81846400
*            TO ALLOW DETECTION OF RESERVE PENDING.            @ZA79766 81862000
*                                                               *       81877600
*  OZ80428 - DETECTOR FUNCTION WITH VAR= PARM DEFAULTED TO 1   @ZA80428 81893200
*            PRODUCES VAR=3 CODE IN ADDITION TO CORRECT CODE.  @ZA80428 81908800
*****************************************************************       81924400
****END OF SPECIFICATIONS****************************************       81932200
.IOSG010 ANOP                                                           81940000
         AIF   ('&FUNC' EQ 'DETECTOR').DET000                           81955600
         AIF   ('&FUNC' EQ 'TP').TP000                                  81971200
         AIF   ('&FUNC' EQ 'UCBFLG').FLG000                             81986800
         AIF   ('&FUNC' EQ 'SETVOID').SV000                    @Y30LPLC 82002400
         AIF   ('&FUNC' EQ 'SETVOIDC').SVC000                  @G860PLM 82018000
         AIF   ('&FUNC' EQ 'WTOID').WT000                          @D1A 82033600
         AIF   ('&FUNC' EQ 'BOX').BX000                            @H1A 82049200
         AGO   .IOSGEN3                                                 82064800
.*****     *****     *****     *****     *****     *****     *****      82080400
.*****     UCBFLG    *****     UCBFLG    *****     UCBFLG    *****      82096000
.*****     *****     *****     *****     *****     *****     *****      82111600
.FLG000  ANOP                                                           82127200
.*                                                                      82142800
.*                                                                      82158400
.*       CHECK FOR MISSING AND INVALID PARAMETERS                       82174000
.*                                                                      82189600
         AIF   ('&UCB' EQ '').IOSGEN3   REQUIRED KEYWORD                82205200
         AIF   ('&TABLE' EQ 'UCBNRY').FLG005                   @G860PLT 82220800
         AIF   (('&TABLE' EQ 'UCBDDRSW')                               X82236400
               OR ('&TABLE' EQ 'UCBIVRR') OR ('&TABLE' EQ 'UCBIVRS')   X82252000
               OR ('&TABLE' EQ '')).FLG005                              82267600
         AIF   ('&TABLE' EQ 'UCBITF').FLG005                            82283200
         AIF   ('&TABLE' EQ 'UCBRVRS').FLG005                  @OZ03863 82298800
         AIF   ('&TABLE' EQ 'UCBNOPTH').FLG005                 @G860PLT 82314400
         AIF   (('&TABLE' EQ 'UCBRESVH') AND ('&VAR' EQ 'OFF') AND     X82330000
               ('&SYSECT' EQ 'IEFAUSRV')).FLG005                   @H1A 82345600
         AGO   .IOSGEN3                                                 82361200
.FLG005  ANOP                                                           82376800
*********************************************************************** 82378500
*                                                                       82380200
* Note that GETLOCK is only currently valid with TABLE=UCBVRHS &   @02A 82381900
* VAR=ON.                                                          @02A 82383600
*                                                                       82385300
*********************************************************************** 82387000
         AIF   (('&GETLOCK' NE 'YES') AND ('&GETLOCK' NE 'NO') AND     X82388700
                  ('&GETLOCK' NE '')).IOSGEN3                     @02A  82390400
         AIF   (('&VAR' NE 'ON') AND ('&VAR' NE 'OFF') AND             X82392400
               ('&VAR' NE 'TEST') AND ('&VAR' NE '')).IOSGEN4           82408000
         AIF   (('&VAR' NE 'ON') AND ('&VAR' NE 'OFF') AND             X82423600
                ('&TABLE' EQ 'UCBRVRS')).IOSGEN3               @G860PLT 82439200
         AIF   (('&REG' NE 'COND') AND ('&REG' NE 'UNCOND') AND        X82454800
               ('&REG' NE '')).IOSGEN3                                  82470400
         AIF   ('&TABLE' EQ 'UCBRVRS').FLG007                  @ZA35584 82486000
         AIF   ((('&REG' EQ 'COND') OR ('&REG' EQ 'UNCOND')) AND       X82501600
               ('&TABLE' NE 'UCBNRY')).IOSGEN3                          82517200
.FLG007  ANOP                                                           82532800
         AIF   ('&IECIFLG' EQ '1').FLG010    ONE CALL ONLY              82548400
&IECIFLG SETB  1                        SET FIRST TIME SWITCH           82564000
         SPACE 2                                                        82579600
*****************************************************************       82595200
*                                                               *       82610800
* FUNCTION:                                                     *       82626400
*    UCBFLG - TESTS, SETS OR RESETS SELECTED STATUS             *       82642000
*             INDICATORS IN THE UCB.                            *       82657600
*                                                               *       82673200
* MACRO CALL:                                                   *       82688800
*    LABEL  IOSGEN  UCBFLG,UCB=(REG),VAR=ON OR OFF OR TEST,     *       82704400
*                   TABLE=UCBBITNAME,REG=COND OR UNCOND         *       82720000
*                                                               *       82735600
*         PLS - GEN REFS(UCBFLA,UCBFLB,UCBFLC,CVTPTR,          @G860PLT 82751200
*               CVTIXAVL,IOCGENA,UCBOB,UCB3TAPE,CVTMAP,        @G860PLT 82766800
*               IOCOM)                                         @G860PLT 82782400
*               (IOSGEN UCBFLG,...KEYWORDS AS IN BAL);          *       82798000
*         NOTE:  %DEACT OFF; MUST FOLLOW INCLUDE STATEMENTS     *       82813600
*                FOR VAR=OFF.                                   *       82829200
*         NOTE:  THE ABOVE REPRESENT THE MAXIMUM REFERENCES     *       82844800
*                REQUIRED.                                      *       82860400
*                                                               *       82876000
*    SPECIAL TAPE OPTION:                                       *       82891600
*         LABEL  IOSGEN  UCBFLG,UCB=(REG)                       *       82907200
*                                                               *       82922800
* INPUT:                                                        *       82938400
*    REGISTER 13 MUST CONTAIN THE ADDRESS OF 16 WORD SAVEAREA   *       82954000
*    FOR THE 'ON' OR 'OFF' OPTIONS AND SPECIAL TAPE OPTION.     *       82969600
*                                                               *       82985200
*    UCB=  MUST SPECIFY A GPR (ABSOLUTE OR SYMBOLIC) CONTAINING *       83000800
*    THE ADDRESS OF THE UCB REPRESENTING THE DEVICE FOR WHICH   *       83016400
*    THE FUNCTION IS DIRECTED.  THIS GPR MUST POINT TO THE      *       83032000
*    UCB COMMON SEGMENT. FOR MULTIPLE EXPOSURE DEVICES,         *       83047600
*    IECVGENA WILL ACQUIRE THE UCB LOCK FROM THE BASE UCB       *       83063200
*    AND WILL USE THE ADDRESS IN THIS PARAMETER  TO             *       83078800
*    PERFORM THE REQUESTED OPERATION.                           *       83094400
*                                                               *       83110000
*    VAR=  INDICATES THE TYPE OF ACTION TO BE PERFORMED.        *       83125600
*         ON   - THE DESIGNATED INDICATOR IS TO BE TURNED ON.   *       83141200
*         OFF  - THE DESIGNATED INDICATOR IS TO BE TURNED OFF.  *       83156800
*         TEST - (DEFAULT) THE DESIGNATED INDICATOR IS TO       *       83172400
*                BE TESTED.                                     *       83188000
*                                                               *       83203600
*    TABLE=  SPECIFIES THE SYMBOLIC NAME OF THE INDICATOR TO    *       83219200
*    BE TESTED, SET, OR RESET.  THE FOLLOWING SYMBOLS ARE       *       83234800
*    SUPPORTED:                                                 *       83250400
*         UCBNRY   - THE DEVICE IS NOT READY.                   *       83266000
*         UCBDDRSW - A VOLUME SWITCH (DYNAMIC DEVICE            *       83281600
*                    RECONFIGURATION) IS PENDING ON THIS DEVICE.*       83297200
*         UCBIVRS  - INTERVENTION REQUIRED MESSAGE HAS BEEN SENT*       83312800
*         UCBIVRR  - INTERVENTION REQUIRED MESSAGE IS NEEDED.   *       83328400
*         UCBITF   - INTERCEPT CONDITION.                       *       83344000
*         UCBRVRS  - NOTREADY AND INTERVENTION MSG             @OZ03863 83359600
*                    SENT. NOT VALID WITH VAR=TEST.            @G860PLT 83375200
*         UCBNOPTH - NO PATHS                                  @G860PLT 83390800
*         UCBRESVH - DEVICE RESERVED OR ASSIGNED (FOR USE ONLY  *       83406400
*                    BY THE ASSIGN SERVICE) - ONLY THE VAR=OFF  *       83422000
*                    OPTION IS SUPPORTED.                          @H1A 83437600
*                                                               *       83453200
*    REG=  APPLIES TO UCBNRY ('ON' ONLY) AND UCBRVRS           @G860PLT 83468800
*         COND   - (DEFAULT) IMPLIES THAT THE NOT READY STATUS  *       83484400
*                   IS TO BE SET ONLY IF AN UNSOLICITED DEVICE  *       83500000
*                   END HAS NOT OCCURED SINCE THE LAST SIO      *       83515600
*                   WAS ISSUED.                                 *       83531200
*         UNCOND - IMPLIES SETTING THE INDICATOR REGARDLESS OF  *       83546800
*                  THE INTERRUPT STATUS.                        *       83562400
*                                                               *       83578000
*    LABEL  OPTIONAL LABEL PARAMETER.                           *       83593600
*                                                               *       83609200
*    OPTIONAL TAPE OPTION - THE STATUS INDICATORS 'NOT READY'   *       83624800
*    AND 'INTERCEPT CONDITION' ARE SET OFF.  THIS CALL IS VALID *       83640400
*    ONLY FOR A TAPE DEVICE AND IF BOTH THE STATUS INDICATORS   *       83656000
*    ARE ALREADY SET ON.  THE 16 WORD SAVE AREA IS REQUIRED FOR *       83671600
*    THIS EXPANSION.  TO RESET AN INTERCEPT CONDITION, I/O      *       83687200
*    SUPERVISOR RESOURCES ALLOCATED TO MAINTAIN THE STATUS OF   *       83702800
*    THE INTERRUPT MUST BE RELEASED.                            *       83718400
*                                                               *       83734000
* OUTPUT:                                                       *       83749600
*    TEST OPTION - THE CONDITION CODE OF ZERO INDICATES THE     *       83765200
*    INDICATOR IS TURNED OFF.                                   *       83780800
*                                                               *       83796400
* EXTERNAL ROUTINES:                                            *       83812000
*    IECVGENA - RESIDENT IOSGEN SUBROUTINE. THIS MODULE IS      *       83827600
*    ENTERED VIA A BAL INSTRUCTION FOR ALL CONDITIONS EXCEPT    *       83843200
*    'TEST'.                                                   @G860PLT 83858800
*                                                               *       83874400
* ATTRIBUTES:                                                   *       83890000
*    THE UCBFLG FUNCTION IS EXPANDED AS IN-LINE, REENTRANT      *       83905600
*    CODE AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES        *       83921200
*    WITHIN THE SAME ASSEMBLY WITHOUT DUPLICATING SYMBOLS.      *       83936800
*                                                               *       83952400
* OTHER:                                                        *       83968000
*                                                               *       83983600
*    THE FOLLOWING MAPPING MACRO ARE REQUIRED:                  *       83999200
*         IEFUCBOB              (TEST ONLY)                     *       84014800
*         CVT   DSECT=YES       (ON & OFF ONLY)                 *       84030400
*         IECDIOCM              (ON & OFF ONLY)                 *       84046000
*                                                               *       84061600
*    LOCKS ARE NOT REQUIRED BY THIS FUNCTION.                   *       84077200
*    FOR VAR=ON OR VAR=OFF, NO LOCK CAN BE HELD WHICH WOULD    @G860PLT 84092800
*    PRECLUDE OBTAINING THE UCB LOCK.                          @G860PLT 84108400
*                                                               *       84124000
*****************************************************************       84139600
         SPACE 2                                                        84155200
*****************************************************************       84170800
*                                                               *       84186400
*        REGISTER EQUATES                                       *       84202000
*                                                               *       84217600
*****************************************************************       84233200
         SPACE                                                          84248800
IECIFGR0 EQU   0                   UCB PREFIX OFFSET REG                84264400
IECIFUCB EQU   4                   UCB PTR                              84280000
IECIFVAR EQU   5                   VARIATION VALUE REG                  84295600
*                                  *APPLIES TO NORMAL REQUESTS          84311200
IECIFSAV EQU   13                  SAVE AREA PTR                        84326800
IECIFRTN EQU   14                  RETURN REG FROM IECVGENA             84342400
IECIFBRR EQU   15                  BRANCH REG TO IECVGENA               84358000
         SPACE                                                          84373600
*****************************************************************       84389200
*                                                               *       84404800
*        UCB - UNIT CONTROL BLOCK                               *       84420400
*              FLAGS DEFINED TO PREVENT PLS XREF PROBLEMS       *       84436000
*                                                               *       84451600
*****************************************************************       84467200
         SPACE                                                          84482800
IECIFXXX EQU   512                 UCB PREFIX                           84498400
IECIFDDR EQU   X'01'               UCBDDRSW  - TEST                     84514000
IECIFIVR EQU   X'04'               UCBIVRR  - TEST                      84529600
IECIFIVS EQU   X'08'               UCBIVRS  - TEST                      84545200
IECIFNRY EQU   X'40'               UCBNRY  - TEST                       84560800
*                                  *AND (SPECIAL TAPE CALL)             84576400
IECIFUDE EQU   X'20'               UCBUDE - (UCBNRY 'ON' COND           84592000
*                                           OR UCBRVRS)                 84607600
IECIF3TA EQU   X'80'               UCB3TAPE - (SPECIAL TAPE CALL)       84623200
IECIFINT EQU   X'80'               UCBINCPT TEST               @G860PLT 84638800
*                                  *AND (SPECIAL TAPE CALL)             84654400
IECIFNOP EQU   X'40'               UCBNOPTH - TEST             @G860PLT 84670000
         SPACE                                                          84685600
*****************************************************************       84701200
*                                                               *       84716800
*        SPECIAL ENTRY POINT BRANCH TABLE VALUES FOR IECVGENA   *       84732400
*        THESE VALUES ARE DISPLACEMENTS FROM REGISTER 15        *       84748000
*        ALL UCBFLG VARIATIONS USE THE DISPLACEMENT 'IECIFLOK'  *       84763600
*                                                               *       84779200
*****************************************************************       84794800
         SPACE                                                          84810400
*        EQU   0                   AVAILABLE                   @G860PLT 84826000
*        EQU   4                   AVAILABLE                   @G860PLT 84841600
*        EQU   8                   NOT AVAILABLE   (RESERVED)           84857200
*        EQU   12                  NOT AVAILABLE   (RESERVED)  @G860PLT 84872800
IECIFLOK EQU   16                  UCBFLG                               84888400
*                                  *SETS UCB LOCK IMMEDIATELY           84904000
         SPACE                                                          84919600
*****************************************************************       84935200
*                                                               *       84950800
*        NORMAL BRANCH TABLE VALUES FOR IECVGENA                *       84966400
*        THESE VALUES ARE DISPLACEMENTS FROM REGISTER 5         *       84982000
*                                                               *       84997600
*****************************************************************       85013200
         SPACE                                                          85028800
IECIFNRC EQU   0                   UCBNRY - ON (CONDITIONALLY)          85044400
IECIFNRN EQU   4                   UCBNRY - ON (UNCONDITIONALLY)        85060000
IECIFNIS EQU   8                   UCBNRY & UCBINCPT-OFF(TAPE) @G860PLT 85075600
IECIFNRF EQU   12                  UCBNRY - OFF                         85091200
IECIFDDN EQU   36                  UCBDDRSW - ON                        85106800
IECIFDDF EQU   44                  UCBDDRSW - OFF                       85122400
IECIFIVN EQU   68                  UCBIVRR - ON                         85138000
IECIFIVF EQU   76                  UCBIVRR - OFF                        85153600
IECIFRSN EQU   84                  UCBIVRS - ON                         85169200
IECIFRSF EQU   92                  UCBIVRS - OFF                        85184800
IECIFITN EQU   116                 UCBITF - ON                          85200400
IECIFITF EQU   124                 UCBITF - OFF                         85216000
IECIFRVN EQU   128                 UCBNRY ON-UCBIVRS ON        @OZ03863 85231600
*                                  UNDER SAME LOCK             @OZ03863 85247200
IECIFRVF EQU   136                 UCBNRY & IVRS OFF  @ZA16174,@OZ03863 85262800
*                                  UNDER SAME LOCK             @OZ03863 85278400
IECIFNON EQU   148                 UCBNOPTH - ON               @G860PLT 85294000
IECIFNOF EQU   156                 UCBNOPTH - OFF              @G860PLT 85309600
IECIFREF EQU   168                 UCBRESVH - OFF             @01C,@H1A 85325200
IECIFRVNT EQU  180                 Same as IECIFRVN except test         85330400
*                                  UCBUDE first w/ the UCB lock    @02A 85335600
         SPACE                                                          85340800
.FLG010  ANOP                                                           85356400
         AIF   (('&GETLOCK' EQ 'NO') OR ('&GETLOCK' EQ '')).FLG015 @02A 85359000
&GETL    SETC 'T'                        Indicate getlock prior         85361600
*                                   to testing bit                 @02A 85364200
.FLG015  ANOP                                                      @02A 85366800
.*                                                                      85369400
.*                                                                      85372000
.*       CHECK FOR TYPE OF VARIATION                                    85387600
.*                                                                      85403200
         AIF   ('&TABLE' EQ '').FLG070  SPECIAL TAPE CALL               85418800
         AIF   (('&VAR' NE 'TEST') AND ('&VAR' NE '')).FLG080           85434400
.*                                                                      85450000
.*       MUST BE 'TEST'                                                 85465600
.*       SET &FIELD EQUAL TO UCB FIELD NAME                             85481200
.*       SET &BIT TO EQUATE DESIGNATION                                 85496800
.*                                                                      85512400
         AIF   ('&TABLE' NE 'UCBIVRS').FLG020                           85528000
&BIT     SETC  'IVS'                    PREVENT DUPLICATE SYMBOLS       85543600
         AGO   .FLG030                                                  85559200
.FLG020  ANOP                                                           85574800
&BIT     SETC  '&TABLE'(4,3)            SET BIT NAME                    85590400
.FLG030  ANOP                                                           85606000
         AIF   ('&TABLE' NE 'UCBNRY').FLG040                   @G860PLT 85621600
&FIELD   SETC  'UCBFLA'                                                 85637200
         AGO   .FLG060                                                  85652800
.FLG040  ANOP                                                           85668400
         AIF   (('&TABLE' NE 'UCBITF') AND                             X85684000
               ('&TABLE' NE 'UCBNOPTH')).FLG050               @G860PLT  85699600
&FIELD   SETC  'UCBFLB'                                                 85715200
         AIF   ('&TABLE' NE 'UCBITF').FLG060                  @G860PLT  85730800
&BIT     SETC  'INT' AVOID DUPLICATE SYMBOLS                            85746400
         AGO   .FLG060                                                  85762000
.FLG050  ANOP                                                           85777600
&FIELD   SETC  'UCBFLC'                                                 85793200
.*                                                                      85808800
.*       CONSTRUCT FOR 'TEST'                                           85824400
.*                                                                      85840000
.FLG060  ANOP                                                           85855600
&NAME    TM    &FIELD.-UCBOB&UCB.,IECIF&BIT   TEST SELECTED BIT         85871200
         MEXIT                                                          85886800
.*                                                                      85902400
.*       MUST BE UCBNRY AND UCBINCPT 'OFF' FOR SPECIAL TAPE CALL        85918000
.*                                                                      85933600
.FLG070  ANOP                                                           85949200
&BIT     SETC  'NI'                                                     85964800
&INDEX   SETC  'S'                                                      85980400
&LABEL   SETC  '&SYSNDX'(2,3)                                           85996000
&NAME    TM    UCBTBYT3-UCBOB&UCB.,IECIF3TA  IS IT A TAPE               86011600
         BNO   IECIF&LABEL         NO, EXIT IMMEDIATELY                 86027200
         TM    UCBFLA-UCBOB&UCB.,IECIFNRY  IS DEV NOT READY             86042800
         BNO   IECIF&LABEL         NO, EXIT IMMEDIATELY                 86058400
         TM    UCBFLB-UCBOB&UCB.,IECIFINT  IS IT               @G860PLT 86074000
*                                  *INTERCEPT CONDITION                 86089600
         BNO   IECIF&LABEL         NO, EXIT IMMEDIATELY                 86105200
         AGO   .FLG140                                                  86120800
.*                                                                      86136400
.*       MUST BE 'ON' OR 'OFF'                                          86152000
.*       CHECK FOR UCBNRY 'ON' AND TYPE OF CONDITION                    86167600
.*                                                                      86183200
.FLG080  ANOP                                                           86198800
         AIF   (('&TABLE' NE 'UCBNRY') OR (('&TABLE' EQ 'UCBNRY')      X86214400
               AND ('&VAR' EQ 'OFF'))).FLG090                           86230000
         AIF   (('&REG' NE 'COND') AND ('&REG' NE '')).FLG100           86245600
.*                                                                      86261200
.*       MUST BE UCBNRY 'ON' - 'COND'                                   86276800
.*                                                                      86292400
&BIT     SETC  'NR'                                                     86308000
&INDEX   SETC  'C'                                                      86323600
&LABEL   SETC  '&SYSNDX'(2,3)                                           86339200
         AIF   ('&GETLOCK' EQ 'YES').FLG140                      @02A   86347000
&NAME    TM    UCBFLC-UCBOB&UCB.,IECIFUDE  IS IT                        86354800
*                                  *UNSOLICITED DEVICE END              86370400
         BO    IECIF&LABEL         YES, EXIT IMMEDIATELY                86386000
         AGO   .FLG140                                                  86401600
.*                                                                      86417200
.*       CHECK FOR UCBIVRS TO PREVENT DUPLICATE SYMBOLS                 86432800
.*                                                                      86448400
.FLG090  ANOP                                                           86464000
         AIF   ('&TABLE' NE 'UCBIVRS').FLG100                           86479600
&BIT     SETC  'RS'                                                     86495200
         AGO   .FLG110                                                  86510800
.*                                                                      86526400
.*       SET &BIT TO REMAINING FIRST TWO CHARACTERS                     86542000
.*                                                                      86557600
.FLG100  ANOP                                                           86573200
&BIT     SETC  '&TABLE'(4,2)            GET FIRST 2 CHARS AFTER UCB     86588800
&LABEL   SETC  '&SYSNDX'(2,3)                                  @ZA03863 86604400
.*                                                                      86620000
.*       SET &INDEX FOR 'ON' OR 'OFF'                                   86635600
.*                                                                      86651200
.FLG110  ANOP                                                           86666800
         AIF   ('&VAR' NE 'ON').FLG120                                  86682400
&INDEX   SETC  'N'                      MUST BE 'ON'                    86698000
         AGO   .FLG125                                         @OZ03863 86713600
.FLG120  ANOP                                                           86729200
&INDEX   SETC  'F'                      MUST BE 'OFF'                   86744800
.FLG125  AIF   ('&TABLE' NE 'UCBRVRS').FLG130                  @OZ03863 86760400
         AIF   ('&REG' EQ 'UNCOND').FLG130                     @ZA35584 86776000
         AIF   ('&GETLOCK' EQ 'YES').FLG140                      @02A   86783800
&NAME    TM    UCBFLC-UCBOB&UCB.,IECIFUDE IS IT UNSOLICITED             86791600
*                                         * END                         86807200
         BO    IECIF&LABEL                YES, EXIT IMMEDIATELY         86822800
         AGO   .FLG140                                         @OZ03863 86838400
.*                                                                      86854000
.*       CONSTRUCT REGISTER SAVE AND RESTORE                            86869600
.*       SET UCB PTR FOR IECVGENA                                       86885200
.*       GET IECVGENA ENTRY POINT                                       86900800
.*                                                                      86916400
.FLG130  ANOP                                                           86932000
&NAME    STM   IECIFGR0,IECIFBRR,0(IECIFSAV)  SAVE REGS                 86947600
         AGO   .FLG150                                                  86963200
.FLG140  ANOP                                                           86978800
         STM   IECIFGR0,IECIFBRR,0(IECIFSAV)  SAVE REGS                 86994400
.FLG150  ANOP                                                           87010000
         LR    IECIFUCB,&UCB(1)                SET IECVGENA UCB PTR     87025600
         LA    IECIFGR0,IECIFXXX(0,0)          GET PREFIX OFFSET        87041200
         SLR   IECIFUCB,IECIFGR0               ADJUST TO PREFIX         87056800
         L     IECIFBRR,CVTPTR(0,0)            GET CVT PTR              87072400
         L     IECIFBRR,CVTIXAVL-CVTMAP(0,IECIFBRR)  GET IOCOM PTR      87088000
         L     IECIFBRR,IOCGENA-IOCOM(0,IECIFBRR)    GET IECVGENA PTR   87103600
         LA    IECIFVAR,IECIF&BIT.&INDEX.&GETL.(0,0)  BRANCH TABLE      87119200
*                                        ENTRY FOR THIS OPERATION  @02C 87134800
         BAL   IECIFRTN,IECIFLOK(0,IECIFBRR)    CALL IECVGENA           87150400
         LM    IECIFGR0,IECIFBRR,0(IECIFSAV)    RESTORE REGS            87166000
.*                                                                      87181600
.*       GENERATE BRANCH LABELS FOR                                     87197200
.*       SPECIAL TAPE CALL AND UCBNRY 'ON' CONDITIONALLY                87212800
.*       ALSO SETTING UCBNRY & UCBIVRS FOR MVS ERP             @G860PLT 87228400
.*       UNDER ONE LOCK.                                       @OZ03863 87244000
.*                                                                      87259600
         AIF   ('&TABLE' EQ 'UCBRVRS').FLG155                  @OZ03863 87275200
         AIF   ('&BIT'(1,1) NE 'N').FLG160                              87290800
         AIF   (('&INDEX' NE 'C') AND ('&INDEX' NE 'S')).FLG160         87306400
.FLG155  ANOP                                                  @OZ03863 87322000
IECIF&LABEL EQU *                  CONTINUE PROCESSING                  87337600
.FLG160  ANOP                                                           87353200
         MEXIT                                                          87368800
.*****     *****     *****     *****     *****     *****     *****      87384400
.*****     TP*TP     *****     TP*TP     *****     TP*TP     *****      87400000
.*****     *****     *****     *****     *****     *****     *****      87415600
.TP000   ANOP                                                           87431200
.*                                                                      87446800
.*                                                                      87462400
.*       CHECK PARAMETERS FOR ERRORS                                    87478000
.*                                                                      87493600
         AIF   (('&UCB' EQ '') OR ('&VAR' EQ '')).IOSGEN3               87509200
         AIF   ('&VAR' NE 'ATNMOD').TP010                               87524800
         AIF   ('&TABLE' EQ '').IOSGEN3                                 87540400
         AIF   ('&REG' EQ '').TP030                                     87556000
         AIF   (N'&REG LT 2).IOSGEN2                                    87571600
         AGO   .TP030                                                   87587200
.TP010   ANOP                                                           87602800
         AIF   (('&VAR' EQ 'ATNTABG') OR ('&VAR' EQ 'ATNTABT')).TP030   87618400
         AIF   (K'&VAR NE 2).IOSGEN4                                    87634000
.TP030   ANOP                                                           87649600
         AIF   ('&IECITP' EQ '1').TP040 CHECK FIRST TIME SWITCH         87665200
&IECITP  SETB  1                        SET SWITCH                      87680800
         SPACE 2                                                        87696400
*****************************************************************       87712000
*                                                               *       87727600
* FUNCTION:                                                     *       87743200
*    TP - WILL MODIFY THE ATTENTION TABLE INDEX OR ERROR        *       87758800
*         TABLE INDEX IN THE UCB.                               *       87774400
*                                                               *       87790000
*    LABEL  IOSGEN  TP,UCB=(GPR),VAR=ATNTABG OR ATNTABT OR      *       87805600
*           XX OR ATNMOD,                                      @G860PLT 87821200
*           TABLE=(GPR),REG=(GPR1,GPR2)                         *       87836800
*                                                               *       87852400
*    PLS - GEN REFS(UCBOB,UCBETI,UCBATI,CVTPTR,CVTMAP,          *       87868000
*          CVTIXAVL,ATBRTN,ATB,IOCATTBL,IOCOM,UCBEXTPT,         *       87883600
*          UCBCMEXT,ATBASID)                                    *       87899200
*          (IOSGEN TP,...KEYWORDS AS IN BAL);                   *       87914800
*                                                               *       87930400
* INPUT:                                                        *       87946000
*    UCB=  MUST SPECIFY A GPR (ABSOLUTE OR SYMBOLIC)            *       87961600
*    CONTAINING THE ADDRESS OF THE UCB COMMON SEGMENT TO        *       87977200
*    BE MODIFIED.                                               *       87992800
*                                                               *       88008400
*    VAR=  ATTENTION TABLE INDEX OR ERROR TABLE INDEX.          *       88024000
*         ATNTABG - ATTENTION TABLE INDEX FOR GRAPHICS.         *       88039600
*         ATNTABT - ATTENTION TABLE INDEX FOR TELEPROCESSING.   *       88055200
*         XX      - WHERE XX SPECIFIES THE NEW ERRTAB INDEX    @G860PLT 88070800
*                   IN HEX (2A,2B,ETC. ).  IT WILL RESULT       *       88086400
*                   IN CODE TO RESET THE ERRTAB INDEX.          *       88102000
*         ATNMOD  - ATTENTION TABLE INDEX.                     @G860PLT 88117600
*                                                               *       88133200
*    TABLE=  (ATNMOD ONLY) MUST SPECIFY A GPR (ABSOLUTE OR      *       88148800
*    SYMBOLIC) WHICH CONTAINS THE ATTENTION TABLE INDEX         *       88164400
*    RIGHT ALIGNED.                                             *       88180000
*                                                               *       88195600
*    REG=(GPR1,GPR2)  THIS PARAMETER IS REQUIRED ONLY           *       88211200
*    IF THE USER (ATNMOD ONLY) DESIRES THE OPTION TO            *       88226800
*    CHANGE THE ATTENTION TABLE ROUTINE ADDRESS AND THE ASID.   *       88242400
*        GPR1 - MUST CONTAIN THE ADDRESS OF THE ATTENTION       *       88258000
*               ROUTINE RIGHT ALIGNED OR ZERO. THE HIGH ORDER  @G860PLT 88273600
*               BIT MUST SPECIFY ADDRESSING MODE.              @G860PLT 88289200
*        GPR2 - MUST CONTAIN THE ASID RIGHT ALIGNED OR ZERO.    *       88304800
*                                                               *       88320400
* OUTPUT:                                                       *       88336000
*    NONE.                                                      *       88351600
*                                                               *       88367200
* ATTRIBUTES:                                                   *       88382800
*    THE FUNCTION EXPANDS AS IN-LINE,REENTRANT CODE             *       88398400
*    AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES             *       88414000
*    IN THE CALLING CSECT.                                      *       88429600
*                                                               *       88445200
*    REGISTERS 0,1,14,15 will be modified in addition to    @L4A*       88450400
*    the UCB register.                                      @L4A*       88455600
*                                                               *       88460800
* OTHER:                                                        *       88476400
*    THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE          *       88492000
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS              *       88507600
*    IN THE CALLING CSECT ASSEMBLY:                             *       88523200
*         IEFUCBOB                                              *       88538800
*         CVT      DSECT=YES    (ATNMOD WITH REG= ONLY)         *       88554400
*         IECDIOCM              (ATNMOD WITH REG= ONLY)         *       88570000
*         IECDATB               (ATNMOD WITH REG= ONLY)         *       88585600
*                                                               *       88601200
*    NO LOCKS ARE REQUIRED FOR THIS FUNCTION IN THAT            *       88616800
*    ONLY SEQUENTIALLY ALLOCATED DEVICES ARE SUPPORTED          *       88632400
*    AND SERIALIZATION IS ASSUMED.                              *       88648000
*                                                               *       88663600
*****************************************************************       88679200
         SPACE 2                                                        88694800
*****************************************************************       88710400
*                                                               *       88726000
*        UCB - UNIT CONTROL BLOCK                               *       88741600
*              ATTENTION TABLE INDEX AND ERROR TABLE INDEX      *       88757200
*                                                               *       88772800
*****************************************************************       88788400
         SPACE                                                          88804000
IECITABG EQU   X'10'               ATNTABG (GRAPHICS)                   88819600
IECITABT EQU   X'14'               ATNTABT (TELEPROCESSING)             88835200
         SPACE                                                          88850800
.TP040   ANOP                                                           88866400
.*                                                                      88868400
.*       CONSTRUCT UNIQUE LABEL                                @03M     88870400
.*                                                                      88872400
&LABEL   SETC  '&SYSNDX'(2,3)           SET LAST 3 DIGITS      @03M     88874400
&NAME    LR    1,&UCB(1).               Get UCB address.       @L4A     88876800
         L     14,16(0,0)               Get CVT address.       @03A     88877800
         TM    116(14),B'00001000'      Test to see if CVTOSLVL         88878800
*                                       is addressable.        @04C     88879800
         BZ    IECIJ&LABEL              CVTOSLVL is not addressable     88880800
*                                       so must be pre 5.2.0   @03A     88881800
         TM    1265(14),B'00010000'     Test to see if the bit          88882800
*                                       (CVTH5520) is on.      @04C     88883800
         BZ    IECIJ&LABEL              The bit is not on so must       88884800
*                                       be pre 5.2.0           @03A     88885800
         IOSCMXR MF=S                   Get UCB Common Extension        88887200
*                                       address.               @L4A     88897600
         LR     &UCB(1).,1              Save result in UCB     @L4A     88908000
*                                       register.              @L4A     88918400
         B     IECIU&LABEL              Exit from get UCB Common        88919100
*                                       Extension.             @03A     88919800
IECIJ&LABEL DS 0H                       This system is pre 5.2.0        88920500
*                                       so get the UCB Common           88921200
*                                       extension ptr without using     88921900
*                                       IOSCMXR                @03A     88922600
         LR     &UCB(1).,1              Restore UCB reg        @03A     88923300
         L     &UCB(1).,UCBEXTPT-UCBOB(0,&UCB(1).)   Get EXTPTR         88924000
*                                                              @03A     88924700
         SLL   &UCB(1).,8               Clear High Order Byte  @03A     88925400
         SRL   &UCB(1).,8               of Extension pointer   @03A     88926100
IECIU&LABEL DS 0H                       Exit point for get UCB          88926800
*                                       Common Extension ptr   @03A     88927500
.*                                                                      88928800
.*       CHECK FOR TYPE OF ACTION                                       88944400
.*                                                                      88960000
         AIF   ('&VAR' EQ 'ATNMOD').TP060                               88975600
         AIF   (('&VAR' EQ 'ATNTABG') OR ('&VAR' EQ 'ATNTABT')).TP050   88991200
.*                                                                      89006800
.*       CONSTRUCT ERROR TABLE INDEX CODE                               89022400
.*                                                                      89038000
&INDEX   SETC  '&SYSNDX'(2,3)           SET TO LAST 3 DIGITS            89053600
IECIT&INDEX EQU   X'&VAR'               ERROR TABLE INDEX               89069200
         MVI   UCBETI-UCBCMEXT&UCB.,IECIT&INDEX  SET ERROR              89084800
*                                                *TABLE INDEX           89100400
         MEXIT                                                          89116000
.*                                                                      89131600
.*       SET UP ATTENTION TABLE INDEX                                   89147200
.*                                                                      89162800
.TP050   ANOP                                                           89178400
&INDEX   SETC  '&VAR'(5,3)                                              89194000
         MVI   UCBATI-UCBCMEXT&UCB.,IECIT&INDEX  SET ATTENTION          89209600
*                                                *TABLE INDEX           89225200
         MEXIT                                                          89240800
.TP060   ANOP                                                           89256400
         AIF   ('&REG' NE '').TP080                                     89272000
         STC   &TABLE(1).,UCBATI-UCBCMEXT(0,&UCB(1).)                   89287600
*                                  *SET ATTENTION TABLE INDEX           89303200
         MEXIT                                                          89318800
.*                                                                      89334400
.*       CONSTRUCT ATNMOD CODE                                 @03C     89350000
.*                                                                      89365600
.TP080   ANOP                                                           89381200
         STC   &TABLE(1).,UCBATI-UCBCMEXT(0,&UCB(1).)                   89412400
*                                  *SET ATTENTION TABLE INDEX           89428000
         LTR   &REG(1).,&REG(1)                                         89443600
*                                  *TEST FOR ATTENTION TABLE RTN ADDR   89459200
         BZ    IECIT&LABEL         NONE, EXIT                           89474800
         L     &UCB(1).,CVTPTR(0,0)  GET CVT PTR                        89490400
         L     &UCB(1).,CVTIXAVL-CVTMAP(0,&UCB(1).)                     89506000
*                                  *GET IOCOM PTR                       89521600
         L     &UCB(1).,IOCATTBL-IOCOM(0,&UCB(1).)                      89537200
*                                  *GET ATTENTION TABLE PTR             89552800
         SLL   &TABLE(1).,1(0)     DOUBLE INDEX                         89568400
         ALR   &UCB(1).,&TABLE(1)  POINT TO THIS ENTRY                  89584000
         ST    &REG(1).,ATBRTN-ATB(0,&UCB(1).)                          89599600
*                                  *SET ATTENTION TABLE ROUTINE ADDR    89615200
         LTR   &REG(2).,&REG(2)    *IS ASID PROVIDED                    89630800
         BZ    IECIT&LABEL         NO, EXIT                             89646400
         STH   &REG(2).,ATBASID-ATB(0,&UCB(1).)                         89662000
*                                  *SET ASID                            89677600
IECIT&LABEL DS 0H                  TP EXIT POINT                        89693200
         MEXIT                                                          89708800
.*****     *****     *****     *****     *****     *****     *****      89724400
.*****   DETECTOR    *****   DETECTOR    *****   DETECTOR    *****      89740000
.*****     *****     *****     *****     *****     *****     *****      89755600
.DET000  ANOP                                                           89771200
.*                                                                      89786800
.*                                                                      89802400
.*       CHECK PARAMETERS FOR ERRORS                                    89818000
.*                                                                      89833600
         AIF   ('&UCB' EQ '').IOSGEN3                                   89849200
.DET005  ANOP                                                  @OZ00805 89864800
         AIF   ('&IECIDET' EQ '1').DET010  CHECK FIRST TIME SWITCH      89880400
&IECIDET SETB  1                       SET SWITCH                       89896000
         SPACE 2                                                        89911600
*****************************************************************       89927200
*                                                               *       89942800
* FUNCTION:                                                     *       89958400
*    DETECTOR - DETERMINES IF A DEVICE IS A SHARED DASD         *       89974000
*         WHICH HAS BEEN RESERVED (HARDWARE OR SOFTWARE).       *       89989600
*                                                               *       90005200
*    LABEL  IOSGEN  DETECTOR,UCB=(REG),VAR=0                   @G860PLT 90020800
*                      - OR -                                  @G860PLT 90036400
*    LABEL  IOSGEN  DETECTOR,UCB=(REG),VAR=1,3 OR 4,REG=(REG)  @ZA79766 90052000
*                                                               *       90067600
*     PLS - GEN REFS(UCBOB,UCBTBYT2,UCBTBYT3,UCBSQC,UCBIEXT)       @L3C 90083200
*          (IOSGEN DETECTOR,UCB=(REG),VAR=0);                      @H1C 90098800
*                      - OR -                                  @ZA79766 90114400
*        (IOSGEN  DETECTOR,UCB=(REG),VAR=1,3 OR 4,REG=(REG));  @ZA79766 90130000
*                                                               *       90145600
*          NOTE: FOR VAR=3, UCBFLG6 MUST ALSO                      @L4C 90161200
*                BE INCLUDED ON THE REFS STATEMENT                 @H1A 90176800
*                                                               *       90192400
*                                                               *       90208000
* INPUT:                                                        *       90223600
*    UCB=  MUST SPECIFY A GPR (ABSOLUTE OR SYMBOLIC)            *       90239200
*    CONTAINING THE ADDRESS OF THE UCB COMMON SEGMENT TO        *       90254800
*    BE MODIFIED. THIS REGISTER WILL BE PRESERVED.              *       90270400
*                                                               *       90286000
*    VAR=  MAY BE SET TO 0,1,3 OR 4                            @ZA79766 90301600
*         0 - TEST WILL BE APPLIED TO THE SOFTWARE              *       90317200
*             RESERVE INDICATOR UCBSQC (RESERVE MACRO          @ZA79766 90332800
*             ISSUED BY SOFTWARE COMPONENT, HARDWARE           @ZA79766 90348400
*             RESERVE MAY OR MAY NOT BE IN EFFECT).            @ZA79766 90364000
*         1 - (DEFAULT) TEST WILL BE APPLIED TO THE             *       90379600
*             HARDWARE RESERVE INDICATOR UCBRESVH              @ZA79766 90395200
*             (RESERVE COMMAND ISSUED TO DEVICE).              @ZA79766 90410800
*         3 - THIS VARIATION WILL TEST FOR A DASD DEVICE       @ZA79766 90426400
*             THAT IS RESERVED OR AN ASSIGNABLE DEVICE THAT    @ZA79766 90442000
*             IS ASSIGNED. ONE WORK REGISTER MUST BE           @ZA79766 90457600
*             PROVIDED ON INPUT. EXAMPLE PROVIDED ABOVE.       @ZA79766 90473200
*         4 - TEST WILL BE APPLIED TO HARDWARE RESERVE         @ZA79766 90488800
*             INDICATORS UCBRESVH UCBRESVP AND UCBRRP          @ZA79766 90504400
*             (RESERVE ISSUED AND PENDING OR RESERVE           @ZA79766 90520000
*             ACTUALLY HELD BY THIS SYSTEM).                   @ZA79766 90535600
*                                                               *       90551200
*    REG= REQUIRED IF VAR=1, VAR=3, OR VAR=4 IS SPECIFIED.     @ZA79766 90566800
*         WORK REGISTER CONTENTS WILL BE DESTROYED.            @G860PLT 90582400
*                                                               *       90598000
* OUTPUT:                                                       *       90613600
*    FOR VAR=0,VAR=1, AND VAR=3:                               @ZA79766 90629200
*    UPON EXIT FROM THIS EXPANSION, THE CONDITION CODE WILL     *       90644800
*    BE SET TO REFLECT THE CONDITIONS TESTED.  A TEST IS        *       90660400
*    MADE FOR DIRECT ACCESS DEVICE TYPE, SHARED FILE,           *       90676000
*    AND RESERVED STATUS OR ASSIGN STATUS.                         @H1C 90691600
*         CC=0  THE CONDITIONS OF THE TESTS WERE NOT MET.       *       90707200
*         CC~=0 THE CONDITIONS OF THE TEST WERE MET.           @ZA79766 90722800
*                                                              @ZA79766 90738400
*    FOR VAR=4:                                                @ZA79766 90754000
*    UPON EXIT FROM THIS EXPANSION, THE CONTENTS OF THE WORK   @ZA79766 90769600
*    REGISTER PASSED WILL INDICATE THE RESULTS OF THE          @ZA79766 90785200
*    TESTS MADE. THE CONDITIONS WILL BE AS FOLLOWS:            @ZA79766 90800800
*         REG CONTENTS          MEANING                        @ZA79766 90816400
*               0          NON-DASD OR NON-SHARED DASD OR      @ZA79766 90832000
*                          RESERVE NOT ISSUED                  @ZA79766 90847600
*               4          SHARED DASD, RESERVE ISSUED,        @ZA79766 90863200
*                          RESERVE PENDING                     @ZA79766 90878800
*               8          SHARED DASD, RESERVE ISSUED,        @ZA79766 90894400
*                          RESERVE HELD BY THIS SYSTEM         @ZA79766 90910000
*    THE CONDITION CODE SETTING UPON EXIT FROM AN              @ZA79766 90925600
*    EXPANSION FOR VAR=4 IS IRRELEVANT.                        @ZA79766 90941200
*                                                               *       90956800
* ATTRIBUTES:                                                   *       90972400
*    THE FUNCTION EXPANDS AS IN-LINE,REENTRANT CODE            @G860PLT 90988000
*    AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES WITHIN     @G860PLT 91003600
*    THE SAME ASSEMBLY WITHOUT DUPLICATING SYMBOLS.            @G860PLT 91019200
*                                                               *       91034800
*    FOR VAR = 1,3,4 REGISTERS 0,1,14,15 WILL BE MODIFIED IN   @L4A     91038700
*    ADDITION TO THE REGISTER SUPPLIED IN REG.                 @L4A     91042600
*                                                               *       91046500
* OTHER:                                                        *       91050400
*    THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE          *       91066000
*    SPECIFICATION OF THE UCB MAPPING MACRO IEFUCBOB            *       91081600
*    IN THE CALLING CSECT ASSEMBLY.                             *       91097200
*                                                               *       91112800
*    NO LOCKS ARE REQUIRED FOR THIS FUNCTION.                   *       91128400
*                                                               *       91144000
*    UCB=() AND REG=() MUST NOT SPECIFY THE SAME REGISTER.      *       91159600
*                                                               *       91175200
*****************************************************************       91190800
         SPACE 2                                                        91206400
*****************************************************************       91222000
*                                                               *       91237600
*        UCB - UNIT CONTROL BLOCK                               *       91253200
*              REFERENCES AND SPECIAL EQUATES                   *       91268800
*                                                               *       91284400
*****************************************************************       91300000
         SPACE                                                          91315600
IECIDSHR EQU   X'20'               UCBRR                                91331200
IECID3DA EQU   X'20'               UCB3DACC                             91346800
IECIDAU  EQU   X'80'               ASSIGNABLE DEVICE               @H1A 91362400
IECIDHRC EQU   X'80'               UCBRESVH                    @YM01123 91378000
IECIDHRO EQU   X'21'               UCBRESVH OFFSET INTO THE PREFIX     X91393600
                                                                   @L3C 91409200
IECIDSRC EQU   X'FF'               TEST FOR SOFTWARE                    91424800
*                                  *RESERVE COUNT                       91440400
         SPACE                                                          91456000
.DET010  ANOP                                                           91471600
         AIF   (('&VAR' NE '0') AND ('&VAR' NE '1') AND                X91487200
                ('&VAR' NE '3') AND ('&VAR' NE '4') AND                X91502800
                ('&VAR' NE '')).IOSGEN3                        @ZA79766 91518400
         AIF   (('&VAR' NE '0') AND                                    X91534000
                (N'&REG LT 1)).IOSGEN2                         @G860PLT 91549600
.*                                                                      91565200
.*       CONSTRUCT UNIQUE LABEL SUFFIX                                  91580800
.*                                                                      91596400
&LABEL   SETC  '&SYSNDX'(2,3)           SET TO LAST 3 DIGITS            91612000
.*                                                                      91627600
&NAME    DS    0H                       IOSGEN DETECTOR            @H1A 91643200
         AIF   ('&VAR' EQ '3').DET015                              @H1A 91658800
.*       CONSTRUCT TESTS FOR DIRECT ACCESS AND SHARE                    91674400
.*                                                                      91690000
         AIF   ('&VAR' EQ '0').DET012                          @ZA79766 91705600
         SLR   &REG(1),&REG(1)     CLEAR WORK REGISTER         @ZA79766 91721200
.DET012  TM    UCBTBYT3-UCBOB&UCB.,IECID3DA  IS THIS A         @ZA79766 91736800
*                                  *DIRECT ACCESS DEVICE                91752400
         BZ    IECID&LABEL         NO, EXIT IMMEDIATELY                 91768000
         SPACE                                                          91783600
         TM    UCBTBYT2-UCBOB&UCB.,IECIDSHR  IS THIS                    91799200
*                                  *DEVICE SHAREABLE                    91814800
*                                  *BETWEEN CPU-S                       91830400
         BZ    IECID&LABEL         NO, EXIT IMMEDIATELY                 91846000
         SPACE                                                          91861600
.*                                                                      91877200
.*       IF VAR=0, THEN GENERATE SOFTWARE TEST                          91892800
.*       IF VAR=1 OR NULL,  THEN GENERATE HARDWARE TEST                 91908400
.*                                                                      91924000
         AIF   ('&VAR' EQ '0').DET020                                   91939600
.DET015  ANOP                                                      @H1A 91955200
         LR    1,&UCB                   Get UCB address.           @L4A 91963400
         IOSCMXR MF=S                   Get UCB Common Extension        91971600
*                                       address.                   @L4A 91979800
         LR     &REG(1).,1              Save result in UCB              91988000
*                                       register.                  @L4A 91996200
         L     &REG(1).,UCBIEXT-UCBCMEXT(&REG(1).) GET UCB PREFIX  @L3A 92004800
         AIF   ('&VAR' EQ '4').DET017                          @ZA79766 92017600
         TM    IECIDHRO&REG.,IECIDHRC TEST FOR HARDWARE        @G860PLT 92033200
*                                  *RESERVE                             92048800
         AIF   (('&VAR' EQ '1') OR                                     X92064400
                ('&VAR' EQ '')).DETXIT                         @ZA80428 92080000
.*                                                                 @H1A 92095600
.*      *************************************************          @H1A 92111200
.*       IF VAR=3, THEN CHECK IF A HARDWARE RESERVE IS             @H1A 92126800
.*       OUTSTANDING IF THIS IS EITHER A DASD OR AN                @H1A 92142400
.*       ASSIGNABLE DEVICE                                         @H1A 92158000
.*      *************************************************          @H1A 92173600
.*                                                                 @H1A 92189200
.*                                                                 @H1A 92204800
         BNO  IECID&LABEL          NO, EXIT IMMEDIATELY            @H1A 92220400
         TM    UCBTBYT3-UCBOB&UCB.,IECID3DA  IS THIS A             @H1A 92236000
*                                  *DIRECT ACCESS DEVICE           @H1A 92251600
         BO    IECID&LABEL         YES, GO TO EXIT                 @H1A 92267200
         LR    1,&UCB                   Get UCB address.           @L4A 92277600
         IOSCMXR MF=S                   Get UCB Common Extension        92288000
*                                       address.                   @L4A 92298400
         LR     &REG(1).,1              Save result in UCB              92308800
*                                       register.                  @L4A 92319200
         TM    UCBFL6-UCBCMEXT(&REG(1).),IECIDAU IS THIS AS ASSIGNABLE X92329600
                                   DEVICE?                         @H1A 92345200
         AGO   .DETXIT                                                  92360800
         SPACE                                                          92376400
.DET017  ANOP                                                  @ZA79766 92392000
         EJECT                                                 @ZA79766 92407600
         IC    &REG(1),IECIDHRO&REG.   GET RESERVE INFO        @ZA79766 92423200
*                                  *INTO WORK REGISTER         @ZA79766 92438800
         N     &REG(1),IECID&LABEL-4    AND OUT UNNEEDED BITS  @ZA79766 92454400
         CL    &REG(1),IECID&LABEL-4    HIGHER THAN X'A0'?     @ZA79766 92470000
         BE    IECIM&LABEL         YES, GO SET RC 4            @ZA79766 92485600
         CL    &REG(1),IECID&LABEL-8    NO, LOWER THAN X'80'?  @ZA79766 92501200
         BNL   IECIL&LABEL         NO, GO SET RC 8             @ZA79766 92516800
         LA    &REG(1),0           YES, THEN NOT RESERVED      @ZA79766 92532400
         B     IECID&LABEL         GO TO END                   @ZA79766 92548000
IECIL&LABEL LA    &REG(1),8        SET RC=8 AND                @ZA79766 92563600
         B     IECID&LABEL         GO TO END                   @ZA79766 92579200
IECIM&LABEL LA    &REG(1),4        SET RC=4 AND                @ZA79766 92594800
         B     IECID&LABEL         GO TO END                   @ZA79766 92610400
         DS   0F                                               @ZA79766 92626000
         DC   X'00000080'          UCBRESVH ONLY               @ZA79766 92641600
         DC   X'000000B0'          UCBRESVP, UCBRESVH, UCBRRP  @ZA79766 92657200
***************************************************************@ZA79766 92672800
*                                                             *@ZA79766 92688400
*       VAR=4 INTERPRETATION OF UCB RESERVE BIT SETTINGS      *@ZA79766 92704000
*_____________________________________________________________*@ZA79766 92719600
*   | U  | U  |    |                               |          *@ZA79766 92735200
*   | C S| C S|   S|                               |          *@ZA79766 92750800
* C | B E| B E| U E|                               |          *@ZA79766 92766400
* A | R T| R T| C T|                               |          *@ZA79766 92782000
* S | E T| E T| B T|                               |MACRO     *@ZA79766 92797600
* E | S I| S I| R I|                               |WILL SET  *@ZA79766 92813200
*   | V N| V N| R N|                               |WORK REG  *@ZA79766 92828800
* # | H G| P G| P G| MEANING:                      |TO:       *@ZA79766 92844400
*_____________________________________________________________*@ZA79766 92860000
* 1 |  0 |  0 |  0 | RESERVE NOT ISSUED            |    0     *@ZA79766 92875600
*_____________________________________________________________*@ZA79766 92891200
* 2 |  0 |  0 |  1 | UNIT CHECK HAS OCCURRED ON    |    0     *@ZA79766 92906800
*   |    |    |    | STANDALONE RELEASE            |          *@ZA79766 92922400
*_____________________________________________________________*@ZA79766 92938000
* 3 |  0 |  1 |  0 | SHOULD NOT OCCUR              |    0     *@ZA79766 92953600
*_____________________________________________________________*@ZA79766 92969200
* 4 |  0 |  1 |  1 | SHOULD NOT OCCUR              |    0     *@ZA79766 92984800
*_____________________________________________________________*@ZA79766 93000400
* 5 |  1 |  0 |  0 | SHOULD NOT OCCUR              |    8     *@ZA79766 93016000
*   |    |    |    | (TREATED AS RESERVED)         |          *@ZA79766 93031600
*_____________________________________________________________*@ZA79766 93047200
* 6 |  1 |  0 |  1 | RELEASE PENDING, RESERVE      |    8     *@ZA79766 93062800
*   |    |    |    | HELD                          |          *@ZA79766 93078400
*_____________________________________________________________*@ZA79766 93094000
* 7 |  1 |  1 |  0 | RESERVE HELD                  |    8     *@ZA79766 93109600
*_____________________________________________________________*@ZA79766 93125200
* 8 |  1 |  1 |  1 | RESERVE ISSUED, RESERVE       |    4     *@ZA79766 93140800
*   |    |    |    | PENDING                       |          *@ZA79766 93156400
*_____________________________________________________________*@ZA79766 93172000
***************************************************************@ZA79766 93187600
         AGO   .DETXIT                                         @ZA79766 93203200
.DET020  ANOP                                                           93218800
         TM    UCBSQC-UCBOB&UCB.,IECIDSRC  TEST FOR                     93234400
*                                  *SOFTWARE RESERVE                    93250000
.DETXIT  ANOP                                                           93265600
IECID&LABEL DS 0H                  DETECTOR EXIT POINT                  93281200
         MEXIT                                                          93296800
.*****     *****     *****     *****     *****     *****       @Y30LPLC 93312400
.*****    SETVOID    *****    SETVOID    *****    SETVOID      @Y30LPLC 93328000
.*****     *****     *****     *****     *****     *****       @Y30LPLC 93343600
.SV000   ANOP                                                  @Y30LPLC 93359200
.*                                                             @Y30LPLC 93374800
.*       CHECK PARAMETERS FOR ERRORS                           @Y30LPLC 93390400
.*                                                             @Y30LPLC 93406000
         AIF   (('&VAR' EQ '(PURGE,A)') AND                            X93421600
                (N'&REG GT 1)).SV005            2 REG REQUIRED @G860PLT 93437200
         AIF   (('&VAR' EQ '(PURGE,R)') AND                            X93452800
                (N'&REG GT 0)).SV005            1 REG REQUIRED @G860PLT 93468400
         AIF   (N'&REG LT 4).IOSGEN2                           @Y30LPLC 93484000
.SV005   ANOP                                                           93499600
         AIF   ('&IECISV' EQ '1').SV008  CHECK FIRST TIME SWITCH        93515200
&IECISV  SETB  1                         SET SWITCH                     93530800
         SPACE 2                                                        93546400
************************************************************** @Y30LPLC 93562000
*                                                              @Y30LPLC 93577600
* FUNCTION:                                                    @Y30LPLC 93593200
*    SETVOID - WILL INITIALIZE ENTRIES IN THE VOID TABLE       @Y30LPLC 93608800
*              (VECTOR OF IOS DRIVERS).                        @Y30LPLC 93624400
*                                                              @Y30LPLC 93640000
*    LABEL    IOSGEN SETVOID,VAR=PURGE OR RESTORE OR EXTENT,   @Y30LPLC 93655600
*                            REG=(GPR1,GPR2,GPR3,GPR4)         @G860PLT 93671200
*                                                              @G860PLT 93686800
*                           - OR -                             @G860PLT 93702400
*                                                              @G860PLT 93718000
*    LABEL    IOSGEN SETVOID,VAR=(PURGE,A),                    @G860PLT 93733600
*                    REG=(GPR1,GPR2)                           @G860PLT 93749200
*                                                              @G860PLT 93764800
*                           - OR -                             @G860PLT 93780400
*                                                              @G860PLT 93796000
*    LABEL    IOSGEN SETVOID,VAR=(PURGE,R),                    @G860PLT 93811600
*                    REG=(GPR1)                                @G860PLT 93827200
*                                                              @G860PLT 93842800
*    LABEL    IOSGEN SETVOID,VAR=NOTIF,                            @P5A 93846700
*                    REG=(GPR1,GPR2,GPR3,GPR4)                     @P5A 93850600
*                                                                  @P5A 93854500
*                                                              @G860PLT 93858400
*    PLS - GEN REFS(CVTPTR,CVTMAP,CVTIXAVL,IOCOM,IOCVOID,      @Y30LPLC 93874000
*          VOIENTRY AND VOIEXTNT OR VOIRSTR OR VOIPRG )        @G860PLT 93889600
*          IF (PURGE,A OR R) IS SPECIFIED, VOIPRGCT,           @G860PLT 93905200
*          IOCVOICT AND IOCVOILN SHOULD ALSO BE ADDED          @G860PLT 93920800
*          TO REFS LIST.                                       @G860PLT 93936400
*                                                              @Y30LPLC 93952000
*          (IOSGEN SETVOID,...KEYWORDS AS IN BAL);             @Y30LPLC 93967600
*                                                              @Y30LPLC 93983200
* INPUT:                                                       @Y30LPLC 93998800
*    IF VAR=(PURGE,A OR R), REGISTER 13 MUST POINT TO          @G860PLT 94014400
*         AN 18 WORD SAVE AREA.                                @G860PLT 94030000
*                                                              @Y30LPLC 94045600
*    VAR= PURGE    - SET DRIVER PURGE VOID ENTRY               @Y30LPLC 94061200
*         (PURGE,A)-SET DRIVER PURGE VOID ENTRY WITH USE COUNT @ZA04107 94076800
*         (PURGE,R)-REMOVE DRIVER PURGE VOID ENTRY WITH USE    @ZA04107 94092400
*                   COUNT                                      @ZA04107 94108000
*         RESTORE  - SET DRIVER RESTORE VOID ENTRY             @Y30LPLC 94123600
*         EXTENT   - SET DRIVER END OF EXTENT VOID ENTRY       @Y30LPLC 94139200
*         NOTIF    - SET DRIVER NOTIFICATION EXIT ENTRY            @P5A 94147000
*                                                              @Y30LPLC 94154800
*    REG=                                                      @G860PLT 94170400
*                                                                       94186000
*       IF VAR=(PURGE,A) IS SPECIFIED, TWO REGISTERS ARE       @G860PLT 94201600
*       REQUIRED:                                              @G860PLT 94217200
*         GPR1 - CONTAINS THE DRIVER ID RIGHT ALIGNED.         @Y30LPLC 94232800
*         GPR2 - CONTAINS ENTRY POINT ADDRESS FOR VOID.        @Y30LPLC 94248400
*                THE HIGH ORDER BIT MUST CONTAIN THE           @G860PLT 94264000
*                ADDRESSING MODE.                              @G860PLT 94279600
*                                                                       94295200
*       IF VAR=(PURGE,R) IS SPECIFIED, ONE REGISTER IS         @G860PLT 94310800
*       REQUIRED:                                              @G860PLT 94326400
*         GPR1 - CONTAINS THE DRIVER ID RIGHT ALIGNED.         @G860PLT 94342000
*                                                              @G860PLT 94357600
*       FOR ALL OTHER OPTIONS, FOUR REGISTERS ARE REQUIRED:    @G860PLT 94373200
*         GPR1 - CONTAINS THE DRIVER ID RIGHT ALIGNED.         @Y30LPLC 94388800
*         GPR2 - CONTAINS ENTRY POINT ADDRESS FOR VOID.        @Y30LPLC 94404400
*                THE HIGH ORDER BIT MUST CONTAIN THE           @G860PLT 94420000
*                ADDRESSING MODE.                              @G860PLT 94435600
*         GPR3 - WORK REGISTER. CONTENTS WILL BE DESTROYED     @Y30LPLC 94451200
*         GPR4 - WORK REGISTER. CONTENTS WILL BE DESTROYED     @Y30LPLC 94466800
*                                                              @Y30LPLC 94482400
* OUTPUT:                                                      @Y30LPLC 94498000
*        SPECIFIED VOID TABLE ENTRY WILL BE SET.               @Y30LPLC 94513600
*        FOR VAR=(PURGE,A OR R) THE USE COUNT WILL BE          @G860PLT 94529200
*        INCREMENTED FOR 'A', DECREMENTED FOR 'R'. WHEN THE    @G860PLT 94544800
*        COUNT REACHES ZERO THE ENTRY WILL BE SET TO THE       @G860PLT 94560400
*        ADDRESS OF A BSM 0,14 INSTRUCTION WHICH IS LOCATED    @G860PLT 94576000
*        AT THE END OF THE VOID TABLE.                         @G860PLT 94591600
*                                                              @Y30LPLC 94607200
* ATTRIBUTES:                                                  @Y30LPLC 94622800
*    THE FUNCTION EXPANDS AS IN-LINE, REENTRANT CODE AND MAY   @Y30LPLC 94638400
*    BE EXPANDED A VARIABLE NUMBER OF TIMES IN THE CALLING     @Y30LPLC 94654000
*    CSECT.                                                    @Y30LPLC 94669600
*                                                              @Y30LPLC 94685200
* RESTRICTIONS:                                                @ZMC0141 94700800
*    WHEN VAR=(PURGE, A OR R) IS USED, THERE CAN BE NO         @ZMC0141 94716400
*    NO OUTSTANDING USINGS ON REGISTER 15.                     @ZMC0141 94732000
*                                                              @ZMC0141 94747600
* OTHER:                                                       @Y30LPLC 94763200
*    THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE         @Y30LPLC 94778800
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS IN          @Y30LPLC 94794400
*    THE CALLING CSECT ASSEMBLY                                @Y30LPLC 94810000
*        CVT   DSECT=YES                                       @Y30LPLC 94825600
*        IECDIOCM                                              @Y30LPLC 94841200
*        IECDVOID                                              @Y30LPLC 94856800
*                                                              @Y30LPLC 94872400
************************************************************** @Y30LPLC 94888000
.SV008   ANOP                                                           94903600
&LABEL   SETC  '&SYSNDX'(2,3)                                  @ZA04107 94919200
         AIF   ('&VAR' EQ '(PURGE,A)').SV050                   @G860PLT 94934800
         AIF   ('&VAR' EQ '(PURGE,R)').SV050                   @G860PLT 94950400
         L     &REG(3).,CVTPTR(0,0)     GET CVT PTR            @Y30LPLC 94966000
         L     &REG(3).,CVTIXAVL-CVTMAP(0,&REG(3).) GET IOCOM  @Y30LPLC 94981600
         L     &REG(3).,IOCVOID-IOCOM(0,&REG(3).) GET VOID PTR @Y30LPLC 94997200
         LR    &REG(4).,&REG(1)         COPY DRIVER ID         @Y30LPLC 95012800
         SLL   &REG(4).,4               DRIVER ID * 16         @G860PLT 95028400
         SLL   &REG(1).,3               DRIVER ID * 8          @Y30LPLC 95044000
         ALR   &REG(1).,&REG(4)         VOID INDEX = 24        @G860PLT 95059600
*                                        DRIVER ID             @Y30LPLC 95075200
         AIF   ('&VAR' EQ 'PURGE').SV010                       @Y30LPLC 95090800
         AIF   ('&VAR' EQ 'NOTIF').SV015                           @P5A 95098600
         AIF   ('&VAR' EQ 'RESTORE').SV020                     @Y30LPLC 95106400
         AIF   ('&VAR' EQ 'EXTENT').SV030                      @Y30LPLC 95122000
         AGO   .IOSGEN3                                        @Y30LPLC 95137600
.SV010   ANOP                                                  @Y30LPLC 95153200
         ST    &REG(2).,VOIPRG-VOIENTRY(&REG(1).,&REG(3).)     @Y30LPLC 95168800
         MEXIT                                                 @Y30LPLC 95184400
.SV015   ANOP                                                      @P5A 95188300
         ST    &REG(2).,VOINOTE-VOIENTRY(&REG(1).,&REG(3).)        @P5A 95192200
         MEXIT                                                     @P5A 95196100
.SV020   ANOP                                                  @Y30LPLC 95200000
         ST    &REG(2).,VOIRSTR-VOIENTRY(&REG(1).,&REG(3).)    @Y30LPLC 95215600
         MEXIT                                                 @Y30LPLC 95231200
.SV030   ANOP                                                  @Y30LPLC 95246800
         ST    &REG(2).,VOIEXTNT-VOIENTRY(&REG(1).,&REG(3).)   @Y30LPLC 95262400
         MEXIT                                                 @Y30LPLC 95278000
.SV050   ANOP                                                  @G860PLT 95293600
         AIF   (N'&REG NE 4).SV055                             @G860PLT 95309200
         MNOTE 0,'***WARNING: VAR=&VAR REQUIRES THE ADDRESS OF AN 18 WOX95324800
               RD SAVE AREA TO BE PASSED IN REGISTER 13 AND NO LONGER RX95340400
               EQUIRES THE WORK REGS TO BE SUPPLIED IN THE REG PARAM.'  95356000
.*                                                             @G860PLT 95371600
.SV055   ANOP                                                  @G860PLT 95387200
         STM   14,12,12(13)            SAVE REGISTERS          @G860PLT 95402800
         LR    3,&REG(1)               LOAD DRIVER ID IN REG3  @G860PLT 95418400
         BALR  15,0                   ESTABLISH ADDRESSABILITY @ZMC0141 95434000
         PUSH  USING                   Save active usings          @P4A 95439200
         DROP  ,                       Drop all usings             @P4A 95444400
         USING *,15                                            @ZMC0141 95449600
         L     5,CVTPTR(0,0)           GET CVT ADDRESS         @G860PLT 95465200
         L     5,CVTIXAVL-CVTMAP(0,5)  REG5 = ADDRESS OF IOCOM @G860PLT 95480800
         L     4,IOCVOID-IOCOM(0,5)    REG4 = ADDRESS OF VOID  @G860PLT 95496400
*                                      TABLE                   @G860PLT 95512000
         LH    10,IOCVOILN-IOCOM(0,5)  REG10= LENGTH OF VOID   @G860PLT 95527600
*                                      ENTRY                   @G860PLT 95543200
         MR    2,10                    VOID INDEX = DRIVER ID  @G860PLT 95558800
*                                      * LENGTH OF VOID ENTRY  @G860PLT 95574400
         ALR   3,4                     ADDRESS OF VOID ENTRY = @G860PLT 95590000
*                                      ADDRESS OF VOID TABLE + @G860PLT 95605600
*                                      VOID INDEX              @G860PLT 95621200
         L     6,VOIPRG-VOIENTRY(0,3)  CURRENT PURGE ADDRESS   @G860PLT 95636800
         L     7,VOIPRGCT-VOIENTRY(0,3) CURRENT PURGE COUNT    @G860PLT 95652400
         AIF   ('&VAR' EQ '(PURGE,R)').SV060                   @G860PLT 95668000
         L     8,20+4*&REG(2).-64*(&REG(2)./14)(0,13)          @G860PLT 95683600
*                                      GET NEW PURGE ADDRESS   @G860PLT 95699200
*                                      FROM SAVE AREA          @G860PLT 95714800
IECIS&LABEL DS 0H                                              @G860PLT 95730400
         LR    9,7                     COPY PURGE COUNT        @G860PLT 95746000
         LA    9,1(9)                  ADD +1 TO PURGE COUNT   @G860PLT 95761600
         CDS   6,8,VOIPRG-VOIENTRY(3)                          @G860PLT 95777200
         BNZ   IECIS&LABEL                                     @G860PLT 95792800
         LM    14,12,12(13)            RESTORE REGISTERS       @G860PLT 95808400
         DROP  15                                              @ZMC0141 95824000
         POP   USING                   Restore usings              @P4A 95831800
         MEXIT                                                 @G860PLT 95839600
.SV060   ANOP                                                  @G860PLT 95855200
         MH    10,IOCVOICT-IOCOM(5)    LENGTH OF VOID TABLE =  @G860PLT 95870800
*                                      LENGTH OF VOID ENTRY    @G860PLT 95886400
*                                      NUMBER OF ENTRIES       @G860PLT 95902000
         ALR   10,4                    ADDR OF BSM 0,14 ROUTINE@G860PLT 95917600
*                                      AT END OF VOID TABLE =  @G860PLT 95933200
*                                      LENGTH OF VOID TABLE +  @G860PLT 95948800
*                                      START OF VOID TABLE.    @G860PLT 95964400
IECIS&LABEL DS 0H                                              @G860PLT 95980000
         LR    8,10                    LOAD BSM 0,14 ADDRESS   @G860PLT 95995600
         LR    9,7                     COPY PURGE COUNT        @G860PLT 96011200
         BCTR  9,0                     DECREMENT PURGE COUNT   @G860PLT 96026800
*                                      BY 1                    @G860PLT 96042400
         LTR   9,9                     IS COUNT NOW ZERO       @G860PLT 96058000
         BZ    IECIT&LABEL             YES, USE BSM 0,14       @G860PLT 96073600
*                                      ADDRESS                 @G860PLT 96089200
         LR    8,6                     NO, KEEP CURRENT        @G860PLT 96104800
*                                      PURGE ADDRESS           @G860PLT 96120400
IECIT&LABEL DS 0H                                              @G860PLT 96136000
         CDS   6,8,VOIPRG-VOIENTRY(3)                          @G860PLT 96151600
         BNZ   IECIS&LABEL                                     @G860PLT 96167200
         LM    14,12,12(13)            RESTORE REGISTERS       @G860PLT 96182800
         DROP  15                                              @ZMC0141 96198400
         POP   USING                   Restore usings              @P4A 96206200
         MEXIT                                                 @G860PLT 96214000
.*****     *****     *****     *****     *****     *****     *****      96229600
.*****    SETVOIDC   *****    SETVOIDC   *****    SETVOIDC   *****      96245200
.*****     *****     *****     *****     *****     *****     *****      96260800
.SVC000  ANOP                                                           96276400
         AIF   ('&IECISVC' EQ '1').SVC010    NOT 1ST TIME, BYPASS PROLG 96292000
&IECISVC SETB  1                             NEXT TIME BYPASS PROLOGUE  96307600
         SPACE 2                                                        96323200
*********************************************************************** 96338800
*                                                                       96354400
*  FUNCTION: SETVOIDC - MODIFY VOID (VECTOR OF IOS DRIVERS). IOSGEN     96370000
*                       SETVOIDC PERFORMS THE SAME FUNCTION AS SETVOID  96385600
*                       BUT IT IS COMPATIBLE WITH MVS/370. THE MACRO    96401200
*                       INTERFACE IS AS FOLLOWS.                        96416800
*                                                                       96432400
*        LABEL IOSGEN SETVOIDC,VAR=PURGE OR RESTORE OR EXTENT,          96448000
*                             REG=(GPR1,GPR2)                           96463600
*                        OR                                             96479200
*        LABEL IOSGEN SETVOIDC,VAR=(PURGE,A),REG=(GPR1,GPR2)            96494800
*                        OR                                             96510400
*        LABEL IOSGEN SETVOIDC,VAR=(PURGE,R),REG=GPR1                   96526000
*                                                                       96541600
*        PLS - GEN REFS(CVTPTR,CVTMAP,CVTIXAVL,IOCOM,IOCGENA)           96557200
*                                                                       96572800
*  INPUT:  REGISTER 13 POINTS TO AN 18 WORD SAVE AREA FOR ALL           96588400
*          INVOCATIONS.                                                 96604000
*          GPR1 - CONTAINS THE DRIVER ID RIGHT ALIGNED                  96619600
*          GPR2 - CONTAINS THE ADDRESS TO BE STORED IN THE VOID         96635200
*                 (NOT REQUIRED FOR VAR=(PURGE,R)                       96650800
*                                                                       96666400
*  OUTPUT: THE VOID INDICATED BY THE DRIVER ID IS MODIFIED.             96682000
*          VAR=PURGE     THE ADDRESS IN GPR2 IS PLACED IN THE PURGE     96697600
*                        SLOT FOR THE VOID ENTRY INDICATED BY THE       96713200
*                        DRIVER ID IN GPR1.                             96728800
*          VAR=(PURGE,A) SAME AS VAR=PURGE PLUS ADD ONE TO THE USE      96744400
*                        COUNT                                          96760000
*          VAR=(PURGE,R) DECREASE PURGE USE COUNT BY ONE. IF COUNT      96775600
*                        GOES TO ZERO, REPLACE ADDRESS IN THE PURGE     96791200
*                        SLOT WITH THE ADDRESS OF SR 15,15   BSM 0,14   96806800
*                        INSTRUCTIONS.                                  96822400
*          VAR=RESTORE   THE ADDRESS IN GPR2 IS PLACED IN THE RESTORE   96838000
*                        SLOT FOR THE VOID ENTRY INDICATED BY THE       96853600
*                        DRIVER ID IN GPR1.                             96869200
*          VAR=EXTENT    THE ADDRESS IN GPR2 IS PLACED IN THE EXTENT    96884800
*                        SLOT FOR THE VOID ENTRY INDICATED BY THE       96900400
*                        DRIVER ID IN GPR1.                             96916000
*                                                                       96931600
*  ATTRIBUTES: THE FUNCTION EXPANDS TO BRANCH OUT OF LINE. THE          96947200
*              INLINE PORTION OF THE FUNCTION IS REENTRANT AND          96962800
*              REFRESHABLE. IT MAY BE EXPANDED ANY NUMBER OF TIMES      96978400
*              WITHIN A CALLING CSECT.                                  96994000
*                                                                       97009600
*  RESTRICTIONS: NONE                                                   97025200
*                                                                       97040800
*  OTHER: THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE             97056400
*         SPECIFICATION OF THE FOLLOWING MAPPING MACROS IN THE          97072000
*         INVOKING CSECT:  CVT DSECT=YES   IECDIOCM                     97087600
*                                                                       97103200
**********************************************************************  97118800
.SVC010  ANOP                                                           97134400
.*000000-999999                                                @G860PLM 97150000
.*                                                                      97165600
.*       CHECK FOR PARAMETER ERRORS                                     97181200
.*                                                                      97196800
         AIF   ('&REG(1)' EQ '13').IOSGEN3                              97212400
         AIF   (('&VAR' EQ '(PURGE,R)') AND (N'&REG EQ 1)).SVC020       97228000
         AIF   (N'&REG NE 2).IOSGEN3              WRONG NUMBER REGS     97243600
         AIF   ('&REG(2)' EQ '13').IOSGEN3                              97259200
         AIF   ('&VAR' EQ '(PURGE,A)').SVC020                           97274800
         AIF   ('&VAR' EQ 'PURGE').SVC020                               97290400
         AIF   ('&VAR' EQ 'RESTORE').SVC020                             97306000
         AIF   ('&VAR' EQ 'EXTENT').SVC020                              97321600
         AGO   .IOSGEN3                         PARAM ERROR             97337200
.SVC020  ANOP                                                           97352800
&NAME    DS    0H                                                       97368400
         STM   14,12,12(13)                            SAVE REGISTERS   97384000
         LR    &REG(1).,&REG(1)                        VALIDATE REG     97399600
         L     1,20+4*&REG(1).-64*(&REG(1)./14)(0,13)  DRIVER ID        97415200
         AIF   ('&VAR' EQ '(PURGE,R)').SVC700                           97430800
         LR    &REG(2).,&REG(2)                        VALIDATE REG     97446400
         L     0,20+4*&REG(2).-64*(&REG(2)./14)(0,13)  DRIVER ADDRESS   97462000
         AIF   ('&VAR' EQ '(PURGE,A)').SVC100                           97477600
         AIF   ('&VAR' EQ 'PURGE').SVC200                               97493200
         AIF   ('&VAR' EQ 'RESTORE').SVC300                             97508800
         LA    2,12                                    VAR=EXTENT       97524400
         AGO   .SVC800                                                  97540000
.SVC100  ANOP                                                           97555600
         LA    2,8                                     VAR=(PURGE,A)    97571200
         AGO   .SVC800                                                  97586800
.SVC200  ANOP                                                           97602400
         LA    2,4                                     VAR=PURGE        97618000
         AGO   .SVC800                                                  97633600
.SVC300  ANOP                                                           97649200
         LA    2,16                                    VAR=RESTORE      97664800
         AGO   .SVC800                                                  97680400
.SVC700  ANOP                                                           97696000
         SR    0,0                                     NO DRIVER ADDR   97711600
         SR    2,2                                     VAR=(PURGE,R)    97727200
.SVC800  ANOP                                                           97742800
         L     15,CVTPTR(0,0)                          CVT ADDRESS      97758400
         L     15,CVTIXAVL-CVTMAP(0,15)                IOCOM ADDRESS    97774000
         L     15,IOCGENA-IOCOM(0,15)                  IECVGENA ADDR    97789600
         BAL   14,24(15)                               UPDATE VOID      97805200
         LM    14,12,12(13)                            RESTORE REGS     97820800
         MEXIT                                                          97836400
.WT000   ANOP                                                  @D1A     97852000
         AIF   ('&IECIWTO' EQ '1').WT010                       @D1A     97867600
&IECIWTO SETB  1                                               @D1A     97883200
**********************************************************************  97898800
*                                                                    *  97914400
*   FUNCTION:                                                        *  97930000
*      WTOID - THE PURPOSE OF THIS FUNCTION IS TO ALLOW THE CALLER   *  97945600
*              TO PASS THE WTO IDENTIFICATION NUMBER OF A MESSAGE    *  97961200
*              THAT THE CALLER WANTS DOM'ED WHENEVER AN UNSOLICITED  *  97976800
*              DEVICE END OCCURS.  THIS FUNCTION UPDATES THE         *  97992400
*              UCBWTOID FIELD USING THE ID PASSED BY THE CALLER.  IF *  98008000
*              THE UCBWTOID FIELD ALREADY CONTAINS A MESSAGE, IT     *  98023600
*              WILL BE DOM'ED BEFORE THE NEW MESSAGE IS INSERTED.    *  98039200
*                                                                    *  98054800
*   MACRO CALL:                                                      *  98070400
*      LABEL IOSGEN WTOID,ID=VAR OR (REG),UCB=VAR OR (REG),          *  98080800
*                   DOM=SVC OR BRANCH                                *  98091200
*                                                                    *  98101600
*         PLS - GEN REFS(CVTIXAVL,CVTMAP,CVTPTR,IOCOM,IOCGENA)       *  98117200
*               (IOSGEN WTOID,...KEYWORDS AS IN BAL);                *  98132800
*                                                                    *  98148400
*   INPUT:                                                           *  98164000
*      REGISTER 13 MUST POINT TO AN 18 WORD SAVEAREA                 *  98179600
*                                                                    *  98195200
*      UCB= SPECIFIES THE ADDRESS OF THE UCB COMMON SEGMENT.  IF THE *  98210800
*      GIVEN PARAMETER SPECIFIES A GENERAL PURPOSE REGISTER          *  98226400
*      (ABSOLUTE OR SYMBOLIC) IT MUST BE IN THE RANGE OF 0, 2-12.    *  98242000
*      IF THE GIVEN PARAMETER SPECIFIES A VARIABLE, IT MUST BE THE   *  98257600
*      LABEL OF THE UCB (AN LA WILL BE PERFORMED ON THE PARAMETER).  *  98273200
*                                                                    *  98288800
*      ID= THE RIGHTMOST 24 BITS OF THE PARAMETER (WHETHER VARIABLE  *  98304400
*      OR REGISTER) WILL CONTAIN THE WTO IDENTIFICATION NUMBER.  IF  *  98320000
*      A REGISTER IS USED, IT MUST BE IN THE RANGE OF 0-12.          *  98335600
*                                                                    *  98351200
*      DOM= THE LINKAGE USED TO ISSUE THE DOM.  THE DEFAULT IS SVC   *  98353400
*      ENTRY.  BRANCH ENTRY SHOULD BE USED WHEN IN SRB MODE, WHEN    *  98355600
*      DISABLED FOR INTERRUPTS, WHEN LOCKS ARE HELD, OR WHEN THE     *  98357800
*      PRIMARY ADDRESS SPACE IS NOT THE SAME AS THE HOME ADDRESS     *  98360000
*      SPACE.                                                        *  98362200
*                                                                       98364400
*   RESTRICTIONS:                                                    *  98366800
*      THE INVOKER OF THIS FUNCTION MUST BE IN KEY 0, ENABLED, TASK  *  98382400
*      MODE.  THE INVOKER CANNOT HOLD ANY LOCKS, UNLESS              *  98392800
*      DOM=BRANCH IS USED IN THE WTOID FUNCTION.                     *  98403200
*                                                                    *  98413600
*   DEPENDENCIES:                                                    *  98429200
*      THE FOLLOWING MAPPING MACROS ARE REQUIRED:                    *  98444800
*         CVT DSECT=YES                                              *  98460400
*         IECDIOCM                                                   *  98476000
*                                                                    *  98491600
**********************************************************************  98507200
*                                                                       98522800
*   REGISTER EQUATES                                                    98538400
*                                                                       98554000
IECWTOID EQU   1               WTOID WILL BE LOADED INTO REG 1     @D1A 98569600
IECWTODM EQU   2               DOM ENTRY TYPE WILL BE IN REG 2     @L2A 98577400
IECWUCB  EQU   6               WILL BE LOADED WITH THE UCB ADDRESS @D1A 98585200
IECWRET  EQU   14              RETURN POINT FROM IECVGENA          @D1A 98600800
IECWENT  EQU   15              ENTRY POINT TO IECVGENA             @D1A 98616400
*                                                                       98632000
*   DOM ENTRY TYPE EQUATES                                              98634600
*                                                                       98637200
DOMSVC   EQU   0               VALUE 0 INDICATES SVC DOM           @L2A 98639800
DOMBRCH  EQU   1               VALUE 1 INDICATES BRANCH            @L2A 98642400
*                                                                       98645000
.WT010   ANOP                                                      @D1A 98647600
         AIF   ('&ID' EQ '').IOSGEN3      IF PARAM MISSING, PRINT MNOTEX98663200
                                                                   @D1A 98678800
         AIF   ('&UCB' EQ '').IOSGEN3     IF PARAM MISSING, PRINT MNOTEX98694400
                                                                   @D1A 98710000
         AIF   (('&DOM' NE 'BRANCH') AND                               X98713900
                ('&DOM' NE 'SVC')).IOSGEN3 IF THE DOM FIELD IS          98717800
*                                         INCORRECT, PRINT MNOTE   @P2A 98721700
&NAME    STM   14,12,12(13)               STORE REGS IN SAVEAREA   @D1C 98725600
         AIF   ('&ID'(1,1) EQ '(').WT020  CHECK IF ID COMING IN REG@D1A 98741200
         L     IECWTOID,&ID               GET ID FROM STORAGE      @D1A 98756800
         AGO   .WT030                     GO TO UCB CHECK          @D1A 98772400
.WT020   AIF   ('&ID' EQ '(1)').WT030     IF IN REG 1, DON'T LOAD  @D1A 98788000
         LR    IECWTOID,&ID(1)            LOAD ID INTO PARAM REG   @D1A 98803600
*                                                                       98811400
.WT030   AIF   ('&UCB'(1,1) EQ '(').WT040 CHECK IF UCB COMING IN REG   X98819200
                                                                   @D1A 98834800
         LA    IECWUCB,&UCB               GET UCB ADDRESS          @D1A 98850400
         AGO   .WT050                     BYPASS REG CHECK BELOW   @D1A 98866000
.WT040   AIF   ('&UCB' EQ '(6)').WT050    IF IN REG 6, DON'T LOAD  @D1A 98881600
         LR    IECWUCB,&UCB               COPY UCB                 @D1A 98897200
*                                                                       98898700
.WT042   AIF   ('&DOM' EQ 'BRANCH').WT044 CHECK FOR SVC OR BRANCH  @L2A 98900200
*                                         ENTRY DOM                     98901700
         LA    IECWTODM,DOMSVC            INDICATE SVC DOM BY      @L2A 98903200
*                                         SETTING TO 0.                 98904700
         AGO   .WT050                                              @L2A 98906200
.WT044   LA    IECWTODM,DOMBRCH           INDICATE BRANCH ENTRY    @L2A 98907700
*                                         DOM BY SETTING TO 1.          98909200
*                                                                       98910700
.WT050   L     IECWENT,CVTPTR(0,0)        GET CVT POINTER          @D1A 98912800
         L     IECWENT,CVTIXAVL-CVTMAP(0,IECWENT)  GET IOCOM PTR   @D1A 98928400
         L     IECWENT,IOCGENA-IOCOM(0,IECWENT)    GET IECVGENA PTR@D1A 98944000
         BAL   IECWRET,20(0,IECWENT)               CALL IECVGENA   @D1A 98959600
         LM    14,12,12(13)               RESTORE REGS             @D1A 98975200
         MEXIT                                                     @D1A 98990800
.BX000   ANOP                                                      @H1A 99006400
         AIF   ('&IECIBX' EQ '1').BX010                            @H1A 99022000
&IECIBX  SETB  1                                                   @H1A 99037600
**********************************************************************  99053200
*                                                                    *  99068800
*   FUNCTION:                                                        *  99084400
*      BOX   - THE PURPOSE OF THIS FUNCTION IS TO BOX A DEVICE       *  99100000
*              BY CALLING THE FORCE DEVICE MODULE.                   *  99115600
*                                                                    *  99131200
*   MACRO CALL:                                                      *  99146800
*      LABEL IOSGEN BOX,UCB=(REG1)                                   *  99162400
*                                                                    *  99178000
*                                                                    *  99193600
*   INPUT:                                                           *  99209200
*      REGISTER 13 MUST POINT TO AN 18 WORD SAVEAREA                 *  99224800
*                                                                    *  99240400
*      UCB= SPECIFIES THE ADDRESS OF THE UCB COMMON SEGMENT.         *  99256000
*                                                                    *  99271600
*   NOTE:                                                            *  99287200
*      REGISTER 0 WILL BE DESTROYED                                  *  99302800
*      REGISTER 1 WILL BE DESTROYED                                  *  99318400
*                                                                    *  99334000
*   RESTRICTIONS:                                                    *  99349600
*      THE INVOKER OF THIS FUNCTION MUST BE IN KEY 0, ENABLED, TASK  *  99365200
*      MODE, AND CANNOT HOLD ANY LOCKS.                              *  99380800
*                                                                    *  99396400
*      THIS FUNCTION IS CURRENTLY RESTRICTED TO USE BY DDR           *  99412000
*                                                                    *  99427600
*      THE HIGH ORDER BIT OF REGISTER 1, INPUT TO IECVFDEV,          *  99443200
*      IS ALWAYS SET ON.  THIS WILL CAUSE THE BOX MESSAGE            *  99458800
*      TO INDICATE THAT THE DEVICE WAS NOT BOXED BECAUSE             *  99474400
*      OF AN OPERATOR REQUEST.                                       *  99490000
*                                                                    *  99505600
**********************************************************************  99521200
IECBXUCB EQU   1                          PARAM REG                @H1A 99536800
.BX010   ANOP                                                      @H1A 99552400
         AIF   ('&UCB' EQ '(1)').BX030    IF IN REG 1, DON'T LOAD  @H1A 99568000
         LR    IECBXUCB,&UCB(1)           LOAD UCB INTO PARAM REG  @H1A 99583600
.BX030   ANOP                                                      @H1A 99599200
         LA    0,1                        PLACE BIT IN REG 0       @H1A 99614800
         SLL   0,31                       SHIFT TO HIGH ORDER BIT  @H1A 99630400
         OR    IECBXUCB,0                 TURN HIGH ORDER BIT ON   @H1A 99646000
         LINK  EP=IECVFDEV                                         @H1A 99661600
         MEXIT                                                     @H1A 99677200
.*****     *****     *****     *****     *****     *****     *****      99692800
.*****     MNOTE     *****     MNOTE     *****     MNOTE     *****      99708400
.*****     *****     *****     *****     *****     *****     *****      99724000
.*                                                                      99739600
.*       MNOTE ERROR MESSAGES                                           99755200
.*                                                                      99770800
.*                                                                      99786400
.IOSGEN2 MNOTE 8,'*** INSUFFICIENT WORK REGISTERS SPECIFIED.'           99802000
         MEXIT                                                          99817600
.*                                                                      99833200
.IOSGEN3 MNOTE 8,'*** ERROR IN PARAMETER SET UP, OR &FUNC NOT A SUPPORTX99848800
               ED FUNCTION'                                             99864400
         MEXIT                                                          99880000
.*                                                                      99895600
.IOSGEN4 MNOTE 8,'*** &VAR NOT SUPPORTED FOR &TABLE BIT OF &FUNC .'     99911200
         MEND                                                           99926800
