*********************************************************************** 00001400
*                                                                     * 00005600
*PROPRIETARY V3 STATEMENT                                             * 00007000
*LICENSED MATERIALS - PROPERTY OF IBM                                 * 00008400
*"RESTRICTED MATERIALS OF IBM"                                        * 00009800
*5695-DF1                                                             * 00011200
*(C) COPYRIGHT 1992  IBM CORP.                                        * 00012600
*END PROPRIETARY V3 STATEMENT                                         * 00014700
*                                                                     * 00016800
*********************************************************************** 00018200
         MACRO                                                          00020000
&LABEL   IGGLDCP &OPTCD=N,&RECFM=F                                      00030000
         GBLB  &CPOPS                                                   00030100
         LCLC  &C                                                       00031000
         AIF   (&CPOPS).NOCPOPS                                         00031100
&CPOPS   SETB  1                                                        00031200
         IGGCPOPS                                                       00031300
.NOCPOPS ANOP                                                           00031400
&C       SETC  '8'                                                      00032000
&LABEL   DS    0D                                                       00040000
.*                                                                      00041000
.*   FUNCTION - MACRO CREATES ALL THE SKELETON CHANNEL PROGRAMS         00050000
.*        REQUIRED FOR LOAD MODE, ACCORDING TO THE RECORD FORMAT        00060000
.*        AND WHETHER WRITE CHECKING HAS BEEN SPECIFIED.                00070000
.*                                                                      00080000
.*   INPUT -                                                            00090000
.*        RECFM = F   (DEFAULT)   FIXED LENGTH RECORDS                  00100000
.*              = V   VARIABLE LENGTH RECORDS                           00110000
.*        OPTCD = N   (DEFAULT)   NO WRITE CHECKING                     00120000
.*              = W   WRITE CHECKING                                    00130000
.*                                                                      00140000
         SPACE 5                                                        00141000
***************************                                             00142000
* CP18 - WRITE DATA RECORDS                                             00150000
***************************                                             00160000
*                                                                       00170000
CL0      CCW   SETSECT,0,SILI+CC,1 *    SETSECTOR                       00180000
CL1      CCW   SIDEQ,0,CC,5 *           SEARCH ID EQUAL                 00182000
CL2      CCW   TIC,0,0,0 *              TIC                             00190000
CL3      CCW   TIC,0,0,0 *              TIC                             00200000
CL4      CCW   WCKD,0,CC,8 *            WRITE COUNT KEY DATA            00210000
*                                                                       00230000
* N ENTRIES WILL BE GENERATED, ONE FOR EACH BUFFER                      00240000
*                                                                       00250000
CL5      CCW   TIC,0,0,0 *              TIC                             00252000
*                                                                       00270000
*                                                                       00280000
CL6      CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00300000
CL7      CCW   0,0,DC,0 *               KEY AND                         00310000
CL8      CCW   0,0,CC,0 *               DATA                            00320000
         AIF   ('&OPTCD' EQ 'N').CP19                                   00330000
&C       SETC  '9'                                                      00340000
*                                                                       00350000
*  CP18- EXTENSION FOR WRITE CHECK                                      00360000
*                                                                       00370000
CL9      CCW   RCKD,0,CC+SKIP,0 *       READ COUNT KEY AND DATA         00382000
*                                                                       00390000
.CP19    ANOP                                                           00400000
CP18LEN  EQU   (CL&C+8-CL0)             LENGTH OF CP18                  00410000
         SPACE 5                                                        00420000
**************************************************************          00421000
* CP19 - PREFORMAT SHARED TRACK AND/OR WRITE CYL OVFL CTRL RCD          00430000
**************************************************************          00440000
*                                                                       00450000
CM0      CCW   SETSECT,0,CC+SILI,1 *    SET SECTOR                      00470000
CM1      CCW   SIDEQ,0,CC,5 *           SEARCH ID EQUAL                 00480000
CM2      CCW   TIC,0,0,0 *              TIC                             00490000
CM3      CCW   WD,0,SILI+CC,6 *         WRITE DATA                      00492000
*                                                                       00500000
CM4      CCW   SEEKHH,0,CC,6 *          SEEK HEAD                       00520000
CM40     CCW   NOP,0,CC+SILI,1 *        NOP - SETSECTOR SLOT            00522000
*                                                                       00530000
CM5      CCW   SIDEQ,0,CC,5 *           SEARCH ID EQUAL                 00550000
CM6      CCW   TIC,0,0,0 *              TIC                             00552000
*                                                                       00560000
CM7      CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00580000
CM8      CCW   0,0,CC,0 *               KEY AND DATA                    00590000
CM9      CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00600000
CM10     CCW   0,0,CC,0 *               KEY AND DATA                    00610000
CM11     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00612000
CM12     CCW   0,0,CC,0 *               KEY AND DATA                    00614000
CM13     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00616000
CM14     CCW   0,0,CC,0 *               KEY AND DATA                    00618000
CM15     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00630000
CM16     CCW   0,0,CC,0 *               KEY AND DATA                    00640000
CM17     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00650000
CM18     CCW   0,0,CC,0 *               KEY AND DATA                    00660000
CM19     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00670000
CM20     CCW   0,0,CC,0 *               KEY AND DATA                    00680000
CM21     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00690000
CM22     CCW   0,0,CC,0 *               KEY AND DATA                    00700000
CM23     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00710000
CM24     CCW   0,0,CC,0 *               KEY AND DATA                    00720000
CM25     CCW   WCKD,0,DC,8 *            WRITE COUNT,                    00730000
CM26     CCW   0,0,00,0 *               KEY AND DATA                    00740000
*                                                                       00770000
CM27     DC    X'0000000000000000'                                      00780000
*                                                                       00790000
CP19LEN  EQU   (CM27+8-CM0)             LENGTH OF CP19                  00800000
*                                                                       00810000
         AIF   ('&RECFM' EQ 'V').VAR                                    00820000
         SPACE 5                                                        00830000
**********************************                                      00831000
* CP20 - WRITE TRACK INDEX ENTRIES                                      00840000
**********************************                                      00850000
*                                                                       00860000
CQ0      CCW   SETSECT,0,CC+SILI,1 *    SET SECTOR                      00862000
CQ1      CCW   SIDEQ,0,CC,5 *           SEARCH ID EQUAL                 00890000
CQ2      CCW   TIC,0,0,0 *              TIC                             00900000
CQ3      CCW   WKD,0,DC,0 *             WRITE KEY                       00910000
CQ4      CCW   0,0,CC,10 *              AND DATA                        00920000
CQ5      CCW   SIDEQ+MT,0,CC,5 *        SEARCH MULTI TRACK HOME ADDRESS 00930000
CQ6      CCW   TIC,0,0,0 *              TIC                             00940000
CQ7      CCW   WKD,0,DC,0 *             WRITE KEY                       00950000
CQ8      CCW   0,0,CC,10 *              AND DATA                        00960000
CQ9      CCW   TIC,0,0,0 *              TIC                             00962000
CQ10     CCW   SIDEQ+MT,0,CC,5 *        SEARCH ID EQUAL                 00980000
CQ11     CCW   TIC,0,0,0 *              TIC                             00990000
CQ12     CCW   WKD,0,CC,0 *             WRITE KEY AND DATA              01000000
         AGO   .CP20COM                                                 01200000
.VAR     ANOP                                                           01400000
         SPACE 5                                                        01410000
**********************************                                      01411000
* CP20 - WRITE TRACK INDEX ENTRIES                                      01420000
**********************************                                      01430000
CQ0      CCW   SETSECT,0,SILI+CC,1      SETSECTOR                       01492000
CQ1      CCW   SIDEQ,0,CC,5             SEARCH ID EQUAL                 01494000
CQ2      CCW   TIC,0,0,0                TIC                             01496000
CQ3      CCW   WD,0,CC+SILI,3           WRITE TRK CAPACITY RECORD       01510000
CQ4      CCW   TIC,0,SILI,5             TIC CL1,CQ3                     01512000
CQ5      DC    XL8'00'                 MAX REX LENGTH,CCHHR             01520000
CQ6      DC    XL8'00'                 AVAILABLE                        01530000
CQ7      DC    XL4'00'                                                  01540000
         DC    XL4'00000008'                                            01550000
CQ8      DC    XL8'00'                 AVAILABLE                        01560000
CQ9      DC    XL8'00'                 LST SCD REC RR,CUR CAP           01570000
CQ10     DC    XL8'00'                 AVAILABLE                        01580000
CQ11     DC    XL8'00'                 PTR-CP18,STAT LRECL              01590000
CQ12     DC    XL8'00'                 AVAILABLE                        01600000
*********************************************************************** 01610000
.CP20COM ANOP                                                           01620000
CQ13     CCW   X'1B',0,X'40',6          CTL SEEK HH -  COMMON EXIT      01630000
CQ14     CCW   X'08',0,X'20',5          TIC, NOP DURING CLOSE           01640000
CQ14A    DC    X'0000000000000000'      MBBCCHHR                        01650000
*                                                                       01660000
*                                                                       01670000
CQ14B    CCW   SETSECT,0,SILI+CC,1      SETSECTOR                       01700000
CQ15     CCW   SIDEQ,0,CC,5             SEARCH ID EQUAL                 01702000
CQ16     CCW   TIC,0,0,0                TIC                             01710000
CQ17     CCW   WCKD,0,DC,8              WRITE COUNT,                    01720000
CQ18     CCW   0,0,DC,0                 KEY                             01722000
CQ19     CCW   0,0,CC,10                AND DATA                        01732000
CQ20     CCW   X'08',0,X'00',0          TIC                             01740000
CQ21     CCW   WCKD,0,DC,8              WRITE COUNT,                    01772000
CQ22     CCW   0,0,DC,0                 KEY                             01774000
CQ23     CCW   0,0,CC,10                AND DATA                        01776000
CQ24     CCW   TIC,0,0,0                TIC                             01782000
CQ25     CCW   WCKD,0,CC,0              WRITE COUNT KEY AND DATA        01800000
CQ26     CCW   TIC,0,0,0                TIC                             01810000
CQ27     CCW   SIDEQ+MT,0,CC,5          SEARCH ID EQUAL - MT            01820000
CQ28     CCW   TIC,0,0,0                TIC                             01830000
CQ29     CCW   TIC,0,0,0                TIC                             01832000
CQ30     DC    X'0000000000000000'      MBBCCHHR                        01840000
*                                                                       01850000
CP20LEN  EQU   (CQ30+8-CQ0)             LENGTH OF CP20                  01860000
*                                                                       01870000
         AIF   ('&OPTCD' NE 'W').CP21                                   01880000
*                                                                       01890000
* CP20 - EXTENTION FOR WR CHK                                           01900000
*                                                                       01910000
CQT0     CCW   NOP,0,SILI+CC,1          NOP/ SETSECTOR                  01950000
CQT1     CCW   SIDEQ,0,CC,5             SEARCH ID EQUAL                 01952000
CQT2     CCW   TIC,0,0,0                TIC                             01954000
CQT3     CCW   RKD,0,CC+SKIP,0 *        READ NORMAL INDEX               01957000
CQT4     CCW   SIDEQ+MT,0,CC,5 *        SEARCH FOR OVERFLOW ENTRY       01960000
CQT4A    CCW   TIC,0,0,0 *              TIC TO CQT4                     01963000
CQT5     CCW   RKD,0,CC+SKIP,0 *        READ OVERFLOW INDEX             01966000
*   THIS SLOT CHANGED DEPENDING ON WHETHER INACTIVE ENTRY WAS WRITTEN.  01969000
CQT5A    CCW   TIC,0,CC+SILI,1 *        TIC TO CQT7 NO INACTIVE         01972000
*        CCW   TIC,0,CC+SILI,1          NOP IF INACTIVE ENTRY.          01975000
*                                                                       01978000
CQT5B    CCW   SIDEQ+MT,0,CC,5 *        SEARCH FOR INACTIVE ENTRY       01981000
CQT5C    CCW   TIC,0,0,0 *              TIC TO CQT5B                    01984000
CQT6     CCW   RKD,0,CC+SKIP,0 *        READ INACTIVE ENTRY             01987000
CQT7     CCW   SEEKHH,0,CC,6            SEEK HEAD                       02000000
CQT8     CCW   TIC,0,SILI,5             TIC - NOP DURING CLOSE          02002000
*                                                                       02010000
CP20WRCK EQU   (CQT8+8-CQT0)            LENGTH OF CP20                  02020000
*                                       *    WRITE EXTENSION            02030000
.CP21    ANOP                                                           02040000
         SPACE 5                                                        02040100
*************************************                                   02041000
* CP21 - WRITE HIGH LEVEL INDEX ENTRY                                   02050000
*************************************                                   02060000
*                                                                       02070000
CQ39A    CCW   SETSECT,0,SILI+CC,1      SETSECTOR                       02110000
CQ40     CCW   SIDEQ,0,CC,5             SEARCH ID EQUAL                 02112000
CQ41     CCW   TIC,0,0,0                TIC                             02114000
CQ42     CCW   WCKD,0,DC,8              WRITE COUNT,                    02120000
CQ43     CCW   0,0,DC,0                 KEY                             02120400
         AIF   ('&OPTCD' EQ 'W').ACQ44                                  02121000
CQ44     CCW   0,0,0,10                 DATA                            02130400
         AGO   .BCQ44                                                   02131000
.ACQ44   ANOP                                                           02131100
CQ44     CCW   0,0,CC,10                DATA                            02132400
.BCQ44   ANOP                                                           02133000
*                                                                       02140000
CP21LEN  EQU   (CQ44+8-CQ39A)           LENGTH OF CP21                  02150000
*                                                                       02160000
         AIF   ('&OPTCD' NE 'W').END                                    02170000
*                                                                       02180000
* CP21 - EXTENTION FOR WR CHK                                           02190000
*                                                                       02200000
CQ44A    CCW   NOP,0,CC+SILI,1          NOP/SET SECTOR SLOT             02220000
CQ45     CCW   SIDEQ,0,CC,5             SEARCH ID EQUAL                 02240000
CQ46     CCW   TIC,0,0,0                TIC                             02240400
CQ47     CCW   RCKD,0,SKIP,0            READ COUNT KEY AND DATA         02242000
*                                                                       02250000
CP21WRCK EQU   (CQ47+8-CQ44A)           LENGTH OF CP21 WRITE            02260000
*                                       *    CHECK EXTENSION            02270000
.END     ANOP                                                           02280000
         MEND                                                           02290000
