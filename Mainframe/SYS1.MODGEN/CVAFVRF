         MACRO                                                          00050000
&LABEL   CVAFVRF &ACCESS=,&BRANCH=,&IOAREA=,&MAPRCDS=,&MF=I,           X00100000
               &UCB=,&VRFAREA=                                          00150000
.**** START OF SPECIFICATIONS ****************************************  00200000
.*                                                                      00250000
.*$MAC(CVAFVRF) COMP(DM1CV) PROD(DMS-XZ): CVAF-VTOC RECORDING FACILITY  00300000
.*                                                                      00350000
.* DESCRIPTIVE-NAME = CVAF - VTOC RECORDING FACILITY (VRF)              00400000
.*                                                                      00450000
.*PROPRIETARY V3 STATEMENT                                              00462500
.*LICENSED MATERIALS - PROPERTY OF IBM                                  00475000
.*"RESTRICTED MATERIALS OF IBM"                                         00487500
.*5695-DF1                                                              00500000
.*(C) COPYRIGHT 1980,1985  IBM CORP.                                    00512500
.*END PROPRIETARY V3 STATEMENT                                          00531200
.*                                                                      00550000
.*$STATUS = RELEASE 2.1.0                                          @L1A 00600000
.*                                                                      00650000
.* FUNCTION = THIS MACRO WILL GENERATE CODE TO SET UP THE CVAF          00700000
.*     PARAMETER LIST TO ALLOW THE CALLER TO RECORD AND RETRIEVE        00750000
.*     VRF DATA IN THE VTOC INDEX MAP (VIXM) IN STORAGE.                00800000
.*                                                                      00850000
.*     THE 'MF' KEYWORD DETERMINES WHETHER THE CVAF PARAMETER LIST      00900000
.*     IS EXPANDED AND/OR EXECUTABLE INSTRUCTIONS ARE GENERATED TO      00950000
.*     INVOKE CVAF.                                                     01000000
.*                                                                      01050000
.*     THE SPECIFICATION OF MF=(E,ADDR), WILL RESULT IN THE             01100000
.*     MODIFICATION OF AN EXISTING CVAF PARAMETER LIST.  THE            01150000
.*     ADDRESS OF THE PARAMETER LIST IS PROVIDED VIA A SECOND           01200000
.*     SUBPARAMETER OF THE 'MF' KEYWORD.  IT ALSO GENERATES CODE        01250000
.*     NECESSARY TO EITHER BRANCH TO CVAF OR ISSUE SVC 139 TO INVOKE    01300000
.*     CVAF TO PERFORM THE REQUESTED FUNCTIONS.  THIS IS CALLED THE     01350000
.*     EXECUTE-FORM OF THE MACRO.                                       01400000
.*                                                                      01450000
.*     WITH A SPECIFICATION OF MF=I, OR NOT SPECIFYING THE 'MF'         01500000
.*     KEYWORD AT ALL, THIS MACRO WILL EXPAND THE CVAF PARAMETER        01550000
.*     LIST AND INITIALIZE IT ACCORDING TO THE OPTIONS SELECTED         01600000
.*     VIA THE ALLOWABLE KEYWORDS.  IT ALSO GENERATES CODE              01650000
.*     NECESSARY TO EITHER BRANCH TO CVAF OR ISSUE SVC 139 TO           01700000
.*     INVOKE CVAF TO PERFORM THE REQUESTED FUNCTIONS.  THIS IS         01750000
.*     CALLED THE INSTRUCTION-FORM (NORMAL-FORM) OF THE MACRO.          01800000
.*                                                                      01850000
.*     THE SPECIFICATION OF MF=L WILL RESULT IN THE EXPANSION OF THE    01900000
.*     PARAMETER LIST AND INITIALIZE IT ACCORDING TO THE SPECIFIED      01950000
.*     KEYWORDS. HOWEVER IT DOES NOT GENERATE THE CODE TO INVOKE        02000000
.*     CVAF.  THIS IS CALLED THE LIST-FORM OF THE MACRO.                02050000
.*                                                                      02100000
.*     KEYWORDS APPLICABLE TO THE CVAFVRF MACRO ARE:                    02150000
.*                                                                      02200000
.*       ACCESS  - WILL SET THE "CVFCTN" FIELD OF THE CVAF              02250000
.*                 PARAMETER LIST TO X'0C' FOR READ, X'0D'              02300000
.*                 FOR WRITE.  THIS KEYWORD IS REQUIRED FOR             02350000
.*                 THE MF=I FORM AND IS OPTIONAL FOR THE MF=L           02400000
.*                 OR MF=(E,ADDR) FORM.                                 02450000
.*                                                                      02500000
.*                 VALID ENTRIES:  ACCESS=READ                          02550000
.*                                 ACCESS=WRITE                         02600000
.*                                                                      02650000
.*       BRANCH  - WILL SET THE FLAG, CV1PGM, TO 1 IF (YES,PGM)         02700000
.*                 IS CODED OR RESET IT TO 0 IF (YES,SUP) IS CODED.     02750000
.*                 IF BRANCH=YES OR NO IS CODED, OR IN THE ABSENCE      02800000
.*                 OF THIS KEYWORD, THE FLAG, CV1PGM, WILL NOT BE       02850000
.*                 CHANGED FOR THE MF=(E,ADDR) FORM.                    02900000
.*                                                                      02950000
.*                 FOR MF=I OR MF=(E,ADDR) AND BRANCH=NO IS             03000000
.*                 CODED, OR OMITTED, CODE WILL BE GENERATED TO         03050000
.*                 INVOKE CVAF VIA SVC 139.                             03100000
.*                                                                      03150000
.*                 FOR MF=I OR MF=(E,ADDR) AND YES IS CODED, THE        03200000
.*                 CODE IS GENERATED TO INVOKE CVAF VIA A BRANCH.       03250000
.*                                                                      03300000
.*                 FOR MF=L, ONLY THE FLAG WILL BE INITIALIZED          03350000
.*                 AND NO EXECUTABLE CODED WILL BE GENERATED.           03400000
.*                                                                      03450000
.*                 THE ABSENCE OF THIS KEYWORD WILL NOT CAUSE           03500000
.*                 AN MNOTE, SINCE NO IS THE DEFAULT FOR ALL            03550000
.*                 FORMS OF THIS MACRO.                                 03600000
.*                                                                      03650000
.*                 VALID ENTRIES:  BRANCH=NO        DEFAULT FOR MF=I    03700000
.*                                 BRANCH=YES       (DEFAULT FOR YES    03750000
.*                                 BRANCH=(YES,SUP)  IS (YES,SUP))      03800000
.*                                 BRANCH=(YES,PGM)                     03850000
.*                                                                      03900000
.*       IOAREA  - WILL SET THE ADDRESS OF THE I/O AREA, SPECIFIED      03950000
.*                 BY THE 'ADDR', INTO THE FIELD CVIOAR.  ALSO,         04000000
.*                 THE FLAG, CV1IOAR, WILL BE SET TO 1 IF KEEP IS       04050000
.*                 CODED AND RESET TO 0 IF NOKEEP IS CODED.             04100000
.*                                                                      04150000
.*                 THE ABSENCE OF THIS KEYWORD WILL NOT CAUSE AN MNOTE, 04200000
.*                 SINCE NOKEEP IS THE DEFAULT FOR MF=L AND MF=I.       04250000
.*                 THE FLAG WILL NOT BE CHANGED IN THE ABSENCE OF THE   04300000
.*                 IOAREA KEYWORD FOR MF=(E,ADDR) FORM.                 04350000
.*                                                                      04400000
.*                 VALID ENTRIES:  IOAREA=NOKEEP    DEFAULT FOR MF=I    04450000
.*                                 IOAREA=(NOKEEP,ADDR)                 04500000
.*                                 IOAREA=KEEP                          04550000
.*                                 IOAREA=(KEEP,ADDR)                   04600000
.*                                                                      04650000
.*       MAPRCDS - WILL SET THE ADDRESS OF THE MAP RECORDS BUFFER LIST, 04700000
.*                 SPECIFIED BY THE 'ADDR', INTO THE FIELD: CVMRCDS.    04750000
.*                 THE ABSENCE OF THIS KEYWORD WILL NOT CAUSE AN MNOTE  04800000
.*                 FOR ANY OF THE FORMS OF THE MACRO SINCE YES IS THE   04850000
.*                 DEFAULT.                                             04900000
.*                                                                      04950000
.*                 ALSO, THE FLAG, CV1MRCDS, WILL BE SET TO 1 IF YES    05000000
.*                 IS CODED.                                            05050000
.*                                                                      05100000
.*                 VALID ENTRIES:  MAPRCDS=YES      DEFAULT FOR MF=I    05150000
.*                                 MAPRCDS=(YES,ADDR)                   05200000
.*                                                                      05250000
.*       MF      - SEE THE OPENING PARAGRAPHS ABOVE.  IF THE MF KEYWORD 05300000
.*                 IS NOT SPECIFIED, THE DEFAULT, MF=I, WILL BE IN      05350000
.*                 EFFECT.                                              05400000
.*                                                                      05450000
.*                 FOR THE INSTRUCTION-FORM (MF=I), THE                 05500000
.*                 FOLLOWING VALIDITY CHECKS WILL BE MADE:              05550000
.*                   1. ACCESS IS REQUIRED.                             05600000
.*                   2. UCB IS REQUIRED WHEN IOAREA=(,ADDR)             05650000
.*                      HAS NOT BEEN SPECIFIED.                         05700000
.*                                                                      05750000
.*                 FOR ALL FORMS OF THE MACRO, THE FOLLOWING            05800000
.*                 VALIDITY CHECKS WILL BE MADE:                        05850000
.*                   1. VALID KEYWORD OPERANDS.                         05900000
.*                                                                      05950000
.*                 VALID ENTRIES:  MF=I             DEFAULT             06000000
.*                                 MF=L                                 06050000
.*                                 MF=(E,ADDR)                          06100000
.*                                                                      06150000
.*       UCB     - WILL SET THE ADDRESS OF THE UCB, SPECIFIED BY        06200000
.*                 THE 'ADDR', INTO THE FIELD: CVUCB.                   06250000
.*                 UCB IS REQUIRED UNLESS IOAREA=(,ADDR) IS             06300000
.*                 SPECIFIED FOR THE MF=I FORM OF THIS MACRO.           06350000
.*                                                                      06400000
.*       VRFAREA - WILL SET THE ADDRESS OF THE VRF DATA, SPECIFIED      06450000
.*                 BY THE 'ADDR', INTO THE FIELD: CVVRFDA.              06500000
.*                 THERE IS NO DIFFERENCE BETWEEN THE MACRO-FORMS       06550000
.*                 FOR THIS KEYWORD.                                    06600000
.*                                                                      06650000
.* NOTES = N/A                                                          06700000
.*                                                                      06750000
.* MODULE-TYPE = MACRO                                                  06800000
.*                                                                      06850000
.*   PROCESSOR = ASSEMBLER LANGUAGE                                     06900000
.*                                                                      06950000
.*   ATTRIBUTES = EXECUTABLE MACRO                                      07000000
.*                                                                      07050000
.* ENTRY-POINT = MACRO STATEMENT.                                       07100000
.*                                                                      07150000
.* INPUT = SEE DESCRIPTION OF KEYWORDS UNDER "FUNCTION".                07200000
.*                                                                      07250000
.* OUTPUT = CVAF PARAMETER LIST WITH THE FLAGS AND THE ADDRESSES        07300000
.*          SET DEPENDING UPON THE KEYWORDS SPECIFIED AS DEFINED        07350000
.*          UNDER "KEYWORDS" ABOVE.                                     07400000
.*                                                                      07450000
.* EXIT-NORMAL = MEND STATEMENT.                                        07500000
.*                                                                      07550000
.* EXIT-ERROR = MNOTE AND MEND STATEMENT.  AN APPROPRIATE MNOTE         07600000
.*              WILL BE GENERATED FOR ANY OF THE FOLLOWING ERRORS:      07650000
.*                                                                      07700000
.*                 FOR THE MF=I FORM OF THE MACRO:                      07750000
.*                   1. ACCESS IS REQUIRED AND NOT SUPPLIED.            07800000
.*                   2. EITHER UCB OR IOAREA IS REQUIRED AND NOT        07850000
.*                      SUPPLIED.                                       07900000
.*                                                                      07950000
.*                 FOR ALL FORMS OF THE MACRO:                          08000000
.*                   1. INVALID KEYWORD OPERAND.                        08050000
.*                                                                      08100000
.* EXTERNAL-REFERENCES = NONE                                           08150000
.*                                                                      08200000
.* TABLES = NONE                                                        08250000
.*                                                                      08300000
.* MACROS = IHBINNRA                                                    08350000
.*                                                                      08400000
.* CHANGE-ACTIVITY =                                                    08450000
.*$L0=IXVTOC,JDM1134,T790225,STLBS: INDEXED VTOC SUPPORT                08480000
.*$L1=VSCR,HDP2210,T840401,STLMDB: CVAF VSCR                       @L1A 08510000
.*$01=OZ89193,HDP1102,,FEDJF: REMOVED SINGLE QUOTES FROM UCB=      @01A 08525000
.*                                                                      08540000
.**** END OF SPECIFICATIONS ******************************************* 08570000
         LCLA  &K                       LENGTH OF PARM                  08600000
         LCLA  &NO                      BRANCH INDEX NUMBER             08650000
         LCLB  &BIOO                    IOAREA OR BIT FLAG1             08700000
         LCLB  &BMRO                    MAPRCDS OR BIT FLAG1            08750000
         LCLB  &BPGO                    BRANCH OR BIT FLAG1             08800000
         LCLB  &BION                    IOAREA AND BIT FLAG1            08850000
         LCLB  &BPGN                    BRANCH AND BIT FLAG1            08900000
         LCLB  &ERRSW                   AN ERROR WAS DETECTED           08950000
         LCLB  &SWIOA                   IOAREA PARM PRESENT SWITCH      09000000
         LCLB  &SWMPR                   MAPRCDS PARM PRESENT SWITCH     09050000
         LCLB  &SWUCB                   UCB PARM PRESENT SWITCH         09100000
         LCLB  &SWVRF                   VRF PARM PRESENT SWITCH         09150000
         LCLB  &IOANCOR                 IOAREA IN STORAGE SWITCH        09200000
         LCLB  &MPRNCOR                 MAPRCDS IN STORAGE SWITCH       09250000
         LCLB  &UCBNCOR                 UCB IN STORAGE SWITCH           09300000
         LCLB  &VRFNCOR                 VRF IN STORAGE SWITCH           09350000
         LCLC  &IOANREG                 IOAREA IN REGISTER VALUE        09400000
         LCLC  &MPRNREG                 MAPRCDS IN REG VALUE            09450000
         LCLC  &UCBNREG                 UCB IN REGISTER VALUE           09500000
         LCLC  &VRFNREG                 VRF IN REGISTER VALUE           09550000
         LCLC  &L                       LOCAL LABEL VARIABLE            09600000
         LCLC  &FM                      MF=FORM CHARACTER VARIABLE      09650000
         LCLC  &FLAG1                   DEFINE LOCAL CHAR VARIABLE      09700000
         LCLC  &FLAG1N                  DEFINE LOCAL CHAR VARIABLE      09750000
         LCLC  &FUNCT                   FUNCTION CODE FOR ACCESS=       09800000
&NO      SETA  &SYSNDX                  INITIALIZE BRANCH INDEX NUM     09850000
&BION    SETB  1                        INITIALIZE 'AND' BIT            09900000
&BPGN    SETB  1                        INITIALIZE 'AND' BIT            09950000
.*                                                                      10000000
.* ******************************************************************** 10050000
.* *     MF=' ' VERIFICATION                                            10100000
.* ******************************************************************** 10150000
.*                                                                      10200000
         AIF   (N'&MF GT 2).ER1         MF= HAS ONLY 2 PARMS            10250000
         AIF   ('&MF(1)' EQ 'E').E1     TEST FOR E FORM                 10300000
         AIF   (N'&MF NE 1).ER1         MF=L OR I HAS ONLY 1 PARM       10350000
         AIF   ('&MF(1)' EQ 'I').I1     TEST FOR I FORM                 10400000
         AIF   ('&MF(1)' EQ 'L').L1     TEST FOR L FORM                 10450000
.ER1     ANOP                                                           10500000
         SPACE 1                                                        10550000
         MNOTE 16,'***  IHB001 INVALID OPERAND - MF=&MF'                10600000
&ERRSW   SETB  1                        SET ERROR SWITCH ON             10650000
         AGO   .CKERR                   GO TO ERROR IN CHECK ROUTINE    10700000
.*                                                                      10750000
.* ******************************************************************** 10800000
.* *     EXECUTE FORM, MF=(E,' ') VERIFICATION                          10850000
.* ******************************************************************** 10900000
.*                                                                      10950000
.E1      ANOP                           EXECUTE FORM OF MACRO           11000000
&FM      SETC  'E'                      SET THE MACRO FORM SWITCH       11050000
         AIF   (N'&MF EQ 2).CK1         MF=E MUST HAVE 2 PARMS          11100000
         SPACE 1                                                        11150000
         MNOTE 16,'***  IHB002 MF=(E,ADDR) FORM: PARAMETER LIST ADDRESSX11200000
                IS REQUIRED'                                            11250000
&ERRSW   SETB  1                        SET ERROR SWITCH ON             11300000
         AGO   .CK1                     GO CHECK NEXT KEYWORD           11350000
.*                                                                      11400000
.* ******************************************************************** 11450000
.* *     LIST FORM OF CVAFVRF                                           11500000
.* ******************************************************************** 11550000
.*                                                                      11600000
.L1      ANOP                           LIST FORM OF MACRO              11650000
&FM      SETC  'L'                      SET THE MACRO FORM SWITCH       11700000
         AGO   .CK1                     GO CHECK NEXT KEYWORD           11750000
.*                                                                      11800000
.* ******************************************************************** 11850000
.* *     INSTRUCTION FORM OF CVAFVRF                                    11900000
.* ******************************************************************** 11950000
.*                                                                      12000000
.I1      ANOP                           INSTRUCTION FORM OF MACRO       12050000
&FM      SETC  'I'                      SET THE MACRO FORM SWITCH       12100000
.*                                                                      12150000
.* ******************************************************************** 12200000
.* *     INSTRUCTION FORM REQUIRES THE 'ACCESS' KEYWORD                 12250000
.* ******************************************************************** 12300000
.*                                                                      12350000
         AIF   ('&ACCESS' NE '').CK1    OK IF ACCESS IS CODED           12400000
         SPACE 1                                                        12450000
         MNOTE 12,'***  IHB003 MF=I FORM: ACCESS KEYWORD IS REQUIRED'   12500000
&ERRSW   SETB  1                         SET ERROR IN CHECK SWITCH      12550000
         AGO   .CK4                      BYPASS NEXT CHECK              12600000
.*                                                                      12650000
.* ******************************************************************** 12700000
.* *     VALIDATE 'ACCESS' KEYWORD                                      12750000
.* ******************************************************************** 12800000
.*                                                                      12850000
.CK1     ANOP                                                           12900000
         AIF   ('&ACCESS' NE 'READ').CK2                                12950000
&FUNCT   SETC  '0C'                       CVAFVRF ACCESS=READ           13000000
         AGO   .CK4                                                     13050000
.CK2     ANOP                                                           13100000
         AIF   ('&ACCESS' NE 'WRITE').CK3 NOT WRITE, GO ON              13150000
&FUNCT   SETC  '0D'                       CVAFVRF ACCESS=WRITE          13200000
         AGO   .CK4                                                     13250000
.CK3     ANOP                                                           13300000
         AIF   ('&ACCESS' EQ '' AND '&FM' EQ 'E').CK4                   13350000
&FUNCT   SETC  '00'                       ACCESS= NOT CODED             13400000
         AIF   ('&ACCESS' EQ '' AND '&FM' NE 'I').CK4 MF=I, ERROR       13450000
         SPACE 1                                                        13500000
         MNOTE 12,'***  IHB001 INVALID OPERAND - ACCESS=&ACCESS'        13550000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       13600000
.*                                                                      13650000
.* ******************************************************************** 13700000
.* *     IF UCB IS PRESENT, CHECK IF IN REG OR NOT                      13750000
.* ******************************************************************** 13800000
.*                                                                      13850000
.CK4 ANOP                                                               13900000
         AIF   ('&UCB' EQ '').CK5       NO UCB, IS IOAREA?              13950000
         AIF   (N'&UCB NE 1).ER2        ONLY 1 UCB PARM ALLOWED         14000000
&SWUCB   SETB  1                        SET UCB SWITCH ON               14050000
         AIF   ('&UCB'(1,1) EQ '(').UCBNREG                             14100000
&UCBNCOR SETB  1                        UCB IS IN CORE                  14150000
         AGO   .CK5                                                     14200000
.UCBNREG ANOP                                                           14250000
&K       SETA  K'&UCB                   STORE NO. OF CHARS IN UCB       14300000
&UCBNREG SETC  '&UCB'(2,&K-2)           GET REGISTER OF UCB             14350000
         AGO   .CK5                                                     14400000
.ER2     ANOP                           UCB= **** ERROR ****            14450000
         SPACE 1                                                        14500000
         MNOTE 12,'***  IHB001 INVALID OPERAND - UCB=&UCB'              14550000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       14600000
.*                                                                      14650000
.* ******************************************************************** 14700000
.* *     IF IOAREA IS PRESENT, CHECK IF IN REG OR NOT                   14750000
.* ******************************************************************** 14800000
.*                                                                      14850000
.CK5     ANOP                                                           14900000
         AIF   ('&IOAREA' EQ '').CK8    NO IOAREA, IS IT MF=I?          14950000
         AIF   (N'&IOAREA EQ 1).CK6     NO IOAREA ADDRESS, KEEP/NOKEEP? 15000000
         AIF   (N'&IOAREA NE 2).ER3     ONLY 2 IOAREA PARMS ALLOWED     15050000
&SWIOA   SETB  1                        SET IOAREA SWITCH ON            15100000
         AIF   ('&IOAREA(2)'(1,1) EQ '(').IOANREG                       15150000
&IOANCOR SETB  1                        IOAREA IS IN CORE               15200000
         AGO   .CK6                     CHECK OUT FIRST PARM            15250000
.IOANREG ANOP                                                           15300000
&K       SETA  K'&IOAREA(2)             STORE NO. OF CHARS IN IOAREA    15350000
&IOANREG SETC  '&IOAREA(2)'(2,&K-2)     GET REGISTER OF IOAREA          15400000
.*                                                                      15450000
.* ******************************************************************** 15500000
.* *     VALIDITY CHECK THE FIRST PARM OF IOAREA                        15550000
.* ******************************************************************** 15600000
.*                                                                      15650000
.CK6     ANOP                                                           15700000
         AIF   ('&IOAREA(1)' NE 'KEEP').CK7                             15750000
&BIOO    SETB  1                        SET IOAREA=KEEP SWITCH          15800000
         AGO   .CK8                                                     15850000
.CK7     ANOP                                                           15900000
         AIF   ('&IOAREA(1)' NE 'NOKEEP').ER3                           15950000
&BION    SETB  0                        SET IOAREA=NOKEEP SWITCH        16000000
         AGO   .CK8                                                     16050000
.ER3     ANOP                           IOAREA= **** ERROR ****         16100000
         SPACE 1                                                        16150000
         MNOTE 12,'***  IHB001 INVALID OPERAND - IOAREA=&IOAREA'        16200000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       16250000
         AGO   .CK9                     SKIP NEXT CHECK                 16300000
.*                                                                      16350000
.* ******************************************************************** 16400000
.* *     INST FORM: 'UCB=' IS REQUIRED WHEN IOAREA ADDRESS IS NOT CODED 16450000
.* ******************************************************************** 16500000
.*                                                                      16550000
.CK8     ANOP                                                           16600000
         AIF   ('&FM' NE 'I').CK9       IF NOT MF=I, SKIP               16650000
         AIF   ('&SWUCB' EQ '1').CK9    UCB ADDRESS, SKIP               16700000
         AIF   (N'&IOAREA EQ 2).CK9     2 IOAREA PARMS, SKIP            16750000
         SPACE 1                                                        16800000
         MNOTE 12,'***  IHB004 MF=I FORM:  UCB=  IS REQUIRED WHEN IOAREX16850000
               A ADDRESS     IS NOT CODED'                         @01C 16900000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       16950000
.*                                                                      17000000
.* ******************************************************************** 17050000
.* *     IF MAPRCDS IS PRESENT, CHECK IF IN REG OR NOT                  17100000
.* ******************************************************************** 17150000
.*                                                                      17200000
.CK9     ANOP                                                           17250000
         AIF   ('&MAPRCDS' EQ '' AND '&FM' EQ 'E').CK11                 17300000
&BMRO    SETB  1                        SET MAPRCDS=YES SWITCH          17350000
         AIF   ('&MAPRCDS' EQ '').CK11  NO MAPRCDS, SKIP                17400000
         AIF   (N'&MAPRCDS EQ 1).CK10   NO MAPRCDS ADDRESS, YES?        17450000
         AIF   (N'&MAPRCDS NE 2).ER4    ONLY 2 MAPRCDS PARMS ALLOWED    17500000
&SWMPR   SETB  1                        SET MAPRCDS SWITCH ON           17550000
         AIF   ('&MAPRCDS(2)'(1,1) EQ '(').MPRNREG                      17600000
&MPRNCOR SETB  1                        MAPRCDS IS IN CORE              17650000
         AGO   .CK10                    CHECK OUT FIRST PARM            17700000
.MPRNREG ANOP                                                           17750000
&K       SETA  K'&MAPRCDS(2)            STORE NO. OF CHARS IN MAPRCDS   17800000
&MPRNREG SETC  '&MAPRCDS(2)'(2,&K-2)    GET REGISTER OF MAPRCDS         17850000
.*                                                                      17900000
.* ******************************************************************** 17950000
.* *     VALIDITY CHECK THE FIRST PARM OF MAPRCDS                       18000000
.* ******************************************************************** 18050000
.*                                                                      18100000
.CK10    ANOP                                                           18150000
         AIF   ('&MAPRCDS(1)' EQ 'YES').CK11                            18200000
.ER4     ANOP                           MAPRCDS= **** ERROR ****        18250000
         SPACE 1                                                        18300000
         MNOTE 12,'***  IHB001 INVALID OPERAND - MAPRCDS=&MAPRCDS'      18350000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       18400000
.*                                                                      18450000
.* ******************************************************************** 18500000
.* *     IF VRFAREA IS PRESENT, CHECK IF IN REG OR NOT                  18550000
.* ******************************************************************** 18600000
.*                                                                      18650000
.CK11    ANOP                                                           18700000
         AIF   ('&VRFAREA' EQ '').CK12  NO VRFAREA, SKIP                18750000
         AIF   (N'&VRFAREA NE 1).ER5    ONLY 1 VRFAREA PARM ALLOWED     18800000
&SWVRF   SETB  1                        SET VRFAREA SWITCH ON           18850000
         AIF   ('&VRFAREA'(1,1) EQ '(').VRFNREG                         18900000
&VRFNCOR SETB  1                        VRFAREA IS IN CORE              18950000
         AGO   .CK12                                                    19000000
.VRFNREG ANOP                                                           19050000
&K       SETA  K'&VRFAREA               STORE NO. OF CHARS IN VRFAREA   19100000
&VRFNREG SETC  '&VRFAREA'(2,&K-2)       GET REGISTER OF VRFAREA         19150000
         AGO   .CK12                                                    19200000
.ER5     ANOP                           VRFAREA= **** ERROR ****        19250000
         SPACE 1                                                        19300000
         MNOTE 12,'***  IHB001 INVALID OPERAND - VRFAREA=&VRFAREA'      19350000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       19400000
.*                                                                      19450000
.* ******************************************************************** 19500000
.* *     VALIDITY CHECK THE BRANCH OPERANDS                             19550000
.* ******************************************************************** 19600000
.*                                                                      19650000
.CK12    ANOP                                                           19700000
         AIF   ('&BRANCH' EQ '').CKERR      NO BRANCH KEYWORD           19750000
         AIF   ('&BRANCH(1)' EQ 'NO').CKERR BRANCH=NO, GO ON            19800000
         AIF   ('&BRANCH(1)' NE 'YES').ER6  BAD BRANCH=                 19850000
         AIF   (N'&BRANCH EQ 1).CKERR       NO 2ND OPERAND              19900000
         AIF   (N'&BRANCH GT 2).ER6         BAD OPERAND                 19950000
         AIF   ('&BRANCH(2)' NE 'PGM').CK13 CHECK FOR PGM               20000000
&BPGO    SETB  1                        SET BRANCH=(YES,PGM) SWITCH     20050000
         AGO   .CKERR                                                   20100000
.CK13    ANOP                                                           20150000
         AIF   ('&BRANCH(2)' NE 'SUP').ER6  BAD 2ND OPERAND             20200000
&BPGN    SETB  0                        SET BRANCH=(YES,SUP) SWITCH     20250000
         AGO   .CKERR                                                   20300000
.ER6     ANOP                           BRANCH= **** ERROR ****         20350000
         SPACE 1                                                        20400000
         MNOTE 12,'***  IHB001 INVALID OPERAND - BRANCH=&BRANCH'        20450000
&ERRSW   SETB  1                        SET ERROR IN CHECK SWITCH       20500000
.*                                                                      20550000
.* ******************************************************************** 20600000
.* *     CHECK ERRORS: IF ANY PRESENT, SET A 'LABEL DS 0F' AND GET OUT  20650000
.* ******************************************************************** 20700000
.*                                                                      20750000
.CKERR   ANOP                                                           20800000
         AIF   ('&ERRSW' EQ '0').EXEC                                   20850000
&LABEL   DS    0F                                                       20900000
         AGO   .FINISH                                                  20950000
.*                                                                      21000000
.* ******************************************************************** 21050000
.* *     ALL PARAMETERS ARE GOOD - BUILD LIST OF DEFINED CONSTANTS.     21100000
.* ******************************************************************** 21150000
.*                                                                      21200000
.EXEC    ANOP                                                           21250000
&FLAG1   SETC  '0&BIOO&BPGO&BMRO.0000'                                  21300000
&L       SETC  '&LABEL'                                                 21350000
         AIF   ('&L' NE '').TSTI                                        21400000
&L       SETC  'ICV&NO.S'                                               21450000
.TSTI    ANOP                                                           21500000
         AIF   ('&FM' EQ 'I').STNDRD                                    21550000
         AIF   ('&FM' EQ 'L').LIST                                      21600000
.*                                                                      21650000
.* ******************************************************************** 21700000
.* *     BEGIN BUILD FOR EXECUTE FORM OF MACRO                          21750000
.* ******************************************************************** 21800000
.*                                                                      21850000
         AIF   ('&LABEL' EQ '').OVER   SKIP OVER LABEL                  21900000
&L       EQU   *                                                        21950000
.OVER    ANOP                                                           22000000
         IHBINNRA &MF(2)                PARM LIST INTO REG 1            22050000
         AIF   ('&ACCESS' EQ '').E2     NO ACCESS=, SKIP                22100000
         MVI   6(1),X'&FUNCT'           SET FUNCTION CODE               22150000
         AGO   .E2                      GO TO COMMON ROUTINE            22200000
.*                                                                      22250000
.* ******************************************************************** 22300000
.* *     BEGIN BUILD FOR LIST FORM OF MACRO                             22350000
.* ******************************************************************** 22400000
.*                                                                      22450000
.LIST    ANOP                                                           22500000
         CNOP  0,4                                                      22550000
&L       EQU   *                                                        22600000
         AGO   .COMMON                  GO TO COMMON ROUTINE            22650000
.*                                                                      22700000
.* ******************************************************************** 22750000
.* *     BEGIN BUILD FOR STANDARD FORM OF MACRO                         22800000
.* ******************************************************************** 22850000
.*                                                                      22900000
.STNDRD  ANOP                                                           22950000
         CNOP  0,4                                                      23000000
&LABEL   BAL   1,ICV&NO.E               LOAD CVPL LIST ADDRESS          23050000
&L       SETC  'ICV&NO.S'               SET START OF CVPL               23100000
&L       EQU   *                        START OF CVPL                   23150000
.*                                                                      23200000
.* ******************************************************************** 23250000
.* *     COMMON BUILD CODE FOR MF=I AND L FORMS                         23300000
.* ******************************************************************** 23350000
.*                                                                      23400000
.COMMON  ANOP                                                           23450000
         DC    CL4'CVPL'                EBCDIC 'CVPL'                   23500000
         DC    AL2(ICV&NO.E-&L)         LENGTH OF CVPL                  23550000
         DC    XL1'&FUNCT'              FUNCTION CODE                   23600000
         DC    XL1'00'                  STATUS INFORMATION              23650000
         DC    B'&FLAG1'                FIRST FLAG BYTE                 23700000
         DC    XL1'00'                  SECOND FLAG BYTE                23750000
         DC    H'0'                     RESERVED                        23800000
.*                                                                      23850000
.* ******************************************************************** 23900000
.* *     UCB PROCESSING                                                 23950000
.* ******************************************************************** 24000000
.*                                                                      24050000
         AIF   ('&SWUCB' EQ '0').U3     NO UCB PRESENT, SKIP            24100000
         AIF   ('&UCBNCOR' EQ '0').U3   UCB IN REG, SKIP                24150000
         DC    A(&UCB)                  UCB ADDRESS                     24200000
         AGO   .M2                      GO ON TO MAPRCDS                24250000
.U3      ANOP                                                           24300000
         DC    A(0)                     UCB ADDRESS                     24350000
.M2      ANOP                                                           24400000
         DC    A(0)                     DATA SET NAME ADDRESS           24450000
         DC    A(0)                     BUFFER LIST ADDRESS             24500000
         DC    A(0)                     INDEX VIR'S BUFFER LIST ADDRESS 24550000
.*                                                                      24600000
.* ******************************************************************** 24650000
.* *     MAPRCDS PROCESSING                                             24700000
.* ******************************************************************** 24750000
.*                                                                      24800000
         AIF   ('&SWMPR' EQ '0').M3     NO MAPRCDS PRESENT, SKIP        24850000
         AIF   ('&MPRNCOR' EQ '0').M3   MAPRCDS IN REG, SKIP            24900000
         DC    A(&MAPRCDS(2))           MAP VIR'S BUFFER LIST ADDRESS   24950000
         AGO   .O2                      GO ON TO IOAREA                 25000000
.M3      ANOP                                                           25050000
         DC    A(0)                     MAP VIR'S BUFFER LIST ADDRESS   25100000
.*                                                                      25150000
.* ******************************************************************** 25200000
.* *     IOAREA PROCESSING                                              25250000
.* ******************************************************************** 25300000
.*                                                                      25350000
.O2      ANOP                                                           25400000
         AIF   ('&SWIOA' EQ '0').O3     NO IOAREA PRESENT, SKIP         25450000
         AIF   ('&IOANCOR' EQ '0').O3   IOAREA IN REG, SKIP             25500000
         DC    A(&IOAREA(2))            I/O AREA ADDRESS                25550000
         AGO   .V2                      GO ON TO VRFAREA                25600000
.O3      ANOP                                                           25650000
         DC    A(0)                     I/O AREA ADDRESS                25700000
.V2      ANOP                                                           25750000
         DC    A(0)                     DEB ADDRESS                     25800000
         DC    A(0)                     ARGUMENT ADDRESS                25850000
         DC    A(0)                     SPACE PARAMETER LIST ADDRESS    25900000
         DC    A(0)                     EXTENT TABLE ADDRESS            25950000
         DC    A(0)                     NEW VRF VIXM BUFFER LIST ADDR   26000000
.*                                                                      26050000
.* ******************************************************************** 26100000
.* *     VRF DATA AREA PROCESSING                                       26150000
.* ******************************************************************** 26200000
.*                                                                      26250000
         AIF   ('&SWVRF' EQ '0').V3     NO VRFAREA PRESENT, SKIP        26300000
         AIF   ('&VRFNCOR' EQ '0').V3   VRFAREA IN REG, SKIP            26350000
         DC    A(&VRFAREA)              VRF DATA ADDRESS                26400000
         AGO   .NDC                     GO ON TO NEXT DC                26450000
.V3      ANOP                                                           26500000
         DC    A(0)                     VRF DATA ADDRESS                26550000
.NDC     ANOP                                                           26600000
         DC    A(0)                     COUNT AREA ADDRESS              26650000
ICV&NO.E EQU   *                        END OF CVPL                     26700000
         AIF   ('&FM' EQ 'L').FINISH    LIST FORM IS DONE               26750000
.*                                                                      26800000
.* ******************************************************************** 26850000
.* *     COMMON BUILD CODE FOR MF=I AND (E,ADDR) FORMS                  26900000
.* ******************************************************************** 26950000
.*                                                                      27000000
.E2      ANOP                                                           27050000
         AIF   ('&FM' EQ 'I').UCB1                                      27100000
&FLAG1N  SETC  '1&BION&BPGN.11111'                                      27150000
         AIF   ('&FLAG1N' EQ '11111111').OF1                            27200000
         NI    8(1),B'&FLAG1N'          RESET CVAF FLAGS OFF            27250000
.OF1     ANOP                                                           27300000
         AIF   ('&FLAG1' EQ '00000000').UCB1                            27350000
         OI    8(1),B'&FLAG1'           SET CVAF FLAGS ON               27400000
.*                                                                      27450000
.* ******************************************************************** 27500000
.* *     UCB PROCESSING                                                 27550000
.* ******************************************************************** 27600000
.*                                                                      27650000
.UCB1    ANOP                                                           27700000
         AIF   ('&SWUCB' EQ '0').MPR1   NO UCB TO PROCESS               27750000
         AIF   ('&UCBNCOR' EQ '1').UNC  UCB IN CORE, SKIP               27800000
         ST    &UCBNREG,12(,1)          STORE UCB PTR IN PARM LIST      27850000
         AGO   .MPR1                                                    27900000
.UNC     ANOP                                                           27950000
         AIF   ('&FM' EQ 'I').MPR1      MF=I, ALREADY THERE, SKIP       28000000
         LA    15,&UCB                  GET UCB ADDRESS AND             28050000
         ST    15,12(,1)                STORE UCB PTR IN PARM LIST      28100000
.*                                                                      28150000
.* ******************************************************************** 28200000
.* *     MAPRCDS PROCESSING                                             28250000
.* ******************************************************************** 28300000
.*                                                                      28350000
.MPR1    ANOP                                                           28400000
         AIF   ('&SWMPR' EQ '0').IOA1   NO MAPRCDS TO PROCESS           28450000
         AIF   ('&MPRNCOR' EQ '1').INC  MAPRCDS IN CORE, SKIP           28500000
         ST    &MPRNREG,24(,1)          STORE MAPRCDS PTR IN PARM LIST  28550000
         AGO   .IOA1                                                    28600000
.INC     ANOP                                                           28650000
         AIF   ('&FM' EQ 'I').IOA1      MF=I, ALREADY THERE, SKIP       28700000
         LA    15,&MAPRCDS(2)           GET MAPRCDS ADDRESS AND         28750000
         ST    15,24(,1)                STORE ADDRESS IN PARM LIST      28800000
.*                                                                      28850000
.* ******************************************************************** 28900000
.* *     IOAREA PROCESSING                                              28950000
.* ******************************************************************** 29000000
.*                                                                      29050000
.IOA1    ANOP                                                           29100000
         AIF   ('&SWIOA' EQ '0').VRF1   NO IOAREA TO PROCESS            29150000
         AIF   ('&IOANCOR' EQ '1').ONC  IOAREA IN CORE, SKIP            29200000
         ST    &IOANREG,32(,1)          STORE IOAREA PTR IN PARM LIST   29250000
         AGO   .VRF1                                                    29300000
.ONC     ANOP                                                           29350000
         AIF   ('&FM' EQ 'I').VRF1      MF=I, ALREADY THERE, SKIP       29400000
         LA    15,&IOAREA(2)            GET IOAREA ADDRESS AND          29450000
         ST    15,32(,1)                STORE ADDRESS IN PARM LIST      29500000
.*                                                                      29550000
.* ******************************************************************** 29600000
.* *     VRF DATA AREA PROCESSING                                       29650000
.* ******************************************************************** 29700000
.*                                                                      29750000
.VRF1    ANOP                                                           29800000
         AIF   ('&SWVRF' EQ '0').BRANCH NO VRFAREA TO PROCESS           29850000
         AIF   ('&VRFNCOR' EQ '1').VNC  VRFAREA IN CORE, SKIP           29900000
         ST    &VRFNREG,56(,1)          STORE VRFAREA PTR IN PARM LIST  29950000
         AGO   .BRANCH                                                  30000000
.VNC     ANOP                                                           30050000
         AIF   ('&FM' EQ 'I').BRANCH    MF=I, ALREADY THERE, SKIP       30100000
         LA    15,&VRFAREA              GET VRFAREA ADDRESS AND         30150000
         ST    15,56(,1)                STORE ADDRESS IN PARM LIST      30200000
.*                                                                      30250000
.* ******************************************************************** 30300000
.* *     BRANCH PROCESSING -                                            30350000
.* *     LOAD THE CVT, THE VS1/VS2 COMMON EXTENTION 2 POINTER,          30400000
.* *     THE CVTCVAF PTR, THE CVAF POINTER AND BRANCH TO CVAF           30420000
.* *     COMMON ICVCMM00                                                30440000
.* ******************************************************************** 30500000
.*                                                                      30550000
.BRANCH  ANOP                                                           30600000
         AIF   ('&BRANCH' EQ '' OR '&BRANCH(1)' EQ 'NO').SVC139         30650000
         L     15,16                    LOAD THE CVT                    30700000
         L     15,328(,15)              LOAD VS1/VS2 COMMON EXTENTION2  30720000
         L     15,12(,15)               LOAD THE CVT CVAF TABLE         30740000
         CLI   14(15),X'81'             WHAT SYSTEM?               @L1A 30753300
         BNL   ICV&NO.B                 BRANCH IF X/A              @L1A 30779900
         L     15,0(,15)                LOAD THE CVAF ADDRESS      @L1A 30793200
         BALR  14,15                    BRANCH AND LINK TO         @L1A 30806500
*                                       GLUE MODULE ICVCMM01       @L1A 30819800
         B     ICV&NO.C                                            @L1A 30833100
ICV&NO.B EQU   *                        MUST SET MODE (BASSM)      @L1A 30846400
         L     15,28(,15)               LOAD THE CVAF ADDRESS      @L1A 30859700
         DC    X'0CEF'                  BR, SAVE & SET MODE TO     @L1A 30873000
*                                       MODULE ICVCMM00            @L1A 30886300
ICV&NO.C DS    0H                                                  @L1A 30893100
         AGO   .FINISH                                                  30900000
.* ******************************************************************** 30950000
.* *     SVC139 PROCESSING                                              31000000
.* ******************************************************************** 31050000
.*                                                                      31100000
.SVC139  ANOP                                                           31150000
         SVC   139                                                      31200000
.FINISH  ANOP                                                           31250000
         MEND                                                           31300000
