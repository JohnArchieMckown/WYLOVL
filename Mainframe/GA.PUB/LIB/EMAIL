SET ESC &          ; Updated 04/26/81  Author - GD.ESW
DEF CONT AS EXE REP
IF (LAST EQ 0) EXEC 3
READ STR S8 UPPER PRO 'OK TO CLEAR YOUR ACTIVE FILE? (Y/N) ' ATTN 190
IF (SUBSTR(S8,1,1) NE 'Y') THEN IF (SUBSTR(S8,1,1) NE'O')COMM MAIL PROCESSING TERMINATED.
THEN EXE 190
CLR ACTIVE
CLR VAR
DUMP MAIL
COMM  

POINT':'3 IN 1 NOL
IF(* LE 0) COMM NO MAIL
THEN CLEAR ACTIVE
THEN EXEC 190
READ STR S8 USING * cols 1/23
SET VAL N0 10000
SET VAL N3 0
SET VAL W3 0
SET VAL W0 1
SET VAL W2 END
&W2 .
IF(W0 GE W2) EXEC 159  ; MU  ;ALP
SET VAL N8 0
SET VAL N1 W0+1
P':'3(1) IN &N1/&W2 NOL
IF(* GT 0) EXEC 31.3
SET VAL W1 W2
EXE 36
SET VAL N1 *+1
P':'6 IN * NOL
IF(* LT 0) EXEC 27
SET VAL W1 *
SET * &W0   ;BETA
SET VAL N1=W1-W0
P *(&N1) UNN attn 99.1 ;B0
READ STR S1 UPPER PRO':Action?  ' ATTN 195  ; E1 ;B1
IF(SIZE(S1) EQ 0) EXEC 66   ;B2
IF(SUBSTR(S1,1,1)NE '?')EXEC 84
LIST 302/327 EXE  UNN  ATTN 66
EXE 66
IF(SUBSTR('DELETE',1,SIZE(S1))EQ S1) EXEC 105 ; DEL
IF(SUBSTR('FORWARD',1,SIZE(S1))EQ S1) EXE 232  ; FORW
IF(SUBSTR(S1,1,3)EQ'FIL') EXEC 138  ; FILE
IF(SUBSTR('LIST',1,SIZE(S1))EQ S1) EXEC 36  ; BETA
IF(SUBSTR('REPLY',1,SIZE(S1))EQ S1) EXEC 123  ; REP
IF(SUBSTR('PRINT',1,SIZE(S1))EQ S1) EXEC 114  ; PRK
IF(SUBSTR('QUIT',1,SIZE(S1))EQ S1) EXEC 121
IF (SUBSTR('HOLD',1,SIZE(S1))EQ S1) EXEC 100
LIST 329/331 EXE UNN ATTN 66
EXEC 66  ; B1
comm ...SEVERAL LINES SKIPPED...
exec 66  ;B1
MOV &W0-.199/&W1-.200 TO &W3 BY .001 QUIET
*+.001          ***** END OF ABOVE MESSAGE *****
SET VAL W0 W3
SET VAL W3 *+.001
CH 3/3 TO ' 'IN &W0 NOL
EXEC 108
DEL &W0-.199/&W1-.200  ;DEL
SET VAL W0 W1  ;GAMMA
EXEC 24  ; ALP
COPY &W0-.199/&W1-1 TO &N0   ;PRK
READ STR S3 UPPER PRO'ON SEPARATE PAGE, (RETURN)=NO, ? ' ATTN 115.4
IF(SUBSTR(S3,1,1)EQ'Y') THEN IF(&N3 EQ 1) THEN &N0-.1 +
IF(SUBSTR(S3,1,1)EQ'Y')THEN END +
THEN SET VAL N3 0
ELSE SET VAL N3 1
SET VAL N0 END
EXEC 66  ; B1
IF (S9 NE '*?*') EXE 121.6
READ STR S3 UPPER PRO'Quitting now will lose unread mail.  QUIT (Y/N)? '
IF (SUBSTR(S3,1,1) EQ'Y') EXE 121.8
EXE 66
COMM All mail processed will be presented again during your next RMAIL session.
SET VAL W2 W0-.199
EXE 161
READ STR S2 USING &W0 COLS 24/29   ;REP
READ STR S3 USING &W0
&W1-.399 
REPLY TO &S3 

CH 11 USING &W0 COLS 10/18 IN &W1-.399 N
CH 25/36 TO '' IN &W1-.399 N
P &W1-.398 NOL
IF(* GT 0) COMM REPLY WAS PREVIOUSLY ENTERED, WHICH IS:
THEN L &W1-.398/&W1-.200 ATTN 124.7
THEN READ STR S5 UPPER PRO 'Use these comments? (Y/N) ' ATTN 124.7
THEN IF (SIZE(S5) GT 0) IF (SUBSTR(S5,1,1) EQ'Y') EXE 129
DEL &W1-.398/&W1-.200
COMM * Collect your reply and then type "CONT" to complete the reply operation.
COL &W1-.398 BY .003
EXE PAUSE
READ STR S5 PRO': Send additional reply copies to ? ' ATTN 129
IF (SIZE(S5) EQ 0) EXEC 131
&W1-.200 cc: &S5 

READ STR S4 PRO ': Subject for reply message? ' ATTN 66
IF (SIZE(S4) GT 0) EXE 132
SET VAL S4 SUBSTR(S3,IND(SUBSTR(S3,9),':')+10)
IF (SIZE(S4) EQ 0) EXE 131
IF (N8 NE 0) SET VAL S2 ''
MAIL &W1-.399/&W1-.200 TO (&S2,&S5) TITLE "&S4"
SET VAL N8 1
EXE 66   ;B1
SET VAL N2 INDEX(S1,' ')+1   ;FILE
IF(N2 NE 1) EXEC 150  ; FILE1
CH 1 TO '*              'IN &W0 NOL
EXEC 155
SET VAL S1 SUBSTR(S1,N2,12)  ;FILE1
CH 1 TO "* &S1 " IN &W0 NOL
MOV &W0 TO &W0-.199
EXEC 108  ; GAMMA
IF(S9 NE '*?*') THEN EXEC 204  ;MU
IF(N0 NE 10000) PRINT 10000/L UNN IND 6 CHARS TN12 FORMS 9511 MARKER +
DEL &W2/L
IF(LAST LT .801) EXEC 189  ; NU
COMM MAIL IS BEING FILED.
NUM .800/LAST FROM 1 BY 1
COPY FROM CHRON
IF(END LE 6000) EXE 180
COMM 
Your CHRON file is getting large which may slow processing.
COMM To avoid this you may move older items to another accessible file.
READ STR S8 UPPER PRO 'MOVE OLDER ITEMS? (Y/N) ' ATTN 178.4
IF(SUBSTR(S8,1,1) EQ 'Y') EXEC 254
SAVE CHRON LINES 1/LAST REPLACE QUIET
DEL 1/LAST
IF(LAST NE 0) THEN NUM QUIET
COMM MAIL COMPLETED
SET ESC   ;NU
CLEAR VAL
UNDEF CONT
CLEAR EXEC
COMM MAIL PROCESSING INTERRUPTED, TO CONTINUE TYPE 'CONT'.
EXEC PAUSE
EXEC 36  ; BETA
SET VAL S9 '*?*'
DUMP MAIL DELETE
DEL &W2
IF(N0 NE 10000) MOVE &N0/LAST TO &W2+1  BY 1 QUIET
SET VAL W0 W0+1
P'&S8' IN 1/9999 N
IF(* LT 0) COMM MAJOR ERROR
THEN EXEC PAUSE
IF (* EQ W2+1) EXE 161
COMM WARNING - At this point you must process remaining mail or lose unread messages.
SET VAL W2 *
D &W2/9999
EXEC 22
P &W0-.198 N
IF(* GT 0) COMM Forwarding comments were previously entered, which are:
THEN L &W0-.198/&W0-.003 ATTN 235
THEN READ STR S3 UPPER PRO'Use these comments? (Y/N) ' ATTN 235
THEN IF (SIZE(S3) GT 0) IF (SUBSTR(S3,1,1) EQ'Y') EXE 241
DEL &W0-.198/&W0-.003
COMM * Collect any new text that you wish to precede the forwarded message.
COMM * and type 'CONT' to complete the FORWARD operation.
C &W0-.198 BY .003
EXE PAUSE
READ STR S3 PRO': Forward message to? ' ATTN 241
&W0-.002 To: &S3

READ STR S2 USING &W0
&W0-.001 FORWARDED MESSAGE &S2
CH 19 USING &W0 COL 10/18 IN &W0-.001 N
CH 32/43 TO '' IN * N
SET VAL S2 SUBSTR(S2,IND(SUBSTR(S2,9),':')+10)
IF (SIZE(S2) EQ 0) READ STR S2 PRO': Subject for forwarding message? ' ATTN 247
IF (SIZE(S2) EQ 0) EXE 246.2
MAIL &W0-.198/&W0-.001 &W0+.001/&W1-.200 TO (&S3) TITLE "&S2"
EXE 66  ; B1
;  THIS ROUTINE SPLITS THE CHRON FILE WHEN IT GETS TOO LARGE.
SET VAL S2 SUBSTR(DATE,10,2)
SET VAL S3 SUBSTR(DATE,16,2)
SET VAL S2 S2-1
IF (S2 LE 0) SET VAL S2 S2+12
THEN SET VAL S3 S3-1
SET VAL S8 '&S2'||'/'
P'* *Memos'1(1) NOL
IF (* LT 0) SET VAL W1 END
ELSE SET VAL W1 *-.001
P'&S8'25/27(1) IN 1/&W1 NOL
IF (* LT 0) EXE 256.3
READ STR S4 USING *
IF(SUBSTR(S4,21,1) EQ ':')EXEC 255.2
P '&S8'25/27(1) IN *+.001/&W1 NOL
EXE 255.1
SET VAL W0 *-.001
READ STR S1 USING 256+&S2  EXE
SET VAL S2 'CHR.&S1'||'&S3'
&W0 * *Memos with following headings are filed under &S2
COMMENT Memos up thru &s1 19&s3 are being moved to  a new file named &s2.
COMM The title lines are being kept in your CHRON for searching.
COMM To reference these memos,  USE &S2  , and press  Q  for header lines.
SAVE &S2 LINES &W0+.001/&W1
DEL ~'* '1 IN &W0/&W1
CH 16/23 TO '&S1&S3   ' IN &W0+.001/&W1 NOL
COMM Your CHRON file now has the following number of lines:
COUNT
EXEC 180
JAN
FEB
MAR
APR
MAY
JUN
JUL
AUG
SEP
OCT
NOV
DEC
              A VERY BRIEF DESCRIPTION OF RMAIL

ACTIONS!
DELETE      erases the current mail message.
PRINT       prints a copy on plain paper from the 3800.
LIST        lists the current message again from the beginning.
REPLY       returns a reply to the sender, and optionally to others.  The
            copied accounts receive ONLY your reply and not the original
            message.
FORWARD     sends your message followed by the original message to one or more
            accounts designated, and separated by spaces.
HOLD        retains the message in the ACTIVE file after completion.
FILE        Files a copy of the message plus any reply and forwarding messages
            in a CHRON file.  For example FILE Budgets will file the message
            using "Budgets" as a subject for later retrieval.  To retrieve mail
            from CHRON, then USE CHRON and list it or parts of it.
QUIT        Stop processing remaining messages after completing previous
            actions.  If the WARNING message has not been given, all mail
            processed in this session will be presented again during your next
            session.  Otherwise unread messages will be lost.

If you "break out of the program" you can get back to process the current
message by typing CONT.  The program will pick up where it left off and
continue.  Mail any comments or problems to GD.ESW

YOUR RESPONSE IS NOT A VALID ACTION.
VALID ACTIONS ARE:  DELETE /PRINT /LIST /REPLY /FORWARD /HOLD /FILE /QUIT
                    For a brief description enter ?

THIS EXEC COPIES THE WYLBUR MAIL FILE INTO THE ACTIVE FILE AND
PROCESSES IT. IT DISPLAYS EACH MESSAGE, PAUSES AND PROMPTS FOR
AN ACTION FROM YOU.  VALID ACTIONS ARE DELETE (D), PRINT (P),
REPLY (R), FORWARD (FOR), LIST (L), HOLD (H), FILE (F), OR QUIT (Q).

IF YOU HIT THE BREAK KEY WHILE THE MESSAGE IS BEING DISPLAYED,
IT WILL SKIP THE REST OF THE MESSAGE AND PROMPT FOR AN ACTION.
IF YOU HIT BREAK WHEN THE 'Action?' PROMPT IS DISPLAYED,
IT WILL INTERRUPT THE PROCESSING AND RETURN YOU TO WYLBUR.
TO RESUME MAIL PROCESSING TYPE 'CONT'.

YOU SHOULD PROCESS ALL OF YOUR MESSAGES AT ONE TIME, SINCE THIS
EXEC DOES NOT SAVE MAIL NOT PROCESSED.

REPLY, FORWARD, AND DELETE ACTIONS ARE COMPLETED BEFORE STARTING
THE NEXT MESSAGE (IF ANY). PRINT, FILE, AND HOLD ACTIONS ARE
COMPLETED AFTER ALL MESSAGES HAVE BEEN PROCESSED.

THE FILING SYSTEM FOR THE MAIL MESSAGES THAT YOU FILE IS A REGULAR
SEQUENTIAL DATASET CALLED CHRON.  WHEN THE CHRON FILE GETS TOO LARGE,
THE EXEC WILL AUTOMATICALLY SPLIT THE CHRON DATA SET BY REMOVING
PREVIOUS MONTHS MESSAGES AND FILING THEM IN ANOTHER FILE WITH A
NAME SUCH AS "CHR.JUN80".  YOU MAY USE THIS FILE AND SEARCH IT
USING ONE OF THE AVAILABLE TECHNIQUES.  E.G. "Q" WILL LIST THE
HEADER LINES OF EACH MESSAGE - ALONG WITH ITS LINE NUMBER.
