; EXHUME version of 11/10/81 by Mark Lawrence
COMM EXHUME version of 11/10/81
COMM
COMM ***  Please take note that EXHUME may not recover all dead
COMM ***  members of your library.  If you are unable to recover
COMM ***  any dead member you wish to restore, please contact
COMM ***  consulting.  The problem is being worked on, and this
COMM ***  message will be removed when it is fixed.
COMM
CLEAR VARIABLES
SET VAL S9 ESC
SET ESC &
SET VAL W9 END
SET VAL N9 LENGTH
SET LENGTH 71
SET VAL S0=ACCOUNT
;
READ STR S8 UPPER PROMPT 'Do you need instructions? '
IF (SIZE(S8) EQ 0) EXEC 150
IF (SUBSTR(S8,1,1) EQ 'N') EXEC 150
COMM
COMM This execfile will submit a job to retrieve scratched members from a
COMM WYLBUR library.  Members can be retrieved only if the library has
COMM not been moved or condensed since they were scratched.
COMM
;  PREFIX FOR DSNAMES
;
SET VAL S8 'WYL.'||SUBSTR(ACC,5,2)||'.'||SUBSTR(ACC,1,3)||'.'
;
;  library
;
COMM
REA STR S6 UPP PRO 'Name of library (<CR>=&(LIBRARY))? '
IF (SIZE(S6) EQ 0) SET VAL S6 LIBRARY
;  DSN CHECK
IF (SUBSTR(S6,1,4) EQ 'WYL.') EXE 639
IF (SUBSTR(S6,1,3) EQ 'SYS') IF (SUBSTR(S6,5,1) EQ '.') EXE 639
;
SET VAL S6 S8||S6                               ;ADD DEFAULT QUALIFIER
;  OUTPUT FILE
;
REA STR S3 UPP PRO 'Specify the data set name to be used for the dumped members '
IF (SIZE(S3) EQ 0) SET VAL S3 'PDSDUMP'
;
;  DSNAME PREFIX CHECK
;
IF (SUBSTR(S3,1,4) EQ 'WYL.') EXE 731
IF (SUBSTR(S3,1,3) EQ 'SYS') IF (SUBSTR(S3,5,1) EQ '.') EXE 731
SET VAL S3 S8||S3                                ;ADD PREFIX
;
;
;  BUILD JCL
;
SET VAL S0 S6                      ; LIB
IF (SUBSTR(S0,1,SIZE(S8)) EQ '&S8') SET VAL S0 SUBSTR(S0,SIZE(S8)+1)  ; NO PREFIX IN USERNAME FIELD
IF (SIZE(S0) LT 14) SET VAL S0 'EXHUME '||S0
IF (SIZE(S0) GT 20) SET VAL S0 SUBSTR(S0,1,20)
;
END //   JOB  ,'&S0',TIME=(,15)
END // EXEC EXHUME,
END // LIB='&S6',
END // DUMPDSN='&S3'
;
;  READY TO RUN
;
COMM
REA STR S0 UPP PRO 'RUN? '
IF (SIZE(S0) EQ 0) EXE 1030
IF (SUBSTR(S0,1,1) EQ 'Y') EXE 1030
IF (S0 EQ 'OK') EXEC 1030
IF (S0 EQ 'HOLD') EXE 1035         ; RUN HOLD
IF (SUBSTR(S0,1,1) EQ 'N') EXE 1100
;
;  EXPLAIN RUN
;
COMM
COMM If you reply YES or "carriage return", the job will be submitted
COMM with a RUN command, and the JCL will be deleted from the active
COMM file.  If you reply HOLD, the job will be submitted with a RUN HOLD
COMM command and the JCL will then be deleted as before.  If you reply
COMM NO, EXHUME will not run the job and will leave the JCL in your
COMM active file for you to inspect or modify.  You will then have to
COMM issue a RUN command to actually submit the job.
COMM
;
exe 1000
;
RUN &W9/L NUM
DEL &W9/L
EXE 1200
;
END /*JOBPARM HOLD=OUTPUT,PURGE=NO
EXE 1030
; DON'T RUN
;
IF (FIRST NE W9) EXE 1110
COMM The JCL is in your active file; issue a RUN command to submit the job.
EXE 1200
;
COMM The JCL is in lines &W9/Last of your active file.
COMM To submit the job, issue the command RUN &W9/LAST.
;
; CLEAN UP
;
SET LENGTH &N9
SET ESC '&S9'
CLR EXE
