; NAME:      SetTerm                                        09/11/92
;
; FUNCTION:  Set terminal type if the session does not yet have one.
;
;   When called this exec will prompt the user for a terminal type.
;   The prompt includes an ENQ character (hex 2D) to trigger an
;   answerback message if the terminal has one.   Otherwise, the
;   user can answer the prompt for the correct terminal type.
;
;   Improved handling of null response.  01/31/89,ltm
;   Added code to set terminal height if Samson.   9/9/92, deb
;
;   On 7/20/94, changed (@deb):
;   if (termtype eq 'SAMSON') begin
;        to
;   if (samson) begin
;
;   On 6/15/96, commented out SET SAMSON TIME  (jnk)

xproc () begin
   on attn,  cmd='on attn reenable'
   on error, cmd='goto ERROR'

   attncount = 0
   default   = ''
   done      = false
   enq       = s'2d'
   termtype  = ''

   if (ttype ne '') done = true
   default = upper(squ(parm_string))

   while (~done) begin

      if (default eq '') tprompt = 'Enter terminal type: '
      else tprompt = 'Enter terminal type (Press Return for ' \
         || default || '): '

      termtype = input(tprompt || enq,'UPPER,ATTN')   ; -- Prompt

      enq = '' ; only invoke answerback once, in case it's bad
      if (abbrev('HELP',termtype,3)) termtype = '?'

      if (ioresult eq 'ATTN') begin                   ; -- Attention
         termtype = ''
         if (attncount gt 0) done = true
         else begin
            wri 'Press attention again to continue \
               without setting a terminal type'
            attncount = attncount + 1
         end
      end

      elseif (termtype eq '') begin                   ; -- Null
         if (default ne '') begin
            termtype = default
            done = true
         end
      end

      elseif (termtype eq '?') begin                  ; -- Help
         termtype = ''
         help TERMINALS
         wri ''
         wri 'Press attention to continue without \
            setting a terminal type'
         attncount = attncount + 1
      end

      if (termtype ne '') begin                       ; -- Set term
         try quiet set terminal &(termtype)
         if (tryid eq 'BADTERM') begin
            wri termtype || ' is an unknown terminal type.'
            wri 'Type HELP or ? for assistance.'
         end
         else done = true
      end

   end

;   if (samson) begin
;      set samson time
;   end

; Code added 9/10/92

    if (theight ge 2) set height &(theight-2)

   xreturn

ERROR:

   wri 'An error has occurred setting your terminal type.'
   if (ttype eq '') wri 'No terminal type set.'
   else wri 'Your terminal type is set to ' || ttype
   xreturn

end
