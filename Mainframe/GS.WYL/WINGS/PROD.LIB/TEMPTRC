*box                                                                    00001000
*                                                                       00002000
*        Trace table routine                                            00003000
*                                                                       00004000
         SPACE 2                                                        00005000
*-                                                                      00006000
*- Trace table entry format                                             00007000
*-                                                                      00008000
TRCENTRY RECORD BEGIN                                                   00009000
TRCCLOCK DS    D                   Time stamp                           00010000
TRCNAME  DS    CL8                 Routine name or trace id             00011000
TRCREGS  DS    16F                 Registers                            00012000
         END                                                            00013000
*-                                                                      00014000
*- Trace routine -- on entry R14 and R15 have been saved in GVTTRSAV    00015000
*-                                                                      00016000
         USING GVT                                                      00017000
         SPACE 1                                                        00018000
NITTRACE IF    GVTFTRC,BEGIN       If tracing active,                   00019000
         L     R15,GVTTRCUR        Get current entry address            00020000
         LA    R15,L'TRCENTRY(R15) Step to next entry                   00021000
         IF    (R15,GE,GVTTREND),'L R15,GVTTRBEG'  Check for wrap       00022000
         ST    R15,GVTTRCUR        Save current entry pointer           00023000
         WITH  (TRCENTRY,R15)                                           00024000
         STCK  TRCCLOCK            Time stamp                           00025000
         MVC   TRCNAME,@R14        Move in id                           00026000
         STM   R0,R13,TRCREGS      Save R0-R13                          00027000
         MVC   TRCREGS+14*4(8),GVTTRSAV    Move in R14-R15              00028000
         END                                                            00029000
         B     8(R14)              Return to caller (step over id)      00030000
         DROP  GVT                                                      00031000
                                                                        00032000
