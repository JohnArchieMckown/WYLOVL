         MACRO                                                          00001000
&L       SCKW  &KP,&XP,&TP,&MP                                          00002000
.*MOD JH3057, 18FEB73 (73.057), J. HALPERIN.                     JH3057 00003000
.*  ADD &MACTYPE GBLC SYMBOL, TO RESTRICT &TP VALUES FOR MILTEN. JH3057 00004000
.*MOD JH3078, 17MAR73 (73.078), J. HALPERIN                      JH3078 00005000
.*  FOR MILTEN ASSEMBLIES, GENERATE YL2 ADCONS USING A RELATIVE  JH3078 00006000
.*    DISPLACEMENT FROM THE START OF THE SCKW.                   JH3078 00007000
.*  ADD BETTER CHECKING FOR ILLEGAL COMBINATIONS.                JH3078 00008000
         GBLC  &PAGECDE,&MACTYPE                                 JH3057 00009000
         LCLA  &X,&PV,&TV,&AV,&LV,&LV1                           JH3078 00010000
         LCLB  &MILMAC  1 IF ASSEMBLING A MILTEN MODULE          JH3057 00011000
         LCLC  &RP,&RPP,&RPS,&AL                                 JH3078 00012000
&RP      SETC  '&XP'                                                    00013000
&AL      SETC  'AL3'   USE AL3 FOR RELOCATIBLE ADCONS NOT IN PAGED CODE 00014000
&MILMAC  SETB  ('&MACTYPE   '(1,3) EQ 'MIL')  1 IF MILTEN ASM    JH3078 00015000
         AIF   (NOT &MILMAC).AL3                                 JH3078 00016000
&AL      SETC  'YL2'         USE YL2 FOR MILTEN RELATIVE ADDR    JH3078 00017000
&RPS     SETC  '-(*-1)'      SET SUFFIX FOR RELATIVE ADDR        JH3078 00018000
.AL3     AIF   ('&RP' NE '').UNZ                                 JH3078 00019000
&RP      SETC  '0'                                                      00020000
&RPS     SETC  ''            NO SUFFIX FOR ZERO CASE             JH3078 00021000
.UNZ     AIF   ('&PAGECDE' NE 'YES').UNPAG                              00022000
&AL      SETC  'AL.24' USE AL.24 FOR ADCONS IN PAGED CODE SO THAT IF    00023000
.*             ARE RELOCATIBLE BY ACCIDENT AN ASSEMBLY ERROR WILL BE    00024000
.*             GENERATED.                                               00025000
         AIF   ('&RP' EQ '0').UNPAG                                     00026000
&RPP     SETC  '&SYSECT.-'                                              00027000
.UNPAG   AIF   ('&KP'.'&TP' EQ '').UNREC                                00028000
.LOOP    ANOP                                                           00029000
&X       SETA  &X+1                                                     00030000
         AIF   (&X GT N'&TP).DONE                                       00031000
         AIF   ('&TP(&X)' EQ 'P').P   should have PARAMETER             00032000
         AIF   ('&TP(&X)' EQ 'A').A   may be ABBREVIATED         JH3057 00033000
         AIF   ('&TP(&X)' EQ 'PI').PI POSITIVE INTEGER                  00034000
         AIF   ('&TP(&X)' EQ 'I').I   INTEGER parameter                 00035000
         AIF   (&MILMAC).ILLTYPE   END OF LIST FOR MILTEN        JH3057 00036000
         AIF   ('&TP(&X)' EQ 'LN').LN LINE-NUMBER parameter             00037000
         AIF   ('&TP(&X)' EQ 'S').S   WTF?                       JH3057 00038000
         AIF   ('&TP(&X)' EQ 'POP').POP   pop up keytable               00039000
         AIF   ('&TP(&X)' EQ 'PUSH').PUSH push down keytable            00040000
.ILLTYPE MNOTE 12,'***** "&TP(&X)" IS ILLEGAL'                   JH3057 00041000
         MEXIT                                                   JH3057 00042000
.P       ANOP                                                           00043000
&PV      SETA  1                                                        00044000
         AGO   .LOOP                                                    00045000
.S       ANOP                                                           00046000
&TV      SETA  1                                                        00047000
         AGO   .LOOP                                                    00048000
.PI      ANOP                                                           00049000
&TV      SETA  2                                                        00050000
.ICOM    AIF   ('&MP' EQ '').LOOP                                       00051000
&TV      SETA  &TV+1                                                    00052000
         AGO   .LOOP                                                    00053000
.I       ANOP                                                           00054000
&TV      SETA  4                                                        00055000
         AGO   .ICOM                                                    00056000
.LN      ANOP                                                           00057000
&TV      SETA  6                                                        00058000
         AGO   .LOOP                                                    00059000
.A       ANOP                                                           00060000
&AV      SETA  1                                                        00061000
         AGO   .LOOP                                                    00062000
.DONE    ANOP                                                           00063000
&X       SETA  &PV*128+&TV*16+&AV*8                              JH3078 00064000
         AIF   ('&KP' EQ '').NOKW                                       00065000
&LV      SETA  K'&KP-1                                                  00066000
         AIF   ('&KP'(1,1) NE '''').NOQ                                 00067000
&LV      SETA  &LV-2                                                    00068000
.NOQ     ANOP                                                           00069000
         AIF   (&LV LT 8).LVSET                                  JH3078 00070000
&LV      SETA  7                                                        00071000
.LVSET   ANOP                                                    JH3078 00072000
&LV1     SETA  &LV+1         TRUE CHARACTER COUNT                JH3078 00073000
&X       SETA  &X+&LV        FINAL FLAG VALUE                    JH3078 00074000
         AIF   ('&KP' EQ '').NOKPQ                                      00075000
         AIF   ('&KP'(1,1) NE '''').NOKPQ                               00076000
&L       DC    AL1(&X),&AL.(&RPP.&RP.&RPS),CL&LV1&KP                    00077000
         AGO   .LIM                                                     00078000
.NOKPQ   ANOP                                                           00079000
&L       DC    AL1(&X),&AL.(&RPP.&RP.&RPS),CL&LV1'&KP'                  00080000
         AGO   .LIM                                              JH3078 00081000
.NOKW    AIF   (&PV EQ 1 OR &TV LT 2).ILLKW                      JH3078 00082000
&L       DC    AL1(&X),&AL.(&RPP.&RP.&RPS),C' '                         00083000
.LIM     ANOP                                                           00084000
         AIF   (&TV LT 2 OR &TV GT 5).END                               00085000
         AIF   ('&MP' EQ '').END                                        00086000
         DC    AL4(&MP)                                                 00087000
         MEXIT                                                          00088000
.ILLKW   MNOTE 8,'**** KEYWORD REQUIRED'                         JH3078 00089000
         MEXIT                                                   JH3078 00090000
.UNREC   ANOP                                                           00091000
&L       DC    X'FF',&AL.(&RPP.&RP.&RPS)                                00092000
         MEXIT                                                          00093000
.POP     ANOP                                                           00094000
&L       DC    X'F9'                                                    00095000
         MEXIT                                                          00096000
.PUSH    ANOP                                                           00097000
&L       DC    X'F8',&AL.(&RPP.&RP.&RPS)                                00098000
.END     MEND                                                           00099000
