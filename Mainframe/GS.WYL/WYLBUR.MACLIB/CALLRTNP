.*                                                                              
.*   written    JAN/91  by ch                                                   
.*                                                                              
.*   PLEASE DO NOT USE THIS MACRO UNLESS ABSOLUTELY NECESSARY!                  
.*                                                                              
.*   see comments in SAVERTNP macro                                             
.*                                                                              
.*   NOTE:                                                                      
.*     CALLRTNP RX - call routine pointed to by reg                             
.*     CALLRTNP @RX - call routine pointed to by loc @reg                       
.*                                                                              
.*                                                                              
         MACRO                                                                  
&L       CALLRTNP &RX                                                           
         GBLB  &$PCODE                                                          
         LCLC  &REGX                                                            
&L       LABEL ,                                                                
         AIF   ('&RX'(1,1) EQ '@').CALLLOC                                      
         AIF   ('&RX' EQ 'R14').CONT                                            
         MNOTE 8,'BASR DOES NOT USE R14. BAD REGISTER CONVENTIONS.'             
         MEXIT                                                                  
.CONT    ANOP                                                                   
         AIF   (&$PCODE).CGEN1                                                  
         BASR  &RX,&RX             presumably always R14                        
         MEXIT                                                                  
.CGEN1   ANOP                                                                   
         MNOTE *,'C-CODE memcpy((char *) && (RTN_PTR1),'                        
         MNOTE *,'C-CODE   (char *) && (&RX), sizeof(&RX)); '                   
         MNOTE *,'C-CODE (*(RTN_PTR1))();'                                      
         MEXIT                                                                  
.CALLLOC ANOP                                                                   
&REGX    SETC  '&RX'(2,K'&RX-1)                                                 
         AIF   (&$PCODE).CGEN2                                                  
         L     R14,@&REGX                                                       
         BASR  R14,R14             presumably always R14                        
         MEXIT                                                                  
.CGEN2   ANOP                                                                   
         MNOTE *,'C-CODE memcpy((char *) && (RTN_PTR1),'                        
         MNOTE *,'C-CODE   (char *) (&REGX), sizeof(RTN_PTR1)); '               
         MNOTE *,'C-CODE (*(RTN_PTR1))();'                                      
         MEND                                                                   
