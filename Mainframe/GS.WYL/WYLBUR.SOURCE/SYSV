SYSV     TITLE 'WYLBUR System Variables'                                        
*******************************************************************             
*                                                                 *             
*     WYLBUR/370 - Release VI - Class I - Stanford Proprietary    *             
*                                                                 *             
*******************************************************************             
         HIBAL                                                                  
*                                                                               
         SPACE 10                                                               
*******************************************************************             
*                                                                 *             
*                **** ATTENTION !!!! ****                         *             
*                **** ATTENTION !!!! ****                         *             
*                **** ATTENTION !!!! ****                         *             
*                                                                 *             
*       SEE COMMENTS ON NEXT PAGE BEFORE ADDING SYSTEM            *             
*       VARIABLES OR FUNCTIONS !!!!                               *             
*                                                                 *             
*******************************************************************             
*                                                                               
*  NOTE: SYSTEM PROCEDURES ARE LOCATED IN PROC MODULE.                          
*  NOTE: SYSTEM FUNCTIONS ARE LOCATED IN FUNC MODULE.                           
*                                                                               
*  FOR MORE INFORMATION SEE COMMENTS IN FUNC MODULE.                            
*                                                                               
         EJECT                                                                  
* LAST UPDATE 7/89                                                              
*******************************************************************             
**                                                             ****             
**                                                              ***             
**      HOW TO ADD A SYSTEM VARIABLE OR FUNCTION !               **             
***     ------------------------------------------               **             
*****                                                            **             
*      FOR MORE INFORMATION SEE COMMENTS IN FUNC MODULE.          *             
*******************************************************************             
*                                                                               
*  PROCEDURE TO ADD VARIABLE OR FUNCTION:                                       
*                                                                               
*  1. ADD A ENTRY INTO THE SYSTEM VARIABLE/FUNCTION TABLE.                      
*                                                                               
*       THIS TABLE (SYSFNS) IS SEARCHED TO FIND THE ADDRESS OF                  
*       THE ROUTINE FOR THE SPECIFIED FUNCTION, VARIABLE, OR                    
*       PROC.  THE ENTRIES MUST APPEAR IN ALPHABETICAL ORDER.                   
*       USE THE 'SYSFN'    AND  'SYSVAR'   MACRO TO CREATE A                    
*       PROPERLY FORMATTED ENTRY.                                               
*                                                                               
*  2. ADD A SYSTEM VARIABLE/FUNCTION ROUTINE.                                   
*                                                                               
*       SYSTEM VARIABLE/FUNCTION ROUTINES ARE FOUND AFTER THE                   
*       SYSTEM VARIABLE/FUNCTION TABLE. THE ROUTINES SHOULD BE                  
*       PLACED IN ALPHABETICAL ORDER BASED ON THE VAR/FUNC                      
*       KEYWORD.  WORK AND COMMON ROUTINES SHOULD BE PLACED                     
*       IN ALPHABETICAL ORDER IN THE COMMON/WORK ROUTINES AREA.                 
*       THE BASIC ENTRY AND EXIT CONVENTIONS ARE:                               
*                                                                               
*       ON ENTRY:                                                               
*            R0 - VARIABLE COUNT                                                
*            R1 - ARGUMENT LIST    (FOR FUNCTIONS/PROC, ONLY)                   
*            R6 - FUNCTION/VARIABLE RETURN AREA                                 
*                 (AREA WILL INITIALLY CONTAIN VAR/FUNC/PROC NAME)              
*                                                                               
*       ON EXIT:                                                                
*            R6 - RETURNED VALUE (SAME AS ON ENTRY)                             
*           R15 - CC=ZERO, ALL OK                                               
*                 CC=NZ, IF ERROR,,, ERROR MSG TSEG 'D                          
*                                                                               
*       THE FORMAT OF THE ARGUMENTS PASSED AND RETURNED IS                      
*       DESCRIBED BY THE VNENTRY DSECT.  EACH ARGUMENT OCCUPIES                 
*       A FIXED LENGTH (L'VPARM) ENTRY. THUS EACH INPUT                         
*       ARGUMENT (IF ANY) CAN BE EASILY FOUND AT A FIXED OFFSET                 
*       BASED OFF OF R1.                                                        
*                                                                               
*       SEVERAL MACROS EXIST TO MAKE THE ADDITION OF ROUTINES                   
*       EASIER.  TO USE THESE MACROS CERTAIN ADDITIONAL                         
*       CONVENTIONS MUST BE ADHERED TO.  THESE CONVENTIONS AND                  
*       THE MACROS ARE DESCRIBED NOW:                                           
*                                                                               
*   *** AN 'PROC' AND AN 'PEND' MUST                                            
*       BE USED TO ENTER AND EXIT THE ROUTINE.                                  
*                                                                               
*   *** IF THE ROUTINE IS SUCCESSFUL R15 MUST BE RETURNED                       
*       EQUAL TO ZERO.  IF NOT R15 MUST BE RETURNED AS NON-ZERO                 
*       (4).  ALSO AN APPROPRIATE ERROR MESSAGE MUST BE TSEG'D.                 
*       ** DO NOT EXIT A ROUTINE VIA CVNEXT OR CVERROR !! **                    
*                                                                               
*   *** IF YOU INTEND TO USE THE "SCANNER", YOU MUST SAVE AND                   
*       RESTORE THE CURRENT SCANNER STATE.  FOR AN EXAMPLE SEE                  
*       'YESNO' ROUTINE.                                                        
*                                                                               
*   *** THE 'VRETURN' MACRO                                                     
*                                                                               
*       THE 'VRETURN' MACRO IS USED TO RETURN A VARIABLE OR                     
*       FUNCTION VALUE.  IT TAKES 2-3 PARAMETERS. THE FIRST IS                  
*       THE TYPE OF VALUE TO RETURN.  THIS MAY BE STRING,                       
*       INTEGER, LINENO, OR BOOLEAN.  ARRAYS AND PACKED NUMBERS                 
*       MAY NOT BE RETURNED WITH THIS MACRO.  ARGUMENTS 2-3 ARE                 
*       THE VALUE OF THE VAR/FUNC.  IF THE TYPE IS A STRING:                    
*       ARGS 2-3 ARE THE STRING LOC, LENGTH; A QUOTED STRING                    
*       MAY BE RETURNED, THE CONVENTIONS FOR RETURNING A STRING                 
*       ARE THE SAME AS FOR THE 'MSG' MACRO.  IF THE TYPE IS                    
*       INTEGER OR LINENO: THE SECOND PARAMETER IS A FULLWORD                   
*       VALUE.  IF THE TYPE IS BOOLEAN: THE SECOND PARAMETER IS                 
*       THE WORD 'TRUE' OR THE WORD 'FALSE'.  THIS MACRO                        
*       REQUIRES THAT R6 BE THE SAME AS WHEN THE SYSTEM                         
*       VAR/FUNC. ROUTINE WAS ENTERED.  FOR EXAMPLES, SEE THE                   
*       'FNCASE' 'FNLENGTH' 'FNLILB' 'FNLAST' AND 'FNTRUE'.                     
*       SOME ISOLATED EXAMPLES ARE:                                             
*             VRETURN STRING,' THIS IS IT '                                     
*             VRETURN STRING,(R1),(R0)                                          
*             VRETURN BOOLEAN,TRUE                                              
*             VRETURN LINENO,L:XXLINENO                                         
*             VRETURN INTEGER,(R4)                                              
*       HEY DUDE !! THE VRETURN MACRO CLOBBERS R15,R0,R1,R2 SO                  
*       BE CAREFUL.  R15 IS SET TO ZERO BY THE VRETURN MACRO.                   
*                                                                               
*   *** THE 'VTRIM' MACRO                                                       
*                                                                               
*       THE 'VTRIM' MACRO IS USED TO TRIM TRAILING BLANKS OFF                   
*       THE END OF RETURNED STINGS.  IT WILL ALSO SET BLANK OR                  
*       ZEROED STRINGS TO NULL STRINGS.  IT REQUIRES THAT R6 BE                 
*       THE SAVE AS WHEN THE SYSTEM FUNC/VAR ROUTINE WAS                        
*       ENTERED.  IT IS GENERALLY CODED DIRECTLY FOLLOWING THE                  
*       'VRETURN STRING,..' MACRO.  FOR AN EXAMPLE SEE 'FNLIB'                  
*       ROUTINE.                                                                
*                                                                               
*                                                                               
*                                                                               
*   *** RETURNING VAR/FUNCTION VALUE,,,                                         
*                                                                               
*       THE EASY WAY IS WITH THE 'VRETURN MACRO', BUT THERE ARE                 
*       OTHER WAYS.  YOU MAY SET UP YOUR OWN RETURN VALUE @R6.                  
*       SEE VNENTRY DSECT. THE AREA MUST BE CLEARED.  FLAGS                     
*       MUST BE SET FOR THE VARIABLE TYPE:  STRING, BOOLEAN,                    
*       NUMBER.  THE VARIABLE VALUE MUST BE SET.  FOR EXAMPLES,                 
*       SEE 'FNASCII' 'FNPI' OR 'FNSUBSTR'.  IF YOU WANT TO                     
*       DEAL WITH ARRAYS (IF THEY EXIST),,, GOOD LUCK HASBRO !!                 
*                                                                               
*   *** FINAL ADVICE                                                            
*                                                                               
*       THIS MODULE ADHERES TO SEVERAL CONVENTIONS.  IF YOU                     
*       ADHERE TO THESE CONVENTIONS, IT WILL MAKE IT EASIER FOR                 
*       YOU AND ALL THE PEOPLE WHO ALSO WANT TO ADD VARS/FUNCS                  
*       TO ADD THEM. IT IS WORTH IT TO TAKE A BIT OF TIME AND                   
*       LOOK AT HOW SEVERAL EXITING SYSTEM VARIABLE/FUNCTION                    
*       ROUTINES ARE CODED.                                                     
*                                                                               
*   *** SOME DOCUMENTATION                                                      
*                                                                               
*        ON ENTRY:                                                              
*             R0 - VARIABLE COUNT                                               
*             R1 - ARGUMENT LIST                                                
*             R6 - FUNCTION/VARIABLE RETURN AREA                                
*                  (AREA WILL INITIALLY CONTAIN VAR/FUNC/PROC NAME)             
*                                                                               
*                                                                               
*        ON EXIT:                                                               
*             R6 - RETURNED VALUE (SAME AS ON ENTRY)                            
*            R15 - CC=ZERO, ALL OK                                              
*                  CC=NZ, IF ERROR,,, ERROR MSG TSEG 'D                         
*                                                                               
*        ARG1     EQU   0*L'VPARM           USUALLY @R1                         
*        ARG2     EQU   1*L'VPARM                                               
*        ARG3     EQU   2*L'VPARM                                               
*        ARG4     EQU   3*L'VPARM                                               
*        ARG5     EQU   4*L'VPARM                                               
*        ARG6     EQU   5*L'VPARM                                               
*                                                                               
*        FNRET    EQU   0*L'VPARM           USUALLY @R6                         
*                                                                               
*                                                                               
*        FNWA     RECORD BEGIN ,            GENERALIZED WORK AREA !             
*        FNWORK   DS    XL(L'VPARM)         256+ BYTE WORK AREA                 
*                 END                                                           
*        ******************** OH YEAH !!                                        
         EJECT                                                                  
WYLSYSV  CSECT                                                                  
         REGS  FSR,,,,,,,BR,(WAR,LSR),PAR,PBR,CPR,CVR,SPR,RAR                   
*                                                                               
SYSV     IDENT 4072                10:30:09 03/12/04  (SLP)                     
*                                                                               
         SYSDEFN ,                 Define installation values                   
*                                                                               
         PUSH  DSECTS                                                           
         TITLE 'DSECTS'                                                         
         COPY  CONTROL             Copy CV/CP                                   
         TITLE 'DSECTS'                                                         
         AIF   (&$PCODE).NOCVT                                                  
         CVT   DSECT=YES                                                        
*                                                                               
USERCVT  RECORD 'USERCVT'                                                       
.NOCVT   ANOP                                                                   
*                                                                               
JCB      RECORD BEGIN                                                           
         COPY  JCB                                                              
         END                                                                    
*                                                                               
KWR      RECORD BEGIN                                                           
         KWR                                                                    
         END                                                                    
*                                                                               
SIN      RECORD BEGIN                                                           
         COPY  SIN                                                              
         END                                                                    
*                                                                               
         COPY  FFINFO                                                           
*                                                                               
         POP   DSECTS                                                           
WYLSYSV  CSECT                                                                  
         EJECT                                                                  
         COPY  BSINFO                                                           
         EJECT                                                                  
         COPY  VNENTRY                                                          
         COPY  VPARM                                                            
         EJECT                                                                  
         COPY  XSENTRY                                                          
         TITLE 'Local Macros'                                                   
*                                                                               
*                                                                               
*   SYSTEM ROUTINE TABLE ENTRY MACRO                                            
*                                                                               
*                                                                               
RTNENTRY RECORD BEGIN                                                           
RTNNAME  DS    CL16                                                             
RTNPTR   DEFRTNP                                                                
         END                                                                    
*                                                                               
*C-DATA  struct sysrtn {                                                        
*C-DATA    unsigned char name[16];                                              
*C-DATA    void (* routine)();                                                  
*C-DATA  };                                                                     
*                                                                               
*                                                                               
         DS    0S(16-L'VNNAME)     VNNAME MUST BE 16 OR FIXED ABOVE             
         DS    0S(L'VNNAME-16)       AND FIXED IN SYSRTN MACRO                  
         DS    0S(16-L'RTNNAME)    RTNNAME MUST BE 16 OR FIXED ABOVE            
         DS    0S(L'RTNNAME-16)      AND FIXED IN SYSRTN MACRO                  
*                                                                               
         MACRO                                                                  
&L       SYSVAR    &NAME,&ROUTINE                                               
&L       SYSRTN    &NAME,&ROUTINE                                               
         MEND                                                                   
*                                                                               
         MACRO                                                                  
&L       LA$TABLE &RX,&LOC                                                      
         GBLB  &$PCODE                                                          
         AIF   (&$PCODE).CGENLA                                                 
         L     &RX,=A(&LOC)                                                     
         MEXIT                                                                  
.CGENLA  ANOP                                                                   
         MNOTE *,'C-CODE &RX = (long int)((char *)( && &LOC));'                 
         MEND                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
*                                                                               
*   LOCAL MACROS                                                                
*                                                                               
*        SETARGS - SET ARG TYPES                                                
*        RETARGS - RETURN PROCEDURE ARGS                                        
*        VRETURN - RETURN VARIABLE VALUE, TYPE                                  
*        BADARG - CREATE BAD ARGUMENT MESSAGE                                   
*                                                                               
*.... ..   -... ..- -..                                                         
         SPACE 2                                                                
*                                                                               
*                               SET ARGUMENT TYPES                              
         MACRO                                                                  
&L       SETARGS  &LIST                                                         
&L       LA    R2,=C&LIST          LIST OF ARGUMENT TYPES TO SET                
         ACALL SETARGS             R1 - ARG LIST, R0 - ARG COUNT                
         MEND                                                                   
         SPACE 2                                                                
*                                                                               
*                             RETURN VARIABLE @R6                               
         MACRO                                                                  
&L       VRETURN &TYPE,&VALUE,&LEN                                              
&L       DS    0H                                                               
         AIF   ('&TYPE' EQ 'STRING').TYPESTR                                    
         AIF   ('&TYPE' EQ 'INTEGER').TYPEINT                                   
         AIF   ('&TYPE' EQ 'LINENO').TYPELNO                                    
         AIF   ('&TYPE' EQ 'BOOLEAN').TYPEBOOL                                  
         MNOTE 8,'INVALID TYPE SPECIFIED'                                       
.*                                                                              
.*                                 RETURN STRING VALUE                          
.TYPESTR ANOP                                                                   
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                 CLEAR ENTRY                              
         SET   VNSTRING                SET STRING TYPE                          
         SETMSG &VALUE,&LEN                                                     
         STH   R0,VNSTRLEN             SAVE STRING LEN                          
         LTR   R3,R0                   SAVE STRING VALUE                        
         IF    POS,BEGIN                                                        
         DEX   R3,' MVC VNSTRLOC(0),@R1 '                                       
         END                                                                    
         SR    R15,R15                                                          
         END   , WITH (VNENTRY,R6)                                              
         MEXIT                                                                  
.*                                 RETURN INTEGER VALUE                         
.TYPEINT ANOP                                                                   
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                 CLEAR ENTRY                              
         SET   VNNUMB                  SET NUMBER TYPE                          
         $L    R1,&VALUE,OP=LA         SET VALUE                                
         ST    R1,VNVALUE                                                       
         LA    R2,VNENTRY                                                       
         VCALL MAKEITOD                ALL #'S RETURNED AS PKD DEC              
         END   , WITH (VNENTRY,R6)                                              
         MEXIT                                                                  
.*                                 RETURN LINE NUMBER VALUE                     
.TYPELNO ANOP                                                                   
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                 CLEAR ENTRY                              
         SET   VNNUMB                  SET NUMBER TYPE                          
         $L    R1,&VALUE,OP=LA         SET VALUE                                
         ST    R1,VNVALUE                                                       
         LA    R2,VNENTRY                                                       
         VCALL MAKELTOD                ALL #'S RETURNED AS PKD DEC              
         END   , WITH (VNENTRY,R6)                                              
         MEXIT                                                                  
.*                                 RETURN BOOLEAN                               
.TYPEBOOL ANOP                                                                  
         AIF   ('&VALUE' EQ 'TRUE').TRUEVAL                                     
         AIF   ('&VALUE' EQ 'FALSE').FALSEVAL                                   
         MNOTE 8,'INVALID BOOLEAN VALUE'                                        
.TRUEVAL ANOP                                                                   
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                 CLEAR ENTRY                              
         SET   VNBOOL                  SET BOOLEAN TYPE                         
         MVC   VNVALUE(12),=X'00000000000001000000000C'   TRUE                  
         SR    R15,R15                                                          
         END   , WITH (VNENTRY,R6)                                              
         MEXIT                                                                  
.FALSEVAL ANOP                                                                  
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                 CLEAR ENTRY                              
         SET   VNBOOL                  SET BOOLEAN TYPE                         
         MVC   VNVALUE(12),=X'00000000000000000000000C'   FALSE                 
         SR    R15,R15                                                          
         END   , WITH (VNENTRY,R6)                                              
         MEXIT                                                                  
.*                                 DECIMAL/ARRAY RETURNS MUST                   
.*                                 BE CODED BY HAND !!!!                        
         MEND                                                                   
         SPACE 2                                                                
*                                                                               
*                               TRIM BLANKS FROM END OF STRING                  
         MACRO                                                                  
&L       VTRIM                                                                  
&L       ACALL VTRIM               TRIM BLANKS, R6 - VAR ENTRY                  
         MEND                                                                   
         SPACE 2                                                                
*                                                                               
*                               BAD ARGUMENT                                    
         MACRO                                                                  
&L       BADARG &ARGNO                                                          
&L       $L    R2,&ARGNO,OP=LA     NUMBER OF BAD ARGUMENT                       
         ACALL BADARG                                                           
         MEND                                                                   
         TITLE 'Binary Search Info for Procedure List'                          
*                                                                               
**                                                                              
**  BINARY SEARCH INFO FOR TABLE OF SYSTEM FUNCTIONS                            
**                                                                              
**  INITIALIZED BY INITFNS ROUTINE IN THIS MODULE.                              
*$  SHOULD GETMAIN THIS AREA TO MAKE REENTRANT !                                
**                                                                              
*                                                                               
         TITLE 'Initialize System Variables'                                    
*box                                                                            
*                                                                               
*                                                                               
*  INITSYSV - SYSV MODULE INITIALIZATION                                        
*                                                                               
*  SET UP BINARY SEARCH INFO FOR SYSTEM VARIABLES/FUNCTIONS.                    
*                                                                               
*                                                                               
*                                                                               
INITSYSV XPROC ,                                                                
*                                                                               
         COMMENT                   GET MEMORY FOR VAR BSEARCH INFO              
         LA    R0,L'BSINFO                                                      
         VCALL GETCORE                                                          
         ST    R1,CVVBINFO                                                      
*                                                                               
         COMMENT                   VARS BSEARCH INFO                            
         L     R0,CVVBINFO         R0 - BSEARCH INFO                            
         LA$TABLE R1,SYSVEND       R1 - TOTAL POSSIBLE TABLE LEN                
         LA$TABLE R2,SYSVARS                                                    
         SR    R1,R2                                                            
         LA    R2,L'RTNENTRY       R2 - ENTRY LENGTH                            
         LA    R3,L'RTNNAME        R3 - SEARCH LENGTH (NAME LEN)                
         LR    R4,R1               R4 - END OF LAST ENTRY = TAB LEN             
         VCALL BSINIT                                                           
*                                                                               
         PEND                                                                   
         EJECT                                                                  
*                                                                               
*                                                                               
*  GTVARRTN - GET SYSTEM VARIABLE ROUTINE ADDRESS                               
*                                                                               
*  ON ENTRY:                                                                    
*    @R0 - PLACE TO RETURN ROUTINE ADDRESS                                      
*    @R1 - VARIABLE NAME, LEFT JUSTIFIED BLANK PADDED                           
*                                                                               
*  ON EXIT:                                                                     
*    R15=Z, ROUTINE FOUND;  R15=NZ, ROUTINE NOT FOUND                           
*    R1 - POINTS TO FULL NAME OF VARIABLE (NOT SAME AS ENTRY VALUE)             
*                                                                               
*                                                                               
*  NOTE:                                                                        
*  IF ROUTINE POINTER IS ZERO, ROUTINE IS NOT DEFINED. THIS IS                  
*  SO THAT WE CAN CONTROL WHICH ABBREVAIATIONS FIND MATCHES.                    
*                                                                               
*                                                                               
GTVARRTN XPROC ,                                                                
*                                                                               
         LR    R4,R0                                                            
         LR    R5,R1                                                            
*                                                                               
         COMMENT                   SEARCH FOR SYSTEM ROUTINE                    
         L     R0,CVVBINFO                                                      
         LA$TABLE R1,SYSVARS                                                    
         LR    R2,R5 IE. NAME                                                   
         VCALL ABSEARCH                                                         
*                                                                               
         COMMENT                   IF FOUND RETURN VALUES                       
         IF    (R15,Z),BEGIN                                                    
         LR    R6,R1                                                            
         USING RTNENTRY,R6                                                      
         IF    (RTNPTR,NZ),BEGIN                                                
         MVC   @R4(L'RTNPTR),RTNPTR                                             
         LA    R1,RTNNAME                                                       
         DROP  R6                                                               
         END                                                                    
         ELSE  BEGIN               IF NO RTNPTR, RETURN R15=NZ                  
         LA    R15,4                                                            
         END                                                                    
         END                                                                    
*                                                                               
         PRETURN (R1)                                                           
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  VTRIM - TRIM TRAILING BLANKS FROM A VAR ENTRY                                
*                                                                               
*  ON ENTRY - R6 VARIABLE ENTRY                                                 
*                                                                               
*  ROUTINE CALLED VIA VTRIM MACRO, TO TRIM SYSTEM VARIABLES                     
*  THAT ARE LEFT JUSTIFIED AND PADDED WITH BLANKS, OR ALL                       
*  ZEROS.                                                                       
*                                                                               
*                                                                               
VTRIM    PROC  ,                                                                
         VCALL VTRIM               IN FUNC MODULE                               
         PEND  ,                                                                
*                                                                               
         QLTORG                                                                 
         TITLE 'Table of System Variables'                                      
         DS    0D                                                               
*box                                                                            
*                                                                               
*                                                                               
*  SORTED TABLE OF SYSTEM VARIABLES                                             
*                                                                               
*  FOR TABLE ENTRIES USE THE FOLLOWING MACRO:                                   
*       SYSVAR  <VARIABLE NAME>,<ROUTINE>                                       
*                                                                               
*                                                                               
*       **** CAUTION !!! ****                                                   
*  ENTRIES MUST BE SORTED ALPHABETICALLY BY NAME !!                             
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         COMMENT                   SYSTEM VARIABLES                             
SYSVARS  SYSVAR  ACCOUNT,FNACC         ALPHABETIZE !                            
         SYSVAR  ACCT,FNACC            ALPHABETIZE !                            
         SYSVAR  ACTBYTES,FNACTBYT                                              
         SYSVAR  ACTNAME,FNACTNAM                                               
         SYSVAR  ACTNO,FNACTNO                                                  
         SYSVAR  ACTTYPE,FNACTTYP                                               
         SYSVAR  ATTN,FNATTN                                                    
         SYSVAR  ATTNID,FNATTNID       ALPHABETIZE !                            
         SYSVAR  ATTNINFO,FNATTNIN                                              
         SYSVAR  AUTHID,FNAUTHID                                                
         SYSVAR  AUTHID_NAME,FNAUTHNM                                           
         SYSVAR  AUTHID_REALM,FNAUTHRL                                          
         SYSVAR  BACK,FNBACK                                                    
         SYSVAR  CASE,FNCASE           ALPHABETIZE !                            
         SYSVAR  CHANGES,FNCHNGS                                                
         SYSVAR  COUNT,FNCOUNT         ALPHABETIZE !                            
         SYSVAR  CP,FNCP                                                        
         SYSVAR  CPROMPT,FNCPRMT                                                
         SYSVAR  CURRENT,FNCURRNT                                               
         SYSVAR  CV,FNCV                                                        
         SYSVAR  DATE,FNDATE                                                    
         SYSVAR  DATEF,FNDATEF                                                  
         SYSVAR  DAY,FNDAY                                                      
         SYSVAR  DELTA,FNDELTA                                                  
         SYSVAR  DESTINATION,FNDEST    ALPHABETIZE !                            
         SYSVAR  E,FNE                                                          
         SYSVAR  EMODE,FNEMODE                                                  
         SYSVAR  END,FNEND                                                      
         SYSVAR  ERR,FNERR             ALPHABETIZE !                            
         SYSVAR  ERRID,FNERRID                                                  
         SYSVAR  ERRINFO,FNERRINF                                               
         SYSVAR  ERRMSG,FNERRMSG                                                
         SYSVAR  ERROR,FNERR                                                    
         SYSVAR  ESCAPE,FNESCAPE                                                
         SYSVAR  EVAL_LNO,FNEVALL                                               
         SYSVAR  EVAL_TEXT,FNEVALT                                              
         SYSVAR  F,FNFIRST                                                      
         SYSVAR  FALSE,FNFALSE         ALPHABETIZE !                            
         SYSVAR  FBLOCK,FNFBLOCK                                                
         SYSVAR  FDEFAULT,FNFDEF                                                
         SYSVAR  FE_HOSTNAME,FNFEHOST                                           
         SYSVAR  FE_IPADDR,FNIPADR                                              
         SYSVAR  FE_ISLOCAL,FNISLOC                                             
         SYSVAR  FE_ISNET,FNISNET                                               
         SYSVAR  FE_NETADDR,FNNETADR                                            
         SYSVAR  FE_NETNAME,FNNETNAM                                            
         SYSVAR  FENAME,FNFENAME                                                
         SYSVAR  FEPORT,FNFEPORT                                                
         SYSVAR  FETYPE,FNFETYPE                                                
         SYSVAR  FIRST,FNFIRST                                                  
         SYSVAR  FPATH,FNFPATH                                                  
         SYSVAR  GROUP,FNGROUP         ALPHABETIZE !                            
         SYSVAR  GRP,FNGROUP           ALPHABETIZE !                            
         SYSVAR  HEIGHT,FNHEIGHT                                                
         SYSVAR  HOST,FNHOST                                                    
         SYSVAR  INSERT,NULL           RESERVE FOR INSERT() FUNCTION            
         SYSVAR  INSTALLATION,FNINSTAL                                          
         SYSVAR  IORESULT,FNIORES                                               
         SYSVAR  JES,FNJES             ALPHABETIZE !                            
         SYSVAR  JOBNAME,FNJOB                                                  
         SYSVAR  L,FNLAST                                                       
         SYSVAR  LAST,FNLAST                                                    
         SYSVAR  LBLOCK,FNLBLOCK                                                
         SYSVAR  LENGTH,FNLENGTH                                                
         SYSVAR  LIBRARY,FNLIB                                                  
         SYSVAR  LINE,NULL             RESERVE FOR LINE() FUNCTION              
         SYSVAR  LINES,FNLINES         ALPHABETIZE !                            
         SYSVAR  LNAME,FNLNAME                                                  
         SYSVAR  LOCALHOS,FNINV    (Not abbreviatable)                          
         SYSVAR  LOCALHOST,FNLHOST                                              
         SYSVAR  MACHINE,FNMACH                                                 
         SYSVAR  MACHINE_ACCESS,FNMACC                                          
         SYSVAR  MACHINE_PRIMARY,FNMPRIM                                        
         SYSVAR  MEMBER,FNMEMBER       ALPHABETIZE !                            
         SYSVAR  MILTEN,FNMILTEN                                                
         SYSVAR  NAME,FNNAME                                                    
         SYSVAR  NEWMAIL,FNNMAIL                                                
         SYSVAR  NEWNEWS,FNNNEWS                                                
         SYSVAR  NEXT,FNNEXT                                                    
         SYSVAR  ORIGSYS,FNORGSYS                                               
         SYSVAR  ORVYL,FNORVYL                                                  
         SYSVAR  ORVYL_CMDS_OK,FNORVCOK                                         
         SYSVAR  ORVYL_CPU,FNORVCPU                                             
         SYSVAR  ORVYL_IO,FNORVIO                                               
         SYSVAR  ORVYL_UP,FNORVUP                                               
         SYSVAR  PACCOUNT,FNPACC                                                
         SYSVAR  PACCT,FNPACC                                                   
         SYSVAR  PARM,FNPARM                                                    
         SYSVAR  PGM,FNPROG                                                     
         SYSVAR  PI,FNPI               ALPHABETIZE !                            
         SYSVAR  PRE,FNPREV                                                     
         SYSVAR  PREFIX,FNPREFIX                                                
         SYSVAR  PREVIOUS,FNPREV                                                
         SYSVAR  PRIV_ACCT,FNPRVACT                                             
         SYSVAR  PRIV_ADM,FNPRVADM                                              
         SYSVAR  PRIV_OPR,FNPRVOPR                                              
         SYSVAR  PRIV_SYS,FNPRVSYS                                              
         SYSVAR  PROGRAM,FNPROG                                                 
         SYSVAR  PROJECT,FNPROJ        ALPHABETIZE !                            
         SYSVAR  PVOLUME,FNPVOL                                                 
         SYSVAR  QNAME,FNQNAME                                                  
         SYSVAR  QNO,FNQNO                                                      
         SYSVAR  QUERY,NULL            RESERVE FOR QUERY() FUNCTION             
         SYSVAR  QUERY_ERRINFO,FNQERR                                           
         SYSVAR  RANDOM,FNRANDOM                                                
         SYSVAR  RC_UPLOAD,FNRCUPL                                              
         SYSVAR  RETURN,FNRETURN                                                
         SYSVAR  SAM_DIALOG,FNSAMDIA                                            
         SYSVAR  SAM_FONT,FNSAMFNT                                              
         SYSVAR  SAM_OS,FNSAMOS                                                 
         SYSVAR  SAM_TYPE,FNSAMTYP                                              
         SYSVAR  SAM_VERSION,FNSAMVER  ALPHABETIZE !                            
         SYSVAR  SAMSON,FNSAMSON                                                
         SYSVAR  SES_NUMBER,FNSESNUM   TEMP, SESNO IS GOING BYE BYE             
         SYSVAR  SES_TAG,FNSESTAG                                               
         SYSVAR  SKIP,FNSKIP                                                    
         SYSVAR  SOF,FNSOF                                                      
         SYSVAR  SUB,NULL              RESERVED FOR SUBSTR() FUNCTION           
         SYSVAR  SUBGROUP,FNSUBGRO                                              
         SYSVAR  SYSTEM,FNSYSTEM                                                
         SYSVAR  TCHARS,FNTCHARS                                                
         SYSVAR  TCLASS,FNTCLASS                                                
         SYSVAR  TERMINAL,FNTERM                                                
         SYSVAR  THEIGHT,FNTHEIGHT                                              
         SYSVAR  TIME,FNTIME                                                    
         SYSVAR  TIMEBIN,FNTIMEB                                                
         SYSVAR  TIMEBLOCK,FNTMBLK                                              
         SYSVAR  TMODEL,FNTMODEL                                                
         SYSVAR  TQUIET,FNTQUIET                                                
         SYSVAR  TRUE,FNTRUE           ALPHABETIZE !                            
         SYSVAR  TRYATTN,FNTYATTN                                               
         SYSVAR  TRYERROR,FNTYERR                                               
         SYSVAR  TRYID,FNTYID                                                   
         SYSVAR  TRYINFO,FNTYINFO                                               
         SYSVAR  TRYMSG,FNTYMSG                                                 
         SYSVAR  TTYPE,FNTTYPE                                                  
         SYSVAR  TWIDTH,FNTWIDTH                                                
         SYSVAR  USER,FNUSER           ALPHABETIZE !                            
         SYSVAR  USERID,FNUID                                                   
         SYSVAR  USERID_LIST,FNUIDL                                             
         SYSVAR  USR,FNUSER            ALPHABETIZE !                            
         SYSVAR  VIEW_COLUMN,FNVCOL                                             
         SYSVAR  VIEW_HEIGHT,FNVHEI                                             
         SYSVAR  VIEW_LINENO,FNVLNO                                             
         SYSVAR  VIEW_NWIND,FNVNWIND                                            
         SYSVAR  VIEW_WIDTH,FNVWID                                              
         SYSVAR  VIEW_WINDOW,FNVWIND                                            
         SYSVAR  VJOBNAME,FNVJOB                                                
         SYSVAR  VJOBNO,FNVJOBNO                                                
         SYSVAR  VLOGON,FNVLOGON                                                
         SYSVAR  VOLUME,FNVOLUME                                                
         SYSVAR  VSESSION,FNVSESS                                               
         SYSVAR  WARN,FNWARN                                                    
         SYSVAR  WCHARGE,FNWCHG                                                 
         SYSVAR  WFDEFAULT,FNWFDEF                                              
         SYSVAR  WIDTH,FNWIDTH                                                  
         SYSVAR  WPROJECT,FNWPROJ                                               
         SYSVAR  WYLBUR,FNWYLBUR                                                
         SYSVAR  WYLBUR_CPU,FNWYLCPU   ALPHABETIZE !                            
         SYSVAR  WYLBUR_IO,FNWYLIO                                              
         SYSVAR  XACCOUNT,FNXACC                                                
         SYSVAR  XACCT,FNXACC                                                   
         SYSVAR  XAUTH,FNXAUTH                                                  
         SYSVAR  XCOMMAND,FNXCMD                                                
         SYSVAR  XDATE,FNXDATE         ALPHABETIZE !                            
         SYSVAR  XDATEF,FNXDATEF                                                
         SYSVAR  XDUMP,FNXDUMP                                                  
         SYSVAR  XLINE,FNXLINE                                                  
         SYSVAR  XQUIET,FNXQUIET       ALPHABETIZE !                            
SYSVEND  SYSVAR  ZZZDUMMY,NULL     END OF SYSTEM TABLE                          
*                                  END OF SYSTEM TABLE                          
         EJECT                                                                  
         QLTORG                                                                 
         TITLE 'System Routines for Variables'                                  
*box                                                                            
*                                                                               
*                                                                               
*  SYSTEM FUNCTION, PROCEDURE, AND VARIABLE ROUTINES                            
*                                                                               
*  ****NOTE !!                                                                  
*  SEE COMMENTS AT START OF THIS MODULE.                                        
*                                                                               
*                                                                               
*  ON ENTRY:                                                                    
*       R0 - VARIABLE COUNT                                                     
*       R1 - ARGUMENT LIST                                                      
*       R6 - FUNCTION/VARIABLE RETURN AREA                                      
*            (AREA WILL INITIALLY CONTAIN FUNCTION/PROC/VAR NAME)               
*                                                                               
*                                                                               
*  ON EXIT:                                                                     
*       R6 - RETURNED VALUE (SAME AS ON ENTRY)                                  
*      R15 - CC=ZERO, ALL OK                                                    
*            CC=NZ, IF ERROR,,, ERROR MSG TSEG 'D                               
*                                                                               
*                                                                               
*                                                                               
ARG1     EQU   0*L'VPARM           USUALLY @R1                                  
ARG2     EQU   1*L'VPARM                                                        
ARG3     EQU   2*L'VPARM                                                        
ARG4     EQU   3*L'VPARM                                                        
ARG5     EQU   4*L'VPARM                                                        
ARG6     EQU   5*L'VPARM                                                        
ARG7     EQU   6*L'VPARM                                                        
ARG8     EQU   7*L'VPARM                                                        
*                                                                               
FNRET    EQU   0*L'VPARM           USUALLY @R6                                  
*                                                                               
*                                                                               
FNWA     RECORD BEGIN ,            GENERALIZED WORK AREA !                      
FNWORK   DS    XL(L'VPARM)         256+ BYTE WORK AREA                          
         END                                                                    
*                                                                               
*                                                                               
**************** ROUTINES FOLLOW BELOW !!                                       
*box                                                                            
*                                                                               
*  FNINV -- Generic error message.                                              
*                                                                               
FNINV    PROC                                                                   
         TSEG  'Invalid variable of function name.',,CR                         
*                                                                               
         LA    R15,4               Error                                        
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ACCOUNT                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNACC    PROC  ,                                                                
         WITH  (VNENTRY,R6)                                                     
         CLEAR VNENTRY                                                          
         SET   VNSTRING                                                         
         CLEAR VNSTRLEN            Assume no account                            
*                                                                               
         IF    (CPSACCT,NZ),BEGIN  Return account...                            
         MVC   VNSTRLEN,=H'6'                                                   
         MVC   VNSTRLOC(3),CPSUSER                                              
         MVI   VNSTRLOC+3,C'$'                                                  
         MVC   VNSTRLOC+4(2),CPSGRP                                             
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ACTBYTES                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNACTBYT PROC  ,                                                                
         VRETURN INTEGER,L:CPABYCT                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ACTNAME                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNACTNAM PROC  ,                                                                
         VRETURN STRING,CPANAME                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ACTNO                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNACTNO  PROC  ,                                                                
         VRETURN INTEGER,L:CPACTNO                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ACTTYPE                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNACTTYP PROC  ,                                                                
         VRETURN STRING,CPATYPE                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ATTN                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNATTN   PROC  ,                                                                
         IF    CPFXXATN,BEGIN                                                   
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ATTNID                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNATTNID PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ATTN, RETURN ATTNID                       
         IF    CPFXXATN,BEGIN                                                   
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.ATTNID       '                                      
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         BOMB                                                                   
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ATTN, RETURN "NOATTN  "                
         ELSE  BEGIN                                                            
         LA    R0,8                                                             
         LA    R1,=CL8'NOATTN  '                                                
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ATTNINFO                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNATTNIN PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ATTENTION, RETURN ATTN INFO               
         IF    CPFXXATN,BEGIN                                                   
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.ATTNINFO    '                                       
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         CLEAR R0                                                               
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ATTENTIONN, RETURN NULL                
         ELSE  BEGIN                                                            
         CLEAR R0                                                               
         CLEAR R1                                                               
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  AUTHID - Authorized identity (currently Kerberos                             
*           principal name)                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNAUTHID PROC  ,                                                                
         VRETURN STRING,CPAUTHID                                                
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  AUTHID_NAME - Kerberos principal name without realm part                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNAUTHNM PROC  ,                                                                
         LA    R1,CPAUTHID                                                      
         CLEAR R0                                                               
         IF (CPAUTHID,NZ),BEGIN                                                 
         LA    R2,L'CPAUTHID                                                    
         LR    R3,R1                                                            
         WHILE ((R2,NZ),AND,(@R3,NE,'@')),BEGIN                                 
         DECR  R2                                                               
         INCR  R0                                                               
         INCR  R3                                                               
         END                                                                    
         END                                                                    
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  AUTHID_REALM - Kerberos realm                                                
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNAUTHRL PROC  ,                                                                
         LA    R1,CPAUTHID                                                      
         CLEAR R0                                                               
         IF (CPAUTHID,NZ),BEGIN                                                 
         LA    R2,L'CPAUTHID                                                    
         LR    R3,R1                                                            
         WHILE ((R2,NZ),AND,(@R3,NE,'@')),BEGIN                                 
         DECR  R2                                                               
         INCR  R3                                                               
         END                                                                    
         IF    (R2,GT,=F'1'),BEGIN Non-null realm                               
         LA    R1,1(,R3)           Point past '@'                               
         LR    R0,R2               Length of realm part                         
         DECR  R0                                                               
         END                                                                    
         END                                                                    
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  BACK                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNBACK   PROC  ,                                                                
         SETMSG 'NOBACK'                                                        
         IF    CPSFBACK,'SETMSG "BACK"'                                         
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  CASE                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCASE   PROC  ,                                                                
         SETMSG 'UPPER'                                                         
         IF    CPSFUPL,'SETMSG "UPLOW"'                                         
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  CHANGES                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCHNGS  PROC  ,                                                                
         VRETURN INTEGER,L:CPACHCT                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  COUNT                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCOUNT  PROC  ,                                                                
         VRETURN INTEGER,L:CPCOUNT                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  CP - CP ADDRESS                                                              
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCP     PROC  ,                                                                
         VRETURN INTEGER,LA:CP                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  CPROMPT -- Current command prompt string.                                    
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCPRMT  PROC  ,                                                                
         VRETURN STRING,CPCPRMT,LH:CPCPLEN                                      
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  CURRENT                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCURRNT PROC  ,                                                                
         VRETURN LINENO,L:CPACLNO                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  CV - CV ADDRESS                                                              
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNCV     PROC  ,                                                                
         VRETURN INTEGER,LA:CV                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  DATE                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNDATE   PROC  ,                                                                
         XPUSH  ,,MAXSTRLN,PTR=R15                                              
         VCALL LOCALTOD                                                         
         VCALL FMTCLCK             IN CR MODULE                                 
         MVC   15(13,R1),17(R1)    Eliminate the century                        
         MVC   19(7,R1),21(R1)      for now                                     
         S     R0,=F'4'                                                         
         VRETURN STRING,(R1),(R0)                                               
         XPOP  ,,MAXSTRLN                                                       
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  DATEF - Date with full year (including century)                              
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
*                                                                               
FNDATEF  PROC  ,                                                                
         XPUSH  ,,MAXSTRLN,PTR=R15                                              
         VCALL LOCALTOD                                                         
         VCALL FMTCLCK             IN CR MODULE                                 
         VRETURN STRING,(R1),(R0)                                               
         XPOP  ,,MAXSTRLN                                                       
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  DAY                                                                          
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNDAY    PROC  ,                                                                
         XPUSH  ,,MAXSTRLN,PTR=R15                                              
         VCALL LOCALTOD                                                         
         VCALL FMTDAY              IN CR MODULE                                 
         VRETURN STRING,(R1),(R0)                                               
         XPOP  ,,MAXSTRLN                                                       
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  DELTA                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNDELTA  PROC  ,                                                                
         VRETURN LINENO,L:CPDELTA                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  DESTINATION                                                                  
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNDEST   PROC  ,                                                                
         VRETURN STRING,CPDEST                                                  
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  E - 2.71828                                                                  
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNE      PROC  ,                                                                
         USING VNENTRY,R6                                                       
         CLEAR VNENTRY                                                          
         SET   VNNUMB                                                           
         MVC   VNVALUE(12),=X'00000000000002718281800C'                         
         SR    R15,R15                                                          
         DROP  R6                                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  EMODE  (Editing mode)                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNEMODE  PROC  ,                                                                
         SETMSG 'LINE'                                                          
         IF    CPVFPAGE,'SETMSG "PAGE"'                                         
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  END                                                                          
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNEND    PROC  ,                                                                
         VCALL ENDLNO              Get END line-number                          
         LR    R1,R0                                                            
         VRETURN LINENO,(R1)                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ERR                                                                          
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNERR    PROC  ,                                                                
         IF    CPFXXERR,BEGIN                                                   
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ERRID                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNERRID  PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ERROR, RETURN ERRID                       
         IF    CPFXXERR,BEGIN                                                   
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.ERRID       '                                       
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         BOMB                                                                   
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ERROR, RETURN OK                       
         ELSE  BEGIN                                                            
         LA    R0,8                                                             
         LA    R1,=CL8'OK      '                                                
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ERRINFO                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNERRINF PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ERROR, RETURN ERROR INFO                  
         IF    CPFXXERR,BEGIN                                                   
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.ERRINFO     '                                       
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         CLEAR R0                                                               
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ERROR, RETURN NULL                     
         ELSE  BEGIN                                                            
         CLEAR R0                                                               
         CLEAR R1                                                               
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ERRMSG                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNERRMSG PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ERROR, RETURN ERROR MSG                   
         IF    CPFXXERR,BEGIN                                                   
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.ERRMSG      '                                       
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         CLEAR R0                                                               
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ERROR, RETURN NULL                     
         ELSE  BEGIN                                                            
         CLEAR R0                                                               
         CLEAR R1                                                               
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  ESCAPE                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNESCAPE PROC  ,                                                                
         VRETURN STRING,CPESCAPE                                                
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  EVAL_LNO -- EVAL Command parameter information.                              
*                                                                               
FNEVALL  PROC  FNWA                                                             
         VRETURN LINENO,L:CPEVLNO                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  EVAL_TEXT -- EVAL Command parameter information.                             
*                                                                               
FNEVALT  PROC  FNWA                                                             
         VRETURN STRING,L:CPEVLOC,L:CPEVLEN                                     
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  FALSE                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNFALSE  PROC  ,                                                                
         VRETURN BOOLEAN,FALSE                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  FBLOCK                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNFBLOCK PROC                                                                   
         L     R1,CPFBKLNO                                                      
         IF    (CPBLKACT,Z),'L R1,=F"-1000"'                                    
         VRETURN LINENO,(R1)                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  FDEFAULT - Not relevant,,, we set to WFDEF value for now.                    
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNFDEF   PROC  ,                                                                
*                                                                               
         COMMENT                   OUTPUT TYPE INFO                             
         SETMSG 'OLDIBM'                                                        
         IF    CVFWINGS,' SETMSG "WINGS" '                                      
         IF    CVFOLDIBM,' SETMSG "OLDIBM" '                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND  ,                                                                
         EJECT                                                                  
*box                                                                            
*                                                                               
*  FE_IPADDR -- Returns the network address of the terminal                     
*    session.                                                                   
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
IPWA     RECORD BEGIN                                                           
IPBUF    DS     CL64                                                            
IPSEG    SEGCB                                                                  
         END                                                                    
*                                                                               
FNIPADR  PROC IPWA                                                              
         SEGINIT IPBUF,L'IPBUF,IPSEG                                            
         IF   CPSTELF,BEGIN                                                     
         SEGDC LC:CPSIPADR           Format IP address "x.x.x.x"...             
         SEG   '.'                                                              
         SEGDC LC:CPSIPADR+1                                                    
         SEG   '.'                                                              
         SEGDC LC:CPSIPADR+2                                                    
         SEG   '.'                                                              
         SEGDC LC:CPSIPADR+3                                                    
         SETMSG L:IPSEGLOC,L:IPSEGLENF                                          
         VRETURN STRING,(R1),(R0)                                               
         END                                                                    
         ELSE BEGIN                                                             
         CLEAR R0                                                               
         CLEAR R1                                                               
         VRETURN STRING,(R1),(R0)                                               
         END                                                                    
         PEND                                                                   
*box                                                                            
*                                                                               
*  FE_ISLOCAL -- Returns TRUE if this is a "local connection".                  
*    The following is highly Stanford dependent.  We added it so                
*    that applications can tell the difference between local                    
*    Stanford sessions (those on net 36) and remote network                     
*    sessions.  It's probably a lost cause in the long run.                     
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNISLOC  PROC                                                                   
         VRETURN BOOLEAN,TRUE      Always return TRUE for now                   
         PEND                                                                   
*box                                                                            
*                                                                               
*  FE_ISNET -- Returns TRUE if this is a "network" connection.                  
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNISNET  PROC                                                                   
         IF    CPSTELF,'VRETURN BOOLEAN,TRUE'  True if ELF                      
         ELSE  'VRETURN BOOLEAN,FALSE'  Otherwise, FALSE                        
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  FE_NETADDR -- Returns the network address of the terminal                    
*    session.                                                                   
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNNETADR PROC                                                                   
         VRETURN STRING,CPSPLOC                                                 
         VTRIM                                                                  
         PEND                                                                   
*box                                                                            
*                                                                               
*  FE_NETNAME -- Returns the name of the workstation connecting                 
*    to us.                                                                     
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNNETNAM PROC                                                                   
         CLEAR R0                  Assume not-available                         
         IF    CPSTELF,BEGIN       ELF connection...                            
         SETMSG CPSPLOC             Name is in port information                 
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  FE_HOSTNAME -- Returns the fully-qulaified name of the                       
*  workstation connecting to us.                                                
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNFEHOST PROC                                                                   
         CLEAR R0                  Assume not-available                         
         IF    CPSTELF,BEGIN       ELF connection...                            
         SETMSG CPSPLOC             Name is in port information                 
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  FENAME -- Front end name.                                                    
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNFENAME PROC                                                                   
         VRETURN STRING,CPSFE      Front-end name                               
         VTRIM                                                                  
         PEND                                                                   
*box                                                                            
*                                                                               
*  FEPORT -- Front end port name.                                               
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNFEPORT PROC                                                                   
         VRETURN STRING,CPSPORT    Front-end port name                          
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  FETYPE - FRONT END TYPE                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNFETYPE PROC  ,                                                                
         SETMSG '???'                                                           
         IF    CPSTCONS,'SETMSG "CONSOLE"'                                      
         IF    CPSTASYN,'SETMSG "ASYNC"'                                        
         IF    CPSTPDP,'SETMSG "PDP"'                                           
         IF    CPSTVTAM,'SETMSG "VTAM"'                                         
         IF    CPSTVIRT,'SETMSG "VIRTUAL"'                                      
         IF    CPSTNSC,'SETMSG "NSC"'                                           
         IF    CPSTELF,BEGIN                                                    
         SETMSG 'ELF'                                                           
         IF    CPSFDUMB,'SETMSG "TELNET"'                                       
         END                                                                    
         IF    CPSTALF,'SETMSG "ALF"'                                           
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  FIRST                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNFIRST  PROC  ,                                                                
         VRETURN LINENO,L:CPAFLNO  FIRST line-number                            
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  FPATH - WINGS PATH NAME.   (FROM 'SET FPATH')                                
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNFPATH  PROC  ,                                                                
         IF    (CPWPATH,NE,0),BEGIN                                             
         VRETURN STRING,CPWPATH                                                 
         END                                                                    
         ELSEIF  (CVWPATH,NE,0),BEGIN                                           
         VRETURN STRING,CVWPATH                                                 
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN STRING,'WINGSV00'                                              
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  GROUP                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNGROUP  PROC  ,                                                                
         VRETURN STRING,CPGRPSV                                                 
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  HEIGHT - "Page-page" height                                                  
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNHEIGHT PROC  ,                                                                
         VRETURN INTEGER,LH:CPSHEIP                                             
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  HOST -- Network host name variable.                                          
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNHOST   PROC                                                                   
         SETMSG CPHOST              Current host name                           
         IF    (CPHOST,Z),'CLEAR R0'  No current host                           
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  INSTALLATION                                                                 
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNINSTAL PROC  ,                                                                
         VRETURN STRING,CVINSTAL                                                
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  IORESULT -- String containing the return code from the last                  
*    terminal input/output function.                                            
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNIORES  PROC  FNWA                                                             
         SETMSG FNWORK                                                          
         LA    R2,=CL16'SYS.IORESULT'                                           
         VCALL GETDATA             Get variable value                           
         IF    NZ,'SETMSG "OK"'       (Not yet defined--same as OK)             
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  JES                                                                          
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNJES    PROC  ,                                                                
         VRETURN STRING,CVJES                                                   
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  JOBNAME                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNJOB    PROC  ,                                                                
         VRETURN STRING,CPJOBNM                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  LAST                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNLAST   PROC  ,                                                                
         VRETURN LINENO,L:CPALLNO  LAST line-number                             
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  LBLOCK                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNLBLOCK PROC  ,                                                                
         L     R1,CPLBKLNO                                                      
         IF    (CPBLKACT,Z),'L R1,=F"-1000"'                                    
         VRETURN LINENO,(R1)                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  LENGTH                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNLENGTH PROC  ,                                                                
         VRETURN INTEGER,LH:CPLENGTH                                            
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  LIB                                                                          
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNLIB    PROC  ,                                                                
         VRETURN STRING,CPLIB                                                   
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  LINES - ACTIVE FILE LINE COUNT                                               
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNLINES  PROC  ,                                                                
         VRETURN INTEGER,L:CPALNCT  Number of lines                             
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  LNAME - LINE NAME                                                            
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNLNAME  PROC  ,                                                                
         VRETURN STRING,CPSNAME                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  LOCALHOST -- Our local host name.                                            
*                                                                               
*  See commments at the start of this module.                                   
*                                                                               
FNLHOST  PROC                                                                   
         SETMSG 'Unknown.Local.Host'  (Universal default)                       
*                                                                               
         IF    (CVMACHID,EQ,'RLG '),'SETMSG "RLG.ORG"'                          
         ELSEIF (CVMACHID,EQ,'SYSC'),'SETMSG "SUH.Stanford.EDU"'                
         ELSEIF (CVMACHID,EQ,'SYSD'),'SETMSG "SYSD.Stanford.EDU"'               
         ELSEIF (CVMACHID,EQ,'SYSG'),'SETMSG "SYSG.RLG.ORG"'                    
         ELSEIF (CVMACHID,EQ,'SYSH'),'SETMSG "SYSH.Stanford.EDU"'               
         ELSE  'SETMSG "Forsythe.Stanford.EDU"'                                 
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  MACHINE                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNMACH   PROC                                                                   
         VRETURN STRING,CVMACHID                                                
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  MACHINE_ACCESS -- Return the user's machine access list.                     
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNMACC   PROC                                                                   
         VRETURN STRING,(R1),0     Assume no access                             
*                                                                               
         XPUSH ,,L'KWR,PTR=R4                                                   
         WITH  (KWR,R4),BEGIN                                                   
         CLEAR KWR                                                              
         XWTO  'FNMACC entered'    *** slp debug ***                            
         MVC   KWRUSER,CPSUSER     Set logged...                                
         MVC   KWRGRP,CPSGRP       ...on account                                
         KREAD KWR                                                              
         IF    KWRIFL.KWRIFVAL,BEGIN  Valid KWR record...                       
*                                                                               
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                                                          
         SET   VNSTRING                                                         
         LC    R15,KWRMACC         Machine access bits                          
         SETMSG VNSTRLOC,MAXSTRLN   Output string area                          
         ACALL GETMACH             Make string                                  
         STH   R0,VNSTRLEN                                                      
         END                                                                    
         END                                                                    
*                                                                               
         CLEAR KWR                 (Tidy)                                       
         CLEAR R15                 A-ok                                         
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  MACHINE_PRIMARY -- Return the user's primary machine name.                   
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNMPRIM  PROC  ,                                                                
         VRETURN STRING,(R1),0     Assume no primary machine (odd)              
*                                                                               
         XPUSH ,,L'KWR,PTR=R4                                                   
         WITH  (KWR,R4),BEGIN                                                   
         CLEAR KWR                                                              
         XWTO  'FNMACC entered'    *** slp debug ***                            
         MVC   KWRUSER,CPSUSER     Set logged...                                
         MVC   KWRGRP,CPSGRP       ...on account                                
         KREAD KWR                                                              
         IF    KWRIFL.KWRIFVAL,BEGIN  Valid KWR record...                       
*                                                                               
         WITH  (VNENTRY,R6),BEGIN                                               
         CLEAR VNENTRY                                                          
         SET   VNSTRING                                                         
         LC    R15,KWRMPRIM        Primary machine identification               
         SETMSG VNSTRLOC,MAXSTRLN   Output string area                          
         ACALL GETMACH             Make string                                  
         STH   R0,VNSTRLEN                                                      
         END                                                                    
         END                                                                    
*                                                                               
         CLEAR KWR                 (Tidy)                                       
         CLEAR R15                 A-ok                                         
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  GETMACH -- Routine to make a string of machine names                         
*    from the access byte (see MACHINE_ACCESS and MACHINE_PRIMARY               
*    above).                                                                    
*                                                                               
*    On entry:                                                                  
*      R15 - machine access byte                                                
*      R1,R0 - output string loc, len                                           
*                                                                               
MACHWA   RECORD BEGIN                                                           
MACHB    DS    X                   Machine id byte                              
*                                                                               
MACHSG   SEGCB                                                                  
         END                                                                    
*-                                                                              
GETMACH  XPROC  (R2,LSR),MACHWA                                                 
         CLEAR MACHWA                                                           
         STC   R15,MACHB           Save machine access byte                     
*                                                                               
*        XWTO 'GETMACH entered'    *** slp debug ***                            
*        IF   (MACHB.KWRFSYSB),' XWTO "GETMACH SYSB"' *** slp ***               
*        IF   (MACHB.KWRFSYSG),' XWTO "GETMACH SYSG"' *** slp ***               
         CLEAR R2                                                               
         SEGINIT (R1),(R0),MACHSG                                               
         IF   (MACHB.KWRFSYSA),'SEG " ",(R2); SEG "SYSA"; LA R2,1'              
         IF   (MACHB.KWRFSYSB),'SEG " ",(R2); SEG "SYSB"; LA R2,1'              
         IF   (MACHB.KWRFSYSC),'SEG " ",(R2); SEG "SYSC"; LA R2,1'              
         IF   (MACHB.KWRFSYSD),'SEG " ",(R2); SEG "SYSD"; LA R2,1'              
         IF   (MACHB.KWRFSYSE),'SEG " ",(R2); SEG "SYSH"; LA R2,1'              
         IF   (MACHB.KWRFSYSF),'SEG " ",(R2); SEG "SYSF"; LA R2,1'              
         IF   (MACHB.KWRFSYSG),'SEG " ",(R2); SEG "SYSG"; LA R2,1'              
*                                                                               
         SETMSG L:MACHSGLOC,L:MACHSGLENF  Message area                          
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  MEMBER                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNMEMBER PROC                                                                   
*                                                                               
         COMMENT                   EXTRACT MEMBER                               
         SETMSG CPAFNAME,L:CPAFNAMEL                                            
         VCALL RETFMEM                                                          
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  MILTEN -- Returns the jobname of the Milten we are connected to.             
*                                                                               
*    Well, eventually, it should do this -- for now it must conform             
*    to the pathname that MILTEN uses (either MILTEN or TESTMIL).               
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNMILTEN PROC                                                                   
         SETMSG CVMILSSN                                                        
         IF    CVFTMIL,'SETMSG "TESTMIL"'                                       
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  NAME                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNNAME   PROC  ,                                                                
         VRETURN STRING,CPNAME                                                  
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  NEWMAIL                                                                      
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNNMAIL  PROC  ,                                                                
         VRETURN BOOLEAN,FALSE     Assume no new mail waiting                   
*                                                                               
         XPUSH ,,L'KWR,PTR=R4                                                   
         WITH  (KWR,R4),BEGIN                                                   
         CLEAR KWR                                                              
         MVC   KWRUSER,CPSUSER     Set logged...                                
         MVC   KWRGRP,CPSGRP       ...on account                                
         KREAD KWR                                                              
         IF    KWRIFL.KWRIFVAL,BEGIN  Valid KWR record...                       
*                                                                               
         IF    KWRSFL.KWRSFMAI,BEGIN  New mail waiting...                       
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         END                                                                    
*                                                                               
         CLEAR KWR                 (Tidy)                                       
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  NEWNEWS                                                                      
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNNNEWS  PROC  ,                                                                
         VRETURN BOOLEAN,FALSE     Assume no new news waiting                   
*                                                                               
         XPUSH ,,L'KWR,PTR=R4                                                   
         WITH  (KWR,R4),BEGIN                                                   
         CLEAR KWR                                                              
         MVC   KWRUSER,CPSUSER     Set logged...                                
         MVC   KWRGRP,CPSGRP       ...on account                                
         KREAD KWR                                                              
         IF    KWRIFL.KWRIFVAL,BEGIN  Valid KWR record...                       
*                                                                               
         IF    (KWRNEWDT,LT,CVNWDATE),BEGIN  New news waiting...                
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         END                                                                    
*                                                                               
         CLEAR KWR                 (Tidy)                                       
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  NEXT                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNNEXT   PROC  ,                                                                
         LA    R1,1                SET INCREMENT                                
         L     R0,CPACLNO                                                       
         BM    FNNONEXT                                                         
         VCALL ADDER               CALC NEXT POSSIBLE                           
         BM    FNNONEXT                                                         
         ST    R0,CPLCNO                                                        
         LA    R1,CPLCNO                                                        
         VCALL LOCATE              FINE (LOCATE) NEXT                           
         PFREE PBR                 FREE ANY LOCATED PAGE                        
         TM    CPDRPT,CPFNTYT+CPFHIGH                                           
         BNZ   FNNONEXT                                                         
         VRETURN LINENO,L:CPLCNO   NEXT                                         
         B     FNNEXTX                                                          
*                                                                               
FNNONEXT LABEL ,                                                                
         VRETURN LINENO,L:=F'-1000'                                             
         B     FNNEXTX                                                          
*                                                                               
FNNEXTX  LABEL ,                                                                
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  ORIGSYS variable.                                                            
*                                                                               
FNORGSYS PROC                                                                   
         VRETURN STRING,CPORGSYS                                                
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  ORVYL variable.                                                              
*                                                                               
FNORVYL  PROC                                                                   
         VRETURN STRING,CPORVYL                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  ORVYL_CMDS_OK boolean variable.                                              
*                                                                               
FNORVCOK PROC  ,                                                                
         IF    (CPFREDT,OR,(CPORVCMD,Z)),'VRETURN BOOLEAN,TRUE'                 
         ELSE  'VRETURN BOOLEAN,FALSE'                                          
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  ORVYL_UP boolean variable.                                                   
*                                                                               
FNORVUP  PROC  ,                                                                
         SETMSG CPORVYL                                                         
         VCALL SYSCHECK            Is ORVYL up?                                 
         IF    Z,'VRETURN BOOLEAN,TRUE'                                         
         ELSE  'VRETURN BOOLEAN,FALSE'                                          
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  ORVYL_CPU variable.                                                          
*                                                                               
FNORVCPU PROC  ,                                                                
         LA    R15,=CL16'ORVYL_CPU'                                             
         VCALL GETCTOT             Get ORVYL cpu time in .001 sec               
         VRETURN LINENO,(R15)                                                   
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  ORVYL_IO variable.                                                           
*                                                                               
FNORVIO  PROC  ,                                                                
         LA    R15,=CL16'ORVYL_IO'                                              
         VCALL GETCTOT             Get ORVYL disk I/O count                     
         VRETURN INTEGER,(R15)                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  PACCOUNT - Returns Pseudo Account.                                           
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNPACC   PROC  ,                                                                
         WITH  (VNENTRY,R6)                                                     
         CLEAR VNENTRY                                                          
         SET   VNSTRING                                                         
         CLEAR VNSTRLEN            Assume no pseudo account set                 
*                                                                               
         IF    (CPPACCT,NZ),BEGIN  Return pseudo account...                     
         MVC   VNSTRLEN,=H'6'                                                   
         MVC   VNSTRLOC(2),CPPGRP                                               
         MVI   VNSTRLOC+2,C'.'                                                  
         MVC   VNSTRLOC+3(3),CPPUSER                                            
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PARM                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPARM   PROC  FNWA                                                             
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.PARM        '                                       
         VCALL GETDATA             GET PARM FROM SESSION DATA                   
         IF    NZ,BEGIN                                                         
         CLEAR R0                                                               
         END                                                                    
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PI - 3.14159                                                                 
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPI     PROC  ,                                                                
         USING VNENTRY,R6                                                       
         CLEAR VNENTRY                                                          
         SET   VNNUMB                                                           
         MVC   VNVALUE(12),=X'00000000000003141592700C'                         
         SR    R15,R15                                                          
         DROP  R6                                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PREFIX                                                                       
*                                                                               
*  NOTE:                                                                        
*  WE HAVE JUNKED THIS UP,,, IN THE NAME OF BACKWARDS                           
*  COMPATABILITY, WE DO NOT RETURN MEMBER PORTION OF                            
*  PREFIX. WE STRIP IT OFF.                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPREFIX PROC  ,                                                                
*                                                                               
         COMMENT                   EXTRACT MEMBER                               
         SETMSG CPAFNAME,L:CPAFNAMEL                                            
         VCALL RETFNAME                                                         
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PREVIOUS                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPREV   PROC  ,                                                                
         LT    R15,CPACLNO         Current lineno                               
         BM    FNNOPREV                                                         
         ST    R15,CPLCNO                                                       
         VCALL PREVLNO             Get previous lineno                          
         BM    FNNOPREV            None                                         
         L     R0,CPLCNO                                                        
         VRETURN LINENO,(R0)       RETURN PREVIOUS                              
         EXIT                                                                   
*                                                                               
FNNOPREV VRETURN LINENO,L:=F'-1000'                                             
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PRIV_ACCT                                                                    
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPRVACT PROC  ,                                                                
         IF    CPSFAPR,BEGIN                                                    
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PRIV_ADM                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPRVADM PROC  ,                                                                
         IF    CPSFADM,BEGIN                                                    
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PRIV_OPR                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPRVOPR PROC  ,                                                                
         IF    CPSFOPR,BEGIN                                                    
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PRIV_SYS                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPRVSYS PROC  ,                                                                
         IF    CPSFSPR,BEGIN                                                    
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  PROGRAM                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPROG   PROC  ,                                                                
         SETMSG CPSVPGM                                                         
         IF    ((CPSVPGM,Z),OR,(CPSVPGM,EQ,' ')),'CLEAR R0'                     
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  PROJECT                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPROJ   PROC  ,                                                                
         VRETURN STRING,CPSPROJ                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  PVOLUME - VOLUME OF PREFIX DATA SET                                          
*                                                                               
*                                                                               
*  NOTE:                                                                        
*  IN MODERN TIMES THIS MAY BE HOST NAME,,                                      
*  BACKWARDS COMPATABILITY... WE SHOULD                                         
*  REDO PREFIX,MEMBER,VOLUME PART OF IT ALL.                                    
*  BUT HOW ??  MORE AT 11:00.                                                   
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNPVOL   PROC  ,                                                                
         VRETURN STRING,CPAHOST,L:CPAHOSTL                                      
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  QNAME -- String containing the current server name.                          
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNQNAME  PROC  FNWA                                                             
         VCALL GETQINFO            Get current sevrer info                      
         VRETURN STRING,(R1),(R0)  Return current server name                   
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  QNO -- Number containing the current server number.                          
*    (From the most recent QOPEN command.)                                      
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNQNO    PROC                                                                   
         VCALL GETQINFO            Get current server info                      
         LR    R4,R15              Copy server number                           
         VRETURN INTEGER,(R4)      Return current server number                 
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  QUERY_ERRINFO -- String containing any error information from the            
*    last QUERY function executed.                                              
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNQERR   PROC  FNWA                                                             
         SETMSG FNWORK                                                          
         LA    R2,=CL16'SYS.QUERY_ERRINFO'                                      
         VCALL GETDATA             Get variable value                           
         IF    NZ,'CLEAR R0'       Not defined, return null string              
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  RANDOM - RETURN RANDOM VALUE BETWEEN 1.000 AND 0.000                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNRANDOM PROC  ,                                                                
         STCK  CPDOUB                                                           
         CLEAR R0                                                               
         L3    R1,CPDOUB+4         LEAST SIGNIFICAN BITS                        
         SRL   R1,8                (BITS THAT ARE ALWAYS ZERO)                  
         M     R0,=F'2719'         JUMBLE                                       
         D     R0,=F'1000'         REM IS BETWEEN 0.000 AND 1.000               
         VRETURN LINENO,(R0)                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  RC_UPLOAD -- String containing the return code from the last                 
*    UPLOAD command.                                                            
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNRCUPL  PROC  FNWA                                                             
         SETMSG FNWORK                                                          
         LA    R2,=CL16'SYS.RC_UPLOAD'                                          
         VCALL GETDATA             Get variable value                           
         IF    NZ,'CLEAR R0'       Not defined, return null string              
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  RETURN - RETURN VALUE                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNRETURN PROC  ,                                                                
         VRETURN LINENO,L:CPRETURN                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  SAM_DIALOG -- SAM_DIALOG variable.                                           
*                                                                               
FNSAMDIA PROC  ,                                                                
         VRETURN INTEGER,LH:CPSAMDV  Dialog support version                     
         PEND                                                                   
         SPACE 2                                                                
*box                                                                            
*                                                                               
*  SAM_OS -- SAM_OS variable.                                                   
*                                                                               
FNSAMOS  PROC                                                                   
         SETMSG CPSAMOS                                                         
         IF    (CPSAMOS,Z),'CLEAR R0'                                           
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         SPACE 2                                                                
*box                                                                            
*                                                                               
*  SAM_FONT -- SAM_FONT variable.                                               
*                                                                               
FNSAMFNT PROC                                                                   
         SETMSG CPSAMFONT                                                       
         IF    (CPSAMFONT,Z),'CLEAR R0'                                         
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         SPACE 2                                                                
*box                                                                            
*                                                                               
*  SAM_TYPE -- SAM_TYPE variable.                                               
*                                                                               
FNSAMTYP PROC  ,                                                                
         SETMSG CPSAMTYP                                                        
         IF    (CPSAMTYP,Z),'CLEAR R0'                                          
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         SPACE 2                                                                
*box                                                                            
*                                                                               
*  SAM_VERSION -- SAM_VERSION variable.                                         
*                                                                               
FNSAMVER PROC  ,                                                                
         SETMSG CPSAMVER                                                        
         IF    (CPSAMVER,Z),'CLEAR R0'                                          
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         SPACE 2                                                                
*box                                                                            
*                                                                               
*  SAMSON -- SAMSON variable.                                                   
*                                                                               
FNSAMSON PROC  ,                                                                
         IF    CPSFSAM,'VRETURN BOOLEAN,TRUE'                                   
         ELSE  'VRETURN BOOLEAN,FALSE'                                          
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*  SES_NUMBER --                                                                
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
*  NOTE:                                                                        
*  SESSION NUMBERS ARE NOT UNIQUE, THEY ARE NOT                                 
*  NEEDED BY WYLBUR THEY ARE GOING AWAY... SO BE                                
*  CAREFUL.  DO NOT USE UNLESS  YOU ARE WJB.                                    
*                                                                               
FNSESNUM PROC  ,                                                                
         L2    R3,CPSANO                                                        
         VRETURN INTEGER,(R3)                                                   
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  SES_TAG -- "Session tag".                                                    
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNSESTAG PROC  ,                                                                
         L     R3,CVCURJCB                                                      
         WITH  (JCB,R3)                                                         
         L     R2,JCBSINP                                                       
         WITH  (SIN,R2)                                                         
*                                                                               
         IF    (SIN,EQ,'SIN'),'SETMSG SINSTAG'                                  
         ELSE  'SETMSG "???"'                                                   
*                                                                               
         IF    (@R1,EQ,X'00'),'CLEAR R0'  (Nulls)                               
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  SKIP CHARACTER                                                               
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNSKIP   PROC  ,                                                                
         VRETURN STRING,CPSKIP                                                  
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  SOF -- Return source of funds and accounts receivable codes.                 
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNSOF    PROC  ,                                                                
         VRETURN STRING,CPSOF2                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  SUBGROUP                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNSUBGRO PROC  ,                   SUBGROUP IS SAME AS PROJECT ID               
         ACALL FNPROJ                                                           
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  SYSTEM                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNSYSTEM PROC  ,                                                                
         AIF   (&$PCODE).NEWSYS                                                 
         SETMSG 'MVS'               Assume MVS                                  
*                                                                               
         L     R2,CVTPTR                                                        
         WITH  (CVT,R2),BEGIN                                                   
         IF    CVTDCB.CVTMVSE,BEGIN  XA or ESA...                               
         SETMSG 'MVS/ESA'           Assume ESA                                  
         IF    (CVTDCB,EQ,X'93'),'SETMSG "MVS/XA"'  XA                          
         END                                                                    
         END                                                                    
         AGO   .ENDSYS                                                          
*                                                                               
.NEWSYS  ANOP                                                                   
         SETMSG 'UNIX'                                                          
         AGO   .ENDSYS                                                          
*                                                                               
.ENDSYS  ANOP                                                                   
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TCHARS - TERMINAL CHARACTER SET                                              
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTCHARS PROC  ,                                                                
         SETMSG CPSCHAR                                                         
         IF    (CPSCHAR,Z),'CLEAR R0'                                           
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TCLASS - TERMINAL CLASS                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTCLASS PROC  ,                                                                
         VRETURN STRING,CPSTCLS                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TERMINAL ID                                                                  
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTERM   PROC                                                                   
         VRETURN STRING,CPSTID                                                  
         VTRIM                                                                  
         PEND                                                                   
*box                                                                            
*                                                                               
*  THEIGHT -- Terminal (actual) height.                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTHEIGHT PROC                                                                  
         VRETURN INTEGER,LH:CPSHEI                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TIME                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTIME   PROC  ,                                                                
         XPUSH  ,,MAXSTRLN,PTR=R15                                              
         VCALL LOCALTOD                                                         
         VCALL FMTTIME             IN CR MODULE                                 
         VRETURN STRING,(R1),(R0)                                               
         XPOP  ,,MAXSTRLN                                                       
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TIMEBIN - NUMBER OF SECONDS SINCE MIDNIGHT                                   
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTIMEB  PROC  ,                                                                
         VCALL LOCALTOD                                                         
         VCALL TIMEDATE            IN CR MODULE                                 
         MH    R0,=H'10'                                                        
         VRETURN LINENO,(R0)                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TIMEBLOCK -- Returns the time-block (DAY, EVENING, NIGHT, etc.)              
*                                                                               
FNTMBLK  PROC  ,                                                                
         SETMSG '???'               Assume unknown time-block                   
         AIF   (&$PCODE).NOTMBLK                                                
         L     R2,CVTPTR           OS CVT                                       
         WITH  (CVT,R2),BEGIN                                                   
         LT    R3,CVTUSER          User CVT (aka SCIPCVT)                       
         IF    NZ,BEGIN                                                         
         WITH  (USERCVT,R3)                                                     
         IF    (USERCVT,NE,'SCIP'),EXIT                                         
         LC    R15,USEBLOCK        Time block                                   
         IF    (R15,Z),'SETMSG "DAY"'                                           
         IF    (R15,EQ,1),'SETMSG "EVENING"'                                    
         IF    (R15,EQ,2),'SETMSG "NIGHT"'                                      
         IF    (R15,EQ,3),'SETMSG "WEEKEND"'                                    
         IF    (R15,EQ,4),'SETMSG "PEAK"'                                       
         END                                                                    
         END                                                                    
.NOTMBLK ANOP                                                                   
         VRETURN STRING,(R1),(R0)                                               
*                                                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TMODEL =  MODEL/NOMODEL TERMINAL                                             
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTMODEL PROC  ,                                                                
         SETMSG 'NOMODEL'           ASSUME NOT MODEL TERMINAL                   
         IF    CPSFMOD,'SETMSG "MODEL"'      IF MODEL TERMINAL                  
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TQUIET                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTQUIET PROC  ,                                                                
         IF    CPSFQUIET,BEGIN                                                  
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TRUE                                                                         
*                                                                               
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTRUE   PROC  ,                                                                
         VRETURN BOOLEAN,TRUE                                                   
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TRYATTN                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTYATTN PROC  ,                                                                
         IF    CPFTATTN,BEGIN                                                   
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TRYERROR                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTYERR  PROC  ,                                                                
         IF    CPFTERR,BEGIN                                                    
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TRYID                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTYID   PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ERROR, RETURN TRYID                       
         IF    CPFTERR,BEGIN                                                    
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.TRYID       '                                       
         VCALL GETDATA                                                          
         IF    ((R15,NZ),OR,(R0,Z)),BEGIN                                       
         LA    R0,8                                                             
         LA    R1,=CL8'OK      '   DEFAULT IS "OK"                              
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ERROR, RETURN OK                       
         ELSE  BEGIN                                                            
         LA    R0,8                                                             
         LA    R1,=CL8'OK      '                                                
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TRYINFO                                                                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTYINFO PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ERROR/ATTN, RETURN INFO                   
         IF    (CPFTATTN,OR,CPFTERR),BEGIN                                      
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.TRYINFO     '                                       
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         CLEAR R0                                                               
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ERROR/ATTN, RETURN NULL                
         ELSE  BEGIN                                                            
         CLEAR R0                                                               
         CLEAR R1                                                               
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  TRYMSG                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTYMSG  PROC  FNWA                                                             
*                                                                               
         COMMENT                   IF ERROR, RETURN ERROR MSG                   
         IF    CPFTERR,BEGIN                                                    
         LA    R0,L'FNWORK                                                      
         LA    R1,FNWORK                                                        
         LA    R2,=CL16'SYS.TRYMSG      '                                       
         VCALL GETDATA                                                          
         IF    NZ,BEGIN                                                         
         CLEAR R0                                                               
         END                                                                    
         END                                                                    
*                                                                               
         COMMENT                   IF NO ERROR, RETURN NULL                     
         ELSE  BEGIN                                                            
         CLEAR R0                                                               
         CLEAR R1                                                               
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  TTYPE - TERMINAL TYPE                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTTYPE  PROC                                                                   
         VRETURN STRING,CPSTTYPE                                                
         VTRIM                                                                  
         PEND                                                                   
*box                                                                            
*                                                                               
*  TWIDTH -- Terminal (actual) width.                                           
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNTWIDTH PROC                                                                   
         VRETURN INTEGER,LH:CPSWID                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  USER                                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNUSER   PROC                                                                   
         VRETURN STRING,CPUSERSV                                                
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  USERID                                                                       
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNUID    PROC                                                                   
         VRETURN STRING,CPUID                                                   
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  USERID_LIST                                                                  
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNIDLWA  RECORD BEGIN                                                           
FNIDAREA DS    CL256               Work area                                    
         END                                                                    
*-                                                                              
FNUIDL   PROC  FNIDLWA                                                          
         LA    R15,CPSACCT                                                      
         SETMSG FNIDAREA            Put result here                             
         VCALL GETUIDL             Get IDLIST                                   
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VIEW_COLUMN Variable.                                                        
*                                                                               
FNVCOL   PROC                                                                   
         VRETURN INTEGER,LH:CPVCOL                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VIEW_HEIGHT Variable.                                                        
*                                                                               
FNVHEI   PROC  ,                                                                
         VRETURN INTEGER,LH:CPVHEI                                              
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VIEW_LINENO Variable.                                                        
*                                                                               
FNVLNO   PROC  ,                                                                
         VRETURN LINENO,L:CPVLNO                                                
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VIEW_NWIND Variable.                                                         
*                                                                               
FNVNWIND PROC  ,                                                                
         VRETURN INTEGER,LH:CPVWCNT                                             
         PEND                                                                   
*box                                                                            
*                                                                               
*  VIEW_WIDTH Variable.                                                         
*                                                                               
FNVWID   PROC  ,                                                                
         VRETURN INTEGER,LH:CPVWID                                              
         PEND                                                                   
*box                                                                            
*                                                                               
*  VIEW_WINDOW Variable.                                                        
*                                                                               
FNVWIND  PROC  ,                                                                
         VRETURN INTEGER,LH:CPVWCUR                                             
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VJOBNAME -- Return's the jobname of the virtual session                      
*    running this job.  I.e., returns a BATWYL job's jobname or                 
*    the null string if this is not a virtual session.                          
*                                                                               
FNVJWA   RECORD BEGIN                                                           
FNVJDATA DS    CL64                Work area for HASPSERV info                  
         END                                                                    
*-                                                                              
FNVJOB   PROC  FNVJWA                                                           
         LT    R15,CPSASCBP        Get virtual job's ASCB ptr                   
         IF    Z,'CLEAR R0,R1'     Not a virtual job                            
*                                                                               
         ELSE  BEGIN               Go try to get jobname...                     
         HASPSERV JOBNAME,FNVJDATA,ASCB=(R15)  Get jobname                      
         IF    (R15,Z),'SETMSG FNVJDATA,8'  Jobname                             
         ELSE  'CLEAR R0,R1'       Not available                                
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)  Jobname                                      
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VJOBNO -- Return's the jobno of the virtual session                          
*    running this job.  I.e., returns a BATWYL job's jobno or                   
*    the null string if this is not a virtual session.                          
*                                                                               
FNVJNWA  RECORD BEGIN                                                           
FNVJNW   DS    CL64                Work area for HASPSERV info                  
         END                                                                    
*-                                                                              
FNVJOBNO PROC  FNVJNWA                                                          
         LT    R15,CPSASCBP        Get virtual job's ASCB ptr                   
         IF    Z,'CLEAR R0,R1'     Not a virtual job                            
*                                                                               
         ELSE  BEGIN               Go try to get jobno...                       
         HASPSERV JOBINFO,FNVJNW,ASCB=(R15)  Get jobno                          
         IF    (R15,Z),'SETMSG FNVJNW,4'  Job number                            
         ELSE  'CLEAR R0,R1'       Not available                                
         END                                                                    
*                                                                               
         VRETURN STRING,(R1),(R0)  Job number                                   
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VLOGON -- True if VLOGONs are allowed from this WYLBUR.                      
*                                                                               
FNVLOGON PROC                                                                   
         VCALL VLOGCHK             Are VLOGONs allowed?                         
         IF    Z,'VRETURN BOOLEAN,TRUE'                                         
         ELSE  'VRETURN BOOLEAN,FALSE'                                          
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
*box                                                                            
*                                                                               
*  VOLUME                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNVOLUME PROC                                                                   
         VRETURN STRING,CPVOLUME                                                
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  VSESSION -- True if we have a VLOGON session currently active.               
*                                                                               
FNVSESS  PROC                                                                   
         VCALL VSESCHK             Is a VLOGON session going now?               
         IF    Z,'VRETURN BOOLEAN,FALSE'                                        
         ELSE  'VRETURN BOOLEAN,TRUE'                                           
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  WARN - WARNING COUNT                                                         
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNWARN   PROC  ,                                                                
         VRETURN INTEGER,LH:CPWRNCNT                                            
         PEND                                                                   
         SPACE 2                                                                
*box                                                                            
*                                                                               
*  WCHARGE -- Value of charge component.                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNWCHG   PROC  ,                                                                
         SETMSG CPWCHAR             WCHARGE component name                      
         IF    (CPWCHAR,Z),'CLEAR R0'  Not set                                  
         VRETURN STRING,(R1),(R0)                                               
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  WFDEF - Wylbur default file access mode (see SET WFDEF).                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
*                                                                               
FNWFDEF  PROC  ,                                                                
*                                                                               
         COMMENT                   OUTPUT TYPE INFO                             
         SETMSG 'OLDIBM'                                                        
         IF    CVFWINGS,' SETMSG "WINGS" '                                      
         IF    CVFOLDIBM,' SETMSG "OLDIBM" '                                    
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND  ,                                                                
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  WIDTH - TERMINAL WIDTH                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNWIDTH  PROC  ,                                                                
         VRETURN INTEGER,LH:CPSWID                                              
         PEND                                                                   
*                                                                               
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*  WPROJECT                                                                     
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNWPROJ  PROC  ,                                                                
         VRETURN STRING,CPWPROJ                                                 
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  WYLBUR - CURRENT WYLBUR SUBSYSTEM                                            
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNWYLBUR PROC  ,                                                                
         VRETURN STRING,CVWYLSSN                                                
         VTRIM                                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  WYLBUR_CPU variable.                                                         
*                                                                               
FNWYLCPU PROC  ,                                                                
         LA    R15,=CL16'WYLBUR_CPU'                                            
         VCALL GETCTOT             Get WYLBUR cpu in .001 sec                   
         VRETURN LINENO,(R15)                                                   
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  WYLBUR_IO variable.                                                          
*                                                                               
FNWYLIO  PROC  ,                                                                
         LA    R15,=CL16'WYLBUR_IO'                                             
         VCALL GETCTOT             Get WYLBUR disk I/O count                    
         VRETURN INTEGER,(R15)                                                  
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  XACCOUNT - Returns ACCOUNT in "GG.UUU" format.                               
*                                                                               
*    For compatibility reasons the ACCOUNT function returns the                 
*    account in UUU$GG format.  New exec should use XACCOUNT instead            
*    of account.                                                                
*                                                                               
*    See comments at the start of this module.                                  
*                                                                               
FNXACC   PROC  ,                                                                
         WITH  (VNENTRY,R6)                                                     
         CLEAR VNENTRY                                                          
         SET   VNSTRING                                                         
         CLEAR VNSTRLEN            Assume no account                            
*                                                                               
         IF    (CPSACCT,NZ),BEGIN  Return account...                            
         MVC   VNSTRLEN,=H'6'                                                   
         MVC   VNSTRLOC(2),CPSGRP                                               
         MVI   VNSTRLOC+2,C'.'                                                  
         MVC   VNSTRLOC+3(3),CPSUSER                                            
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  XAUTH                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNXAUTH  PROC  ,                                                                
         IF    CPFXAUTH,BEGIN                                                   
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  XCOMMAND - Returns pending command.                                          
*                                                                               
*  See comments at the start of this module.                                    
*                                                                               
FNXCMD   PROC  ,                                                                
*                                                                               
         LT    R2,CPXCMDP                                                       
         IF    Z,'CLEAR R1,R0'     No pending command                           
         ELSE  'SETMSG LA:@R2+2,LH:@R2'                                         
*                                                                               
         VRETURN STRING,(R1),(R0)                                               
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  XDATE - ARPA FORMAT TIME STAMP                                               
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNXDATE  PROC  ,                                                                
         XPUSH  ,,MAXSTRLN,PTR=R15                                              
         VCALL LOCALTOD                                                         
         VCALL FMTXDATE            IN CR MODULE                                 
         MVC   12(15,R1),14(R1)    Squeeze out century                          
         S     R0,=F'2'                                                         
         VRETURN STRING,(R1),(R0)                                               
         XPOP  ,,MAXSTRLN                                                       
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  XDATEF - ARPA FORMAT TIME STAMP WITH CENTURY                                 
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNXDATEF PROC  ,                                                                
         XPUSH  ,,MAXSTRLN,PTR=R15                                              
         VCALL LOCALTOD                                                         
         VCALL FMTXDATE           IN CR MODULE                                  
         VRETURN STRING,(R1),(R0)                                               
         XPOP  ,,MAXSTRLN                                                       
         PEND                                                                   
         QLTORG                                                                 
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  XDUMP                                                                        
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNXDUMP  PROC  ,                                                                
         IF    CPFXDUMP,BEGIN                                                   
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*  XLINE -- Return the Milten line number of this session.                      
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNXLINE  PROC  ,                                                                
         L     R5,CVCURJCB                                                      
         WITH  (JCB,R5)                                                         
         VRETURN INTEGER,LH:JCBSEQ  Milten line number                          
         PEND                                                                   
         EJECT                                                                  
*box                                                                            
*                                                                               
*                                                                               
*  XQUIET                                                                       
*                                                                               
*  SEE COMMENTS AT START OF THIS MODULE                                         
*                                                                               
FNXQUIET PROC  ,                                                                
         IF    CPFXQT,BEGIN                                                     
         VRETURN BOOLEAN,TRUE                                                   
         END                                                                    
         ELSE  BEGIN                                                            
         VRETURN BOOLEAN,FALSE                                                  
         END                                                                    
         PEND                                                                   
         QLTORG                                                                 
*                                                                               
         VLTORG                                                                 
         END   .                                                                
