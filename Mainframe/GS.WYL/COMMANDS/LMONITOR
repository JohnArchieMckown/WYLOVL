;
;;  LMONITOR -- This is the LMONITOR command.
;;
;;  The command displays the terminal I/O trace from a MILTEN session.
;;
;;  Command syntax is:
;;    show ltrace [line-number|name] [collect options]
;;
;;
;;  Created, 05/91, Jim Nisbet
;;
;;  Modifications:
;;     5/25/91  Niz     Initial version.
;

xproc () begin
   ;
   ;  General initialization.
   ;
   x.origact = actno
   x.attn = 0                      ; attn counter (see attnexit)
   x.noattn = false                ; allow ATTNs

   x.pgm = 'LMONITOR'              ; our program name
   x.maint = '(gg.jdn)'            ; maintenance people

   on error cmd 'pcall errorexit'
   on attn  cmd 'pcall attnexit'

   opts = parm_string
   token = ''
   toktype = ''
   syscall scan_parm(token, opts, toktype)
   if (toktype ne 'NUMBER') begin
      if (token ne '') trace_opts = 'like ' || token || ' ' || opts
      else trace_opts = ''
   end
   else trace_opts = token || ' ' || opts

   ;
   ;  Do the SHOW LTRACE command.
   ;
   xreturn cmd show ltrace monitor &(trace_opts)
end


; <.page>
;
;  attnexit -- Attention exit routine.
;

proc attnexit() begin
   if (not x.noattn) begin
      x.attn = x.attn + 1
      write 'BREAK interrupted the ' || x.pgm || ' command.'
      xreturn attn
   end
end



;
;  errorexit -- Routine to handle an error in the exec.
;    Right now all we do is log the error information.
;

proc errorexit() begin
   write '----'
   write 'An error occurred in the ' || x.pgm || ' command.'
   write ''
   write 'Debugging information:'
   write '   errmsg: '||errmsg
   write '  errinfo: '||errinfo

   write ''
   write '--> show vars type error'
   try show vars type error

   write ''
   write '--> show vars type x'
   try show vars type error

   write ''
   write '--> show vars type ses'
   try show vars type error

   write ''
   write 'End of diagnostics.'

   xreturn error
end
