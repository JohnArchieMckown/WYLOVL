;
;;  _ERROR -- Error exit subroutine.
;;
;;    Something bad has happened, write out some diagnostic
;;    messages, send mail to the maintenance people and scram.
;

xproc (pgm, maint, eid, emsg, einfo) begin
   write ''
   write '-----'
   write 'An error occurred in the ' || pgm || ' command.'
   write 'The programming staff will be notified.'
   write ''
   write 'Debugging information:'
   write '   errmsg: '||emsg
   write '  errinfo: '||einfo

;  Mail debugging information to maintenance people.

   open errors
   putend An error occurred in the &(pgm) command.
   putend
   putend Debugging information:
   putend
   dump xdate
   dump account
   putend errid = &(eid)
   putend errmsg = &(emsg)
   putend errinfo = &(einfo)
   putend
   putend ---
   putend
   putend >>> show vars type ses
   dump vars type ses
   putend
;; putend >>> show vars type x
;; dump vars type x
;; putend
   putend >>> show vars type error  ; local vars at time of error
   dump vars type error
   putend
   putend End of dump.

   try quietly mail to &(maint) title '&(pgm) error'
   close

   xreturn cmd=pcall cleanup('error')
end
